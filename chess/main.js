"use strict";(()=>{const D=function(){if("undefined"==typeof window)return null;const a={};ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer}),"undefined"==typeof globalThis&&"undefined"!=typeof window&&(window.globalThis=window);var s=function(e,t){return s=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}),s(e,t)};function e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function d(e,r,a,h){return new(a=a||Promise)(function(i,t){function s(e){try{o(h.next(e))}catch(e){t(e)}}function n(e){try{o(h.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,(t instanceof a?t:new a(function(e){e(t)})).then(s,n))}o((h=h.apply(e,r||[])).next())})}function c(s,n){var o,r,a,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(i){return function(e){var t=[i,e];if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return h.label++,{value:t[1],done:!1};case 5:h.label++,r=t[1],t=[0];continue;case 7:t=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=0<a.length&&a[a.length-1])&&(6===t[0]||2===t[0])){h=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3]))h.label=t[1];else if(6===t[0]&&h.label<a[1])h.label=a[1],a=t;else{if(!(a&&h.label<a[2])){a[2]&&h.ops.pop(),h.trys.pop();continue}h.label=a[2],h.ops.push(t)}}t=n.call(s,h)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}}function h(e,t){t.statusMessage=e.statusText,t.statusCode=e.status,t.data=e.body}function t(e,t,n){n=n||{};var o,i,r=n.body;return n.method=e,n.headers=n.headers||{},r instanceof FormData||r&&"object"==typeof r&&(n.headers["content-type"]="application/json",n.body=JSON.stringify(r)),n.withCredentials&&(n.credentials="include"),n.timeout&&(i=new AbortController,n.signal=i.signal,o=setTimeout(i.abort,n.timeout)),new Promise((e,s)=>{fetch(t,n).then((t,i)=>{clearTimeout(o),h(t,t),i=400<=t.status?s:e,r=t.headers.get("content-type"),r&&~r.indexOf("application/json")?t.text().then(e=>{try{t.data=JSON.parse(e,n.reviver),i(t)}catch(e){e.headers=t.headers,h(t,e),s(e)}}):i(t)}).catch(e=>{e.timeout=i&&i.signal.aborted,s(e)})})}var i,n=t.bind(t,"GET"),o=t.bind(t,"POST"),r=t.bind(t,"PATCH"),l=t.bind(t,"DELETE"),u=t.bind(t,"PUT"),p=n,n=r,m=o,r=u,o=t,u={del:l,get:p,patch:n,post:m,put:r,send:o},D=Object.freeze(Object.assign(Object.create(null),u,{default:u,del:l,get:p,patch:n,post:m,put:r,send:o})),I=(i=Error,e(g,i),g);function g(e,t){t=i.call(this,t)||this;return t.name="ServerError",t.code=e,t}function f(e,t){if(this._offset=t,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}function v(e,t,i){var s,n=typeof i,o=0,r=0,a=0,h=0,l=0;if("string"==n){if(h=function(e){for(var t,i=0,s=0,n=e.length;s<n;s++)t=e.charCodeAt(s),t<128?i+=1:t<2048?i+=2:t<55296||57344<=t?i+=3:(s++,i+=4);return i}(i),h<32)e.push(160|h),l=1;else if(h<256)e.push(217,h),l=2;else if(h<65536)e.push(218,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("String too long");e.push(219,h>>24,h>>16,h>>8,h),l=5}return t.push({_str:i,_length:h,_offset:e.length}),l+h}if("number"==n)return Math.floor(i)===i&&isFinite(i)?0<=i?i<128?(e.push(i),1):i<256?(e.push(204,i),2):i<65536?(e.push(205,i>>8,i),3):i<4294967296?(e.push(206,i>>24,i>>16,i>>8,i),5):(r=i/Math.pow(2,32)>>0,a=i>>>0,e.push(207,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),9):-32<=i?(e.push(i),1):-128<=i?(e.push(208,i),2):-32768<=i?(e.push(209,i>>8,i),3):-2147483648<=i?(e.push(210,i>>24,i>>16,i>>8,i),5):(r=Math.floor(i/Math.pow(2,32)),a=i>>>0,e.push(211,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),9):(e.push(203),t.push({_float:i,_length:8,_offset:e.length}),9);if("object"==n){if(null===i)return e.push(192),1;if(Array.isArray(i)){if(h=i.length,h<16)e.push(144|h),l=1;else if(h<65536)e.push(220,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Array too large");e.push(221,h>>24,h>>16,h>>8,h),l=5}for(o=0;o<h;o++)l+=v(e,t,i[o])}else{if(i instanceof Date)return s=i.getTime(),r=Math.floor(s/Math.pow(2,32)),a=s>>>0,e.push(215,0,r>>24,r>>16,r>>8,r,a>>24,a>>16,a>>8,a),10;if(i instanceof ArrayBuffer){if(h=i.byteLength,h<256)e.push(196,h),l=2;else if(h<65536)e.push(197,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Buffer too large");e.push(198,h>>24,h>>16,h>>8,h),l=5}return t.push({_bin:i,_length:h,_offset:e.length}),l+h}if("function"==typeof i.toJSON)return v(e,t,i.toJSON());for(var d=[],c="",u=Object.keys(i),o=0,p=u.length;o<p;o++)c=u[o],"function"!=typeof i[c]&&d.push(c);if(h=d.length,h<16)e.push(128|h),l=1;else if(h<65536)e.push(222,h>>8,h),l=3;else{if(!(h<4294967296))throw new Error("Object too large");e.push(223,h>>24,h>>16,h>>8,h),l=5}for(o=0;o<h;o++)c=d[o],l+=v(e,t,c),l+=v(e,t,i[c])}return l}if("boolean"==n)return e.push(i?195:194),1;if("undefined"==n)return e.push(212,0,0),3;throw new Error("Could not encode")}f.prototype._array=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=this._parse();return t},f.prototype._map=function(e){for(var t,i={},s=0;s<e;s++)t=this._parse(),i[t]=this._parse();return i},f.prototype._str=function(e){var t=function(e,t,i){for(var s="",n=0,o=t,r=t+i;o<r;o++){var a=e.getUint8(o);if(0==(128&a))s+=String.fromCharCode(a);else if(192==(224&a))s+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else if(224==(240&a))s+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else{if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));n=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0,65536<=n?(n-=65536,s+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):s+=String.fromCharCode(n)}}return s}(this._view,this._offset,e);return this._offset+=e,t},f.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},f.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),i=0,s=0,n=0,o=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(223<t)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:return i=this._view.getUint8(this._offset),s=this._view.getInt8(this._offset+1),this._offset+=2,[s,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),s=this._view.getInt8(this._offset+2),this._offset+=3,[s,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),s=this._view.getInt8(this._offset+4),this._offset+=5,[s,this._bin(i)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return n=this._view.getUint32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,n+o;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return n=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,n+o;case 212:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?void(this._offset+=1):[s,this._bin(1)];case 213:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(2)];case 214:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(4)];case 215:return s=this._view.getInt8(this._offset),this._offset+=1,0===s?(n=this._view.getInt32(this._offset)*Math.pow(2,32),o=this._view.getUint32(this._offset+4),this._offset+=8,new Date(n+o)):[s,this._bin(8)];case 216:return s=this._view.getInt8(this._offset),this._offset+=1,[s,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")};var G=globalThis.WebSocket||function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},N=(_.prototype.send=function(e){e instanceof ArrayBuffer?this.ws.send(e):Array.isArray(e)&&this.ws.send(new Uint8Array(e).buffer)},_.prototype.connect=function(e){this.ws=new G(e,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror},_.prototype.close=function(e,t){this.ws.close(e,t)},_);function _(e){this.events=e}w.prototype.send=function(e){this.transport.send(e)},w.prototype.connect=function(e){this.transport.connect(e)},w.prototype.close=function(e,t){this.transport.close(e,t)};var z=w;function w(){this.events={},this.transport=new N(this.events)}var y={};function b(e,t){y[e]=t}function k(e){var t=y[e];if(t)return t;throw new Error("missing serializer: "+e)}a.Protocol=void 0,u=a.Protocol||(a.Protocol={}),u[u.HANDSHAKE=9]="HANDSHAKE",u[u.JOIN_ROOM=10]="JOIN_ROOM",u[u.ERROR=11]="ERROR",u[u.LEAVE_ROOM=12]="LEAVE_ROOM",u[u.ROOM_DATA=13]="ROOM_DATA",u[u.ROOM_STATE=14]="ROOM_STATE",u[u.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",u[u.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",a.ErrorCode=void 0,l=a.ErrorCode||(a.ErrorCode={}),l[l.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",l[l.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",l[l.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",l[l.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",l[l.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",l[l.AUTH_FAILED=4215]="AUTH_FAILED",l[l.APPLICATION_ERROR=4216]="APPLICATION_ERROR";x.prototype.register=function(e,t){return this.handlers.push(e),this},x.prototype.invoke=function(){for(var t=this,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this.handlers.forEach(function(e){return e.apply(t,i)})},x.prototype.invokeAsync=function(){for(var t=this,i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];return Promise.all(this.handlers.map(function(e){return e.apply(t,i)}))},x.prototype.remove=function(e){e=this.handlers.indexOf(e);this.handlers[e]=this.handlers[this.handlers.length-1],this.handlers.pop()},x.prototype.clear=function(){this.handlers=[]};var H=x;function x(){this.handlers=[]}function S(){var n=new H;function e(e){return n.register(e,null===this)}return e.once=function(i){var s=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(this,e),n.remove(s)};n.register(s)},e.remove=function(e){return n.remove(e)},e.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.invoke.apply(n,e)},e.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.invokeAsync.apply(n,e)},e.clear=function(){return n.clear()},e}n=function(S,e){function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}m(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}function i(e,t,i,s){var n,o=arguments.length,r=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;0<=a;a--)(n=e[a])&&(r=(o<3?n(r):3<o?n(t,i,r):n(t,i))||r);3<o&&r&&Object.defineProperty(t,i,r)}function h(e,t){for(var i=0,s=t.length,n=e.length;i<s;i++,n++)e[n]=t[i];return e}function T(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"==typeof t||isNaN(t)?e[t]:e.at(t)},set:function(e,t,i){var s;return"symbol"==typeof t||isNaN(t)?e[t]=i:(s=Array.from(e.$items.keys()),s=parseInt(s[t]||t),null==i?e.deleteAt(s):e.setAt(s,i)),!0},deleteProperty:function(e,t){return"number"==typeof t?e.deleteAt(t):delete e[t],!0}}),e}function G(e){return e.$proxy=!0,e=new Proxy(e,{get:function(e,t){return"symbol"!=typeof t&&void 0===e[t]?e.get(t):e[t]},set:function(e,t,i){return"symbol"!=typeof t&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,i):e[t]=i,!0},deleteProperty:function(e,t){return e.delete(t),!0}}),e}function t(e,t){ie[e]=t}function F(e){return ie[e]}function d(r,a){return void 0===a&&(a=se),function(t,i){var t=t.constructor,e=(t._context=a,a.has(t)||a.add(t),t._definition);if(e.addField(i,r),e.descriptors[i]){if(e.deprecated[i])return;try{throw new Error("@colyseus/schema: Duplicate '"+i+"' definition on '"+t.name+"'.\nCheck @type() annotation")}catch(e){t=e.stack.split("\n")[4].trim();throw new Error(e.message+" "+t)}}var s=M.is(r),n=!s&&L.is(r),o=("string"==typeof r||v.is(r)||(t=Object.values(r)[0],"string"==typeof t)||a.has(t)||a.add(t),"_"+i);e.descriptors[o]={enumerable:!1,configurable:!1,writable:!0},e.descriptors[i]={get:function(){return this[o]},set:function(e){e!==this[o]&&(null!=e?(!s||e instanceof M||(e=new(M.bind.apply(M,h([void 0],e)))),!n||e instanceof L||(e=new L(e)),void 0===e.$proxy&&(n?e=G(e):s&&(e=T(e))),this.$changes.change(i),e.$changes&&e.$changes.setParent(this,this.$changes.root,this._definition.indexes[i])):this.$changes.delete(i),this[o]=e)},enumerable:!0,configurable:!0}}}function N(e,t,i){for(var s,n=0,o=i.length;n<o;n++)s=i.charCodeAt(n),s<128?e[t++]=s:(s<2048?e[t++]=192|s>>6:(s<55296||57344<=s?e[t++]=224|s>>12:(n++,s=65536+((1023&s)<<10|1023&i.charCodeAt(n)),e[t++]=240|s>>18,e[t++]=128|s>>12&63),e[t++]=128|s>>6&63),e[t++]=128|63&s)}function z(e,t){e.push(255&t)}function C(e,t){e.push(255&t)}function H(e,t){e.push(255&t),e.push(t>>8&255)}function n(e,t){e.push(255&t),e.push(t>>8&255)}function s(e,t){e.push(255&t),e.push(t>>8&255),e.push(t>>16&255),e.push(t>>24&255)}function o(e,t){var i=t>>24,s=t>>16,n=t>>8;e.push(255&t),e.push(255&n),e.push(255&s),e.push(255&i)}function U(e,t){var i=Math.floor(t/Math.pow(2,32)),t=t>>>0;o(e,t),o(e,i)}function $(e,t){var i=t/Math.pow(2,32)>>0,t=t>>>0;o(e,t),o(e,i)}function q(e,t){ne[0]=t,s(e,w[0])}function r(e,t){oe[0]=t,s(e,w[0]),s(e,w[1])}function P(e,t){t=t||"";var i=function(e){for(var t,i=0,s=0,n=e.length;s<n;s++)t=e.charCodeAt(s),t<128?i+=1:t<2048?i+=2:t<55296||57344<=t?i+=3:(s++,i+=4);return i}(t),s=0;if(i<32)e.push(160|i),s=1;else if(i<256)e.push(217),C(e,i),s=2;else if(i<65536)e.push(218),n(e,i),s=3;else{if(!(i<4294967296))throw new Error("String too long");e.push(219),o(e,i),s=5}return N(e,e.length,t),s+i}function B(e,t){return isNaN(t)?B(e,0):isFinite(t)?t!==(0|t)?(e.push(203),r(e,t),9):0<=t?t<128?(C(e,t),1):t<256?(e.push(204),C(e,t),2):t<65536?(e.push(205),n(e,t),3):t<4294967296?(e.push(206),o(e,t),5):(e.push(207),$(e,t),9):-32<=t?(e.push(224|t+32),1):-128<=t?(e.push(208),z(e,t),2):-32768<=t?(e.push(209),H(e,t),3):-2147483648<=t?(e.push(210),s(e,t),5):(e.push(211),U(e,t),9):B(e,0<t?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}function W(e,t){return a(e,t)<<24>>24}function a(e,t){return e[t.offset++]}function j(e,t){return c(e,t)<<16>>16}function c(e,t){return e[t.offset++]|e[t.offset++]<<8}function u(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}function p(e,t){return u(e,t)>>>0}function V(e,t){var i=p(e,t),e=u(e,t)*Math.pow(2,32);return e+i}function Y(e,t){var i=p(e,t),e=p(e,t)*Math.pow(2,32);return e+i}function X(e,t){return y[0]=u(e,t),re[0]}function J(e,t){return y[0]=u(e,t),y[1]=u(e,t),ae[0]}function K(e,t){var i,s=e[t.offset++],s=(s<192?i=31&s:217===s?i=a(e,t):218===s?i=c(e,t):219===s&&(i=p(e,t)),function(e,t,i){for(var s="",n=0,o=t,r=t+i;o<r;o++){var a=e[o];0==(128&a)?s+=String.fromCharCode(a):192==(224&a)?s+=String.fromCharCode((31&a)<<6|63&e[++o]):224==(240&a)?s+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0):240==(248&a)?(n=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0,65536<=n?(n-=65536,s+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):s+=String.fromCharCode(n)):console.error("Invalid byte "+a.toString(16))}return s}(e,t.offset,i));return t.offset+=i,s}function A(e,t){var i=e[t.offset++];return i<128?i:202===i?X(e,t):203===i?J(e,t):204===i?a(e,t):205===i?c(e,t):206===i?p(e,t):207===i?Y(e,t):208===i?W(e,t):209===i?j(e,t):210===i?u(e,t):211===i?V(e,t):223<i?-1*(255-i+1):void 0}function Q(e,t){return 255===e[t.offset-1]&&(e[t.offset]<128||202<=e[t.offset]&&e[t.offset]<=211)}function Z(e,t,i,s){if(!(e instanceof t))throw new I("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+i.constructor.name+"#"+s)}var E,m,ee,g,te,M,L,ie,f,_,se,w,ne,oe,O,y,re,ae,he,R,D,le,de,I,v,b,k,x;E=e,m=function(e,t){return m=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(e,t){e.__proto__=t}:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}),m(e,t)},E.OPERATION=void 0,e=E.OPERATION||(E.OPERATION={}),e[e.ADD=128]="ADD",e[e.REPLACE=0]="REPLACE",e[e.DELETE=64]="DELETE",e[e.DELETE_AND_ADD=192]="DELETE_AND_ADD",e[e.TOUCH=1]="TOUCH",e[e.CLEAR=10]="CLEAR",ee=function(){function e(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return e.prototype.getNextUniqueId=function(){return this.nextUniqueId++},e.prototype.addRef=function(e,t,i){void 0===i&&(i=!0),this.refs.set(e,t),i&&(this.refCounts[e]=(this.refCounts[e]||0)+1)},e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1,this.deletedRefs.add(e)},e.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},e.prototype.garbageCollectDeletedRefs=function(){var n=this;this.deletedRefs.forEach(function(e){if(n.refCounts[e]<=0){var t=n.refs.get(e);if(t instanceof v)for(var i in t._definition.schema)"string"!=typeof t._definition.schema[i]&&t[i]&&t[i].$changes&&n.removeRef(t[i].$changes.refId);else{var s=t.$changes.parent._definition,s=s.schema[s.fieldsByIndex[t.$changes.parentIndex]];"function"==typeof Object.values(s)[0]&&Array.from(t.values()).forEach(function(e){return n.removeRef(e.$changes.refId)})}n.refs.delete(e),delete n.refCounts[e]}}),this.deletedRefs.clear()},e}(),g=function(){function e(e,t,i){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=e,this.setParent(t,i)}return e.prototype.setParent=function(e,t,i){var s=this;if(this.indexes||(this.indexes=this.ref instanceof v?this.ref._definition.indexes:{}),this.parent=e,this.parentIndex=i,t)if(this.root=t,this.ref instanceof v){var n,o=this.ref._definition;for(n in o.schema){var r,a=this.ref[n];a&&a.$changes&&(r=o.indexes[n],a.$changes.setParent(this.ref,t,r))}}else"object"==typeof this.ref&&this.ref.forEach(function(e,t){e instanceof v&&(e=e.$changes,t=s.ref.$changes.indexes[t],e.setParent(s.ref,s.root,t))})},e.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)},e.prototype.change=function(e,t){void 0===t&&(t=E.OPERATION.ADD);var i="number"==typeof e?e:this.indexes[e],e=(this.assertValidIndex(i,e),this.changes.get(i));e&&e.op!==E.OPERATION.DELETE&&e.op!==E.OPERATION.TOUCH||this.changes.set(i,{op:e&&e.op===E.OPERATION.DELETE?E.OPERATION.DELETE_AND_ADD:t,index:i}),this.allChanges.add(i),this.changed=!0,this.touchParents()},e.prototype.touch=function(e){var t="number"==typeof e?e:this.indexes[e];this.assertValidIndex(t,e),this.changes.has(t)||this.changes.set(t,{op:E.OPERATION.TOUCH,index:t}),this.allChanges.add(t),this.touchParents()},e.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},e.prototype.getType=function(e){var t;return this.ref._definition?(t=this.ref._definition,t.schema[t.fieldsByIndex[e]]):(t=this.parent._definition,e=t.schema[t.fieldsByIndex[this.parentIndex]],Object.values(e)[0])},e.prototype.getChildrenFilter=function(){var e=this.parent._definition.childFilters;return e&&e[this.parentIndex]},e.prototype.getValue=function(e){return this.ref.getByIndex(e)},e.prototype.delete=function(e){var t="number"==typeof e?e:this.indexes[e];void 0===t?console.warn("@colyseus/schema "+this.ref.constructor.name+": trying to delete non-existing index: "+e+" ("+t+")"):(e=this.getValue(t),this.changes.set(t,{op:E.OPERATION.DELETE,index:t}),this.allChanges.delete(t),delete this.caches[t],e&&e.$changes&&(e.$changes.parent=void 0),this.changed=!0,this.touchParents())},e.prototype.discard=function(e,t){var i=this;void 0===e&&(e=!1),void 0===t&&(t=!1),this.ref instanceof v||this.changes.forEach(function(e){e.op===E.OPERATION.DELETE&&(e=i.ref.getIndex(e.index),delete i.indexes[e])}),this.changes.clear(),this.changed=e,t&&this.allChanges.clear(),this.currentCustomOperation=0},e.prototype.discardAll=function(){var t=this;this.changes.forEach(function(e){e=t.getValue(e.index);e&&e.$changes&&e.$changes.discardAll()}),this.discard()},e.prototype.cache=function(e,t){this.caches[e]=t},e.prototype.clone=function(){return new e(this.ref,this.parent,this.root)},e.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},e.prototype.assertValidIndex=function(e,t){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+t+'"')},e}(),te=function(e,t){e=e.toString(),t=t.toString();return e<t?-1:t<e?1:0},M=function(){function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,e)}return s.is=function(e){return Array.isArray(e)},Object.defineProperty(s.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:!1,configurable:!0}),s.prototype.push=function(){for(var t,i=this,e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];return e.forEach(function(e){t=i.$refId++,i.setAt(t,e)}),t},s.prototype.pop=function(){var e,t=Array.from(this.$indexes.values()).pop();if(void 0!==t)return this.$changes.delete(t),this.$indexes.delete(t),e=this.$items.get(t),this.$items.delete(t),e},s.prototype.at=function(e){e=Array.from(this.$items.keys())[e];return this.$items.get(e)},s.prototype.setAt=function(e,t){void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,e);var i=null!=(i=null==(i=this.$changes.indexes[e])?void 0:i.op)?i:E.OPERATION.ADD;this.$changes.indexes[e]=e,this.$indexes.set(e,e),this.$items.set(e,t),this.$changes.change(e,i)},s.prototype.deleteAt=function(e){e=Array.from(this.$items.keys())[e];return void 0!==e&&this.$deleteAt(e)},s.prototype.$deleteAt=function(e){return this.$changes.delete(e),this.$indexes.delete(e),this.$items.delete(e)},s.prototype.clear=function(e){var t=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){t.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},s.prototype.concat=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return new(s.bind.apply(s,h([void 0],(e=Array.from(this.$items.values())).concat.apply(e,t))))},s.prototype.join=function(e){return Array.from(this.$items.values()).join(e)},s.prototype.reverse=function(){var i=this,s=Array.from(this.$items.keys()),e=Array.from(this.$items.values()).reverse();return e.forEach(function(e,t){i.setAt(s[t],e)}),this},s.prototype.shift=function(){var e,t=Array.from(this.$items.keys()),t=t.shift();if(void 0!==t)return e=this.$items.get(t),this.$deleteAt(t),e},s.prototype.slice=function(e,t){return new(s.bind.apply(s,h([void 0],Array.from(this.$items.values()).slice(e,t))))},s.prototype.sort=function(e){var i=this,s=(void 0===e&&(e=te),Array.from(this.$items.keys())),e=Array.from(this.$items.values()).sort(e);return e.forEach(function(e,t){i.setAt(s[t],e)}),this},s.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var i=2;i<arguments.length;i++)i-2,0;for(var s=Array.from(this.$items.keys()),n=[],o=e;o<e+t;o++)n.push(this.$items.get(s[o])),this.$deleteAt(s[o]);return n},s.prototype.unshift=function(){for(var i=this,e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var s=this.length,n=e.length,o=Array.from(this.$items.values());return e.forEach(function(e,t){i.setAt(t,e)}),o.forEach(function(e,t){i.setAt(n+t,e)}),s+n},s.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)},s.prototype.lastIndexOf=function(e,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(e,t)},s.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)},s.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)},s.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)},s.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)},s.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)},s.prototype.reduce=function(e,t){return Array.from(this.$items.values()).reduce(e,t)},s.prototype.reduceRight=function(e,t){return Array.from(this.$items.values()).reduceRight(e,t)},s.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)},s.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)},s.prototype.fill=function(e,t,i){throw new Error("ArraySchema#fill() not implemented")},s.prototype.copyWithin=function(e,t,i){throw new Error("ArraySchema#copyWithin() not implemented")},s.prototype.toString=function(){return this.$items.toString()},s.prototype.toLocaleString=function(){return this.$items.toLocaleString()},s.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},s.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()},s.prototype.entries=function(){return this.$items.entries()},s.prototype.keys=function(){return this.$items.keys()},s.prototype.values=function(){return this.$items.values()},s.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)},s.prototype.flatMap=function(e,t){throw new Error("ArraySchema#flatMap() is not supported.")},s.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")},s.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},s.prototype.getIndex=function(e){return this.$indexes.get(e)},s.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},s.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},s.prototype.toArray=function(){return Array.from(this.$items.values())},s.prototype.toJSON=function(){return this.toArray().map(function(e){return"function"==typeof e.toJSON?e.toJSON():e})},s.prototype.clone=function(e){e=new(e?s.bind.apply(s,h([void 0],Array.from(this.$items.values()))):s.bind.apply(s,h([void 0],this.map(function(e){return e.$changes?e.clone():e}))));return e},s.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},s}(),L=function(){function t(e){var i=this;if(this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e)if(e instanceof Map)e.forEach(function(e,t){return i.set(t,e)});else for(var t in e)this.set(t,e[t])}return t.is=function(e){return void 0!==e.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),t.prototype.set=function(e,t){if(null==t)throw new Error("MapSchema#set('"+e+"', "+t+"): trying to set "+t+" value on '"+e+"'.");var i=void 0!==this.$changes.indexes[e],s=i?this.$changes.indexes[e]:this.$refId++,n=i?E.OPERATION.REPLACE:E.OPERATION.ADD,o=void 0!==t.$changes;return o&&t.$changes.setParent(this,this.$changes.root,s),i?o&&this.$items.get(e)!==t&&(n=E.OPERATION.ADD):(this.$changes.indexes[e]=s,this.$indexes.set(s,e)),this.$items.set(e,t),this.$changes.change(e,n),this},t.prototype.get=function(e){return this.$items.get(e)},t.prototype.delete=function(e){return this.$changes.delete(e),this.$items.delete(e)},t.prototype.clear=function(e){var t=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){t.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(e){return this.$items.has(e)},t.prototype.forEach=function(e){this.$items.forEach(e)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},t.prototype.getIndex=function(e){return this.$indexes.get(e)},t.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},t.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},t.prototype.toJSON=function(){var i={};return this.forEach(function(e,t){i[t]="function"==typeof e.toJSON?e.toJSON():e}),i},t.prototype.clone=function(e){var i;return e?i=Object.assign(new t,this):(i=new t,this.forEach(function(e,t){e.$changes?i.set(t,e.clone()):i.set(t,e)})),i},t.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},t}(),ie={},f=function(){function i(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return i.create=function(e){var t=new i;return t.schema=Object.assign({},e&&e.schema||{}),t.indexes=Object.assign({},e&&e.indexes||{}),t.fieldsByIndex=Object.assign({},e&&e.fieldsByIndex||{}),t.descriptors=Object.assign({},e&&e.descriptors||{}),t.deprecated=Object.assign({},e&&e.deprecated||{}),t},i.prototype.addField=function(e,t){var i=this.getNextFieldIndex();this.fieldsByIndex[i]=e,this.indexes[e]=i,this.schema[e]=Array.isArray(t)?{array:t[0]}:t},i.prototype.addFilter=function(e,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[e]]=t,this.indexesWithFilters.push(this.indexes[e]),!0},i.prototype.addChildrenFilter=function(e,t){var i=this.indexes[e],s=this.schema[e];if(F(Object.keys(s)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[i]=t,!0;console.warn("@filterChildren: field '"+e+"' can't have children. Ignoring filter.")},i.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]},i.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},i}(),_=function(){function e(){this.types={},this.schemas=new Map,this.useFilters=!1}return e.prototype.has=function(e){return this.schemas.has(e)},e.prototype.get=function(e){return this.types[e]},e.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size),e._definition=f.create(e._definition),e._typeid=t,this.types[t]=e,this.schemas.set(e,t)},e.create=function(t){return void 0===t&&(t=new e),function(e){return d(e,t)}},e}(),se=new _,w=new Int32Array(2),ne=new Float32Array(w.buffer),oe=new Float64Array(w.buffer),O=Object.freeze({__proto__:null,utf8Write:N,int8:z,uint8:C,int16:H,uint16:n,int32:s,uint32:o,int64:U,uint64:$,float32:function(e,t){q(e,t)},float64:function(e,t){r(e,t)},writeFloat32:q,writeFloat64:r,boolean:function(e,t){return C(e,t?1:0)},string:P,number:B}),y=new Int32Array(2),re=new Float32Array(y.buffer),ae=new Float64Array(y.buffer),he=Object.freeze({__proto__:null,int8:W,uint8:a,int16:j,uint16:c,int32:u,uint32:p,float32:X,float64:J,int64:V,uint64:Y,readFloat32:X,readFloat64:J,boolean:function(e,t){return 0<a(e,t)},string:K,stringCheck:function(e,t){e=e[t.offset];return e<192&&160<e||217===e||218===e||219===e},number:A,numberCheck:function(e,t){e=e[t.offset];return e<128||202<=e&&e<=211},arrayCheck:function(e,t){return e[t.offset]<160},switchStructureCheck:Q}),R=function(){function i(e){var t=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(e){return t.add(e)})}return i.is=function(e){return void 0!==e.collection},i.prototype.add=function(e){var t=this.$refId++,i=void 0!==e.$changes;return i&&e.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t),t},i.prototype.at=function(e){e=Array.from(this.$items.keys())[e];return this.$items.get(e)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(e){for(var t,i,s=this.$items.entries();(i=s.next())&&!i.done;)if(e===i.value[1]){t=i.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},i.prototype.clear=function(e){var t=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){t.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(t){return Array.from(this.$items.values()).some(function(e){return e===t})},i.prototype.forEach=function(s){var n=this;this.$items.forEach(function(e,t,i){return s(e,t,n)})},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},i.prototype.getIndex=function(e){return this.$indexes.get(e)},i.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},i.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var i=[];return this.forEach(function(e,t){i.push("function"==typeof e.toJSON?e.toJSON():e)}),i},i.prototype.clone=function(e){var t;return e?t=Object.assign(new i,this):(t=new i,this.forEach(function(e){e.$changes?t.add(e.clone()):t.add(e)})),t},i.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},i}(),D=function(){function i(e){var t=this;this.$changes=new g(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,e&&e.forEach(function(e){return t.add(e)})}return i.is=function(e){return void 0!==e.set},i.prototype.add=function(e){var t,i;return!this.has(e)&&(t=this.$refId++,void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,t),i=null!=(i=null==(i=this.$changes.indexes[t])?void 0:i.op)?i:E.OPERATION.ADD,this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,e),this.$changes.change(t,i),t)},i.prototype.entries=function(){return this.$items.entries()},i.prototype.delete=function(e){for(var t,i,s=this.$items.entries();(i=s.next())&&!i.done;)if(e===i.value[1]){t=i.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},i.prototype.clear=function(e){var t=this;this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach(function(e){t.$changes.root.removeRef(e.$changes.refId)}),this.$items.clear(),this.$changes.operation({index:0,op:E.OPERATION.CLEAR}),this.$changes.touchParents()},i.prototype.has=function(e){for(var t,i=this.$items.values(),s=!1;(t=i.next())&&!t.done;)if(e===t.value){s=!0;break}return s},i.prototype.forEach=function(s){var n=this;this.$items.forEach(function(e,t,i){return s(e,t,n)})},i.prototype.values=function(){return this.$items.values()},Object.defineProperty(i.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),i.prototype.setIndex=function(e,t){this.$indexes.set(e,t)},i.prototype.getIndex=function(e){return this.$indexes.get(e)},i.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))},i.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t),this.$indexes.delete(e)},i.prototype.toArray=function(){return Array.from(this.$items.values())},i.prototype.toJSON=function(){var i=[];return this.forEach(function(e,t){i.push("function"==typeof e.toJSON?e.toJSON():e)}),i},i.prototype.clone=function(e){var t;return e?t=Object.assign(new i,this):(t=new i,this.forEach(function(e){e.$changes?t.add(e.clone()):t.add(e)})),t},i.prototype.triggerAll=function(){v.prototype.triggerAll.apply(this)},i}(),le=function(){function e(){this.handlers=[]}return e.prototype.register=function(e,t){return this.handlers.push(e),this},e.prototype.invoke=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handlers.forEach(function(e){return e.apply(void 0,t)})},e.prototype.invokeAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Promise.all(this.handlers.map(function(e){return e.apply(void 0,t)}))},e.prototype.remove=function(e){e=this.handlers.indexOf(e);this.handlers[e]=this.handlers[this.handlers.length-1],this.handlers.pop()},e.prototype.clear=function(){this.handlers=[]},e}(),de=function(){function t(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return t.prototype.addRefId=function(e){this.refIds.has(e)||(this.refIds.add(e),this.containerIndexes.set(e,new Set))},t.get=function(e){return void 0===e.$filterState&&(e.$filterState=new t),e.$filterState},t}(),I=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t}(Error),v=function(){function T(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new g(this,void 0,new ee),enumerable:!1,writable:!0},$listeners:{value:{},enumerable:!1,writable:!0}});var i=this._definition.descriptors;i&&Object.defineProperties(this,i),e[0]&&this.assign(e[0])}return T.onError=function(e){console.error(e)},T.is=function(e){return e._definition&&void 0!==e._definition.schema},T.prototype.assign=function(e){return Object.assign(this,e),this},Object.defineProperty(T.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),T.prototype.listen=function(e,t){var i=this;return this.$listeners[e]||(this.$listeners[e]=new le),this.$listeners[e].register(t),function(){return i.$listeners[e].remove(t)}},T.prototype.decode=function(e,t,i,s){void 0===t&&(t={offset:0}),void 0===i&&(i=this),void 0===s&&(s=new Map);var n=this.$changes.root,o=e.length,r=[];for(n.refs.set(0,this),s.set(0,r);t.offset<o;){var a=e[t.offset++];if(255==a){var h=A(e,t),l=n.refs.get(h);if(!l)throw new Error('"refId" not found: '+h);i=l,r=[],s.set(h,r)}else{var l=i.$changes,h=void 0!==i._definition,d=h?a>>6<<6:a;if(d===E.OPERATION.CLEAR)i.clear(!0);else{var a=h?a%(d||255):A(e,t),c=h?i._definition.fieldsByIndex[a]:"",u=l.getType(a),p=void 0,m=void 0,g=void 0;if(h?m=i["_"+c]:(m=i.getByIndex(a),(d&E.OPERATION.ADD)===E.OPERATION.ADD?(g=i instanceof L?K(e,t):a,i.setIndex(a,g)):g=i.getIndex(a)),(d&E.OPERATION.DELETE)===E.OPERATION.DELETE&&(d!==E.OPERATION.DELETE_AND_ADD&&i.deleteByIndex(a),m&&m.$changes&&n.removeRef(m.$changes.refId),p=null),void 0===c){console.warn("@colyseus/schema: definition mismatch");for(var f={offset:t.offset};t.offset<o&&(!Q(e,t)||(f.offset=t.offset+1,!n.refs.has(A(e,f))));)t.offset++}else{if(d!==E.OPERATION.DELETE)if(T.is(u)){var _,w=A(e,t),p=n.refs.get(w);d!==E.OPERATION.REPLACE&&(_=this.getSchemaType(e,t,u),p||(p=this.createTypeInstance(_),p.$changes.refId=w,m&&(p.onChange=m.onChange,p.onRemove=m.onRemove,p.$listeners=m.$listeners,m.$changes.refId)&&w!==m.$changes.refId&&n.removeRef(m.$changes.refId)),n.addRef(w,p,p!==m))}else if("string"==typeof u)_=u,w=e,y=t,p=he[_](w,y);else{var y=F(Object.keys(u)[0]),u=A(e,t),v=n.refs.has(u)?m||n.refs.get(u):new y.constructor;if(p=v.clone(!0),p.$changes.refId=u,m&&(p.onAdd=m.onAdd,p.onRemove=m.onRemove,p.onChange=m.onChange,m.$changes.refId)&&u!==m.$changes.refId){n.removeRef(m.$changes.refId);for(var b=[],k=m.entries();(x=k.next())&&!x.done;){var x=x.value,S=x[0],x=x[1];b.push({op:E.OPERATION.DELETE,field:S,value:void 0,previousValue:x})}s.set(m.$changes.refId,b)}n.addRef(u,p,v!==m),y.getProxy&&(p=y.getProxy(p))}var C,u=m!==p;null!=p&&(p.$changes&&p.$changes.setParent(l.ref,l.root,a),i instanceof T?i[c]=p:i instanceof L?(S=g,i.$items.set(S,p)):i instanceof M?i.setAt(a,p):i instanceof R?(C=i.add(p),i.setIndex(a,C)):i instanceof D&&(C=i.add(p),!1!==C)&&i.setIndex(a,C)),u&&r.push({op:d,field:c,dynamicIndex:g,value:p,previousValue:m})}}}}return this._triggerChanges(s),n.garbageCollectDeletedRefs(),s},T.prototype.encode=function(e,t,i){void 0===e&&(e=!1),void 0===t&&(t=[]),void 0===i&&(i=!1);for(var s=this.$changes,n=new WeakSet,o=[s],r=1,a=0;a<r;a++){for(var h=o[a],l=h.ref,d=l instanceof T,c=(h.ensureRefId(),n.add(h),h!==s&&(h.changed||e)&&(C(t,255),B(t,h.refId)),e?Array.from(h.allChanges):Array.from(h.changes.values())),u=0,p=c.length;u<p;u++){var m=e?{op:E.OPERATION.ADD,index:c[u]}:c[u],g=m.index,f=d?l._definition.fieldsByIndex&&l._definition.fieldsByIndex[g]:g,_=t.length;if(m.op!==E.OPERATION.TOUCH)if(d)C(t,g|m.op);else{if(C(t,m.op),m.op===E.OPERATION.CLEAR)continue;B(t,g)}if(d||(m.op&E.OPERATION.ADD)!=E.OPERATION.ADD||l instanceof L&&(w=h.ref.$indexes.get(g),P(t,w)),m.op!==E.OPERATION.DELETE){var w=h.getType(g),y=h.getValue(g);if(y&&y.$changes&&!n.has(y.$changes)&&(o.push(y.$changes),y.$changes.ensureRefId(),r++),m.op!==E.OPERATION.TOUCH){if(T.is(w))Z(y,w,l,f),B(t,y.$changes.refId),(m.op&E.OPERATION.ADD)===E.OPERATION.ADD&&this.tryEncodeTypeId(t,w,y.constructor);else if("string"==typeof w){m=void 0,v=void 0,b=void 0,k=void 0,x=void 0,S=void 0;var m=w,v=t,b=y,k=l,x=f,S=(!function(e,t,i,s){var n,o=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":n="number",isNaN(e)&&console.log('trying to encode "NaN" in '+i.constructor.name+"#"+s);break;case"string":n="string",o=!0;break;case"boolean":return}if(typeof e!==n&&(!o||null!==e))throw t="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")"||""),new I("a '"+n+"' was expected, but "+t+" was provided in "+i.constructor.name+"#"+s)}(b,m,k,x),O[m]);if(!S)throw new I("a '"+m+"' was expected, but "+b+" was provided in "+k.constructor.name+"#"+x);S(v,b)}else{m=F(Object.keys(w)[0]);Z(l["_"+f],m.constructor,l,f),B(t,y.$changes.refId)}i&&h.cache(g,t.slice(_))}}}e||i||h.discard()}return t},T.prototype.encodeAll=function(e){return this.encode(!0,[],e)},T.prototype.applyFilters=function(f,_){void 0===_&&(_=!1);for(var w=this,y=new Set,v=de.get(f),b=[this.$changes],k=1,x=[],e=0;e<k;e++)!function(e){var t=b[e];if(y.has(t.refId))return;var i=t.ref,s=i instanceof T,e=(C(x,255),B(x,t.refId),v.refIds.has(t)),n=_||!e,o=(v.addRefId(t),v.containerIndexes.get(t)),r=n?Array.from(t.allChanges):Array.from(t.changes.values());!_&&s&&i._definition.indexesWithFilters&&(e=i._definition.indexesWithFilters,e.forEach(function(e){!o.has(e)&&t.allChanges.has(e)&&(n?r.push(e):r.push({op:E.OPERATION.ADD,index:e}))}));for(var a=0,h=r.length;a<h;a++){var l=n?{op:E.OPERATION.ADD,index:r[a]}:r[a];if(l.op===E.OPERATION.CLEAR)C(x,l.op);else{var d=l.index;if(l.op===E.OPERATION.DELETE)s?C(x,l.op|d):(C(x,l.op),B(x,d));else{var c,u=t.getValue(d),p=t.getType(d);if(s){var m=i._definition.filters&&i._definition.filters[d];if(m&&!m.call(i,f,u,w)){u&&u.$changes&&y.add(u.$changes.refId);continue}}else{var g=t.parent,m=t.getChildrenFilter();if(m&&!m.call(g,f,i.$indexes.get(d),u,w)){u&&u.$changes&&y.add(u.$changes.refId);continue}}u.$changes&&(b.push(u.$changes),k++),l.op!==E.OPERATION.TOUCH?l.op===E.OPERATION.ADD||s?(x=x.concat(t.caches[d]),o.add(d)):o.has(d)?x=x.concat(t.caches[d]):(o.add(d),C(x,E.OPERATION.ADD),B(x,d),i instanceof L&&(c=t.ref.$indexes.get(d),P(x,c)),u.$changes?B(x,u.$changes.refId):O[p](x,u)):u.$changes&&!s&&(C(x,E.OPERATION.ADD),B(x,d),i instanceof L&&(c=t.ref.$indexes.get(d),P(x,c)),B(x,u.$changes.refId))}}}}(e);return x},T.prototype.clone=function(){var e,t=new this.constructor,i=this._definition.schema;for(e in i)"object"==typeof this[e]&&"function"==typeof this[e].clone?t[e]=this[e].clone():t[e]=this[e];return t},T.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var e=new Map;T.prototype._triggerAllFillChanges.call(this,this,e);try{T.prototype._triggerChanges.call(this,e)}catch(e){T.onError(e)}}},T.prototype.toJSON=function(){var e,t=this._definition.schema,i=this._definition.deprecated,s={};for(e in t)i[e]||null===this[e]||void 0===this[e]||(s[e]="function"==typeof this[e].toJSON?this[e].toJSON():this["_"+e]);return s},T.prototype.discardAllChanges=function(){this.$changes.discardAll()},T.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]},T.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0},T.prototype.tryEncodeTypeId=function(e,t,i){t._typeid!==i._typeid&&(C(e,213),B(e,i._typeid))},T.prototype.getSchemaType=function(e,t,i){var s;return 213===e[t.offset]&&(t.offset++,s=this.constructor._context.get(A(e,t))),s||i},T.prototype.createTypeInstance=function(e){e=new e;return e.$changes.root=this.$changes.root,e},T.prototype._triggerAllFillChanges=function(e,t){if(!t.has(e.$changes.refId)){var i=[];if(t.set(e.$changes.refId||0,i),e instanceof T){var s,n=e._definition.schema;for(s in n){var o="_"+s,r=e[o];void 0!==r&&(i.push({op:E.OPERATION.ADD,field:s,value:r,previousValue:void 0}),void 0!==r.$changes)&&T.prototype._triggerAllFillChanges.call(this,r,t)}}else for(var a=e.entries();(h=a.next())&&!h.done;){var h=h.value,l=h[0],r=h[1];i.push({op:E.OPERATION.ADD,field:l,dynamicIndex:l,value:r,previousValue:void 0}),void 0!==r.$changes&&T.prototype._triggerAllFillChanges.call(this,r,t)}}},T.prototype._triggerChanges=function(e){var p=this;e.forEach(function(e,t){var i,s,n,o,r,a;if(0<e.length){for(var h=p.$changes.root.refs.get(t),l=h instanceof T,d=0;d<e.length;d++){var c=e[d],u=h.$listeners&&h.$listeners[c.field];if(l||(c.op===E.OPERATION.ADD&&void 0===c.previousValue?null!=(s=(i=h).onAdd)&&s.call(i,c.value,null!=(s=c.dynamicIndex)?s:c.field):c.op===E.OPERATION.DELETE?void 0!==c.previousValue&&null!=(s=(i=h).onRemove)&&s.call(i,c.previousValue,null!=(n=c.dynamicIndex)?n:c.field):c.op===E.OPERATION.DELETE_AND_ADD?(void 0!==c.previousValue&&null!=(o=(n=h).onRemove)&&o.call(n,c.previousValue,c.dynamicIndex),null!=(r=(o=h).onAdd)&&r.call(o,c.value,c.dynamicIndex)):c.op!==E.OPERATION.REPLACE&&c.value===c.previousValue||null!=(a=(r=h).onChange)&&a.call(r,c.value,c.dynamicIndex)),(c.op&E.OPERATION.DELETE)===E.OPERATION.DELETE&&c.previousValue instanceof T&&c.previousValue.onRemove&&c.previousValue.onRemove(),u)try{u.invoke(c.value,c.previousValue)}catch(e){T.onError(e)}}if(l&&h.onChange)try{h.onChange(e)}catch(e){T.onError(e)}}})},T._definition=f.create(),T}(),b=new _,k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),i([d("string",b)],t.prototype,"name",void 0),i([d("string",b)],t.prototype,"type",void 0),i([d("number",b)],t.prototype,"referencedType",void 0),t}(v),x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fields=new M,e}return l(e,t),i([d("number",b)],e.prototype,"id",void 0),i([d([k],b)],e.prototype,"fields",void 0),e}(v),e=function(t){function u(){var e=null!==t&&t.apply(this,arguments)||this;return e.types=new M,e}return l(u,t),u.encode=function(e){var t,e=e.constructor,i=new u,s=(i.rootType=e._typeid,e._context.types);for(t in s){var n,o=new x,r=(o.id=Number(t),n=void 0,d=void 0,c=void 0,h=void 0,l=void 0,o),a=s[t]._definition.schema;for(n in a){var h,l,d=new k,c=(d.name=n,void 0);"string"==typeof a[n]?c=a[n]:(h=a[n],l=void 0,v.is(h)?(c="ref",l=a[n]):(c=Object.keys(h)[0],"string"==typeof h[c]?c+=":"+h[c]:l=h[c]),d.referencedType=l?l._typeid:-1),d.type=c,r.fields.push(d)}i.types.push(r)}return i.encodeAll()},u.decode=function(e,t){var i,o=new _,s=new u,r=(s.decode(e,t),s.types.reduce(function(e,t){i=v,l(n,i);var i,s=n;function n(){return null!==i&&i.apply(this,arguments)||this}t=t.id;return e[t]=s,o.add(s,t),e},{})),n=(s.types.forEach(function(e){var n=r[e.id];e.fields.forEach(function(e){var t,i,s;(void 0!==e.referencedType?(i=e.type,s=r[e.referencedType],s||(t=e.type.split(":"),i=t[0],s=t[1]),d("ref"===i?s:(t={},t[i]=s,t),o)):d(e.type,o))(n.prototype,e.name)})}),r[s.rootType]),a=new n;for(i in n._definition.schema){var h=n._definition.schema[i];"string"!=typeof h&&(a[i]=new("function"==typeof h?h:F(Object.keys(h)[0]).constructor))}return a},i([d([x],b)],u.prototype,"types",void 0),i([d("number",b)],u.prototype,"rootType",void 0),u}(v),t("map",{constructor:L,getProxy:G}),t("array",{constructor:M,getProxy:T}),t("set",{constructor:D}),t("collection",{constructor:R}),E.ArraySchema=M,E.CollectionSchema=R,E.Context=_,E.MapSchema=L,E.Reflection=e,E.ReflectionField=k,E.ReflectionType=x,E.Schema=v,E.SchemaDefinition=f,E.SetSchema=D,E.decode=he,E.defineTypes=function(e,t,i){void 0===i&&(i=e._context||se);for(var s in t)d(t[s],i)(e.prototype,s);return e},E.deprecated=function(i,e){void 0===i&&(i=!0);return function(e,t){e=e.constructor,e=e._definition;e.deprecated[t]=!0,i&&(e.descriptors[t]={get:function(){throw new Error(t+" is deprecated.")},set:function(e){},enumerable:!1,configurable:!0})}},E.dumpChanges=function(e){for(var t=[e.$changes],e={},s=e,i=0;i<1;i++)!function(e){var i=t[e];i.changes.forEach(function(e){var t=i.ref,e=e.index,t=t._definition?t._definition.fieldsByIndex[e]:t.$indexes.get(e);s[t]=i.getValue(e)})}(i);return e},E.encode=O,E.filter=function(s){return function(e,t){var e=e.constructor,i=e._definition;i.addFilter(t,s)&&(e._context.useFilters=!0)}},E.filterChildren=function(s){return function(e,t){var e=e.constructor,i=e._definition;i.addChildrenFilter(t,s)&&(e._context.useFilters=!0)}},E.hasFilter=function(e){return e._context&&e._context.useFilters},E.registerType=t,E.type=d,Object.defineProperty(E,"__esModule",{value:!0})},r={exports:{}},n(r,r.exports);var C,T=r.exports,U=(F.prototype.connect=function(e){var t=this;this.connection=new z,this.connection.events.onmessage=this.onMessageCallback.bind(this),this.connection.events.onclose=function(e){t.hasJoined?(t.onLeave.invoke(e.code),t.destroy()):(console.warn("Room connection was closed unexpectedly ("+e.code+"): "+e.reason),t.onError.invoke(e.code,e.reason))},this.connection.events.onerror=function(e){console.warn("Room, onError ("+e.code+"): "+e.reason),t.onError.invoke(e.code,e.reason)},this.connection.connect(e)},F.prototype.leave=function(e){void 0===e&&(e=!0),this.connection?e?this.connection.send([a.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(4e3)},F.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)},F.prototype.send=function(e,t){var i,s=[a.Protocol.ROOM_DATA];"string"==typeof e?T.encode.string(s,e):T.encode.number(s,e),void 0!==t?(e=function(e){var t=[],i=[],e=v(t,i,e),e=new ArrayBuffer(e),s=new DataView(e),n=0,o=0,r=-1;0<i.length&&(r=i[0]._offset);for(var a,h,l,d=0,c=t.length;d<c;d++)if(s.setUint8(o+d,t[d]),d+1===r){if(a=i[n],h=a._length,l=o+r,a._bin)for(var u=new Uint8Array(a._bin),p=0;p<h;p++)s.setUint8(l+p,u[p]);else if(a._str){g=void 0,f=void 0,_=void 0,m=void 0,w=void 0,y=void 0;for(var m,g=s,f=l,_=a._str,w=0,y=_.length;w<y;w++)m=_.charCodeAt(w),m<128?g.setUint8(f++,m):(m<2048?g.setUint8(f++,192|m>>6):(m<55296||57344<=m?g.setUint8(f++,224|m>>12):(w++,m=65536+((1023&m)<<10|1023&_.charCodeAt(w)),g.setUint8(f++,240|m>>18),g.setUint8(f++,128|m>>12&63)),g.setUint8(f++,128|m>>6&63)),g.setUint8(f++,128|63&m))}else void 0!==a._float&&s.setFloat64(l,a._float);n++,o+=h,i[n]&&(r=i[n]._offset)}return e}(t),i=new Uint8Array(s.length+e.byteLength),i.set(new Uint8Array(s),0),i.set(new Uint8Array(e),s.length)):i=new Uint8Array(s),this.connection.send(i.buffer)},Object.defineProperty(F.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:!1,configurable:!0}),F.prototype.removeAllListeners=function(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}},F.prototype.onMessageCallback=function(e){var t,i,s,n,o=Array.from(new Uint8Array(e.data)),r=o[0];r===a.Protocol.JOIN_ROOM?(i=1,this.serializerId=function(e,t){for(var i=e[t++],s="",n=0,o=t,r=t+i;o<r;o++){var a=e[o];if(0==(128&a))s+=String.fromCharCode(a);else if(192==(224&a))s+=String.fromCharCode((31&a)<<6|63&e[++o]);else if(224==(240&a))s+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else{if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));n=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0,65536<=n?(n-=65536,s+=String.fromCharCode(55296+(n>>>10),56320+(1023&n))):s+=String.fromCharCode(n)}}return s}(o,1),i+=function(e){void 0===e&&(e="");for(var t,i=0,s=0,n=e.length;s<n;s++)t=e.charCodeAt(s),t<128?i+=1:t<2048?i+=2:t<55296||57344<=t?i+=3:(s++,i+=4);return i+1}(this.serializerId),this.serializer||(t=k(this.serializerId),this.serializer=new t),o.length>i&&this.serializer.handshake&&this.serializer.handshake(o,{offset:i}),this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([a.Protocol.JOIN_ROOM])):r===a.Protocol.ERROR?(t={offset:1},i=T.decode.number(o,t),n=T.decode.string(o,t),this.onError.invoke(i,n)):r===a.Protocol.LEAVE_ROOM?this.leave():r===a.Protocol.ROOM_DATA_SCHEMA?(t={offset:1},i=this.serializer.getState().constructor._context,s=i.get(T.decode.number(o,t)),n=new s,n.decode(o,t),this.dispatchMessage(s,n)):r===a.Protocol.ROOM_STATE?(o.shift(),this.setState(o)):r===a.Protocol.ROOM_STATE_PATCH?(o.shift(),this.patch(o)):r===a.Protocol.ROOM_DATA&&(i={offset:1},s=T.decode.stringCheck(o,i)?T.decode.string(o,i):T.decode.number(o,i),n=o.length>i.offset?function(e,t){void 0===t&&(t=0);var t=new f(e,t),i=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return i}(e.data,i.offset):void 0,this.dispatchMessage(s,n))},F.prototype.setState=function(e){this.serializer.setState(e),this.onStateChange.invoke(this.serializer.getState())},F.prototype.patch=function(e){this.serializer.patch(e),this.onStateChange.invoke(this.serializer.getState())},F.prototype.dispatchMessage=function(e,t){var i=this.getMessageHandlerKey(e);this.onMessageHandlers.events[i]?this.onMessageHandlers.emit(i,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):console.warn("onMessage not registered for type '"+e+"'.")},F.prototype.destroy=function(){this.serializer&&this.serializer.teardown()},F.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$"+e._typeid;case"string":return e;case"number":return"i"+e;default:throw new Error("invalid message type.")}},F);function F(e,t){var i=this;this.onStateChange=S(),this.onError=S(),this.onLeave=S(),this.onJoin=S(),this.hasJoined=!1,this.onMessageHandlers={events:{},emit(e,...t){(this.events[e]||[]).forEach(e=>e(...t))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter(e=>e!==t)}},this.id=null,this.name=e,t&&(this.serializer=new(k("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(function(e,t){return console.warn("colyseus.js - onError => ("+e+") "+t)}),this.onLeave(function(){return i.removeAllListeners()})}function P(){return C=C||("undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}}),C}var B="colyseus-auth-token",$=(a.Platform=void 0,o=a.Platform||(a.Platform={}),o.ios="ios",o.android="android",Object.defineProperty(A.prototype,"hasToken",{get:function(){return!!this.token},enumerable:!1,configurable:!0}),A.prototype.login=function(r){return void 0===r&&(r={}),d(this,void 0,void 0,function(){var s,n,o;return c(this,function(e){switch(e.label){case 0:return s=Object.assign({},r),this.hasToken&&(s.token=this.token),[4,this.request("post","/auth",s)];case 1:for(o in n=e.sent(),this.token=n.token,t=B,i=this.token,P().setItem(t,i),n)this.hasOwnProperty(o)&&(this[o]=n[o]);return this.registerPingService(),[2,this]}var t,i})})},A.prototype.save=function(){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:return e.sent(),[2,this]}})})},A.prototype.getFriends=function(){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}})})},A.prototype.getOnlineFriends=function(){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}})})},A.prototype.getFriendRequests=function(){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}})})},A.prototype.sendFriendRequest=function(t){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("post","/friends/requests",{userId:t})];case 1:return[2,e.sent()]}})})},A.prototype.acceptFriendRequest=function(t){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("put","/friends/requests",{userId:t})];case 1:return[2,e.sent()]}})})},A.prototype.declineFriendRequest=function(t){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("del","/friends/requests",{userId:t})];case 1:return[2,e.sent()]}})})},A.prototype.blockUser=function(t){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("post","/friends/block",{userId:t})];case 1:return[2,e.sent()]}})})},A.prototype.unblockUser=function(t){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.request("put","/friends/block",{userId:t})];case 1:return[2,e.sent()]}})})},A.prototype.request=function(o,r,a,h,l){return void 0===a&&(a={}),void 0===l&&(l={}),d(this,void 0,void 0,function(){var t,i,s,n;return c(this,function(e){switch(e.label){case 0:for(i in l.Accept="application/json",this.hasToken&&(l.Authorization="Bearer "+this.token),t=[],a)t.push(i+"="+a[i]);return s=0<t.length?"?"+t.join("&"):"",n={headers:l},h&&(n.body=h),[4,D[o](""+this.endpoint+r+s,n)];case 1:return[2,e.sent().data]}})})},A.prototype.logout=function(){var e;this.token=void 0,e=B,P().removeItem(e),this.unregisterPingService()},A.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3),this.unregisterPingService(),this.keepOnlineInterval=setInterval(function(){return t.request("get","/auth")},e)},A.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)},A);function A(e){var t,i=this;this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=e.replace("ws","http"),e=B,t=function(e){return i.token=e},e=P().getItem(e),"undefined"!=typeof Promise&&e instanceof Promise?e.then(function(e){return t(e)}):t(e)}E=Error,e(M,E);var E,q=M;function M(e,t){e=E.call(this,e)||this;return e.code=t,Object.setPrototypeOf(e,M.prototype),e}var W="undefined"!=typeof window&&void 0!==window.location?window.location.protocol.replace("http","ws")+"//"+window.location.hostname+(window.location.port&&":"+window.location.port):"ws://127.0.0.1:2567",u=(Object.defineProperty(L.prototype,"auth",{get:function(){return this._auth||(this._auth=new $(this.endpoint)),this._auth},enumerable:!1,configurable:!0}),L.prototype.joinOrCreate=function(t,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",t,i,s)];case 1:return[2,e.sent()]}})})},L.prototype.create=function(t,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.createMatchMakeRequest("create",t,i,s)];case 1:return[2,e.sent()]}})})},L.prototype.join=function(t,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.createMatchMakeRequest("join",t,i,s)];case 1:return[2,e.sent()]}})})},L.prototype.joinById=function(t,i,s){return void 0===i&&(i={}),d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.createMatchMakeRequest("joinById",t,i,s)];case 1:return[2,e.sent()]}})})},L.prototype.reconnect=function(t,i,s){return d(this,void 0,void 0,function(){return c(this,function(e){switch(e.label){case 0:return[4,this.createMatchMakeRequest("joinById",t,{sessionId:i},s)];case 1:return[2,e.sent()]}})})},L.prototype.getAvailableRooms=function(i){return void 0===i&&(i=""),d(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=this.endpoint.replace("ws","http")+"/matchmake/"+i,[4,p(t,{headers:{Accept:"application/json"}})];case 1:return[2,e.sent().data]}})})},L.prototype.consumeSeatReservation=function(t,i){return d(this,void 0,void 0,function(){var s;return c(this,function(e){return s=this.createRoom(t.room.name,i),s.id=t.room.roomId,s.sessionId=t.sessionId,s.connect(this.buildEndpoint(t.room,{sessionId:s.sessionId})),[2,new Promise(function(e,i){function t(e,t){return i(new I(e,t))}s.onError.once(t),s.onJoin.once(function(){s.onError.remove(t),e(s)})})]})})},L.prototype.createMatchMakeRequest=function(i,s,n,o){return void 0===n&&(n={}),d(this,void 0,void 0,function(){var t;return c(this,function(e){switch(e.label){case 0:return t=this.endpoint.replace("ws","http")+"/matchmake/"+i+"/"+s,this._auth&&this._auth.hasToken&&(n.token=this._auth.token),[4,m(t,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if(t=e.sent().data,t.error)throw new q(t.error,t.code);return[2,this.consumeSeatReservation(t,o)]}})})},L.prototype.createRoom=function(e,t){return new U(e,t)},L.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var i,s=[];for(i in t)t.hasOwnProperty(i)&&s.push(i+"="+t[i]);return this.endpoint+"/"+e.processId+"/"+e.roomId+"?"+s.join("&")},L);function L(e){void 0===e&&(e=W),this.endpoint=e}O.prototype.setState=function(e){this.state.decode(e)},O.prototype.getState=function(){return this.state},O.prototype.patch=function(e){this.state.decode(e)},O.prototype.teardown=function(){var e;null!=(e=null==(e=this.state)?void 0:e.$changes)&&e.root.clearRefs()},O.prototype.handshake=function(e,t){var i;this.state?(i=new T.Reflection,i.decode(e,t)):this.state=T.Reflection.decode(e,t)};l=O;function O(){}R.prototype.setState=function(e){},R.prototype.getState=function(){return null},R.prototype.patch=function(e){},R.prototype.teardown=function(){},R.prototype.handshake=function(e){};n=R;function R(){}return b("schema",l),b("none",n),a.Auth=$,a.Client=u,a.Room=U,a.SchemaSerializer=l,a.registerSerializer=b,a}();const l=function(){function e(e,...t){n.enabled&&s[e].apply(s,t)}function t(e,...t){for(n[e].apply(n,t),i=0;i<o.length;++i)o[i][e].apply(o[i],t)}let i,s=console,n={enabled:!0,log:e.bind(null,"log"),info:e.bind(null,"info"),warn:e.bind(null,"warn"),error:e.bind(null,"error"),trace:e.bind(null,"trace")},o=[],r={channels:o,console:n,log:t.bind(null,"log"),info:t.bind(null,"info"),warn:t.bind(null,"warn"),error:t.bind(null,"error"),trace:t.bind(null,"trace")};return r}();class r{constructor(){this.invoke=this.fire,this.count=0,this._delegates=[],this._invoking=0,this._dirty=0}add(e,t){if(null!==t&&"object"!=typeof t&&"function"!=typeof t)throw new Error("Invalid target, must be an object or null!");if(0<=this.indexOf(e,t))throw new Error("Delegate already added!");this._delegates.push({callback:e,target:t,state:this._dirty=this._invoking?1:0}),this.count++}remove(e,t){e=this.indexOf(e,t);if(e<0)throw new Error("Delegate is not added!");this._invoking?this._dirty=this._delegates[e].state=-1:this._delegates.splice(e,1),this.count--}clear(){if(this._invoking){for(let e=0;e<this._delegates.length;++e)this._delegates[e].state=-1;this._dirty=1}else this.count=this._delegates.length=0}contains(e,t){return 0<=this.indexOf(e,t)}fire(){if(this._invoking)throw new Error("Delegate is already being invoked!");if(this.count){this._invoking=1;for(let e=0;e<this._delegates.length;++e)this._delegates[e].state||this._delegates[e].callback.apply(this._delegates[e].target,arguments);if(this._invoking=0,this._dirty){for(let e=0;e<this._delegates.length;++e)-1===this._delegates[e].state?this._delegates.splice(e--,1):1===this._delegates[e].state&&(this._delegates[e].state=0);this._dirty=0}}}indexOf(t,i){for(let e=0;e<this._delegates.length;++e)if(-1!==this._delegates[e].state&&this._delegates[e].target===i&&this._delegates[e].callback===t)return e;return-1}}class I extends class{constructor(){this.list=null,this.next=null,this.previous=null}}{constructor(e=null){super(),this.value=e}}class G{constructor(e){this.first=null,this.last=null,this.count=0,e&&this.append(e)}append(e){if(null!==e.list)throw new Error("The node is already in a list!");return 0<this.count?(this.last.next=e,e.previous=this.last):this.first=e,this.last=e,e.list=this,this.count++,e}prepend(e){if(null!==e.list)throw new Error("The node is already in a list!");return 0<this.count?(this.first.previous=e,e.next=this.first):this.last=e,this.first=e,e.list=this,this.count++,e}remove(e){if(e.list!==this)throw new Error("Node is not in this list!");return 1===this.count?this.first=this.last=null:e===this.first?(this.first=e.next,this.first.previous=null):e===this.last?(this.last=e.previous,this.last.next=null):(e.previous.next=e.next,e.next.previous=e.previous),e.list=e.next=e.previous=null,this.count--,e}removeFirst(){return 0<this.count?this.remove(this.first):null}removeLast(){return 0<this.count?this.remove(this.last):null}clear(){let e=this.first;for(;e;){var t=e.next;e.list=e.next=e.previous=null,e=t}this.first=this.last=null,this.count=0}}class N{constructor(){this._pool=[],this._count=0}get count(){return this._count}remove(){let e=null;return 0<this._count&&(e=this._pool[this._count-1],this._pool[this._count-1]=null,this._count--),e}add(e){if(!e)throw new Error("Cannot add null or empty to pool!");this._pool.length>this._count?this._pool[this._count]=e:this._pool.push(e),this._count++}}var z;class H{constructor(e=null){null===e&&(e=Math.floor(Math.random()*z.m)),this.seed=e}current(){return this.seed/z.m}next(){return this.seed=(z.a*this.seed+z.c)%z.m,this.seed/z.m}nextInt(e=0,t=z.m){return t++,Math.floor(this.next()*(t-e)+e)}nextItem(e){return e[Math.floor(this.next()*e.length)]}removeNextItem(e){return e.splice(Math.floor(this.next()*e.length),1)[0]}static current(){return this.seed/this.m}static next(){return this.seed=(this.a*this.seed+this.c)%this.m,this.seed/this.m}static nextInt(e=0,t=this.m){return t++,Math.floor(this.next()*(t-e)+e)}static nextItem(e){return e[Math.floor(this.next()*e.length)]}static removeNextItem(e){return e.splice(Math.floor(this.next()*e.length),1)[0]}}z=H,H.seed=Math.floor(2147483647*Math.random()),H.m=2147483647,H.MAX_SEED=z.m,H.a=1103515245,H.c=12345;var a;function U(){}const $={error:!1};"undefined"!=typeof window&&window.addEventListener("error",function e(t){if(document.getElementById("game-script").src===t.filename){window.removeEventListener("error",e),$.error=!0;try{d.dispose()}catch(t){}document.getElementById("preloader").classList.remove("close"),document.getElementById("preloader").classList.add("error"),document.getElementById("preloader-msg").innerHTML="Sorry, the game crashed. Press here to reload."}});class q{constructor(e,t,i,s,n){this.state=0,this._promiseSet=!1,this.onfulfilled=this.onfulfilled.bind(this),this.onrejected=this.onrejected.bind(this),t!==U&&t.prototype&&l.warn("EventPromiseEntry success handler is not bound"),i!==U&&i.prototype&&l.warn("EventPromiseEntry failure handler is not bound"),s!==U&&s.prototype&&l.warn("EventPromiseEntry cancelSuccess handler is not bound"),n!==U&&n.prototype&&l.warn("EventPromiseEntry cancelFailure handler is not bound"),this._successTarget=t,this._failureTarget=i,this._cancelSuccessTarget=s,this._cancelFailureTarget=n,e&&this.setPromise(e)}setPromise(e){0===this.state&&(this._promiseSet?l.warn("EventPromiseEntry promise was already set!"):e.then(this.onfulfilled,this.onrejected).catch(this.onrejected))}cancel(){0===this.state&&(this.state=3,d.disposePromiseEntry(this))}onfulfilled(e){0===this.state?(this.state=1,this._successTarget(e),d.disposePromiseEntry(this)):3===this.state&&this._cancelSuccessTarget(e)}onrejected(e){0===this.state?(this.state=2,this._failureTarget(e),d.disposePromiseEntry(this)):3===this.state&&this._cancelFailureTarget(e)}}const d=new class{constructor(){this.listenerCount=0,this.timeoutCount=0,this._listenerEntries=[],this._timeoutEntries=[],this._promiseEntries=[],this._isDisposed=!1;let e=!1;var t=Object.defineProperty({},"passive",{get:function(){return e=!0,!0}});self.addEventListener("testPassive",null,t),self.removeEventListener("testPassive",null,t),this.isEventOptionsSupported=e}dispose(){if(!this._isDisposed){for(;0<this._listenerEntries.length;)this.remove(this._listenerEntries[0].target,this._listenerEntries[0].type,this._listenerEntries[0].callback);for(;0<this._timeoutEntries.length;)this.clearTimeout(this._timeoutEntries[0].callback);for(;0<this._promiseEntries.length;)this.disposePromiseEntry(this._promiseEntries[0]);this._isDisposed=!0}}promise(e,t,i,s=U,n=U){e=new q(e,t,i,s,n);return this._isDisposed?(l.warn("Tried to add a EventManager.promise after disposed!"),e.cancel()):this._promiseEntries.push(e),e}disposePromiseEntry(e){this._promiseEntries.length;e.cancel(),this._promiseEntries.splice(this._promiseEntries.indexOf(e),1)}add(e,t,i,s=!1,n=!0){if(!this._isDisposed){if(i.prototype)throw new Error("Must be bound!");if(0<=this.indexOf(e,t,i))throw new Error("Event handler already added!");this._listenerEntries.push({target:e,type:t,callback:i,capture:s,passive:n}),this.listenerCount++,this.isEventOptionsSupported?e.addEventListener(t,i,{capture:s,passive:n}):s?e.addEventListener(t,i,!0):e.addEventListener(t,i)}}remove(e,t,i){if(!this._isDisposed){var s=this.indexOf(e,t,i);if(s<0)throw new Error("Event handler is not added!");var n=this._listenerEntries[s];this._listenerEntries.splice(s,1),this.listenerCount--,this.isEventOptionsSupported?e.removeEventListener(t,i,{capture:n.capture,passive:n.passive}):n.capture?e.removeEventListener(t,i,!0):e.removeEventListener(t,i)}}contains(e,t,i){return 0<=this.indexOf(e,t,i)}indexOf(t,i,s){for(let e=0;e<this._listenerEntries.length;++e)if(this._listenerEntries[e].target===t&&this._listenerEntries[e].type===i&&this._listenerEntries[e].callback===s)return e;return-1}setTimeout(i,s,e,...n){if(this._isDisposed)return;if(i.prototype)throw new Error("Must be bound!");if(0<=this.indexOfTimeout(i))throw new Error("Timeout handler already added!");let o={callback:i,duration:s,args:n,id:null,repeat:e},r=(this._timeoutEntries.push(o),this.timeoutCount++,this);let a=o.id=setTimeout(function e(){var t=r.indexOfTimeout(i);r._timeoutEntries.splice(t,1),o.id=null,r.timeoutCount--,o.repeat&&(r._timeoutEntries.push(o),r.timeoutCount++,a=o.id=setTimeout(e,s)),o.callback.apply(null,n)},s)}clearTimeout(e){if(!this._isDisposed){e=this.indexOfTimeout(e);if(e<0)throw new Error("Timeout handler is not added!");var t=this._timeoutEntries[e];this._timeoutEntries.splice(e,1),this.timeoutCount--,clearTimeout(t.id),t.id=null}}containsTimeout(e){return 0<=this.indexOfTimeout(e)}indexOfTimeout(t){for(let e=0;e<this._timeoutEntries.length;++e)if(this._timeoutEntries[e].callback===t)return e;return-1}};class p{get isRunning(){return null!==this._worker}static register(e){if(this._runnables[e.classpath])throw new Error("Runnable already registered at classpath: "+e.classpath);this._runnables[e.classpath]=e}static dispose(){for(;0<this.active.length;)this.active[0].stop()}static sendMessage(e,t=null){if(this.isMainThread)throw new Error("On Main Thread!");e={type:e,data:t};self.postMessage(e)}static self_message(e){if(e.data.start){if(this._started)throw new Error("Already started!");this._started=!0;var t=this._runnables[e.data.start];if(!t)throw new Error("Could not find runnable with classpath: "+e.data.start);t.main(e.data.args)}else{t=e.data;this.onMessage.invoke(t)}}constructor(e){if(this.onMessage=new r,this._workerURL=null,this._worker=null,this._runnable=null,!p.isSupported)throw new Error("Threads are not supported!");if(!p.isMainThread)throw new Error("Child threads are not supported!");this.worker_message=this.worker_message.bind(this),this.worker_error=this.worker_error.bind(this),this._runnable=e}start(e){if(null!==this._worker)throw new Error("Already running!");if(p.active.length>=p.maxThreads)throw new Error("Maximum threads already started!");p.active.push(this),this._worker=new Worker(n.script.src),d.add(this._worker,"message",this.worker_message),d.add(this._worker,"error",this.worker_error),this._worker.postMessage({start:this._runnable.classpath,args:e})}stop(){if(null===this._worker)throw new Error("Not running!");d.remove(this._worker,"message",this.worker_message),d.remove(this._worker,"error",this.worker_error),this._worker.terminate(),this._worker=null,this._workerURL&&(URL.revokeObjectURL(this._workerURL),this._workerURL=null),p.active.splice(p.active.indexOf(this),1)}sendMessage(e,t=null){if(null===this._worker)throw new Error("Not running!");e={type:e,data:t};this._worker.postMessage(e)}worker_message(e){e=e.data;this.onMessage.invoke(e)}worker_error(e){throw e.error}}p.onMessage=new r,p.isSupported=!0,p.isMainThread=!1,p.maxThreads=0,p.active=[],p._started=!1,p._runnables={},p.staticConstructor=function(t){if(t.self_message=t.self_message.bind(t),"undefined"!=typeof Worker&&"undefined"!=typeof URL&&URL.createObjectURL?t.isSupported=!0:t.isSupported=!1,"undefined"!=typeof Window?t.isMainThread=!0:t.isMainThread=!1,t.isSupported&&t.isMainThread){let e=navigator.hardwareConcurrency||4;isNaN(e)||e<1?e=1:16<e&&(e=16),t.maxThreads=e}else t.maxThreads=0;t.isMainThread||d.add(self,"message",t.self_message)}(p);const t=p.isMainThread?new class{constructor(){var e,t=document,i=window,s=document.fonts&&document.fonts.add&&document.fonts.delete&&"undefined"!=typeof FontFace&&!!FontFace.prototype.load;this.fontFace={support:s?"W3C":"Unsupported",isSupported:s},this.webAudio={support:self.AudioContext?"W3C":self.webkitAudioContext?"WebKit":"Unsupported",isSupported:!(!self.AudioContext&&!self.webkitAudioContext)},i.PointerEvent&&"onpointerdown"in i?this.pointerEvents={support:"W3C",isSupported:!0,pointerover:"pointerover",pointerenter:"pointerenter",pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",pointercancel:"pointercancel",pointerout:"pointerout",pointerleave:"pointerleave"}:this.pointerEvents={support:"Unsupported",isSupported:!1},t.pointerLockElement!==e?this.pointerLock={support:"W3C",isSupported:!0,pointerLockElement:"pointerLockElement",requestPointerLock:"requestPointerLock",exitPointerLock:"exitPointerLock",pointerlockchange:"pointerlockchange",pointerlockerror:"pointerlockerror"}:t.webkitPointerLockElement!==e?this.pointerLock={support:"WebKit",isSupported:!0,pointerLockElement:"webkitPointerLockElement",requestPointerLock:"webkitRequestPointerLock",exitPointerLock:"webkitExitPointerLock",pointerlockchange:"webkitpointerlockchange",pointerlockerror:"webkitpointerlockerror"}:t.mozPointerLockElement!==e?this.pointerLock={support:"Moz",isSupported:!0,pointerLockElement:"mozPointerLockElement",requestPointerLock:"mozRequestPointerLock",exitPointerLock:"mozExitPointerLock",pointerlockchange:"mozpointerlockchange",pointerlockerror:"mozpointerlockerror"}:this.pointerLock={support:"Unsupported",isSupported:!1},t.fullscreenEnabled!==e?this.fullscreen={support:"W3C",isSupported:!0,fullscreenEnabled:"fullscreenEnabled",fullscreenElement:"fullscreenElement",requestFullscreen:"requestFullscreen",exitFullscreen:"exitFullscreen",fullscreenchange:"fullscreenchange",fullscreenerror:"fullscreenerror"}:t.webkitFullscreenEnabled!==e?this.fullscreen={support:"WebKit",isSupported:!0,fullscreenEnabled:"webkitFullscreenEnabled",fullscreenElement:"webkitFullscreenElement",requestFullscreen:"webkitRequestFullscreen",exitFullscreen:"webkitExitFullscreen",fullscreenchange:"webkitfullscreenchange",fullscreenerror:"webkitfullscreenerror"}:t.mozFullScreenEnabled!==e?this.fullscreen={support:"Moz",isSupported:!0,fullscreenEnabled:"mozFullScreenEnabled",fullscreenElement:"mozFullScreenElement",requestFullscreen:"mozRequestFullScreen",exitFullscreen:"mozCancelFullScreen",fullscreenchange:"mozfullscreenchange",fullscreenerror:"mozfullscreenerror"}:t.msFullscreenEnabled!==e?this.fullscreen={support:"MS",isSupported:!0,fullscreenEnabled:"msFullscreenEnabled",fullscreenElement:"msFullscreenElement",requestFullscreen:"msRequestFullscreen",exitFullscreen:"msExitFullscreen",fullscreenchange:"MSFullscreenChange",fullscreenerror:"MSFullscreenError"}:this.fullscreen={support:"Unsupported",isSupported:!1},t.visibilityState!==e?this.pageVisibility={support:"W3C",isSupported:!0,visibilityState:"visibilityState",visibilitychange:"visibilitychange"}:t.webkitVisibilityState!==e?this.pageVisibility={support:"WebKit",isSupported:!0,visibilityState:"webkitVisibilityState",visibilitychange:"webkitvisibilitychange"}:t.mozVisibilityState!==e?this.pageVisibility={support:"Moz",isSupported:!0,visibilityState:"mozVisibilityState",visibilitychange:"mozvisibilitychange"}:t.msVisibilityState!==e?this.pageVisibility={support:"MS",isSupported:!0,visibilityState:"msVisibilityState",visibilitychange:"msvisibilitychange"}:this.pageVisibility={support:"Unsupported",isSupported:!1}}}:null;class W{static dist(e,t,i,s){return ye.warn("Vector2::dist","Vector2::distance"),this.distance(e,i,t,s)}static distance(e,t,i,s){return e=i-e,t=s-t,Math.sqrt(e*e+t*t)}static dotProduct(e,t,i,s){return ye.warn("Vector2::dotProduct","Vector2::dot"),this.dot(e,i,t,s)}static dot(e,t,i,s){return e*i+t*s}constructor(e,t){this.x=e||0,this.y=t||0}set(e,t){return this.x=e,this.y=t,this}copy(e){return this.x=e.x,this.y=e.y,this}unit(e,t=1,i=!1){return i?(this.x=Math.cos(e*c.DEG_TO_RAD)*t,this.y=Math.sin(e*c.DEG_TO_RAD)*t):(this.x=c.cosDegrees(e)*t,this.y=c.sinDegrees(e)*t),this}normalize(e=1){var t=this.length();return 0<t&&(this.x/=t,this.y/=t),this.x*=e,this.y*=e,this}scale(e){return this.x*=e,this.y*=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addValues(e,t){return this.x+=e,this.y+=t,this}subtract(e){return this.x-=e.x,this.y-=e.y,this}subtractValues(e,t){return this.x-=e,this.y-=t,this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}floorTo(e){return e=Math.pow(10,e),this.x=Math.floor(this.x*e)/e,this.y=Math.floor(this.y*e)/e,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundTo(e){return e=Math.pow(10,e),this.x=Math.round(this.x*e)/e,this.y=Math.round(this.y*e)/e,this}rotation(){let e=Math.atan2(this.y,this.x)*c.RAD_TO_DEG;return e<0&&(e+=360),e}distance(e){return Math.sqrt((this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y))}distanceSquared(e){return(this.x-e.x)*(this.x-e.x)+(this.y-e.y)*(this.y-e.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}right(){var e=this.x;return this.x=this.y,this.y=-e,this}left(){var e=this.x;return this.x=-this.y,this.y=e,this}inverse(){return this.x*=-1,this.y*=-1,this}dotProduct(e){return ye.warn("Vector2::dotProduct","Vector2::dot"),this.dot(e)}dot(e){return this.x*e.x+this.y*e.y}crossProduct(e){return ye.warn("Vector2::crossProduct","Vector2::cross"),this.cross(e)}cross(e){return this.x*e.y-this.y*e.x}clone(){return new W(this.x,this.y)}toVector3(){return new j(this.x,this.y,0)}equals(e,t){return"number"==typeof e?this.x===e&&this.y===t:this.x===e.x&&this.y===e.y}interpolate(e,t){return t=t||new W,t.x=this.x*e,t.y=this.y*e,t}toString(){return"[Vector2 (x="+this.x+" y="+this.y+")]"}}class j{constructor(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}normalize(e=1){var t=this.length();return 0<t&&(this.x/=t,this.y/=t,this.z/=t),this.x*=e,this.y*=e,this.z*=e,this}scale(e){return this.x*=e,this.y*=e,this.z*=e,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addValues(e,t,i){return this.x+=e,this.y+=t,this.z+=i,this}subtract(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subtractValues(e,t,i){return this.x-=e,this.y-=t,this.z-=i,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}negate(){return ye.warn("Vector3::negate","Vector3::inverse"),this.inverse()}inverse(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){var t=this.x,i=this.y;return this.x=i*e.z-this.z*e.y,this.y=this.z*e.x-t*e.z,this.z=t*e.y-i*e.x,this}tangents(e,t){var i,s=this.length();0<s?(i=j._helper,s=1/s,i.set(this.x*s,this.y*s,this.z*s),s=j._helper2,Math.abs(i.x)<.9?s.set(1,0,0):s.set(0,1,0),e.copy(i).cross(s),t.copy(i).cross(e)):(e.set(1,0,0),t.set(0,1,0))}isAntiparallelTo(e,t){return j._helper.copy(this).inverse(),j._helper.almostEquals(e,t)}clone(){return new j(this.x,this.y,this.z)}toVector2(){return new W(this.x,this.y)}equals(e,t,i){return"number"==typeof e?this.x===e&&this.y===t&&this.z===i:this.x===e.x&&this.y===e.y&&this.z===e.z}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}}j._helper=new j,j._helper2=new j;const c=new class{constructor(){this.DEG_TO_RAD=Math.PI/180,this.RAD_TO_DEG=180/Math.PI,this.TWO_PI=2*Math.PI,this._lutCosDegrees=[],this._lutSinDegrees=[],this._v1=new W,this._v2=new W,this._lutCosDegrees.length=this._lutSinDegrees.length=3600;for(let e=0;e<3600;++e)this._lutCosDegrees[e]=Math.cos(this.DEG_TO_RAD*e/10),this._lutSinDegrees[e]=Math.sin(this.DEG_TO_RAD*e/10)}isInteger(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}isNonNegativeInteger(e){return this.isInteger(e)&&0<=e}isPowerOf2(e){return 0==(e&e-1)}truncate(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}roundTo(e,t){return e=+e,isFinite(e)&&(t=Math.pow(10,t),e*=t,e=Math.round(e),e/=t),e}clamp(e,t,i){return Math.max(t,Math.min(e,i))}cosDegrees(e){return e*=10,e=e+(0<=e?.5:-.5)<<0,e%=3600,e=-0===e?0:e,e=0<=e?e:e+3600,this._lutCosDegrees[e]}sinDegrees(e){return e*=10,e=e+(0<=e?.5:-.5)<<0,e%=3600,e=-0===e?0:e,e=0<=e?e:e+3600,this._lutSinDegrees[e]}areObjectsConverging(e,t,i,s){return this._v1.set(s.x-t.x,s.y-t.y).dot(this._v2.set(i.x-e.x,i.y-e.y))<0}interpolateAlongValues(e,t){if(t.length%2!=0)throw new Error("Odd number of values!");if(t.length<2)return new W(t[0],t[1]);if(e<=0)return new W(t[0],t[1]);if(1<=e)return new W(t[t.length-2],t[t.length-1]);var i=[];for(let e=0;e<t.length;e+=2)i.push(new W(t[e],t[e+1]));let s=0;var n=[0];for(let e=1;e<i.length;++e){var o=i[e-1],r=i[e];s+=r.distance(o),n.push(s)}if(0===s)return new W(t[0],t[1]);var a=e*s;for(let e=1;e<n.length;++e){var h,l,d,c=n[e],u=n[e-1];if(u<a&&a<=c)return h=i[e-1],l=i[e],l.subtract(h),d=a-u,c=c-u,u=new W,l.interpolate(d/c,u),u.add(h),u}throw new Error("Should never happen!")}normalizeDegrees(e){for(;e<0;)e+=360;for(;360<=e;)e-=360;return e}lineLineIntersection(e,t,i,s){var n;return e.x===t.x&&e.y===t.y||i.x===s.x&&i.y===s.y||(n=(s.y-i.y)*(t.x-e.x)-(s.x-i.x)*(t.y-e.y),0==n)?null:(s=((s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x))/n,i=e.x+s*(t.x-e.x),n=e.y+s*(t.y-e.y),new W(i,n))}};{var V=a=a||{};Math.PI,V.none=function(e,t,i,s){return i*e/s+t};let u;function Y(e,t,i,s,n,o){var r=.025*i,a=e,h=t,l=i+r,d=.7*s,c=e-d,t=t+i+r,i=-r,r=s-d;return e<=d?n(a,h,l,d):o(c,t,i,r)}b=u=V.Quadratic||(V.Quadratic={}),b.easeIn=function(e,t,i,s){return i*(e/=s)*e+t},b.easeOut=function(e,t,i,s){return-i*(e/=s)*(e-2)+t},b.easeInOut=function(e,t,i,s){return(e/=s/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},b=V.Cubic||(V.Cubic={}),b.easeOut=function(e,t,i,s){return e/=s,(1-Math.pow(1-e,3))*i+t},b=V.Circ||(V.Circ={}),b.easeOut=function(e,t,i,s){return e/=s,Math.sqrt(1-Math.pow(e-1,2))*i+t},b=V.Quart||(V.Quart={}),b.easeOut=function(e,t,i,s){return e/=s,(1-Math.pow(1-e,4))*i+t},b.easeIn=function(e,t,i,s){return e/=s,Math.pow(e,4)*i+t},b=V.Quint||(V.Quint={}),b.easeOut=function(e,t,i,s){return e/=s,(1-Math.pow(1-e,5))*i+t},b.easeIn=function(e,t,i,s){return e/=s,Math.pow(e,5)*i+t},b=V.Expo||(V.Expo={}),b.easeOut=function(e,t,i,s){return e/=s,(1==e?1:1-Math.pow(2,-10*e))*i+t},b=V.Overshoot||(V.Overshoot={}),b.softEaseOut=function(e,t,i,s){return Y(e,t,i,s,u.easeOut,V.none)},b.medEaseOut=function(e,t,i,s){return e=e,t=t,i=i,s=s,n=u.easeOut,o=V.none,r=.05*i,a=e,h=t,l=i+r,d=.7*s,c=e-d,t=t+i+r,i=-r,r=s-d,e<=d?n(a,h,l,d):o(c,t,i,r);var n,o,r,a,h,l,d,c},b.softEaseInOut=function(e,t,i,s){return Y(e,t,i,s,u.easeIn,u.easeOut)},b.eastOutPct30=function(e,t,i,s){return e=e,t=t,i=i,s=s,n=u.easeOut,o=V.none,r=.3*i,a=e,h=t,l=i+r,d=.7*s,c=e-d,t=t+i+r,i=-r,r=s-d,e<=d?n(a,h,l,d):o(c,t,i,r);var n,o,r,a,h,l,d,c},b=V.Bounce||(V.Bounce={}),b.easeOut=function(e,t,i,s){let n=e/s,o=(e=7.5625,s=2.75,0);return n<=0?t:1<=n?t+i:(o=n<1/s?e*n*n:n<2/s?e*(n-=1.5/s)*n+.75:n<2.5/s?e*(n-=2.25/s)*n+.9375:e*(n-=2.625/s)*n+.984375,o*i+t)},b=V.Rock||(V.Rock={}),b.easeOut=function(e,t,i,s){return s/=7,e<=s?u.easeIn(e,t,i,s):e<=2*s?u.easeOut(e-s,t+i,.5*i,s):e<=3*s?u.easeIn(e-2*s,t+1.5*i,-i/2,s):e<=4*s?u.easeOut(e-3*s,t+i,-i/4,s):e<=5*s?u.easeIn(e-4*s,t+.75*i,i/4,s):e<=6*s?u.easeOut(e-5*s,t+i,i/8,s):u.easeIn(e-6*s,t+1.125*i,-i/8,s)}}class X{get hasMoreLoops(){return this.total<0||this.count<this.total}constructor(e=-1,t=!1){this.total=0,this.count=0,this.total=e,this.reverseDirection=t}loop(e,t=!0){t?(this.count++,e.time-=e.duration):(this.count--,e.time+=e.duration),this.reverseDirection&&(t=e.start,e.start=e.end,e.end=t)}}class o{get duration(){return this._duration}set duration(e){if(e<=0)throw new Error("Supplied duration must be greater than 0!");this._duration=e}get value(){return this.ease.safeForExclusiveValues?this.ease(this.time-this.delay,this.start,this.end-this.start,this._duration):this.time<=this.delay?this.start:this.time-this.delay>=this.duration?this.end:this.ease(this.time-this.delay,this.start,this.end-this.start,this._duration)}get position(){return this.time<=this.delay?0:this.time-this.delay>=this.duration?1:(this.time-this.delay)/this._duration}get easedPosition(){return this.ease.safeForExclusiveValues?this.ease((this.time-this.delay)/this._duration,0,1,1):this.time<=this.delay?0:this.time-this.delay>=this.duration?1:this.ease((this.time-this.delay)/this._duration,0,1,1)}get isFinished(){return this.time>=this._duration+this.delay&&(!this.looper||!this.looper.hasMoreLoops)}constructor(e,t,i,s=0,n=null,o=null){this.onStarted=new r,this.onLooped=new r,this.onReverseLooped=new r,this.onFinished=new r,this._duration=1,this.time=0,this.delay=s,this.start=e,this.end=t,this.duration=i,this.ease=n||a.none,this.looper=o}underflow(){for(;this.time<0;)this.looper?(this.looper.loop(this,!1),this.onReverseLooped.count&&this.onReverseLooped.invoke(this)):this.time=0}overflow(){for(;this.time>this._duration+this.delay;)this.looper&&this.looper.hasMoreLoops?(this.looper.loop(this,!0),this.onLooped.count&&this.onLooped.invoke(this)):(this.time=this._duration+this.delay,this.onFinished.count&&this.onFinished.invoke(this))}reachedEnding(){this.looper&&this.looper.hasMoreLoops||this.onFinished.count&&this.onFinished.invoke(this)}update(e){let t=!1;return this.time<=this.delay&&(t=!0),this.time+=e,t&&this.time>this.delay&&this.onStarted.invoke(this),this.time<0?this.underflow():this.time===this._duration+this.delay?this.reachedEnding():this.time>this._duration+this.delay&&this.overflow(),this.value}}class J{constructor(e=0,t=0,i=50){this.origin=new W(e,t),this.radius=i}containsVector(e){return e.distanceSquared(this.origin)<this.radius*this.radius}}class K{get isIdentity(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.tx&&0===this.ty}constructor(e=1,t=0,i=0,s=1,n=0,o=0){this.a=e,this.b=t,this.c=i,this.d=s,this.tx=n,this.ty=o}set(e,t,i,s,n,o){return this.a=e,this.b=t,this.c=i,this.d=s,this.tx=n,this.ty=o,this}copy(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}identity(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this}setTransform(e,t,i,s,n,o,r,a,h){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0;let l,d;return d=n%360?(l=c.cosDegrees(n),c.sinDegrees(n)):(l=1,0),o||r?(this.append(c.cosDegrees(r),c.sinDegrees(r),-c.sinDegrees(o),c.cosDegrees(o),e,t),this.append(l*i,d*i,-d*s,l*s,0,0)):this.append(l*i,d*i,-d*s,l*s,e,t),(a||h)&&(this.tx-=a*this.a+h*this.c,this.ty-=a*this.b+h*this.d),this}invert(){var e=this.a,t=this.tx,i=e*this.d-this.b*this.c;return this.tx=(this.c*this.ty-this.d*t)/i,this.ty=-(this.a*this.ty-this.b*t)/i,this.a=this.d/i,this.b=-this.b/i,this.c=-this.c/i,this.d=e/i,this}append(e,t,i,s,n,o){var r=this.a,a=this.b,h=this.c,l=this.d;return 1===e&&0===t&&0===i&&1===s||(this.a=r*e+h*t,this.b=a*e+l*t,this.c=r*i+h*s,this.d=a*i+l*s),this.tx=r*n+h*o+this.tx,this.ty=a*n+l*o+this.ty,this}appendMatrix(e){var t=this.a,i=this.b,s=this.c,n=this.d;return 1===e.a&&0===e.b&&0===e.c&&1===e.d||(this.a=t*e.a+s*e.b,this.b=i*e.a+n*e.b,this.c=t*e.c+s*e.d,this.d=i*e.c+n*e.d),this.tx=t*e.tx+s*e.ty+this.tx,this.ty=i*e.tx+n*e.ty+this.ty,this}appendTransform(e,t,i,s,n,o,r,a,h){let l,d;return d=n%360?(l=c.cosDegrees(n),c.sinDegrees(n)):(l=1,0),o||r?(this.append(c.cosDegrees(r),c.sinDegrees(r),-c.sinDegrees(o),c.cosDegrees(o),e,t),this.append(l*i,d*i,-d*s,l*s,0,0)):this.append(l*i,d*i,-d*s,l*s,e,t),(a||h)&&(this.tx-=a*this.a+h*this.c,this.ty-=a*this.b+h*this.d),this}prepend(e,t,i,s,n,o){var r=this.a,a=this.c,h=this.tx;return this.a=e*r+i*this.b,this.b=t*r+s*this.b,this.c=e*a+i*this.d,this.d=t*a+s*this.d,this.tx=e*h+i*this.ty+n,this.ty=t*h+s*this.ty+o,this}prependMatrix(e){var t=this.a,i=this.c,s=this.tx;return this.a=e.a*t+e.c*this.b,this.b=e.b*t+e.d*this.b,this.c=e.a*i+e.c*this.d,this.d=e.b*i+e.d*this.d,this.tx=e.a*s+e.c*this.ty+e.tx,this.ty=e.b*s+e.d*this.ty+e.ty,this}prependTransform(e,t,i,s,n,o,r,a,h){e=K._helper.setTransform(e,t,i,s,n,o,r,a,h);return this.prepend(e.a,e.b,e.c,e.d,e.tx,e.ty)}transformVector(e){var t=e.x,i=e.y;return e.x=t*this.a+i*this.c+this.tx,e.y=t*this.b+i*this.d+this.ty,e}clone(){return new K(this.a,this.b,this.c,this.d,this.tx,this.ty)}equals(e){return e.a===this.a&&e.b===this.b&&e.c===this.c&&e.d===this.d&&e.tx===this.tx&&e.ty===this.ty}toString(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"}}K._helper=new K;class Q{constructor(e,t,i,s){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0===s?1:s}identity(){this.x=this.y=this.z=0,this.w=1}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setFromVectors(e,t){var i,s;return e.isAntiparallelTo(t)?(i=Q._helperVec1,s=Q._helperVec2,e.tangents(i,s),this.setFromAxisAngle(i,Math.PI)):(s=e.cross(t),this.x=s.x,this.y=s.y,this.z=s.z,this.w=Math.sqrt(Math.pow(e.length(),2)*Math.pow(t.length(),2))+e.dot(t),this.normalize()),this}setFromAxisAngle(e,t){var i=Math.sin(.5*t);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t),this}setFromEuler(e,t,i,s){s=s||0;var n=Math.cos(e/2),o=Math.cos(t/2),r=Math.cos(i/2),e=Math.sin(e/2),t=Math.sin(t/2),i=Math.sin(i/2);return 0===s?(this.x=e*o*r+n*t*i,this.y=n*t*r-e*o*i,this.z=n*o*i+e*t*r,this.w=n*o*r-e*t*i):1===s?(this.x=e*o*r+n*t*i,this.y=n*t*r-e*o*i,this.z=n*o*i-e*t*r,this.w=n*o*r+e*t*i):2===s?(this.x=e*o*r-n*t*i,this.y=n*t*r+e*o*i,this.z=n*o*i+e*t*r,this.w=n*o*r-e*t*i):3===s?(this.x=e*o*r-n*t*i,this.y=n*t*r+e*o*i,this.z=n*o*i-e*t*r,this.w=n*o*r+e*t*i):4===s?(this.x=e*o*r+n*t*i,this.y=n*t*r+e*o*i,this.z=n*o*i-e*t*r,this.w=n*o*r-e*t*i):5===s&&(this.x=e*o*r-n*t*i,this.y=n*t*r-e*o*i,this.z=n*o*i+e*t*r,this.w=n*o*r+e*t*i),this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}normalize(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0==e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}integrate(e,t,i){var s=e.x*i.x,n=e.y*i.y,e=e.z*i.z,i=this.x,o=this.y,r=this.z,a=this.w,t=.5*t;return this.x+=t*(s*a+n*r-e*o),this.y+=t*(n*a+e*i-s*r),this.z+=t*(e*a+s*o-n*i),this.w+=t*(-s*i-n*o-e*r),this}vmult(e,t){return ye.warn("Quaternion::vmult","Quaternion::transformVector"),t=t||new j,t.copy(e),this.transformVector(t)}transformVector(e){var t=e.x,i=e.y,s=e.z,n=this.x,o=this.y,r=this.z,a=this.w,h=a*t+o*s-r*i,l=a*i+r*t-n*s,d=a*s+n*i-o*t,t=-n*t-o*i-r*s;return e.x=h*a+t*-n+l*-r-d*-o,e.y=l*a+t*-o+d*-n-h*-r,e.z=d*a+t*-r+h*-o-l*-n,e}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}}Q._helperVec1=new j,Q._helperVec2=new j;class h{get isEmpty(){return 0===this.width||0===this.height}get bottom(){return this.y+this.height}get right(){return this.x+this.width}constructor(e,t,i,s){this.x=e||0,this.y=t||0,this.width=i||0,this.height=s||0}set(e,t,i,s){return this.x=e,this.y=t,this.width=i,this.height=s,this}copy(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this}containsVector(e){return e.x>=this.x&&e.x<this.x+this.width&&e.y>=this.y&&e.y<this.y+this.height}extend(e){var t=Math.min(this.x,e.x),i=Math.min(this.y,e.y),s=Math.max(this.x+this.width,e.x+e.width),e=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.y=i,this.width=s,this.height=e,this}equals(e){return e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height}clone(){return new h(this.x,this.y,this.width,this.height)}toString(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"}}const u=new class{genCombosTable(t){var i=[];i.length=t.length+1;for(let e=0;e<i.length;++e)i[e]=this.genCombos(t,e);return i}genCombos(e,t){var i=[],s=(i.length=t,[]);return this.genCombosRecursion(e,0,t,i,0,s),s}genCombosRecursion(t,i,s,n,o,r){if(o===s)r.push(n.slice());else for(let e=i;e<t.length;++e)n[o]=t[e],this.genCombosRecursion(t,e+1,s,n,o+1,r)}validateBoolean(e,t){return null==e||!0!==e&&!1!==e?t:e}validateIntArrayMinInclusive(t,i,s){if(!Array.isArray(t))return s;for(let e=0;e<t.length;++e){var n=t[e];if(null==n)return s;if("number"!=typeof n)return s;if(n<i)return s;n|=0,t[e]=n}return t}validateIntMinInclusive(e,t,i){return null==e||"number"!=typeof e||e<t?i:0|e}validateNumberMinInclusive(e,t,i){return null==e||"number"!=typeof e||e<t?i:e}validateNumberRangeInclusive(e,t,i,s){return null==e||"number"!=typeof e||e<t||i<e?s:e}validateOneOf(e,t,i){return 0<=t.indexOf(e)?e:i}isInt(e){return Number.isSafeInteger(e)}isIntMin(e,t){return Number.isSafeInteger(e)&&t<=e}isIntMax(e,t){return Number.isSafeInteger(e)&&e<=t}isIntMinMax(e,t,i){return Number.isSafeInteger(e)&&t<=e&&e<=i}dataURLToArrayBuffer(e){var t=e.indexOf(";base64,"),e=e.substr(t+8);return this.base64ToArrayBuffer(e)}base64ToArrayBuffer(e){var t=window.atob(e),i=t.length,s=new Uint8Array(i);for(let e=0;e<i;++e)s[e]=t.charCodeAt(e);return s.buffer}bytesToBase64(i){let s="";for(let t=0;t<i.length;t+=8192){let e=t+8192;e>i.length&&(e=i.length),s+=String.fromCharCode.apply(null,i.subarray(t,e))}return btoa(s)}toNumericString(e,t=0){let i=!1,s=(e<0&&(i=!0,e*=-1),e.toString()),n="";if(0<=s.indexOf(".")&&(e=s.split("."),n=e[1],s=e[0]),0===t)n="";else if(0<t)if(n.length>t)n=n.substring(0,t);else for(;n.length<t;)n+="0";let o=3;for(;;){if(!(s.length>o))break;s=s.substr(0,s.length-o)+","+s.substr(s.length-o),o+=4}e=i?"-":"";return""!==n&&null!==n&&void 0!==n?e+s+"."+n:e+s}toPlaceString(e,t=!1){return(t?u.toNumericString(e):e)+this.getPlaceSuffix(e)}getPlaceSuffix(e){return 4<=e&&e<=20?"th":(e=e%10,1==e?"st":2==e?"nd":3==e?"rd":"th")}buildEvent(e,t,i){let s;try{s=new self[e](t,i)}catch(e){}if(!s){if(!self.document)return null;for(var n in s=self.document.createEvent("Event"),s.initEvent(t,i.bubbles,i.cancelable),i)void 0===s[n]&&(s[n]=i[n])}return s}toTimerString(t,i=0){var e=Math.floor(t/1e3),s=Math.floor(e/60/60),n=Math.floor((e-60*s*60)/60),o=Math.floor(e-(60*s*60+60*n));t=(t-1e3*e)/1e3;let r="",a=(0<s&&(r=s.toString()+":"),n.toString()),h=(1===a.length&&(a="0"+a),o.toString());if(1===h.length&&(h="0"+h),0<i){t=Math.floor(t*Math.pow(10,i));let e=t.toString();for(;e.length<i;)e="0"+e;return r+a+":"+h+"."+e}return r+a+":"+h}openLink(e,i,s=null){if(s=s||"_blank",e)l.info("opening as native app link"),window.open(i,"_system");else{e=window.open(i,"_blank");if(void 0===e){l.info("popup blocker got link, opening via hidden link ("+s+"): "+i);let t=null;try{t=document.getElementById("com.battleline.util.hiddenLink")}catch(e){t=null}t||(t=document.createElement("a"),t.id="com.battleline.util.hiddenLink",t.style.display="none",t.href="",t.target="_blank",document.body.insertBefore(t,document.body.firstChild));e=document.createEvent("Event");t.href=i,t.target=s,e.initEvent("click",!0,!1),t.dispatchEvent(e)}}}getTimeLeftInDay(){var e=new Date;return 864e5-(60*e.getHours()*60*1e3+60*e.getMinutes()*1e3+1e3*e.getSeconds()+e.getMilliseconds())}};const Z=new class{constructor(){if(this.isMobileDevice=!1,p.isMainThread){var e=document.getElementById("game-script");if(e.hasAttribute("data-runtime")){e=e.getAttribute("data-runtime");if(!(0<=["Web App"].indexOf(e)))throw new Error("Unknown runtime: "+e);this.runtime=e}else this.runtime="Web App"}else this.runtime="Thread";if(this.isWebRuntime="Web App"===this.runtime,"Thread"===this.runtime)this.os="UNKNOWN",this.device="UNKNOWN",this.browser="UNKNOWN";else{if(!this.isWebRuntime)throw new Error("Not implemented!");e=navigator.userAgent.toLowerCase();this.os=this.detectOS(e),this.device=this.detectDevice(e),this.browser=this.detectBrowser(e)}this.isMobileDevice=p.isMainThread&&("Handheld"===this.device||"Tablet"===this.device||"android-auto"===window.games247.nativeAppType)}detectOS(e){return 0<=e.indexOf("cros")?"Chrome OS":0<=e.indexOf("android")?0<=e.indexOf("kindle")||0<=e.indexOf("; kf")||0<=e.indexOf("silk/")?"Fire OS":"Android":0<=e.indexOf("iphone")&&e.indexOf("like iphone")<0||0<=e.indexOf("ipad")&&e.indexOf("like ipad")<0||0<=e.indexOf("ipod")&&e.indexOf("like ipod")<0?"Apple iOS":0<=e.indexOf("mac os x ")?navigator.maxTouchPoints?"Apple iOS":"Mac OS":0<=e.indexOf("windows phone os ")?"Windows Phone":0<=e.indexOf("windows")?"Windows":"UNKNOWN"}detectDevice(e){return"Chrome OS"===this.os||"Mac OS"===this.os||"Windows"===this.os?"Computer":"Apple iOS"===this.os?0<=e.indexOf("ipod")||0<=e.indexOf("iphone")?"Handheld":"Tablet":"Fire OS"===this.os?"Tablet":"Android"===this.os?0<=e.indexOf("mobile")?"Handheld":"Tablet":"Windows Phone"===this.os?"Handheld":"UNKNOWN"}detectBrowser(e){return navigator.brave&&navigator.brave.isBrave?"Brave":0<=e.indexOf("silk/")?"Silk":0<=e.indexOf("[fban/")||0<=e.indexOf("[fb_iab/")?"Facebook":0<=e.indexOf("edge/")?"Edge":0<=e.indexOf("edg/")?"Edge Chromium":0<=e.indexOf("firefox/")||0<=e.indexOf("fxios/")?"Firefox":0<=e.indexOf("opr/")||0<=e.indexOf("opera/")?"Opera":0<=e.indexOf("vivaldi/")?"Vivaldi":0<=e.indexOf("samsungbrowser/")?"Samsung":0<=e.indexOf("chrome/")||0<=e.indexOf("crios/")?"Chrome":"Apple iOS"===this.os||"Mac OS"===this.os?"Safari":0<=e.indexOf("trident/")||0<=e.indexOf("msie")?"IE":"UNKNOWN"}};class ee{constructor(){this.major=0,this.minor=0,this.build=0,this.revision=0,this.str="0.0.0.0",this.name="Unknown"}fromName(e){this.str="0.0.0.0",this.major=this.minor=this.build=this.revision=0,this.name=e}fromVersionString(e,t){this.str=e,this.name=t||"";t=e.split(".");return this.major=0<t.length?parseInt(t[0],10):0,this.minor=1<t.length?parseInt(t[1],10):0,this.build=2<t.length?parseInt(t[2],10):0,this.revision=3<t.length?parseInt(t[3],10):0,this}fromVersionNumbers(e,t,i,s,n){return this.major=e||0,this.minor=t||0,this.build=i||0,this.revision=s||0,this.name=n||"",this.str="",void 0!==e&&(this.str+=e),void 0!==t&&(this.str+="."+t),void 0!==i&&(this.str+="."+i),void 0!==s&&(this.str+="."+s),this}static compare(e,t){return e.major<t.major?-1:e.major>t.major?1:e.minor<t.minor?-1:e.minor>t.minor?1:e.build<t.build?-1:e.build>t.build?1:e.revision<t.revision?-1:e.revision>t.revision?1:0}toString(){let e="";return""!==this.name&&(e+=this.name+" "),e+this.str}}class te{constructor(e,t,i,s,n,o){this.family=e,this.weight=t,this.style=i,this.ascent=s,this.descent=n,this.unitsPerEm=o}cssFont(e){return this.style+" "+this.weight+" "+e+"px "+this.family}}const ie=p.isMainThread?function(){let t;var e="$isSupported",i="true";t=self.localStorage;try{t.setItem(e,i),t.getItem(e)!==i?t=null:t.removeItem(e),t.constructor.prototype.mode=0}catch(e){t=null}if(!t){l.warn("LocalStorage is unsupported.");try{t=self.sessionStorage,t.getItem(e)!==i?t=null:t.removeItem(e),t.constructor.prototype.mode=1}catch(e){t=null}}return t||l.warn("SessionStorage is unsupported."),t=t||new class{constructor(){this.mode=2,this._keys=[],this._data={}}get length(){return this._keys.length}clear(){this._keys=[],this._data={}}getItem(e){return e+="",this._data.hasOwnProperty(e)?this._data[e]:null}key(e){return 0<=e&&e<this._keys.length?this._keys[e]:null}removeItem(e){e+="",this._data.hasOwnProperty(e)&&(this._keys.splice(this._keys.indexOf(e),1),delete this._data[e])}setItem(e,t){e+="",t+="",this._data.hasOwnProperty(e)||this._keys.push(e),this._data[e]=t}},t}():null;class se{constructor(e){this.name=e}write(e){let t;try{t=JSON.stringify(e)}catch(e){l.warn("Storable ("+this.name+"): Error stringifying data. Defaulting to empty object.",e),t="{}"}try{ie.setItem(this.name,t)}catch(e){l.warn("Storable ("+this.name+"): Error setting json.",+e)}}read(){let t,i=null;try{t=ie.getItem(this.name)}catch(e){l.warn("Storable ("+this.name+"): Error getting json. Defaulting to empty object.",e),t="{}"}void 0!==t&&null!==t&&"null"!==t&&"undefined"!==t&&""!==t||(t="{}");try{i=JSON.parse(t)}catch(e){l.warn("Storable ("+this.name+"): Error parsing json ("+t+"). Defaulting to empty object.",e),i={}}return null!==i&&void 0!==i||(i={}),i}destroy(){try{ie.removeItem(this.name)}catch(e){l.warn("Storable ("+this.name+"): Error destroying.",e)}}}const n=p.isMainThread?new class{constructor(){this.onPauseChange=new r,this.defaultPreferFullscreen=Z.isMobileDevice&&t.fullscreen.isSupported&&"Apple iOS"!==Z.os,this.preferFullscreen=this.defaultPreferFullscreen,this.pauseElement_click=this.pauseElement_click.bind(this),this.script=document.getElementById("game-script"),this.element=document.getElementById("app-player"),this.pauseElement=document.getElementById("pause")}initialize(){Z.isMobileDevice&&!window.games247.nativeAppType?this.isPaused=!0:this.isPaused=!1,this.isPaused&&(this.pauseElement.style.display="block"),d.add(this.pauseElement,"click",this.pauseElement_click,!0,!0)}updateState(e){window.games247.nativeAppType&&(e=!1),this.isPaused!==e&&(this.isPaused=e,this.isPaused?this.pauseElement.style.display="block":this.pauseElement.style.display="none",y.AppPlayer_pauseChange(),0<this.onPauseChange.count)&&this.onPauseChange.invoke()}closeSplash(){if(document.getElementById("preloader").classList.add("close"),"android-auto"===window.games247.nativeAppType)if(void 0!==navigator.splashscreen)l.info("CLOSING VIEW navigator"),navigator.splashscreen.hide();else try{l.info("CLOSING VIEW window"),window.SplashScreenWebInterface.hide()}catch(e){}}preloadError(){document.getElementById("preloader").classList.add("error"),document.getElementById("preloader-msg").innerHTML="Sorry, we couldn't load the game. Press here to reload."}preloadProgress(e,t,i){document.getElementById("preloader-msg").innerHTML="LOADING "+Math.floor(100*i)+"%"}pause(){m.fullscreen.isFullscreen&&m.fullscreen.exitFullscreen(),this.updateState(!0)}App_fullscreenChange(){this.preferFullscreen&&(m.fullscreen.isFullscreen?this.updateState(!1):this.updateState(!0))}App_deactivate(){this.preferFullscreen&&this.updateState(!0)}pauseElement_click(){this.preferFullscreen?m.fullscreen.requestFullscreen():(document.body.scrollTop=0,document.documentElement.scrollTop=0,this.updateState(!1))}}:null;class ne{constructor(){this.onViewChange=new r,this.pixelRatio=1,this.rect={x:1,y:1,w:1,h:1},this.orientation=0,this.domRect={x:1,y:1,w:1,h:1},this._invalid=!1,this._minValidationInterval=100,this._lastValidationTime=0,this.window_resizescroll=this.window_resizescroll.bind(this)}initialize(){this.resize(),d.add(window,"resize",this.window_resizescroll,!0,!0),d.add(window,"scroll",this.window_resizescroll,!0,!0)}poll(){this._invalid&&Date.now()-this._lastValidationTime>=this._minValidationInterval&&(this._invalid=!1,this._lastValidationTime=Date.now(),this.resize())&&(y.GameWindow_view_change(),0<this.onViewChange.count)&&this.onViewChange.invoke()}invalidate(e){e&&(this._lastValidationTime=0),this._invalid||(this._invalid=!0,y.GameWindow_view_invalidated())}resize(){let e=window.devicePixelRatio||(screen.deviceXDPI&&screen.logicalXDPI?screen.deviceXDPI/screen.logicalXDPI:1);ve.resize();var t=n.element.getBoundingClientRect(),t={x:t.left*e,y:t.top*e,w:Math.max(1,t.width*e),h:Math.max(1,t.height*e)};let i=!1;return(e<=0||!isFinite(e))&&(e=1),e===this.pixelRatio&&t.x===this.rect.x&&t.y===this.rect.y&&t.w===this.rect.w&&t.h===this.rect.h||(this.pixelRatio=e,this.rect.x=t.x,this.rect.y=t.y,this.rect.w=t.w,this.rect.h=t.h,this.orientation=this.rect.w>=this.rect.h?0:1,this.domRect.x=t.x/e,this.domRect.y=t.y/e,this.domRect.w=t.w/e,this.domRect.h=t.h/e,i=!0),i}window_resizescroll(){this.invalidate(!1)}}class oe{constructor(){this.onFocusChange=new r,this.window_focusblur=this.window_focusblur.bind(this)}initialize(){this.isFocused=document.hasFocus(),d.add(window,"focus",this.window_focusblur,!0,!0),d.add(window,"blur",this.window_focusblur,!0,!0)}updateState(){var e=document.hasFocus();this.isFocused!==e&&(this.isFocused=e,y.GameWindow_focus_change(),0<this.onFocusChange.count)&&this.onFocusChange.invoke()}window_focusblur(){this.updateState()}}class re{constructor(){this.onVisibilityChange=new r,this.document_visibilitychange=this.document_visibilitychange.bind(this)}initialize(){t.pageVisibility.isSupported?(this.isVisible="visible"===document[t.pageVisibility.visibilityState],d.add(document,t.pageVisibility.visibilitychange,this.document_visibilitychange,!0,!0)):this.isVisible=!0}updateState(){var e="visible"===document[t.pageVisibility.visibilityState];this.isVisible!==e&&(this.isVisible=e,y.GameWindow_visibility_change(),0<this.onVisibilityChange.count)&&this.onVisibilityChange.invoke()}document_visibilitychange(){this.updateState()}}class ae{constructor(){this.onFullscreenChange=new r,this.isFullscreen=!1,this.isSupported=!1}initialize(){}poll(){}}class he extends ae{constructor(){super(),this.isSupported=!0}updateState(e){this.isFullscreen!==e&&(this.isFullscreen=e,y.GameWindow_fullscreen_change(),0<this.onFullscreenChange.count)&&this.onFullscreenChange.invoke()}requestFullscreen(){this.isFullscreen||(document.documentElement.classList.add("cssfs"),this.updateState(!0))}exitFullscreen(){this.isFullscreen&&(document.documentElement.classList.remove("cssfs"),this.updateState(!1))}toggleFullscreen(){this.isFullscreen?this.exitFullscreen():this.requestFullscreen()}}class le extends ae{constructor(){super(),this._enabled=!1,this._expanded=!1,this._dragging=!1,this._pendingScroll=0,this._minMeasureInterval=100,this._lastMeasureTime=0,this.window_touchEvt=this.window_touchEvt.bind(this),this.window_scroll=this.window_scroll.bind(this),this.isSupported=!0}initialize(){this.isFullscreen=!1,this._pctElement=document.getElementById("expfs-pct"),this._vhElement=document.getElementById("expfs-vh"),this._fixedElement=document.getElementById("expfs-fixed")}dispose(){document.documentElement.classList.remove("expfs"),document.documentElement.classList.remove("expfs-expanded"),this._enabled&&(d.remove(window,"touchstart",this.window_touchEvt),d.remove(window,"touchend",this.window_touchEvt),d.remove(window,"touchcancel",this.window_touchEvt)),this._pctElement=null,this._vhElement=null,this._fixedElement=null}requestFullscreen(){this._enabled||(this._enabled=!0,document.documentElement.classList.add("expfs"),d.add(window,"touchstart",this.window_touchEvt,!0,!1),d.add(window,"touchend",this.window_touchEvt,!0,!1),d.add(window,"touchcancel",this.window_touchEvt,!0,!1),d.add(window,"scroll",this.window_scroll,!0,!0),this.measure()&&this.updateState())}exitFullscreen(){this._enabled&&(this._enabled=!1,this._lastMeasureTime=0,this._dragging=!1,this._expanded=!1,this._pendingScroll=0,document.documentElement.classList.remove("expfs"),document.documentElement.classList.remove("expfs-expanded"),d.remove(window,"touchstart",this.window_touchEvt),d.remove(window,"touchend",this.window_touchEvt),d.remove(window,"touchcancel",this.window_touchEvt),d.remove(window,"scroll",this.window_scroll),this.updateState())}toggleFullscreen(){this._enabled?this.exitFullscreen():this.requestFullscreen()}measure(){this._lastMeasureTime=Date.now();var e=window.innerHeight,t=this._pctElement.clientHeight,i=this._vhElement.clientHeight,s=this._fixedElement.clientHeight;let n=t<e&&e<=s||e===t&&e===i?!0:!1;return!this._expanded&&!this._dragging&&0<this._pendingScroll&&(this._pendingScroll--,document.body.scrollTop=0,document.documentElement.scrollTop=0),n&&!this._expanded?(this._expanded=!0,document.documentElement.classList.add("expfs-expanded"),!0):!(n||!this._expanded||(this._expanded=!1,document.documentElement.classList.remove("expfs-expanded"),document.body.scrollTop=0,document.documentElement.scrollTop=0,0))}updateState(){this.isFullscreen!==this._expanded&&(this.isFullscreen=this._expanded,y.GameWindow_fullscreen_change(),0<this.onFullscreenChange.count)&&this.onFullscreenChange.invoke()}poll(){this._enabled&&Date.now()-this._lastMeasureTime>=this._minMeasureInterval&&this.measure()&&this.updateState()}window_touchEvt(e){this._expanded&&("touchstart"===e.type?e.cancelable&&e.preventDefault():"touchend"!==e.type&&"touchcancel"!==e.type||this._pendingScroll),"touchstart"===e.type?this._dragging=!0:this._dragging=!1}window_scroll(){this._pendingScroll=2}}class de extends ae{constructor(){super(),this.document_fullscreenchangeerror=this.document_fullscreenchangeerror.bind(this),this.isSupported=!0}initialize(){this.isFullscreen=document[t.fullscreen.fullscreenElement]===n.element,d.add(document,t.fullscreen.fullscreenchange,this.document_fullscreenchangeerror,!0,!0),d.add(document,t.fullscreen.fullscreenerror,this.document_fullscreenchangeerror,!0,!0)}dispose(){d.remove(document,t.fullscreen.fullscreenchange,this.document_fullscreenchangeerror),d.remove(document,t.fullscreen.fullscreenerror,this.document_fullscreenchangeerror)}requestFullscreen(){var e;this.isFullscreen||(e=n.element[t.fullscreen.requestFullscreen]({navigationUI:"hide"}),e&&d.promise(e,U,U))}exitFullscreen(){var e;document[t.fullscreen.fullscreenElement]&&(e=document[t.fullscreen.exitFullscreen](),e)&&d.promise(e,U,U)}toggleFullscreen(){this.isFullscreen?this.requestFullscreen():this.exitFullscreen()}updateState(){var e=document[t.fullscreen.fullscreenElement]===n.element;this.isFullscreen!==e&&(this.isFullscreen=e,y.GameWindow_fullscreen_change(),0<this.onFullscreenChange.count)&&this.onFullscreenChange.invoke()}document_fullscreenchangeerror(){this.updateState()}}const m=p.isMainThread?new class{constructor(){this.view=new ne,this.focus=new oe,this.visibility=new re,this.window_keydown=this.window_keydown.bind(this),"android-auto"===window.games247.nativeAppType?(l.info("Fullscreen disabled in android auto builds."),this.fullscreen=new he):window.games247.isEmbed?document[t.fullscreen.fullscreenEnabled]?this.fullscreen=new de:(l.warn("Fullscreen is disabled because document."+t.fullscreen.fullscreenEnabled+" is "+document[t.fullscreen.fullscreenEnabled]),this.fullscreen=new he):"Apple iOS"===Z.os?"Safari"===Z.browser?(l.info("Using Expansion based fullscreen functionality."),this.fullscreen=new le):(l.info("Using fallback fullscreen on iOS. Try using Safari."),this.fullscreen=new he):t.fullscreen.isSupported?document[t.fullscreen.fullscreenEnabled]?this.fullscreen=new de:(l.warn("Fullscreen is disabled because document."+t.fullscreen.fullscreenEnabled+" is "+document[t.fullscreen.fullscreenEnabled]),this.fullscreen=new he):(l.info("No fullcreen modes are supported. Using CSS fallback."),this.fullscreen=new he)}initialize(){this.view.initialize(),this.focus.initialize(),this.visibility.initialize(),this.fullscreen.initialize(),d.add(window,"keydown",this.window_keydown,!0,!0)}poll(){this.view.poll(),this.fullscreen.poll()}window_keydown(e){this.fullscreen.exitFullscreen()}App_pauseChange(){n.isPaused&&this.fullscreen.exitFullscreen(),this.view.invalidate(!0)}App_fullscreenChange(){this.view.invalidate(!0)}App_visibilityChange(){this.view.invalidate(!0),this.fullscreen.exitFullscreen()}}:null;class g{constructor(...t){this.onPress=new r,this.onRepeat=new r,this.onRelease=new r,this.onCancel=new r,this.name="",this.mappings=[],this.isPressed=!1;for(let e=0;e<t.length;e+=2)this.mappings.push({id:t[e],location:t[e+1]})}press(e){this.isPressed||(this.isPressed=!0,ue.onPress.invoke(this,e),this.isPressed&&this.onPress.invoke(this,e))}repeat(e){this.isPressed&&(ue.onRepeat.invoke(this,e),this.isPressed)&&this.onRepeat.invoke(this,e)}release(e){this.isPressed&&(this.isPressed=!1,ue.onRelease.invoke(this,e),this.onRelease.invoke(this,e))}cancel(){this.isPressed&&(this.isPressed=!1,ue.onCancel.invoke(this),this.onCancel.invoke(this))}}class ce{constructor(){this.Escape=new g("Escape",0,"Esc",0),this.Backspace=new g("Backspace",0),this.Delete=new g("Delete",0,"Del",0),this.Space=new g(" ",0,"Spacebar",0),this.Tab=new g("Tab",0),this.Enter=new g("Enter",0),this.Home=new g("Home",0),this.End=new g("End",0),this.PageUp=new g("PageUp",0),this.PageDown=new g("PageDown",0),this.LeftShift=new g("Shift",1),this.RightShift=new g("Shift",2),this.LeftCtrl=new g("Control",1),this.RightCtrl=new g("Control",2),this.LeftOS=new g("Meta",1,"OS",1,"Win",1),this.RightOS=new g("Meta",2,"OS",2,"Win",2),this.LeftAlt=new g("Alt",1),this.RightAlt=new g("Alt",2),this.ContextMenu=new g("ContextMenu",0,"Apps",0),this.CapsLock=new g("CapsLock",0),this.Insert=new g("Insert",0),this.ScrollLock=new g("ScrollLock",0,"Scroll",0),this.Top1=new g("1",0,"!",0),this.Top2=new g("2",0,"@",0),this.Top3=new g("3",0,"#",0),this.Top4=new g("4",0,"$",0),this.Top5=new g("5",0,"%",0),this.Top6=new g("6",0,"^",0),this.Top7=new g("7",0,"&",0),this.Top8=new g("8",0,"*",0),this.Top9=new g("9",0,"(",0),this.Top0=new g("0",0,")",0),this.TopDash=new g("-",0,"_",0),this.TopEquals=new g("=",0,"+",0),this.NumLock=new g("NumLock",0),this.NumpadForwardSlash=new g("/",3,"Divide",3),this.NumpadStar=new g("*",3,"Multiply",3),this.NumpadMinus=new g("-",3,"Subtract",3),this.NumpadPlus=new g("+",3,"Add",3),this.NumpadEnter=new g("Enter",3),this.NumpadDecimal=new g(".",3,"Decimal",3,"Del",3,"Delete",3),this.Numpad0=new g("0",3,"Insert",3),this.Numpad1=new g("1",3,"End",3),this.Numpad2=new g("2",3,"ArrowDown",3,"Down",3),this.Numpad3=new g("3",3,"PageDown",3),this.Numpad4=new g("4",3,"ArrowLeft",3,"Left",3),this.Numpad5=new g("5",3,"Clear",3),this.Numpad6=new g("6",3,"ArrowRight",3,"Right",3),this.Numpad7=new g("7",3,"Home",3),this.Numpad8=new g("8",3,"ArrowUp",3,"Up",3),this.Numpad9=new g("9",3,"PageUp",3),this.LeftArrow=new g("ArrowLeft",0,"Left",0),this.RightArrow=new g("ArrowRight",0,"Right",0),this.UpArrow=new g("ArrowUp",0,"Up",0),this.DownArrow=new g("ArrowDown",0,"Down",0),this.F1=new g("F1",0),this.F2=new g("F2",0),this.F3=new g("F3",0),this.F4=new g("F4",0),this.F5=new g("F5",0),this.F6=new g("F6",0),this.F7=new g("F7",0),this.F8=new g("F8",0),this.F9=new g("F9",0),this.F10=new g("F10",0),this.F11=new g("F11",0),this.F12=new g("F12",0),this.Tilde=new g("`",0,"~",0),this.LeftBracket=new g("[",0,"{",0),this.RightBracket=new g("]",0,"}",0),this.Backslash=new g("\\",0,"|",0),this.Semicolon=new g(";",0,":",0),this.Quote=new g("'",0,'"',0),this.Comma=new g(",",0,"<",0),this.Period=new g(".",0,">",0),this.ForwardSlash=new g("/",0,"?",0);var e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");for(e of t)this[e]=new g(e.toLowerCase(),0,e,0);var i,s=[],n={};for(i in this){var o,r=this[i];r.name=i,s.push(r);for(o of r.mappings){let e=n[o.id];if(e||(n[o.id]=e={}),e[o.location])throw new Error("Conflict!");e[o.location]=r}}this.list=s,this.mappings=n}}const ue=p.isMainThread?new class{constructor(){this.onPress=new r,this.onRepeat=new r,this.onRelease=new r,this.onCancel=new r,this.keys=new ce,this.reset=this.reset.bind(this),this.target_keydown=this.target_keydown.bind(this),this.target_keyup=this.target_keyup.bind(this)}App_activate(){d.add(window,"keydown",this.target_keydown,!0,!1),d.add(window,"keyup",this.target_keyup,!0,!1)}App_deactivate(){this.reset(),d.remove(window,"keydown",this.target_keydown),d.remove(window,"keyup",this.target_keyup)}reset(){for(var e of this.keys.list)e.cancel()}getKey(e,t){let i=null;e=this.keys.mappings[e];return e&&(i=e[t]||null),i}target_keydown(e){"F12"===e.key.toUpperCase()||"V"===e.key.toUpperCase()&&(e.ctrlKey||e.metaKey)||"C"===e.key.toUpperCase()&&(e.ctrlKey||e.metaKey)||"X"===e.key.toUpperCase()&&(e.ctrlKey||e.metaKey)||e.cancelable&&!e.defaultPrevented&&e.preventDefault();e=this.getKey(e.key,e.location);e&&(e.isPressed?e.repeat():e.press())}target_keyup(e){"F12"!==e.key&&e.cancelable&&!e.defaultPrevented&&e.preventDefault();e=this.getKey(e.key,e.location);e&&e.release()}}:null;class pe{constructor(){this.onPress=new r,this.onRelease=new r,this.onCancel=new r,this.isPressed=!1}press(){this.isPressed||(this.isPressed=!0,i.onPress.invoke(this),this.isPressed&&this.onPress.invoke(this))}release(){this.isPressed&&(this.isPressed=!1,i.onRelease.invoke(this),this.onRelease.invoke(this))}cancel(){this.isPressed&&(this.isPressed=!1,i.onCancel.invoke(this),this.onCancel.invoke(this))}}class me{constructor(){this.onScroll=new r,this.onScrollReset=new r,this.lock=!1,this.scroll=0,this._reset=!0}down(e,t){this._reset=!1,this.scroll+=e,i.onScroll.invoke(this,e,t),this._reset||this.onScroll.invoke(this,e,t)}up(e,t){this._reset=!1,this.scroll-=e,i.onScroll.invoke(this,e,t),this._reset||this.onScroll.invoke(this,-e,t)}reset(){this._reset=!0,this.scroll=0,i.onScrollReset.invoke(this),this.onScrollReset.invoke(this)}}const i=p.isMainThread?new class{constructor(){this.onDetected=new r,this.onOver=new r,this.onMove=new r,this.onOut=new r,this.onPress=new r,this.onRelease=new r,this.onCancel=new r,this.onScroll=new r,this.onScrollReset=new r,this.onLockStateChange=new r,this.onLockGained=new r,this.onLockLost=new r,this.isDetected=!1,this.x=-1,this.y=-1,this.isOver=!1,this.left=new pe,this.right=new pe,this.middle=new pe,this.wheel=new me,this.buttons=[this.left,this.middle,this.right],this.target_move=this.target_move.bind(this),this.target_button=this.target_button.bind(this),this.target_wheel=this.target_wheel.bind(this),this.window_mouseUp=this.window_mouseUp.bind(this)}initialize(){this._target=document.getElementById("app-player");for(var e of["mouseover","mousemove","mouseout"])d.add(this._target,e,this.target_move,!0,!0);for(var t of["mousedown","mouseup"])d.add(this._target,t,this.target_button,!0,!0);d.add(this._target,"wheel",this.target_wheel,!0,!1),d.add(window,"mouseup",this.window_mouseUp,!1,!0)}App_deactivate(){this.reset()}reset(){for(let e=0;e<this.buttons.length;++e)this.buttons[e].cancel()}move(n,o,r,e,t){if(y.isActive){this.isDetected||(this.isDetected=!0,0<this.onDetected.count&&this.onDetected.invoke());let e=this.x,t=this.y,i=this.isOver,s=!1;this.x=Math.floor((n-m.view.domRect.x)*m.view.pixelRatio),this.y=Math.floor((o-m.view.domRect.y)*m.view.pixelRatio),this.isOver="mouseout"!==r&&0<=this.x&&this.x<m.view.rect.w&&0<=this.y&&this.y<m.view.rect.h,!i&&this.isOver&&(e=this.x,t=this.y,s=!0,this.onOver.count)&&this.onOver.invoke(),(s||e!==this.x||t!==this.y)&&this.onMove.count&&this.onMove.invoke(this.x-e,this.y-t),i&&!this.isOver&&this.onOut.count&&this.onOut.invoke()}}target_move(e){this.move(e.clientX,e.clientY,e.type,e.movementX||0,e.movementY||0)}target_button(e){var t;y.isActive&&(this.move(e.clientX,e.clientY,e.type,e.movementX||0,e.movementY||0),e.button<this.buttons.length)&&(t=this.buttons[e.button],"mousedown"===e.type?this.isOver&&t.press():this.isOver?t.release():t.cancel())}target_wheel(e){y.isActive&&this.isOver&&(this.move(e.clientX,e.clientY,e.type,e.movementX||0,e.movementY||0),this.isOver)&&(0<e.deltaY?this.wheel.down(1,e):this.wheel.up(1,e),this.wheel.lock)&&e.preventDefault()}window_mouseUp(e){e.button<this.buttons.length&&this.buttons[e.button].cancel()}}:null;class ge{constructor(e){this.onPress=new r,this.onMove=new r,this.onRelease=new r,this.onCancel=new r,this.x=0,this.y=0,this.isPressed=!1,this.identifier=void 0,this.index=e}press(){this.isPressed||(this.isPressed=!0,fe.numPressed++,this.onPress.count&&this.onPress.invoke(this))}move(e,t){var i,s;this.x===e&&this.y===t||(i=e-this.x,s=t-this.y,this.x=e,this.y=t,this.isPressed&&this.onMove.count&&this.onMove.invoke(this,i,s))}release(){this.identifier=void 0,this.isPressed&&(this.isPressed=!1,fe.numPressed--,this.onRelease.count)&&this.onRelease.invoke(this)}cancel(){this.identifier=void 0,this.isPressed&&(this.isPressed=!1,fe.numPressed--,this.onCancel.count)&&this.onCancel.invoke(this)}}const fe=p.isMainThread?new class{constructor(){this.numPressed=0,this.isDetected=!1,this.reset=this.reset.bind(this),this.target_touchEvt=this.target_touchEvt.bind(this),this.target_touchCancel=this.target_touchCancel.bind(this);var t=[];for(let e=0;e<10;++e)t.push(new ge(e));this.points=t}initialize(){this._target=document.getElementById("app-player"),d.add(this._target,"touchstart",this.target_touchEvt,!0,!1),d.add(this._target,"touchmove",this.target_touchEvt,!0,!0),d.add(this._target,"touchend",this.target_touchEvt,!0,!1),d.add(this._target,"touchcancel",this.target_touchCancel,!0,!1),d.add(this._target,"blur",this.reset)}App_deactivate(){this.reset()}reset(){for(let e=0;e<this.points.length;++e)this.points[e].cancel()}fetch(t){let i=null,s=null;for(let e=0;e<this.points.length;++e){if(this.points[e].identifier===t){i=this.points[e];break}null===s&&void 0===this.points[e].identifier&&(s=this.points[e])}return null===i&&null!==s&&(i=s,i.identifier=t),i}target_touchEvt(t){if(y.isActive){this.isDetected=!0;var i=t.changedTouches;for(let e=0;e<i.length;++e){var s=i[e],n=this.fetch(s.identifier);n&&(s.rotationAngle||s.webkitRotationAngle,n.move(Math.round((s.clientX-m.view.domRect.x)*m.view.pixelRatio),Math.round((s.clientY-m.view.domRect.y)*m.view.pixelRatio)),"touchstart"===t.type?n.press():"touchend"===t.type&&n.release())}"touchstart"===t.type?"INPUT"!==t.target.tagName.toUpperCase()&&t.cancelable&&t.preventDefault():"touchend"===t.type&&t.cancelable&&t.preventDefault()}}target_touchCancel(e){y.isActive&&e.cancelable&&e.preventDefault();var t=e.changedTouches;for(let e=0;e<t.length;++e){var i=t[e],i=this.fetch(i.identifier);i&&i.cancel()}}}:null;class _e{constructor(e){this.onPress=new r,this.onMove=new r,this.onRelease=new r,this.onCancel=new r,this.onPresent=new r,this.onAbsent=new r,this.onSecondaryPress=new r,this.onSecondaryRelease=new r,this.onSecondaryCancel=new r,this.x=0,this.y=0,this.isPressed=!1,this.isPresent=!1,this.type=0,this.isSecondaryPressed=!1,this.index=e}present(){this.isPresent||(this.isPresent=!0,this.onPresent.invoke(this))}absent(){this.isPresent&&(this.isPresent=!1,this.onAbsent.invoke(this))}press(){this.isPressed||(this.isPressed=!0,this.onPress.invoke(this))}secondaryPress(){this.isSecondaryPressed||(this.isSecondaryPressed=!0,this.onSecondaryPress.invoke(this))}move(e,t){var i,s;this.x===e&&this.y===t||(i=e-this.x,s=t-this.y,this.x=e,this.y=t,this.onMove.invoke(this,i,s))}release(){this.isPressed&&(this.isPressed=!1,this.onRelease.invoke(this))}secondaryRelease(){this.isSecondaryPressed&&(this.isSecondaryPressed=!1,this.onSecondaryRelease.invoke(this))}cancel(){this.isPressed&&(this.isPressed=!1,this.onCancel.invoke(this))}secondaryCancel(){this.isSecondaryPressed&&(this.isSecondaryPressed=!1,this.onSecondaryCancel.invoke(this))}}const we=p.isMainThread?new class{constructor(){this._mouseControl=!1,this._touchPointControl=!1,this.lastInputFrameTime=0;var t=[];t.push(new _e(0));for(let e=1;e<fe.points.length;++e)t.push(new _e(e));this.pointers=t,this.primary=this.pointers[0]}initialize(){i.onMove.add(this.Mouse_onMove,this),i.left.onPress.add(this.Mouse_left_onPress,this),i.left.onRelease.add(this.Mouse_left_onRelease,this),i.left.onCancel.add(this.Mouse_left_onCancel,this),i.right.onPress.add(this.Mouse_right_onPress,this),i.right.onRelease.add(this.Mouse_right_onRelease,this),i.right.onCancel.add(this.Mouse_right_onCancel,this),i.onOver.add(this.Mouse_onOver,this),i.onOut.add(this.Mouse_onOut,this);for(let e=0;e<fe.points.length;++e)fe.points[e].onPress.add(this.touchPoint_onPress,this),fe.points[e].onMove.add(this.touchPoint_onMove,this),fe.points[e].onRelease.add(this.touchPoint_onRelease,this),fe.points[e].onCancel.add(this.touchPoint_onCancel,this);i.isOver?(this.primary.type=1,this.primary.move(i.x,i.y),this.primary.present()):(this.primary.type=1,this.primary.absent())}Mouse_onMove(e,t){this._touchPointControl||(this.primary.type=1,this.primary.move(i.x,i.y))}Mouse_onOver(){this._touchPointControl||(this.primary.type=1,this.primary.present())}Mouse_onOut(){this._touchPointControl||(this.primary.type=1,this.primary.absent())}Mouse_left_onPress(e){this._touchPointControl||(this._mouseControl=!0,this.primary.type=1,this.primary.move(i.x,i.y),this.primary.press())}Mouse_left_onRelease(e){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(i.x,i.y),this.primary.release())}Mouse_left_onCancel(e){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(i.x,i.y),this.primary.cancel())}Mouse_right_onPress(e){this._touchPointControl||(this._mouseControl=!0,this.primary.type=1,this.primary.move(i.x,i.y),this.primary.secondaryPress())}Mouse_right_onRelease(e){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(i.x,i.y),this.primary.secondaryRelease())}Mouse_right_onCancel(e){this._mouseControl&&(this._mouseControl=!1,this.primary.type=1,this.primary.move(i.x,i.y),this.primary.secondaryCancel())}touchPoint_onPress(e){0<e.index?(this.pointers[e.index].type=2,this.pointers[e.index].move(e.x,e.y),this.pointers[e.index].present(),this.pointers[e.index].press()):this._mouseControl||(this._touchPointControl=!0,this.primary.type=2,this.primary.move(e.x,e.y),this.primary.present(),this.primary.press())}touchPoint_onMove(e,t,i){0<e.index?(this.pointers[e.index].type=2,this.pointers[e.index].move(e.x,e.y)):this._touchPointControl&&(this.primary.type=2,this.primary.move(e.x,e.y))}touchPoint_onRelease(e){0<e.index?(this.pointers[e.index].type=2,this.pointers[e.index].move(e.x,e.y),this.pointers[e.index].release(),this.pointers[e.index].absent()):this._touchPointControl&&(this._touchPointControl=!1,this.primary.type=2,this.primary.move(e.x,e.y),this.primary.release(),i.isOver?this.primary.move(i.x,i.y):this.primary.absent())}touchPoint_onCancel(e){0<e.index?(this.pointers[e.index].type=2,this.pointers[e.index].move(e.x,e.y),this.pointers[e.index].cancel(),this.pointers[e.index].absent()):this._touchPointControl&&(this._touchPointControl=!1,this.primary.type=2,this.primary.move(e.x,e.y),this.primary.cancel(),i.isOver?this.primary.move(i.x,i.y):this.primary.absent())}}:null,ye=function(){let i={};return{warn:function(e,t){i[e]||(i[e]=!0,"android-auto"!==window.games247.nativeAppType&&(t?l.info("DEPRECATED: "+e+" is deprecated. Use "+t+" instead."):l.info("DEPRECATED: "+e+" is deprecated.")))}}}();const ve=new class{constructor(){this.onFramerateUpdate=new r,this.fps=-1,this._frames=0,this.rps=-1,this._resizes=0,this._lastTime=0,this.reset()}reset(){this._lastTime=Date.now(),this._frames=0,this.fps=-1,this._resizes=0,this.rps=-1,0<this.onFramerateUpdate.count&&this.onFramerateUpdate.invoke()}frame(){var e=Date.now(),t=e-this._lastTime;1e3<=t&&(this._lastTime=e,this.fps=Math.round(this._frames/t*1e3),this.rps=Math.round(this._resizes/t*1e3),this._resizes=this._frames=0,0<this.onFramerateUpdate.count)&&this.onFramerateUpdate.invoke(),this._frames++}resize(){this._resizes++}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){if(y.isActive)if(ve.fps<0)this._fpsElement.style.color="#CCCCCC",this._fpsElement.innerHTML="FPS: -- / 60";else{ve.fps<30?this._fpsElement.style.color="#FF0000":ve.fps<50?this._fpsElement.style.color="#FFFF00":this._fpsElement.style.color="#00FF00";let e=""+ve.fps;for(;e.length<2;)e=" "+e;this._fpsElement.innerHTML="FPS: "+e+" / 60"}else this._fpsElement.style.color="#AAAAAA",this._fpsElement.innerHTML="FPS:  0 / 60"}Telementry_onFramerateUpdate(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){this._contentsElement.innerHTML="rect XY: "+c.roundTo(m.view.rect.x,2)+", "+c.roundTo(m.view.rect.y,2)+"<br>pixel ratio: "+c.roundTo(m.view.pixelRatio,2)+"<br>app WH: "+c.roundTo(m.view.rect.w,2)+" x "+c.roundTo(m.view.rect.h,2)+"<br>Paused: "+n.isPaused+"<br>Fullscreen: "+m.fullscreen.isFullscreen+"<br>Visible: "+m.visibility.isVisible+"<br>Focused: "+m.focus.isFocused+"<br>Active: "+y.isActive+"<br>Ticking: "+y.isTicking+"<br>Stage SF: "+F.scaleFactor+"<br>Stage W: "+F.width+"<br>Stage H: "+F.height+"<br>Stage OSF: "+F.outerScaleFactor+"<br>Stage OW: "+F.outerWidth+"<br>Stage OH: "+F.outerHeight}app_statechanged(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){let e="";for(var t of ue.keys.list)t.isPressed&&(e&&(e+="<br>"),e+=t.name);this._btnsElement.innerHTML=e}keyboard_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){this._stateElement.innerHTML="Detected: "+i.isDetected+"<br>x: "+i.x+"<br>y: "+i.y+"<br>isOver: "+i.isOver+"<br>scroll: "+i.wheel.scroll;let e="";i.left.isPressed&&(e+="Left"),i.middle.isPressed&&(e&&(e+="<br>"),e+="Middle"),i.right.isPressed&&(e&&(e+="<br>"),e+="Right"),this._btnsElement.innerHTML=e}mouse_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){this._numPressedElement.innerHTML="down: "+fe.numPressed;let e="";for(var t of fe.points)t.isPressed&&(""!==e&&(e+="<br>"),e+=t.index+": "+t.x+","+t.y+" ("+t.identifier+")");this._touchesElement.innerHTML=e}mouse_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1}enable(){}disable(){}updateContents(){let t="";for(var i of we.pointers){let e="";""!==t&&(e+="<br>"),i.isPresent&&(e+=i.index+": "+i.x+","+i.y+", isPressed: "+i.isPressed,t+=e)}this._touchesElement.innerHTML=t}mouse_change(){this.updateContents()}};new class{constructor(){this.isEnabled=!1,this._screenManager=null}enable(e){}disable(){}updateContents(){let t="";if(this._screenManager)for(let e=0;e<this._screenManager._list.length;++e){var i=this._screenManager._list[e];0<e&&(t="<br>"+t),t=i.name+t}this._contentsElement.innerHTML=t}tick(){this.isEnabled&&this.updateContents()}};class be{get volume(){return this._volume}set volume(e){this._volume=Math.max(Math.min(e,1),0)}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=Math.max(Math.min(e,1),0)}constructor(e,t){if(this._volume=1,this._playbackRate=1,this.isLooped=!1,this.category=_.getCategory("SFX"),this.type=e,0===e||1===e?(this.buffer=t,this.duration=1e3*this.buffer.duration):(this.buffer=null,this.duration=t),this.duration<=0)throw new Error("Duration must be greater than 0!")}}class ke{constructor(){this.onSuspensionUpdate=new r,this.isSuspended=!0}}const xe=p.isMainThread?new class extends ke{constructor(){super(),this.context_statechange=this.context_statechange.bind(this),t.webAudio.isSupported?this.isSupported=!0:(l.info("Web Audio is not supported"),this.isSupported=!1)}initialize(){this.isSupported&&(this.context=new(window.AudioContext||window.webkitAudioContext),this.context.onstatechange=this.context_statechange)}updateSuspensionState(){y.isActive&&"running"===this.context.state?this.isSuspended=!1:this.isSuspended=!0,0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke()}updateContextState(e){var t=y.isTicking,i=this.context.state;t&&"running"!==i?e&&(e=this.context.resume(),e)&&d.promise(e,U,U):t||"running"!==i||(e=this.context.suspend(),e&&d.promise(e,U,U))}App_tickingChange(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!0))}App_activate(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!0))}App_deactivate(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!1))}window_unlockEvent(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!0))}context_statechange(){this.isSupported&&(this.updateSuspensionState(),this.updateContextState(!1))}}:null;const Se=p.isMainThread?new class extends ke{constructor(){super(),this._tag=null,this.isSupported=!0}initialize(){function e(e,t){let i=t;for(;1<e;e--)i+=t;return i}var t;"Apple iOS"===Z.os&&(t=document.createElement("div"),t.innerHTML="<audio x-webkit-airplay='deny'></audio>",this._tag=t.children.item(0),this._tag.controls=!1,this._tag.disableRemotePlayback=!0,this._tag.preload="auto",this._tag.src="data:audio/mpeg;base64,//uQx"+e(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+e(16,"gICA")+e(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+e(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+e(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+e(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+e(97,"V")+"Q==",this._tag.loop=!0,this._tag.load())}updateSuspensionState(e,t){this.isSuspended!==e&&(this.isSuspended=e),this.isSuspended?0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke():t&&0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke()}updateTagState(e){var t=y.isTicking;if(t&&this._tag.paused){if(e)try{var i=this._tag.play();i&&d.promise(i,U,U)}catch(e){}}else if(!t&&!this._tag.paused)try{this._tag.pause()}catch(e){}}App_tickingChange(){this._tag&&this.updateTagState(!1)}App_activate(){this.updateSuspensionState(!y.isActive,!Z.isMobileDevice)}App_deactivate(){this.updateSuspensionState(!y.isActive,!1)}window_unlockEvent(){this._tag&&this.updateTagState(!0),this.updateSuspensionState(!y.isActive,!0)}}:null;const Ce=p.isMainThread?new class extends ke{constructor(){super(),this.isSupported=!0}initialize(){}updateSuspensionState(){this.isSuspended=!y.isActive,0<this.onSuspensionUpdate.count&&this.onSuspensionUpdate.invoke()}App_tickingChange(){this.isSupported&&this.updateSuspensionState()}App_activate(){this.isSupported&&this.updateSuspensionState()}App_deactivate(){this.isSupported&&this.updateSuspensionState()}window_unlockEvent(){this.isSupported&&this.updateSuspensionState()}}:null;class Te{get volume(){return this._volume}set volume(e){e=Math.max(Math.min(e,1),0),this._volume!==e&&(this._volume=e,this.onVolumeUpdate.invoke())}get isMuted(){return this._isMuted}set isMuted(e){this._isMuted!==e&&(this._isMuted=e,this.onVolumeUpdate.invoke())}constructor(e){this.onVolumeUpdate=new r,this._volume=1,this._isMuted=!1,this.name=e}}class f{get volume(){return this._volume}set volume(e){e=Math.max(Math.min(e,1),0),this._volume!==e&&(this._volume=e,this.renderer.updateVolume())}get isMuted(){return this._isMuted}set isMuted(e){this._isMuted!==e&&(this._isMuted=e,this.renderer.updateVolume())}get isLooped(){return this._isLooped}set isLooped(e){this._isLooped!==e&&(this._isLooped=e,this.renderer.updateLoop())}get playbackRate(){return this._playbackRate}set playbackRate(e){e=Math.max(e,0),this._playbackRate!==e&&(this._playbackRate=e,this.renderer.updatePlaybackRate())}get position(){return this.renderer.getPosition()}constructor(e,t=e.category){this.onComplete=new r,this.onLoop=new r,this.state=0,this._isMuted=!1,this.isStopped=!0,this.isPlaying=!1,this.isPaused=!1,this.data=e,this.category=t,this.duration=this.data.duration,this._volume=this.data.volume,this._isLooped=this.data.isLooped,this._playbackRate=this.data.playbackRate,0===e.type?(this.engine=xe,this.renderer=new Pe(this)):1===e.type?(this.engine=Se,this.renderer=new Be(this)):(this.engine=Ce,this.renderer=new Ae(this))}play(){1!==this.state&&(this.state=1,this.isPlaying=!0,this.isStopped=!1,this.isPaused=!1,this.engine.onSuspensionUpdate.add(this.engine_onSuspensionUpdate,this),_.onVolumeUpdate.add(this.SoundManager_onVolumeUpdate,this),this.category.onVolumeUpdate.add(this.category_onVolumeUpdate,this),this.renderer.updatePlayback())}pause(){1===this.state&&this.haltPlayback(2)}resume(){this.play()}stop(){0!==this.state&&this.haltPlayback(0)}haltPlayback(e){1===this.state&&(this.engine.onSuspensionUpdate.remove(this.engine_onSuspensionUpdate,this),_.onVolumeUpdate.remove(this.SoundManager_onVolumeUpdate,this),this.category.onVolumeUpdate.remove(this.category_onVolumeUpdate,this)),this.state=e,this.isPlaying=!1,0===e?(this.isStopped=!0,this.isPaused=!1):(this.isStopped=!1,this.isPaused=!0),this.renderer.updatePlayback()}engine_onSuspensionUpdate(){this.renderer.updatePlayback()}SoundManager_onVolumeUpdate(){this.renderer.updateVolume()}category_onVolumeUpdate(){this.renderer.updateVolume()}}class Fe{constructor(e){this.sound=e}}class Pe extends Fe{constructor(e){super(e),this._srcNode=null,this._lastTick=0,this._position=0,this.source_ended=this.source_ended.bind(this)}getPosition(){return this._position}updateVolume(){this._gainNode&&(this._gainNode.gain.value=_._isMuted||this.sound.category._isMuted||this.sound._isMuted?0:_._volume*this.sound.category._volume*this.sound._volume)}updateLoop(){this._srcNode&&(this._srcNode.loop=this.sound._isLooped)}updatePlayback(){let e=!1;this.sound.engine.isSuspended||1!==this.sound.state||(e=!0),e?this._srcNode||this.createSource():(0===this.sound.state&&(this._position=0),this._srcNode&&this.destroySource())}updatePlaybackRate(){this._srcNode&&(this._srcNode.playbackRate.value=this.sound._playbackRate)}createSource(){this._srcNode=xe.context.createBufferSource(),this._srcNode.buffer=this.sound.data.buffer,this._srcNode.playbackRate.value=this.sound._playbackRate,this._gainNode=xe.context.createGain(),this._srcNode.connect(this._gainNode),this._gainNode.connect(xe.context.destination),d.add(this._srcNode,"ended",this.source_ended),this._srcNode.onended=this.source_ended,this.updateLoop(),this.updateVolume(),this._lastTick=Date.now(),_.onPoll.add(this.SoundManager_onPoll,this),0<this._position?this._srcNode.start(0,this._position/1e3):this._srcNode.start()}destroySource(){d.remove(this._srcNode,"ended",this.source_ended),this._srcNode.onended=null,_.onPoll.remove(this.SoundManager_onPoll,this),this._srcNode.loop=!1,this._gainNode.gain.value=0,this._srcNode.stop(),this._srcNode.disconnect(),this._gainNode.disconnect(),this._gainNode=null,this._srcNode=null}source_ended(e){this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)}SoundManager_onPoll(){var e=Date.now()-this._lastTick;this._lastTick+=e,this._position+=e,this._position>=this.sound.duration&&(this._srcNode.loop?(this._position=this._position%this.sound.duration,this.sound.onLoop.count&&this.sound.onLoop.invoke(this.sound)):(this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)))}}class Be extends Fe{constructor(e){super(e),this._tag=null,this._playPromise=null,this._started=!1,this._lastTick=0,this._position=0,this.tag_loadeddata=this.tag_loadeddata.bind(this),this.tag_ended=this.tag_ended.bind(this),this.tag_play_fulfilled=this.tag_play_fulfilled.bind(this),this.tag_play_rejected=this.tag_play_rejected.bind(this)}getPosition(){return this._position}updateVolume(){this._tag&&(this._tag.volume=_._isMuted||this.sound.category._isMuted||this.sound._isMuted?0:_._volume*this.sound.category._volume*this.sound._volume)}updateLoop(){this._tag&&(this._tag.loop=this.sound._isLooped)}updatePlayback(){let e=!1;this.sound.engine.isSuspended||1!==this.sound.state||(e=!0),e?this._tag||this.createSource():(0===this.sound.state&&(this._position=0),this._tag&&this.destroySource())}updatePlaybackRate(){}createSource(){var e;"Apple iOS"===Z.os?(e=document.createElement("div"),e.innerHTML="<audio x-webkit-airplay='deny'></audio>",this._tag=e.children.item(0)):this._tag=document.createElement("audio"),this._tag.controls=!1,this._tag.disableRemotePlayback=!0,this._tag.crossOrigin=this.sound.data.buffer.crossOrigin,this._tag.playbackRate=this.sound.data.buffer.playbackRate,this._tag.preload="auto",this.updateLoop(),this.updateVolume(),d.add(this._tag,"loadeddata",this.tag_loadeddata),d.add(this._tag,"ended",this.tag_ended),_.onPoll.add(this.SoundManager_onPoll,this),this._tag.src=this.sound.data.buffer.src;try{var t=this._tag.play();t?this._playPromise=d.promise(t,this.tag_play_fulfilled,this.tag_play_rejected):this._tag.paused?this.destroySource():(this._lastTick=Date.now(),this._started=!0)}catch(e){this.destroySource()}}destroySource(){this._playPromise&&this._playPromise.cancel(),d.remove(this._tag,"loadeddata",this.tag_loadeddata),d.remove(this._tag,"ended",this.tag_ended),_.onPoll.remove(this.SoundManager_onPoll,this);try{this._tag.loop=!1}catch(e){}try{this._tag.muted=!0}catch(e){}try{this._tag.volume=0}catch(e){}try{this._tag.pause()}catch(e){}this._started=!1,this._tag=null}tag_loadeddata(){0!==this._position&&(this._tag.currentTime=this._position/1e3)}tag_ended(){this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)}tag_play_fulfilled(){this._playPromise=null,this._started=!0,this._lastTick=Date.now()}tag_play_rejected(e){this._playPromise=null,this.destroySource()}SoundManager_onPoll(){var e;this._started&&(e=Date.now()-this._lastTick,this._lastTick+=e,this._position+=e,this._position>=this.sound.duration)&&(this._tag.loop?(this._position=this._position%this.sound.duration,this.sound.onLoop.count&&this.sound.onLoop.invoke(this.sound)):(this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)))}}class Ae extends Fe{constructor(e){super(e),this._src=!1,this._lastTick=0,this._position=0,this._loop=!1}getPosition(){return this._position}updateVolume(){}updateLoop(){this._loop=this.sound._isLooped}updatePlayback(){let e=!1;this.sound.engine.isSuspended||1!==this.sound.state||(e=!0),e?this._src||this.createSource():(0===this.sound.state&&(this._position=0),this._src&&this.destroySource())}updatePlaybackRate(){}createSource(){this._src=!0,this.updateLoop(),this.updateVolume(),this._lastTick=Date.now(),_.onPoll.add(this.SoundManager_onPoll,this)}destroySource(){_.onPoll.remove(this.SoundManager_onPoll,this),this._loop=!1,this._src=!1}SoundManager_onPoll(){var e=Date.now()-this._lastTick;this._lastTick+=e,this._position+=e,this._position>=this.sound.duration&&(this._loop?(this._position=this._position%this.sound.duration,this.sound.onLoop.count&&this.sound.onLoop.invoke(this.sound)):(this.sound.haltPlayback(0),this.sound.onComplete.count&&this.sound.onComplete.invoke(this.sound)))}}const _=p.isMainThread?new class{get volume(){return this._volume}set volume(e){e=Math.max(Math.min(e,1),0),this._volume!==e&&(this._volume=e,this.onVolumeUpdate.invoke())}get isMuted(){return this._isMuted}set isMuted(e){this._isMuted!==e&&(this._isMuted=e,this.onVolumeUpdate.invoke())}constructor(){this.onVolumeUpdate=new r,this.onPoll=new r,this._volume=1,this._isMuted=!1,this._categories={},this._unlockingEvents=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],this.window_unlockEvent=this.window_unlockEvent.bind(this),this._categories.SFX=new Te("SFX"),this._categories.Music=new Te("Music")}initialize(){Se.initialize(),xe.initialize(),Ce.initialize();for(var e of this._unlockingEvents)d.add(window,e,this.window_unlockEvent,!1,!0)}createCategory(e){if(this._categories[e])throw"Sound Category ("+e+") already exists!";var t=new Te(e);return this._categories[e]=t,t}getCategory(e){var t=this._categories[e];if(e)return t;throw new Error("Sound Category ("+e+") does not exist!")}poll(){0<this.onPoll.count&&this.onPoll.invoke()}App_tickingChange(){(y.isTicking?(Se.App_tickingChange(),xe.App_tickingChange(),Ce):(Ce.App_tickingChange(),xe.App_tickingChange(),Se)).App_tickingChange()}App_activate(){Se.App_activate(),xe.App_activate(),Ce.App_activate()}App_deactivate(){Ce.App_deactivate(),xe.App_deactivate(),Se.App_deactivate()}window_unlockEvent(){Se.window_unlockEvent(),xe.window_unlockEvent(),Ce.window_unlockEvent()}}:null;class Ee{get srcUrl(){return this.src+"?v=1715626943813"}constructor(e,t){this.onLoaded=new r,this.onProgress=new r,this.onError=new r,this.onUnloaded=new r,this.preload=!0,this.state=0,this.bytesLoaded=0,this.progress=0,this.data=null,this.assetType=e,this.path=t}setSrc(e,t){this.ext=e,this.src=this.path+"."+e,this.size=t}load(){if(0!==this.state)throw new Error("Asset is not currently unloaded!");this.state=1}progressed(e,t){if(1!==this.state)throw new Error("Asset is not currently loading!");let i=0;t?(this.bytesLoaded=this.size,i=1):(e=e||0,e<0&&(e=0),e>this.size&&(e=this.size),this.bytesLoaded=e,0<this.size&&(i=e/this.size)),this.progress!==i&&(this.progress=i,this.onProgress.invoke(this))}loaded(e){if(this.progressed(this.size,!0),this.data=e,1!==this.state)throw new Error("Asset is not currently loading!");this.state=2,this.onLoaded.invoke(this)}error(e){if(1!==this.state)throw new Error("Asset is not currently loading!");this.state=3,l.warn("Failed to load",this.src,e),this.onError.invoke(this)}unloaded(){0!==this.state&&(this.state=0,this.data=null,this.progress=0,this.bytesLoaded=0,this.onUnloaded.invoke(this))}}class Me extends Ee{constructor(e,t){super(2,t),this.imageAssetType=e}}class e extends Me{constructor(e,t,i,s){super(0,t),this._isFallbackPNG=!1,this.tag_error=this.tag_error.bind(this),this.tag_load=this.tag_load.bind(this),this.rasterAssetType=e,this._pngJpgSize=i,this._webpSize=s,w.support&&this.init()}init(){let e=this._pngJpgSize,t=2===this.rasterAssetType?"jpg":"png";1===this.rasterAssetType&&w.support.webp&&(t="webp",e=this._webpSize),this.setSrc(t,e)}load(){super.load(),this._tag=document.createElement("img"),this.listen(),this._tag.src=this.srcUrl}listen(){d.add(this._tag,"abort",this.tag_error),d.add(this._tag,"error",this.tag_error),d.add(this._tag,"load",this.tag_load)}unlisten(){d.remove(this._tag,"abort",this.tag_error),d.remove(this._tag,"error",this.tag_error),d.remove(this._tag,"load",this.tag_load)}tag_load(e){var t=this._tag;this.unlisten(),this._tag=null,this.loaded(t)}tag_error(e){"error"===e.type&&1===this.rasterAssetType&&w.support.webp&&!this._isFallbackPNG?(this._isFallbackPNG=!0,this.ext="png",this.src=this.path+".png",this.size=this._pngJpgSize,this._tag.src=this.srcUrl):(this.unlisten(),this._tag=null,this.error("Failed to load raster image asset due to "+e.type))}unload(){this._tag&&(this.unlisten(),this._tag=null),this.unloaded()}}class Le extends Me{constructor(e,t,i,s){super(1,e),this._isSVGAsset=!0,this.tag_error=this.tag_error.bind(this),this.tag_load=this.tag_load.bind(this),this._svgSize=s,this.naturalWidth=t,this.naturalHeight=i,w.support&&this.init()}init(){this.setSrc("svg",this._svgSize)}load(){super.load(),this._tag=document.createElement("img"),this.listen(),this._tag.src=this.srcUrl}listen(){d.add(this._tag,"abort",this.tag_error),d.add(this._tag,"error",this.tag_error),d.add(this._tag,"load",this.tag_load)}unlisten(){d.remove(this._tag,"abort",this.tag_error),d.remove(this._tag,"error",this.tag_error),d.remove(this._tag,"load",this.tag_load)}tag_load(e){var t=this._tag;this.unlisten(),this._tag=null,this.loaded(t)}tag_error(e){this.unlisten(),this._tag=null,this.error("Failed to load svg image asset due to "+e.type)}unload(){this._tag&&(this.unlisten(),this._tag=null),this.unloaded()}}class Oe extends Ee{constructor(e,t,i,s,n,o){super(0,e),this._fontFace=null,this._fontFaceLoadPromise=null,this._fontFaceAdded=!1,this._style=null,this._embed=null,this._lastWidth=-1,this._lastHeight=-1,this._startTime=null,this._isIntervalSet=!1,this._timeoutDelay=3e3,this._usingFontFaceAPI=!1,this.fontFace_onfulfilled=this.fontFace_onfulfilled.bind(this),this.fontFace_onrejected=this.fontFace_onrejected.bind(this),this.setInterval_handler=this.setInterval_handler.bind(this),this._ttfSize=n,this._woff2Size=o;n=e.split("/"),o=n[n.length-1];this._font=new te(o,"normal","normal",t,i,s),w.support&&this.init()}init(){let e=this._ttfSize,t="ttf";w.support.woff2&&(t="woff2",e=this._woff2Size),this.setSrc(t,e)}load(){super.load(),t.fontFace.isSupported?this.loadUsingFontFace():this.loadUsingEmbedTest()}loadUsingFontFace(){this._usingFontFaceAPI=!0;var e={family:this._font.family,weight:this._font.weight,style:this._font.style,variant:"normal"};this._fontFace=new FontFace(this._font.family,"url("+this.srcUrl+")",e),this._fontFaceLoadPromise=d.promise(this._fontFace.load(),this.fontFace_onfulfilled,this.fontFace_onrejected)}fontFace_onfulfilled(e){this._fontFaceLoadPromise=null,this._fontFaceAdded=!0,document.fonts.add(e),this.loaded(this._font)}fontFace_onrejected(e){this._fontFaceLoadPromise=null,this.error("Font Face promise failed: "+e)}loadUsingEmbedTest(){var e="@font-face {\n\tfont-family: '"+this._font.family+"';\n\tsrc: url('"+this.srcUrl+"') format('truetype');\n\tfont-weight: "+this._font.weight+";\n\tfont-style: "+this._font.style+";\n\tfont-display: block;\n}";this._style=document.createElement("style"),this._style.innerHTML=e,document.head.appendChild(this._style),null===Oe._embedHolder&&(Oe._embedHolder=document.createElement("div"),Oe._embedHolder.style.cssText="display: inline-block; clear: both; white-space: nowrap; position: absolute; top: -10000px; left: -10000px;",0<document.body.children.length?document.body.insertBefore(Oe._embedHolder,document.body.children[0]):document.body.appendChild(Oe._embedHolder)),this._embed=document.createElement("div"),this._embed.style.cssText="font-family: Arial; font-weight: "+this._font.weight+"; font-style: "+this._font.style+";",this._embed.innerHTML="ABCDEFGHIJKLMNOPQRSTUVWXYZabcderfhijklmnopqrstuvwxyz0123456789`~!@#$%^&amp;*()_-+=|]}[{'&quot;;:/?.&gt;,&lt;",Oe._embedHolder.appendChild(this._embed),this.measure(),this._embed.style.cssText="font-family: '"+this._font.family+"', Arial; font-weight: "+this._font.weight+"; font-style: "+this._font.style+";",this.check()||this.startInterval()}measure(){var e=this._embed.clientWidth,t=this._embed.clientHeight,i=e!==this._lastWidth||t!==this._lastHeight;return this._lastWidth=e,this._lastHeight=t,i}check(){return!!this.measure()&&(this.embedComplete(),!0)}startInterval(){this._startTime=Date.now(),d.setTimeout(this.setInterval_handler,250,!0),this._isIntervalSet=!0}stopInterval(){this._isIntervalSet&&d.clearTimeout(this.setInterval_handler),this._isIntervalSet=!1}setInterval_handler(){!this._isIntervalSet||this.check()||Date.now()-this._startTime>=this._timeoutDelay&&this.embedTimeout()}embedTimeout(){this.stopInterval(),l.warn("Font "+this._font.family+" (weight: "+this._font.weight+", style: "+this._font.style+") timed out.");var e=this._font;this.loaded(e)}embedComplete(){this.stopInterval();var e=this._font;this.loaded(e)}unload(){this._usingFontFaceAPI?(this._usingFontFaceAPI=!1,this._fontFaceLoadPromise&&(this._fontFaceLoadPromise.cancel(),this._fontFaceLoadPromise=null),this._fontFaceAdded&&(document.fonts.delete(this._fontFace),this._fontFaceAdded=!1),this._fontFace=null):(this._embed&&(this._embed.parentElement.removeChild(this._embed),this._embed=null),this._style&&(this._style.parentElement.removeChild(this._style),this._style=null),this._isIntervalSet&&this.stopInterval(),this._lastWidth=this._lastHeight=-1,this._startTime=null,Oe._embedHolder&&0===Oe._embedHolder.children.length&&(Oe._embedHolder.parentElement.removeChild(Oe._embedHolder),Oe._embedHolder=null)),this.unloaded()}}Oe._embedHolder=null;class Re extends Ee{constructor(e,t,i,s){super(1,e),this._request=null,this._decodePromise=null,this._tag=null,this._usingWebAudio=!1,this.request_error=this.request_error.bind(this),this.request_progress=this.request_progress.bind(this),this.request_load=this.request_load.bind(this),this.decodeAudioData_error=this.decodeAudioData_error.bind(this),this.decodeAudioData_success=this.decodeAudioData_success.bind(this),this.tag_canplaythrough=this.tag_canplaythrough.bind(this),this.tag_error=this.tag_error.bind(this),this._mp3FileSize=i,this._m4aFileSize=s,this._duration=0<t?t:1e3,w.support&&this.init()}init(){let e=this._mp3FileSize,t="mp3";w.support.m4a&&(t="m4a",e=this._m4aFileSize),this.setSrc(t,e)}load(){super.load(),xe.isSupported?this.loadWebAudio():this.loadHTMLAudio()}loadWebAudio(){this._usingWebAudio=!0,this._request=new XMLHttpRequest,this._request.open("GET",this.srcUrl,!0),this._request.responseType="arraybuffer",this.listenRequest(),this._request.send()}listenRequest(){d.add(this._request,"progress",this.request_progress),d.add(this._request,"load",this.request_load),d.add(this._request,"abort",this.request_error),d.add(this._request,"error",this.request_error),d.add(this._request,"timeout",this.request_error)}unlistenRequest(){d.remove(this._request,"progress",this.request_progress),d.remove(this._request,"load",this.request_load),d.remove(this._request,"abort",this.request_error),d.remove(this._request,"error",this.request_error),d.remove(this._request,"timeout",this.request_error)}request_progress(e){this.stagedProgress(e.loaded,!1,!1)}stagedProgress(e,t,i){if(1!==this.state)throw new Error("Asset is not currently loading!");let s=0,n=0;t?(this.bytesLoaded=this.size,s=1):(e=e||0,e<0&&(e=0),e>this.size&&(e=this.size),this.bytesLoaded=e,0<this.size&&(s=e/this.size)),i&&(n=1);t=.5*s+.5*n;this.progress!==t&&(this.progress=t,this.onProgress.invoke(this))}request_load(e){400<=this._request.status?this.request_error(e):(this.stagedProgress(this.size,!0,!1),e=this._request.response,this.unlistenRequest(),this._request=null,this.decodeData(e))}request_error(e){this.unlistenRequest();var t=this._request.status;this._request=null,this.error("Failed to load web audio sound asset due to "+("load"===e.type?t+" status code":e.type))}decodeData(e){this._decodePromise=d.promise(void 0,this.decodeAudioData_success,this.decodeAudioData_error);e=xe.context.decodeAudioData(e,this._decodePromise.onfulfilled,this._decodePromise.onrejected);e&&this._decodePromise.setPromise(e)}decodeAudioData_error(e){this._decodePromise.cancel(),this._decodePromise=null,"Apple iOS"===Z.os?(l.warn("Failed to decode audio data due to error below, will use "+this._duration+"ms empty fallback since this is an iOS device, for:",this.src),l.warn(e),this.stagedProgress(this.size,!0,!0),this.loaded(new be(2,this._duration))):(l.warn("Failed to decode audio data due to error below, trying HTML audio fallback, for:",this.src),l.warn(e),this.loadHTMLAudio())}decodeAudioData_success(e){this._decodePromise.cancel(),this._decodePromise=null,this.stagedProgress(this.size,!0,!0),this.loaded(new be(0,e))}loadHTMLAudio(){this._tag=document.createElement("audio"),this.listenTag(),this._tag.src=this.srcUrl,this._tag.load()}listenTag(){"Android"===Z.os?d.add(this._tag,"loadstart",this.tag_canplaythrough):d.add(this._tag,"canplaythrough",this.tag_canplaythrough),d.add(this._tag,"error",this.tag_error),d.add(this._tag,"abort",this.tag_error)}unlistenTag(){"Android"===Z.os?d.remove(this._tag,"loadstart",this.tag_canplaythrough):d.remove(this._tag,"canplaythrough",this.tag_canplaythrough),d.remove(this._tag,"error",this.tag_error),d.remove(this._tag,"abort",this.tag_error)}tag_canplaythrough(e){this.unlistenTag();var t=new be(1,this._tag);this._tag=null,this.loaded(t)}tag_error(e){this.unlistenTag(),this._tag=null,l.warn("Failed to load html audio file due to "+e.type+" and will use "+this._duration+"ms empty fallback for:",this.src),this.loaded(new be(2,this._duration))}unload(){this._usingWebAudio?(this._usingWebAudio=!1,this._request&&(this.unlistenRequest(),this._request=null),this._decodePromise&&(this._decodePromise.cancel(),this._decodePromise=null)):this._tag&&(this.unlistenTag(),this._tag=null),super.unloaded()}}class De{get error(){return this._error}get bytesTotal(){let e=0;for(var t of this._assets)e+=t.size;return e}get bytesLoaded(){let e=0;for(var t of this._assets)e+=t.bytesLoaded;return e}constructor(){this.onLoaded=new r,this.onProgress=new r,this.onError=new r,this._state=0,this._assets=[],this._activeThreadCount=0,this._currentIndex=0,this._isInLoadLoop=!1,this.progress=0,this._error=!1,this.done_timeout=this.done_timeout.bind(this)}add(e){if(0!==this._state)throw new Error("Loader already started!");if(null==e)throw new Error("Asset param is "+e);if(Array.isArray(e))for(var t of e)this._assets.push(t);else this._assets.push(e)}load(e=16){if(0!==this._state)throw new Error("Not currently unloaded!");this._state=1,this._maxThreads=e,this.loadNext()}loadNext(){if(!this._isInLoadLoop){for(this._isInLoadLoop=!0;!this._error&&this._currentIndex<this._assets.length&&this._activeThreadCount<this._maxThreads;){var e=this._assets[this._currentIndex];this._currentIndex++,e.onProgress.add(this.asset_onProgress,this),e.onLoaded.add(this.asset_onLoaded,this),e.onError.add(this.asset_onError,this),this._activeThreadCount++,0===e.state?e.load():1===e.state?this.asset_onProgress(e):2===e.state?(this.asset_onProgress(e),this.asset_onLoaded(e)):this.asset_onError(e)}this._isInLoadLoop=!1,!this._error&&0===this._activeThreadCount&&this._currentIndex>=this._assets.length&&(this.progress=1,this.onProgress.invoke(this),d.setTimeout(this.done_timeout,0,!1))}}cancel(){d.containsTimeout(this.done_timeout)&&d.clearTimeout(this.done_timeout);for(var e of this._assets)e.onProgress.contains(this.asset_onProgress,this)&&e.onProgress.remove(this.asset_onProgress,this),e.onLoaded.contains(this.asset_onLoaded,this)&&e.onLoaded.remove(this.asset_onLoaded,this),e.onError.contains(this.asset_onError,this)&&e.onError.remove(this.asset_onError,this);this._state=0,this._assets.length=0,this._activeThreadCount=0,this._currentIndex=0,this._isInLoadLoop=!1,this.progress=0,this._error=!1}done_timeout(){this._state=2,this.onLoaded.invoke(this)}asset_onProgress(e){if(!this._error){var t,i=1/this._assets.length;this.progress=0;for(t of this._assets)this.progress+=t.progress*i;this.progress<0&&(this.progress=0),1<this.progress&&(this.progress=1),this.onProgress.invoke(this)}}asset_onLoaded(e){this._activeThreadCount--,e.onProgress.remove(this.asset_onProgress,this),e.onLoaded.remove(this.asset_onLoaded,this),e.onError.remove(this.asset_onError,this),this._error||this.loadNext()}asset_onError(e){e.onProgress.remove(this.asset_onProgress,this),e.onLoaded.remove(this.asset_onLoaded,this),e.onError.remove(this.asset_onError,this),this._error=!0,this.onError.invoke(this)}}const w={fonts:{},sounds:{},images:{},dynamic:{vector:{},pattern:{},gradient:{},raster:{}},support:null,preload:function(){let a=this;{var e;a.support={},t.fontFace.isSupported?(e=new FontFace("t","url('data:font/woff2;base64,d09GMgABAAAAAADwAAoAAAAAAiQAAACoAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmAALAogOAE2AiQDBgsGAAQgBSAHIBuDAciO1EZ3I/mL5/+5/rfPnTt9/9Qa8H4cUUZxaRbh36LiKJoVh61XGzw6ufkpoeZBW4KphwFYIJGHB4LAY4hby++gW+6N1EN94I49v86yCpUdYgqeZrOWN34CMQg2tAmthdli0eePIwAKNIIRS4AGZFzdX9lbBUAQlm//f262/61o8PlYO/D1/X4FrWFFgdCQD9DpGJSxmFyjOAGUU4P0qigcNb82GAAA') format('woff2')",{}),d.promise(e.load(),U,U),a.support.woff2="loading"===e.status||"loaded"===e.status):a.support.woff2=!1,a.support.woff2||l.info("woff2 fonts are not supported, falling back to ttf"),a.support.m4a=window.MediaSource&&MediaSource.isTypeSupported("audio/aac");let r;function h(e){r.removeEventListener("load",h),r.removeEventListener("error",h),a.support.webp="load"===e.type&&!!r.width,a.support.webp||l.info("webp images are not supported, falling back to png"),i(a.images),i(a.fonts),i(a.sounds);{let i=new De;function t(e){for(var t in e)e[t].preload&&i.add(e[t])}function s(){i.onError.remove(s,null),i.onProgress.remove(n,null),i.onLoaded.remove(o,null),y.Assets_preloadError()}function n(){y.Assets_preloadProgress(i.bytesLoaded,i.bytesTotal,i.progress)}function o(){i.onError.remove(s,null),i.onProgress.remove(n,null),i.onLoaded.remove(o,null),y.Assets_preloadComplete()}t(a.sounds),t(a.fonts),t(a.images),i.onError.add(s,null),i.onProgress.add(n,null),i.onLoaded.add(o,null),i.load()}function i(e){for(var t in e)e[t].init()}}r=document.createElement("img"),r.addEventListener("load",h),r.addEventListener("error",h),r.src="data:image/webp;base64,UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAABBxAR/Q9ERP8DAABWUDggGAAAADABAJ0BKgEAAQADADQlpAADcAD++/1QAA=="}}};class Ie extends class{constructor(){this.onActivated=new r,this.onDeactivated=new r,this.onTickingChange=new r,this.isActive=!1,this.isTicking=!1,this._started=!1,this._rafId=null,this.info={name:"Chess",id:"games247.chess",namespace:"chess",gameType:"chess",version:(new ee).fromVersionString("1.2.0.0"),buildDate:new Date(1715626943813),theme:document.getElementById("game-script").getAttribute("data-theme")},this.script_loadGame=this.script_loadGame.bind(this),this.script_startGame=this.script_startGame.bind(this),this.raf=this.raf.bind(this),n.script.loadGame=this.script_loadGame,n.script.startGame=this.script_startGame}initialize(){at.initialize(),m.initialize(),n.initialize(),i.initialize(),we.initialize(),fe.initialize(),_.initialize(),F.initialize(),w.preload()}start(){w.sounds.click.data.volume=.5,this._started=!0,this.tick(),R.main(),this.updateTickingActiveState()}tick(){m.poll(),_.poll(),F.poll(),P._instance&&P._instance.tick(),ve.frame()}raf(){this._rafId=null,this.tick(),this.isTicking&&(this._rafId=requestAnimationFrame(this.raf))}updateTickingActiveState(){var e=this.testActive(),e=(this.isActive!==e&&(this.isActive=e,this.isActive?this.activate():this.deactivate()),this.testTickable());this.isTicking!==e&&(this.isTicking=e,this.isTicking?null===this._rafId&&(this._rafId=requestAnimationFrame(this.raf)):(null!==this._rafId&&cancelAnimationFrame(this._rafId),this._rafId=null),_.App_tickingChange(),this.onTickingChange.count)&&this.onTickingChange.invoke()}activate(){ue.App_activate(),_.App_activate(),P._instance&&P._instance.activate(),this.tick(),ve.reset(),this.onActivated.invoke()}deactivate(){this.onDeactivated.invoke(),P._instance&&P._instance.deactivate(),_.App_deactivate(),fe.App_deactivate(),i.App_deactivate(),ue.App_deactivate(),n.App_deactivate(),this.tick(),ve.reset()}script_loadGame(e){e=e||{},e.defaultMute=e.defaultMute||!1,e.rateUsURL=e.rateUsURL||"https://www.247games.com/",e.moreGamesURL=e.moreGamesURL||"https://www.247games.com/",!0!==e.showRateUsButton&&!1!==e.showRateUsButton&&(e.showRateUsButton=!0),e.interstitials=e.interstitials||{},e.interstitials.desktop=e.interstitials.desktop||{},e.interstitials.desktop.enabled=e.interstitials.desktop.enabled||!1,e.interstitials.mobile=e.interstitials.mobile||{},e.interstitials.mobile.enabled=e.interstitials.mobile.enabled||!1,this.config=e,this.initialize()}Assets_preloadProgress(e,t,i){i<0&&(i=0),1<i&&(i=1),n.preloadProgress(e,t,i)}Assets_preloadError(){n.preloadError()}Assets_preloadComplete(){n.script.onGameLoaded()}script_startGame(){this.start()}AppPlayer_pauseChange(){m.App_pauseChange(),this.updateTickingActiveState()}GameWindow_view_invalidated(){}GameWindow_view_change(){F.App_viewChange()}GameWindow_focus_change(){this.updateTickingActiveState()}GameWindow_visibility_change(){m.App_visibilityChange(),this.updateTickingActiveState()}GameWindow_fullscreen_change(){ue.reset(),i.reset(),fe.reset(),F.App_fullscreenChange(),m.App_fullscreenChange(),n.App_fullscreenChange(),this.updateTickingActiveState()}}{constructor(){super()}testActive(){return this._started&&!n.isPaused&&m.visibility.isVisible&&("Apple iOS"!==Z.os||m.focus.isFocused)}testTickable(){return this._started&&m.visibility.isVisible&&("Apple iOS"!==Z.os||m.focus.isFocused)}}const y=function(){if(p.isMainThread){if("Web App"===Z.runtime)return new Ie;throw new Error("Not implemented")}}();class v{get r(){return this._r}set r(e){this._r=1<=e?1:e<=0?0:e}get g(){return this._g}set g(e){this._g=1<=e?1:e<=0?0:e}get b(){return this._b}set b(e){this._b=1<=e?1:e<=0?0:e}get a(){return this._a}set a(e){this._a=1<=e?1:e<=0?0:e}constructor(e=1,t=1,i=1,s=1){this._r=1<=e?1:e<=0?0:e,this._g=1<=t?1:t<=0?0:t,this._b=1<=i?1:i<=0?0:i,this._a=1<=s?1:s<=0?0:s}copy(e){return this._r=e._r,this._g=e._g,this._b=e._b,this._a=e._a,this}set(e,t,i,s){return this._r=1<=e?1:e<=0?0:e,this._g=1<=t?1:t<=0?0:t,this._b=1<=i?1:i<=0?0:i,this._a=1<=s?1:s<=0?0:s,this}interpolateFromTo(e,t,i){return this.set(i*(t._r-e._r)+e._r,i*(t._g-e._g)+e._g,i*(t._b-e._b)+e._b,i*(t._a-e._a)+e._a)}equals(e){return this._r===e._r&&this._g===e._g&&this._b===e._b&&this._a===e._a}clone(){return new v(this._r,this._g,this._b,this._a)}toHSV(){var e=255*this.r,t=255*this.g,i=255*this.b;let s=Math.max(e,t,i),n=Math.min(e,t,i),o=s-n,r,a=0===s?0:o/s,h=s/255;switch(s){case n:r=0;break;case e:r=t-i+o*(t<i?6:0),r/=6*o;break;case t:r=i-e+2*o,r/=6*o;break;case i:r=e-t+4*o,r/=6*o}return{h:r,s:a,v:h}}fromHSV(e,t,i,s=1){e<0&&(e=0),t<0&&(t=0),i<0&&(i=0);let n,o,r,a,h,l,d,c;switch(a=Math.floor(6*e),h=6*e-a,l=i*(1-t),d=i*(1-h*t),c=i*(1-(1-h)*t),a%6){case 0:n=i,o=c,r=l;break;case 1:n=d,o=i,r=l;break;case 2:n=l,o=i,r=c;break;case 3:n=l,o=d,r=i;break;case 4:n=c,o=l,r=i;break;case 5:n=i,o=l,r=d}this.r=n,this.g=o,this.b=r,this.a=s}toStyleHexRGB(){var e=Math.round(255*this._r),t=Math.round(255*this._g),i=Math.round(255*this._b);return"#"+((1<<24)+(e<<16)+(t<<8)+i).toString(16).slice(1)}toStyleHexRGBA(){function e(e){e=e.toString(16);return 1===e.length?"0"+e:e}var t=Math.round(255*this._r),i=Math.round(255*this._g),s=Math.round(255*this._b),n=Math.round(255*this._a);return"#"+e(t)+e(i)+e(s)+e(n)}fromStyleHexRGB(e){ye.warn("Color::fromStyleHexRGB","Color::fromStyleHex"),8===e.length&&"#"!==e.charAt(0)&&(e="#"+e),9===e.length&&(e=e.substring(0,7)),4===e.length&&"#"!==e.charAt(0)&&(e="#"+e),5===e.length&&(e=e.substring(0,4));e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,i,s){return t+t+i+i+s+s});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(t)return this.r=parseInt(t[1],16)/255,this.g=parseInt(t[2],16)/255,this.b=parseInt(t[3],16)/255,this;throw new Error("Not a valid 6 or 3 char hex rgb value! "+e)}fromStyleHex(e){if("#"!==e.charAt(0))throw new Error("Hex doesn't start with pound. Hex: "+e);if(4!==e.length&&5!==e.length&&7!==e.length&&9!==e.length)throw new Error("Hex length invalid! Hex: "+e);if(4===e.length?(t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,e=e.replace(t,function(e,t,i,s){return t+t+i+i+s+s})):5===e.length&&(t=/^#?([a-f\d])([a-f\d])([a-f\d])([a-f\d])$/i,e=e.replace(t,function(e,t,i,s,n){return t+t+i+i+s+s+n+n})),7===e.length){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)throw new Error("Not a valid 6 or 3 char hex rgb value! "+e);this.r=parseInt(t[1],16)/255,this.g=parseInt(t[2],16)/255,this.b=parseInt(t[3],16)/255}else{if(9!==e.length)throw new Error("Unexpected hex code length ("+e.length+")! Hex (may be expanded): "+e);t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)throw new Error("Not a valid 6 or 3 char hex rgb value! "+e);this.r=parseInt(t[1],16)/255,this.g=parseInt(t[2],16)/255,this.b=parseInt(t[3],16)/255,this.a=parseInt(t[4],16)/255}return this}fromStyleFuncRGBA(e){e=e.split("(")[1].split(")")[0].split(",");return this.r=parseInt(e[0],10)/255,this.g=parseInt(e[1],10)/255,this.b=parseInt(e[2],10)/255,this.a=parseFloat(e[3]),this}fromStyle(e){return e=e.trim(),0===e.indexOf("rgba(")?this.fromStyleFuncRGBA(e):this.fromStyleHex(e)}toStyleFuncRGBA(){return"rgba("+Math.round(255*this._r)+", "+Math.round(255*this._g)+", "+Math.round(255*this._b)+", "+this._a+")"}toStyle(){return 1!==this._a?this.toStyleFuncRGBA():this.toStyleHexRGB()}}class Ge{constructor(e,t){this.asset=e,this.canvas=document.createElement("canvas"),this.canvas.width=this.asset.naturalWidth,this.canvas.height=this.asset.naturalHeight,this._ctx=this.canvas.getContext("2d"),this.update(t)}update(e){var t;this.scaleFactor!==e&&(this.scaleFactor=e,this.inverseScaleFactor=1/e,t=e*this.asset.naturalWidth,e=e*this.asset.naturalHeight,this.canvas.width=Math.max(1,Math.ceil(t)),this.canvas.height=Math.max(1,Math.ceil(e)),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.drawImage(this.asset.data,0,0,t,e))}}const Ne=new class{constructor(){this._dict={},this._list=[],this._scaleFactor=1,this.enabled=!0}get(e){let t=this._dict[e.path];return t||(this._dict[e.path]=t=new Ge(e,this._scaleFactor),this._list.push(t)),t}update(e){if((!this.enabled||e<1)&&(e=1),this._scaleFactor!==e){this._scaleFactor=e;for(var t of this._list)t.update(e)}}},ze={};var He,s,Ue,b,k,$e;class x{constructor(e,t=!0,i=!0,s=null){this.onPointerOver=new r,this.onPointerOut=new r,this.onPointerRollOver=new r,this.onPointerRollOut=new r,this.onPointerPress=new r,this.onPointerRelease=new r,this.onPointerClick=new r,this.onPointerCancel=new r,this.onPointerSecondaryPress=new r,this.onPointerSecondaryRelease=new r,this.onPointerSecondaryClick=new r,this.onPointerSecondaryCancel=new r,this.displayObject=e,this.pointerEnabled=t,this.pointerChildrenEnabled=i,this.hitArea=s}}class qe{get overDisplayObject(){return this._pointChain.last?this._pointChain.last.value:null}constructor(){this._pointChains=[new G,new G],this._pointChainIndex=0,this._pressChain=new G,this._secondaryPressChain=new G,this._pressed=!1,this._secondaryPressed=!1,this._cursor=null,this._pool=new N,this._pointChain=this._pointChains[0],this._nextPointChain=this._pointChains[1],we.primary.onPress.add(this.PointerInput_primary_onPress,this),we.primary.onRelease.add(this.PointerInput_primary_onRelease,this),we.primary.onCancel.add(this.PointerInput_primary_onCancel,this),we.primary.onSecondaryPress.add(this.PointerInput_primary_onSecondaryPress,this),we.primary.onSecondaryRelease.add(this.PointerInput_primary_onSecondaryRelease,this),we.primary.onSecondaryCancel.add(this.PointerInput_primary_onSecondaryCancel,this)}beginFrame(){this.point()}point(){let e,t,i,s;var n,o;let r,a,h=null;for(o=we.primary.isPresent?F.pick(we.primary.x,we.primary.y,0):null,n=this._pointChain.last?this._pointChain.last.value:null,i=o;i;){var l=this._pool.remove()||new I;l.value=i,this._nextPointChain.prepend(l),h=h||i.cursor,i=i.parent}for(r=null,t=this._pointChain.first,e=this._nextPointChain.first,a=null!==t||null!==e;t&&e&&t.value===e.value;)r=t.value,t=t.next,e=e.next,t||e||(a=!1);for(s=!1,t=this._pointChain.last;t;)a&&t.value.input&&t.value.input.onPointerOut.count&&t.value.input.onPointerOut.invoke(t.value,n),s||(t.value!==r?t.value.input&&t.value.input.onPointerRollOut.count&&t.value.input.onPointerRollOut.invoke(t.value,n):s=!0),t.value=null,this._pool.add(t),t=t.previous;for(this._pointChain.clear(),s=!1,e=this._nextPointChain.last;e;)s||(e.value!==r?e.value.input&&e.value.input.onPointerRollOver.count&&e.value.input.onPointerRollOver.invoke(e.value,o):s=!0),a&&e.value.input&&e.value.input.onPointerOver.count&&e.value.input.onPointerOver.invoke(e.value,o),e=e.previous;0===this._pointChainIndex?(this._pointChain=this._pointChains[1],this._nextPointChain=this._pointChains[0],this._pointChainIndex=1):(this._pointChain=this._pointChains[0],this._nextPointChain=this._pointChains[1],this._pointChainIndex=0),h=F.overrideCursorType||h||F.defaultCursor,this._cursor!==h&&(this._cursor=h,F.canvas.style.cursor=h)}press(){this._pressed&&this.cancel(),this._pressed=!0,this.point();let e=this._pointChain.last,t;for(;e;)t=this._pool.remove()||new I,t.value=e.value,this._pressChain.prepend(t),e=e.previous;t=this._pressChain.last;for(var i=t?t.value:null;t;)t.value.input&&t.value.input.onPointerPress.count&&t.value.input.onPointerPress.invoke(t.value,i),t=t.previous}release(){this._pressed=!1,this.point();let e,t,i,s;var n;let o,r;for(o=null,t=this._pressChain.first,e=this._pointChain.first,r=null!==t||null!==e;t&&e&&t.value===e.value;)o=t.value,t=t.next,e=e.next,t||e||(r=!1);if(r){for(i=!1,t=this._pressChain.last,s=t?t.value:null;t;)i||t.value===o?i=!0:t.value.input&&t.value.input.onPointerCancel.count&&t.value.input.onPointerCancel.invoke(t.value,s),t.value=null,this._pool.add(t),t=t.previous;for(this._pressChain.clear(),e=this._pointChain.last,n=e?e.value:null;e;)e.value.input&&e.value.input.onPointerRelease.count&&e.value.input.onPointerRelease.invoke(e.value,n),e=e.previous}else{for(t=this._pressChain.last,s=t?t.value:null;t;)t.value.input&&t.value.input.onPointerRelease.count&&t.value.input.onPointerRelease.invoke(t.value,s),t.value.input&&t.value.input.onPointerClick.count&&t.value.input.onPointerClick.invoke(t.value,s),t.value=null,this._pool.add(t),t=t.previous;this._pressChain.clear()}}cancel(){this._pressed=!1;let e=this._pressChain.last;for(var t=e?e.value:null;e;)e.value.input&&e.value.input.onPointerCancel.count&&e.value.input.onPointerCancel.invoke(e.value,t),e.value=null,this._pool.add(e),e=e.previous;this._pressChain.clear()}pressSecondary(){this._secondaryPressed&&this.cancelSecondary(),this._secondaryPressed=!0,this.point();let e=this._pointChain.last,t;for(;e;)t=this._pool.remove()||new I,t.value=e.value,this._secondaryPressChain.prepend(t),e=e.previous;t=this._secondaryPressChain.last;for(var i=t?t.value:null;t;)t.value.input&&t.value.input.onPointerSecondaryPress.count&&t.value.input.onPointerSecondaryPress.invoke(t.value,i),t=t.previous}releaseSecondary(){this._secondaryPressed=!1,this.point();let e,t,i,s;var n;let o,r;for(o=null,t=this._secondaryPressChain.first,e=this._pointChain.first,r=null!==t||null!==e;t&&e&&t.value===e.value;)o=t.value,t=t.next,e=e.next,t||e||(r=!1);if(r){for(i=!1,t=this._secondaryPressChain.last,s=t?t.value:null;t;)i||t.value===o?i=!0:t.value.input&&t.value.input.onPointerSecondaryCancel.count&&t.value.input.onPointerSecondaryCancel.invoke(t.value,s),t.value=null,this._pool.add(t),t=t.previous;for(this._secondaryPressChain.clear(),e=this._pointChain.last,n=e?e.value:null;e;)e.value.input&&e.value.input.onPointerSecondaryRelease.count&&e.value.input.onPointerSecondaryRelease.invoke(e.value,n),e=e.previous}else{for(t=this._secondaryPressChain.last,s=t?t.value:null;t;)t.value.input&&t.value.input.onPointerSecondaryRelease.count&&t.value.input.onPointerSecondaryRelease.invoke(t.value,s),t.value.input&&t.value.input.onPointerSecondaryClick.count&&t.value.input.onPointerSecondaryClick.invoke(t.value,s),t.value=null,this._pool.add(t),t=t.previous;this._secondaryPressChain.clear()}}cancelSecondary(){this._secondaryPressed=!1;let e=this._secondaryPressChain.last;for(var t=e?e.value:null;e;)e.value.input&&e.value.input.onPointerSecondaryCancel.count&&e.value.input.onPointerSecondaryCancel.invoke(e.value,t),e.value=null,this._pool.add(e),e=e.previous;this._secondaryPressChain.clear()}PointerInput_primary_onPress(){this.press()}PointerInput_primary_onRelease(){this.release()}PointerInput_primary_onCancel(){this.cancel()}PointerInput_primary_onSecondaryPress(){this.pressSecondary()}PointerInput_primary_onSecondaryRelease(){this.releaseSecondary()}PointerInput_primary_onSecondaryCancel(){this.cancelSecondary()}}class We{constructor(){this.parent=null,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.skewX=0,this.skewY=0,this.regX=0,this.regY=0,this.maskShape=null,this.visible=!0,this.alpha=1,this.cursor=null,this.input=null,this._wvp=new K,this._pt=new W,this._xformMatrix=new K}getConcatenatedMatrix(e){e=e||new K,e.setTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY);let t=this.parent;for(;t;)e.prependTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY),t=t.parent;return e.prependTransform(0,0,F.scaleFactor,F.scaleFactor,0,0,0,0,0),e}globalToLocal(e){return this.getConcatenatedMatrix(this._xformMatrix).invert().transformVector(e)}localToGlobal(e){return this.getConcatenatedMatrix(this._xformMatrix).transformVector(e)}setPosition(e,t){return this.x=e,this.y=t,this}setRotation(e){return this.rotation=e,this}setReg(e,t){return this.regX=e,this.regY=t,this}}class je extends We{constructor(){super(...arguments),this._children=[]}get children(){return this._children}addChild(e){if(e===this)throw new Error("Cannot add an item to itself!");let t=this.parent;for(;t;){if(t===e)throw new Error("An item cannot be added as its own descendant!");t=t.parent}return e.parent&&e.parent.removeChild(e),this._children.push(e),e.parent=this,e}addChildAt(e,t){if(e===this)throw new Error("Cannot add an item to iteself!");let i=this.parent;for(;i;){if(i===e)throw new Error("An item cannot be added as its own descendant!");i=i.parent}if(t<0||t>this._children.length)throw new Error("Index ("+t+") out of range [0, "+this._children.length+"]!");return e.parent&&e.parent.removeChild(e),t<=0?this._children.unshift(e):t>=this._children.length?this._children.push(e):this._children.splice(t,0,e),e.parent=this,e}getChildIndex(e){e=this._children.indexOf(e);if(e<0)throw new Error("DisplayObject is not a child of this Container!");return e}setChildIndex(e,t){if(t<0||t>=this._children.length)throw new Error("Index ("+t+") out of range [0, "+this._children.length+"]!");var i=this._children.indexOf(e);if(i<0)throw new Error("DisplayObject is not a child of this Container!");i!==t&&(this._children.splice(i,1),t<=0?this._children.unshift(e):t>=this._children.length?this._children.push(e):this._children.splice(t,0,e))}swapChildren(e,t){var i=this._children.indexOf(e),s=this._children.indexOf(t);if(i<0||s<0)throw new Error("DisplayObject is not a child of this Container!");i!==s&&(this._children[i]=t,this._children[s]=e)}getChildAt(e){if(e<0||e>=this._children.length)throw new Error("Index ("+e+") out of range [0, "+this._children.length+"]!");return this._children[e]}removeChild(e){var t=this._children.indexOf(e);if(t<0)throw new Error("DisplayObject is not a child of this Container!");return this._children.splice(t,1),e.parent=null,e}removeChildAt(e){if(e<0||e>=this._children.length)throw new Error("Index ("+e+") out of range [0, "+this._children.length+"]!");e=this._children.splice(e,1)[0];return e.parent=null,e}pick(i,s,n,o){if(0!==o||!this.input||this.input&&this.input.pointerChildrenEnabled){let t;for(let e=this._children.length-1;0<=e;--e)if(t=this._children[e],t.visible&&!(t.alpha<=0)&&0!==t.scaleX&&0!==t.scaleY&&(0!==o||!t.input||t.input.pointerEnabled||t.input.pointerChildrenEnabled)&&(t=t.pick(this._wvp.copy(i).appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY),s,n,o),t))return t}return 0===o&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(i).invert().transformVector(this._pt.set(s,n)),this.input.hitArea.containsVector(this._pt))?this:null}render(t,i,s){var n;for(let e=0;e<this._children.length;++e)n=this._children[e],!n.visible||n.alpha<=0||0===n.scaleX||0===n.scaleY||(null!==n.maskShape&&(t.save(),t.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),(n.maskShape,!1)?n.maskShape.execute(t,!1):n.maskShape instanceof h?(t.beginPath(),t.rect(n.maskShape.x,n.maskShape.y,n.maskShape.width,n.maskShape.height)):n.maskShape&&(t.beginPath(),t.arc(n.maskShape.origin.x,n.maskShape.origin.y,n.maskShape.radius,0,c.TWO_PI)),t.clip()),n.render(t,this._wvp.copy(i).appendTransform(n.x,n.y,n.scaleX,n.scaleY,n.rotation,n.skewX,n.skewY,n.regX,n.regY),s*n.alpha),null!==n.maskShape&&t.restore())}}class Ve extends je{get parent(){return null}set parent(e){if(null!==e)throw new Error("The stage root cannot be set as a child of anything!")}constructor(){super(),this._rootTransform=new K}rootPick(e,t,i){return this._rootTransform.setTransform(0,0,F.scaleFactor,F.scaleFactor,0,0,0,-F.x/F.scaleFactor,-F.y/F.scaleFactor),this._rootTransform.appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY),this.pick(this._rootTransform,e,t,i)||this}rootDraw(){this._rootTransform.setTransform(0,0,F.scaleFactor,F.scaleFactor,0,0,0,-F.x/F.scaleFactor,-F.y/F.scaleFactor),this._rootTransform.appendTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.skewX,this.skewY,this.regX,this.regY),this.render(F.ctx,this._rootTransform,this.alpha)}}class S extends We{constructor(e="",t=null,i){super(),this.fontSize=12,this.align="left",this.baseline="top",this.fill="#000000",this.underStroke=null,this.underStrokeWidth=1,this.overStroke=null,this.overStrokeWidth=1,this.shadowFill=null,this.shadowUnderStroke=null,this.shadowUnderStrokeWidth=1,this.shadowOverStroke=null,this.shadowOverStrokeWidth=1,this.shadowX=0,this.shadowY=0,this.shadowAlpha=.3,this.underStrokeJoin="round",this.text=e,this.font=t,this.fontSize=i}pick(e,t,i){return this.input&&this.input.pointerEnabled,null}measure(){return F.ctx.font=this.font.cssFont(this.fontSize),F.ctx.textAlign=this.align,F.ctx.measureText(this.text)}getVerticalCenterOffset(){var e,t;if("top"===this.baseline)return e=this.font.ascent/this.font.unitsPerEm*this.fontSize,t=this.font.descent/this.font.unitsPerEm*this.fontSize,(e+t)/2-t;throw new Error("Not implemented!")}render(e,t,i){e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.font=this.font.cssFont(this.fontSize),e.textBaseline="alphabetic",e.textAlign=this.align;let s=0;if("top"===this.baseline)s+=this.font.ascent/this.font.unitsPerEm*this.fontSize;else if("alphabetic"===this.baseline)s+=0;else if("bottom"===this.baseline)s+=this.font.descent/this.font.unitsPerEm*this.fontSize;else{if("middle"!==this.baseline)throw new Error("Text Baseline "+this.baseline+" is not yet supported!");var t=this.font.ascent/this.font.unitsPerEm*this.fontSize,n=this.font.descent/this.font.unitsPerEm*this.fontSize;s+=(t+n)/2}e.globalAlpha=i*this.shadowAlpha,this.shadowUnderStroke&&0<this.shadowUnderStrokeWidth&&(e.strokeStyle=this.shadowUnderStroke,e.lineWidth=this.shadowUnderStrokeWidth,e.strokeText(this.text,0+this.shadowX,s+this.shadowY)),this.shadowFill&&(e.fillStyle=this.shadowFill,e.fillText(this.text,0+this.shadowX,s+this.shadowY)),this.shadowOverStroke&&0<this.shadowOverStrokeWidth&&(e.strokeStyle=this.shadowOverStroke,e.lineWidth=this.shadowOverStrokeWidth,e.strokeText(this.text,0+this.shadowX,s+this.shadowY)),e.globalAlpha=i,this.underStroke&&0<this.underStrokeWidth&&(e.lineJoin=this.underStrokeJoin,e.strokeStyle=this.underStroke,e.lineWidth=this.underStrokeWidth,e.strokeText(this.text,0,s)),this.fill&&(e.fillStyle=this.fill,e.fillText(this.text,0,s)),this.overStroke&&0<this.overStrokeWidth&&(e.strokeStyle=this.overStroke,e.lineWidth=this.overStrokeWidth,e.strokeText(this.text,0,s))}}class Ye extends We{constructor(e=null){super(),this.img=null,this.isSVG=!1,this.width=0,this.height=0,this.blendMode=null,this.setImage(e)}setRegCenterCenter(){return this.regX=this.width/2,this.regY=this.height/2,this}setScale(e,t){return this.scaleX=e,this.scaleY=t,this}setVisible(e){return this.visible=e,this}setImage(e){e?1===e.imageAssetType?(this.width=e.naturalWidth,this.height=e.naturalHeight,this.isSVG=!0,this.img=Ne.get(e).canvas):0===e.imageAssetType?(this.width=e.data.width,this.height=e.data.height,this.isSVG=!1,this.img=e.data):(this.width=e.width,this.height=e.height,this.isSVG=!1,this.img=e):(this.width=0,this.height=0,this.isSVG=!1,this.img=null)}render(e,t,i){this.img&&(this.isSVG&&Ne.enabled&&1<F.scaleFactor&&t.appendTransform(0,0,1/F.scaleFactor,1/F.scaleFactor,0,0,0,0,0),_i.showBitmapOutlines&&(e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha=i,e.strokeStyle="#FF0000",e.lineWidth=2*F.pixelSize,e.strokeRect(0,0,this.img.width,this.img.height)),e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha=i,this.blendMode&&(e.globalCompositeOperation=this.blendMode),e.drawImage(this.img,0,0),this.blendMode)&&(e.globalCompositeOperation="source-over")}pick(e,t,i,s){return(!this.input||this.input.pointerEnabled)&&0===s&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(e).invert().transformVector(this._pt.set(t,i)),this.input.hitArea.containsVector(this._pt))?this:null}}class C extends je{}class Xe extends We{constructor(e,t,i,s,n=null){super(),this.strokeWidth=0,this.strokeLineCap="round",this.strokeLineJoin="round",this.rectangle=new h(e,t,i,s),this.fillStyle=n,this.input=new x(this,!0,!1,this.rectangle)}pick(e,t,i,s){return 0===s&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(e).invert().transformVector(this._pt.set(t,i)),this.input.hitArea.containsVector(this._pt))?this:null}render(e,t,i){e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha=i,e.beginPath(),e.rect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.fillStyle&&(e.fillStyle=this.fillStyle,e.fill()),this.strokeStyle&&0<this.strokeWidth&&(e.lineJoin=this.strokeLineJoin,e.lineCap=this.strokeLineCap,e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,e.stroke())}}class T extends We{constructor(e,t,i,s,n,o=null){super(),this.strokeWidth=0,this.strokeUnderFill=!1,this.topLeftRadius=0,this.topRightRadius=0,this.bottomLeftRadius=0,this.bottomRightRadius=0,this.rectangle=new h(e,t,i,s),this.fillStyle=o,this.topLeftRadius=this.topRightRadius=this.bottomLeftRadius=this.bottomRightRadius=n,this.input=new x(this,!0,!1,this.rectangle)}pick(e,t,i,s){return 0===s&&this.input&&this.input.pointerEnabled&&this.input.hitArea&&(this._wvp.copy(e).invert().transformVector(this._pt.set(t,i)),this.input.hitArea.containsVector(this._pt))?this:null}render(e,t,i){e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha=i;let s=this.rectangle.x,n=s+this.rectangle.width;n<s&&(i=n,n=s,s=i);let o=this.rectangle.y,r=o+this.rectangle.height,a=(r<o&&(i=r,r=o,o=i),0);a=this.topLeftRadius,i=a<0,i&&(a=-a);var h=s,l=o+a,d=s+a,c=o,u=i?s+a:s,p=i?o+a:o,m=(a=this.topRightRadius,i=a<0,i&&(a=-a),n-a),g=o,f=n,_=o+a,w=i?n-a:n,y=i?o+a:o,v=(a=this.bottomRightRadius,i=a<0,i&&(a=-a),n),b=r-a,k=n-a,x=r,S=i?n-a:n,C=i?r-a:r,T=(a=this.bottomLeftRadius,i=a<0,i&&(a=-a),s+a),F=r,P=s,B=r-a,A=i?s+a:s,i=i?r-a:r;e.beginPath(),e.moveTo(h,l),e.quadraticCurveTo(u,p,d,c),e.lineTo(m,g),e.quadraticCurveTo(w,y,f,_),e.lineTo(v,b),e.quadraticCurveTo(S,C,k,x),e.lineTo(T,F),e.quadraticCurveTo(A,i,P,B),e.closePath(),this.strokeUnderFill&&this.strokeStyle&&0<this.strokeWidth&&(e.lineJoin="round",e.lineCap="round",e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,e.stroke()),this.fillStyle&&("string"==typeof this.fillStyle?(e.fillStyle=this.fillStyle,e.fill()):(e.scale(this.rectangle.width,this.rectangle.height),e.fillStyle=this.fillStyle,e.fill(),e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty))),!this.strokeUnderFill&&this.strokeStyle&&0<this.strokeWidth&&(e.lineJoin="round",e.lineCap="round",e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,e.stroke())}}class Je extends We{constructor(e,t=null){if(super(),this.strokeStyle=null,this.strokeWidth=0,this.closePath=!0,this.strokeLineCap="round",this.strokeLineJoin="round",this.strokeDash=null,this.strokeDashOffset=0,e.length%2!=0)throw new Error("Invalid path! Odd number of values");this.points=e.slice(0),this.fillStyle=t}pick(e,t,i){return null}render(t,e,i){if(t.setTransform(e.a,e.b,e.c,e.d,e.tx,e.ty),t.globalAlpha=i,2<this.points.length){t.beginPath(),t.moveTo(this.points[0],this.points[1]);for(let e=2;e<this.points.length;e+=2)t.lineTo(this.points[e],this.points[e+1]);this.closePath&&t.closePath(),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fill()),this.strokeStyle&&0<this.strokeWidth&&(this.strokeDash&&this.strokeDash.length&&(t.setLineDash(this.strokeDash),t.lineDashOffset=this.strokeDashOffset),t.lineJoin=this.strokeLineJoin,t.lineCap=this.strokeLineCap,t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.stroke(),t.lineJoin="round",this.strokeDash)&&this.strokeDash.length&&(t.setLineDash([]),t.lineDashOffset=0)}}setPoints(e){if(e.length%2!=0)throw new Error("Invalid path! Odd number of values");this.points=e.slice()}}class Ke extends We{constructor(e=0,t=0,i=50,s=null,n=null){super(),this.strokeWidth=1,this.strokeMatrix=null,this.startAngle=0,this.endAngle=360,this.innerRadius=0,this.strokeDash=null,this.strokeDashOffset=0,this.asPie=!1,this.strokeBeforeClosePie=!1,this.blendMode=null,this.circle=new J(e,t,i),this.fillStyle=s,this.strokeStyle=n}pick(e,t,i){return this.input&&!this.input.pointerEnabled?null:(e.invert().transformVector(this._pt.set(t,i)),this.input&&this.input.hitArea?this.input.hitArea.containsVector(this._pt)?this:null:this.circle.containsVector(this._pt)?this:null)}render(e,t,i){var s;this.startAngle!==this.endAngle&&0!==this.circle.radius&&(this.fillStyle||this.strokeStyle)&&(e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha=i,this.blendMode&&(e.globalCompositeOperation=this.blendMode),i=c.DEG_TO_RAD*this.startAngle,s=c.DEG_TO_RAD*this.endAngle,e.moveTo(this.circle.origin.x,this.circle.origin.y),e.beginPath(),e.arc(0,0,this.circle.radius,i,s,!1),this.strokeDash&&this.strokeDash.length&&(e.setLineDash(this.strokeDash),e.lineDashOffset=this.strokeDashOffset),this.asPie&&(this.strokeBeforeClosePie&&this.strokeStyle&&0<this.strokeWidth&&(e.lineJoin="round",e.lineCap="round",e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,this.strokeMatrix&&(this._wvp.copy(t).appendMatrix(this.strokeMatrix),e.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty)),e.stroke(),this.strokeMatrix)&&e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.lineTo(this.circle.origin.x,this.circle.origin.y),e.closePath()),0!==this.innerRadius&&e.arc(this.circle.origin.x,this.circle.origin.y,this.innerRadius,s,i,!0),this.fillStyle&&(e.fillStyle=this.fillStyle,e.fill()),this.strokeStyle&&0<this.strokeWidth&&(this.asPie&&this.strokeBeforeClosePie||(e.lineJoin="round",e.lineCap="round",e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,this.strokeMatrix&&(this._wvp.copy(t).appendMatrix(this.strokeMatrix),e.setTransform(this._wvp.a,this._wvp.b,this._wvp.c,this._wvp.d,this._wvp.tx,this._wvp.ty)),e.stroke())),this.strokeDash&&this.strokeDash.length&&(e.setLineDash([]),e.lineDashOffset=0),this.blendMode)&&(e.globalCompositeOperation="source-over")}}const F=p.isMainThread?new class{get designWidth(){return this._designWidth}set designWidth(e){this._designWidth!==e&&(this._designWidth=e,this._dirty=!0)}get designHeight(){return this._designHeight}set designHeight(e){this._designHeight!==e&&(this._designHeight=e,this._dirty=!0)}get autoRotateDesignSize(){return this._autoRotateDesignSize}set autoRotateDesignSize(e){this._autoRotateDesignSize!==e&&(this._autoRotateDesignSize=e,this._dirty=!0)}get respectTitleSafeArea(){return this._respectTitleSafeArea}set respectTitleSafeArea(e){this._respectTitleSafeArea=e,this._dirty=!0}constructor(){this.onResize=new r,this.scaleFactor=1,this.pixelSize=1,this.titleSafeArea=new h(0,0,100,100),this.root=new Ve,this._designWidth=1600,this._designHeight=1200,this._autoRotateDesignSize=!0,this.x=0,this.y=0,this.width=100,this.height=100,this.outerWidth=100,this.outerHeight=100,this.outerScaleFactor=1,this.titleSafePadding={top:0,left:0,right:0,bottom:0},this.screen={top:0,left:0,right:0,bottom:0,width:100,height:100},this._dirty=!0,this.canvas=document.getElementById("app-player-game-canvas"),this.canvasWidth=100,this.canvasHeight=100,this._respectTitleSafeArea=!0,this.defaultCursor="default",this.overrideCursorType=null}initialize(){this.ctx=this.canvas.getContext("2d"),this.inputManager=new qe,ze.panelBg=this.ctx.createLinearGradient(0,0,0,1),ze.panelBg.addColorStop(0,"#000000"),ze.panelBg.addColorStop(1,"#333333")}App_viewChange(){this._dirty=!0}App_fullscreenChange(){this._dirty=!0}pick(e,t,i){return this.root.rootPick(e,t,i)}poll(){if(this._dirty){this.canvasWidth=m.view.rect.w,this.canvasHeight=m.view.rect.h,this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.canvas.style.width=this.canvasWidth/m.view.pixelRatio+"px",this.canvas.style.height=this.canvasHeight/m.view.pixelRatio+"px",this.titleSafePadding.bottom=0,this.titleSafePadding.top=0,this.titleSafePadding.left=0,this.titleSafePadding.right=0,"Apple iOS"===Z.os&&"Safari"===Z.browser&&("Handheld"===Z.device?0===m.view.orientation?this.titleSafePadding.top=20*m.view.pixelRatio:this.titleSafePadding.bottom=40*m.view.pixelRatio:this.titleSafePadding.bottom=20*m.view.pixelRatio),this._respectTitleSafeArea||(this.titleSafePadding.bottom=0,this.titleSafePadding.top=0,this.titleSafePadding.left=0,this.titleSafePadding.right=0),this.titleSafeArea.set(this.titleSafePadding.left,this.titleSafePadding.top,this.canvas.width-this.titleSafePadding.left-this.titleSafePadding.right,this.canvas.height-this.titleSafePadding.top-this.titleSafePadding.bottom);let e=this._designWidth,t=this._designHeight;this._autoRotateDesignSize&&1===m.view.orientation&&(e=this._designHeight,t=this._designWidth),this.outerScaleFactor=Math.min(m.view.rect.w/e,m.view.rect.h/t),this.outerWidth=m.view.rect.w/this.outerScaleFactor,this.outerHeight=m.view.rect.h/this.outerScaleFactor,this.scaleFactor=Math.min(this.titleSafeArea.width/e,this.titleSafeArea.height/t),this.x=this.titleSafeArea.x,this.y=this.titleSafeArea.y,this.width=this.titleSafeArea.width/this.scaleFactor,this.height=this.titleSafeArea.height/this.scaleFactor,this.screen.left=this.titleSafePadding.left*(-1/F.scaleFactor),this.screen.right=this.width+this.titleSafePadding.right*(1/F.scaleFactor),this.screen.width=this.screen.right-this.screen.left,this.screen.top=this.titleSafePadding.top*(-1/F.scaleFactor),this.screen.bottom=this.height+this.titleSafePadding.bottom*(1/F.scaleFactor),this.screen.height=this.screen.bottom-this.screen.top,this._dirty=!1,this.onResize.count&&this.onResize.invoke(),Ne.update(this.scaleFactor)}this.inputManager.beginFrame()}clear(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.setTransform(1,0,0,1,0,0)}draw(){this.root.rootDraw()}}:null;class Qe extends C{get state(){return this._state}constructor(){super(),this._state=0,this.isPressed=!1,this.isOver=!1,this.isDisabled=!1,this.clickSound=null,this.value=null,this._canceled=!1,this.cursor="pointer",this.input=new x(this),this.input.onPointerRollOver.add(this.this_onPointerRollOver,this),this.input.onPointerRollOut.add(this.this_onPointerRollOut,this),this.input.onPointerPress.add(this.this_onPointerPress,this),this.input.onPointerCancel.add(this.this_onPointerCancel,this),this.input.onPointerRelease.add(this.this_onPointerRelease,this),this.input.onPointerClick.add(this.this_onPointerClick,this)}updateButtonState(e=!1){this.isDisabled?3===this._state&&!e||this.disabled():this.isOver?this.isPressed?(3!==this._state&&!e||this.enabled(),2===this._state&&!e||this.down()):(3!==this._state&&!e||this.enabled(),1===this._state&&!e||this.over()):(3!==this._state&&!e||this.enabled(),0===this._state&&!e||this.up())}up(){this._state=0}down(){this._state=2}over(){this._state=1}click(){}disabled(){this._state=3}enabled(){}enableButton(){this.isDisabled&&(this.isDisabled=!1,this.input.pointerEnabled=!0,this.updateButtonState(!0))}disableButton(){this.isDisabled||(this.isDisabled=!0,this.input.pointerEnabled=!1,this.updateButtonState(!0))}this_onPointerRollOver(e,t){this.isOver=!0,this.updateButtonState()}this_onPointerRollOut(e,t){this.isOver=!1,this.updateButtonState()}this_onPointerPress(e,t){this._canceled=!1,this.isPressed=!0,this.updateButtonState()}this_onPointerCancel(e,t){this.isPressed=!1,this.updateButtonState()}this_onPointerRelease(e,t){this.isPressed=!1,this.updateButtonState()}this_onPointerClick(e,t){this._canceled||(this.clickSound&&(this.clickSound.stop(),this.clickSound.play()),this.click())}simClick(){this.input.pointerEnabled&&this.input.onPointerClick.invoke(this,this)}cancel(){this._canceled=!0,this.isPressed=!1,this.updateButtonState()}}class Ze extends Xe{constructor(e){super(0,0,F.width,F.height,e.toStyleFuncRGBA()),this.cursor="pointer",this.anchor()}anchor(){this.rectangle.set(F.screen.left,F.screen.top,F.screen.width,F.screen.height)}render(e,t,i){this.anchor(),super.render(e,t,i)}}class et extends Xe{constructor(e=0){super(0,-.5,300,1,"#999999"),this.y=e}}class tt extends Qe{constructor(e,t){super();var i=t;this.width=t,this.input.pointerEnabled=!0,this.input.pointerChildrenEnabled=!1,this.input.hitArea=new h(0,0,t,i),this.bg=new Xe(0,0,t,i,"#CC0000"),this.addChild(this.bg),this._sideDiv=new Xe(-.5,0,1,i,"#999999"),this.addChild(this._sideDiv),this._sideDiv.visible=!e,this._sideDiv2=new Xe(-.5+t,0,1,i,"#999999"),this.addChild(this._sideDiv2),this._sideDiv2.visible=e,this._topDiv=new Xe(0,-.5,t,1,"#999999"),this.addChild(this._topDiv),this.iconHolder=new C,this.addChild(this.iconHolder),this.iconHolder.x=t/2,this.iconHolder.y=i/2,t*=.6,i*=.6;let s;this.iconHolder.addChild(s=new Xe(0,0,5/6*t,6,"#FFFFFF")),s.rotation=45,s.regX=s.rectangle.width/2,s.regY=s.rectangle.height/2,this.iconHolder.addChild(s=new Xe(0,0,5/6*i,6,"#FFFFFF")),s.rotation=-45,s.regX=s.rectangle.width/2,s.regY=s.rectangle.height/2,this.clickSound=new f(w.sounds.click.data)}up(){this.bg.fillStyle="#CC0000",this.iconHolder.scaleX=this.iconHolder.scaleY=1,super.up()}over(){this.bg.fillStyle="#DD0000",this.iconHolder.scaleX=this.iconHolder.scaleY=1.02,super.over()}down(){this.bg.fillStyle="#C00000",this.iconHolder.scaleX=this.iconHolder.scaleY=.98,super.down()}render(e,t,i){this._topDiv.visible=0!==F.y,super.render(e,t,i)}}class it extends Qe{get isOn(){return this._isOn}set isOn(e){e!==this._isOn&&(this._isOn=e,e?(this.knob.x=this.onKnobX,this.toggleBG.fillStyle=this.onColor):(this.knob.x=this.offKnobX,this.toggleBG.fillStyle=this.offColor))}constructor(e,t){super(),this._isOn=!0,this.onColor="#33CC66",this.offColor="#666666";this.height=50,this._bg=new Xe(0,0,300,50,"rgba(255,255,255,0.1)"),this._bg.visible=!1,this.addChild(this._bg),this._textField=new S(e,w.fonts["OpenSans-ExtraBold"].data,20),this._textField.fill="#FFFFFF",this._textField.align="left",this._textField.baseline="middle",this._textField.x=12,this._textField.y=25,this._textField.shadowFill="#000000",this._textField.shadowAlpha=.2,this._textField.shadowX=-2,this._textField.shadowY=2,this.addChild(this._textField);var e=new et,e=(e.y=50,this.addChild(e),this._textField.fontSize,this.onKnobX=56,this.offKnobX=3,new C),i=new T(0,-11,75,22,3,this.onColor),s=(e.addChild(i),this.toggleBG=i,new T(0,-8,16,16,2,"#FFFFFF"));s.x=56,e.addChild(s),this.knob=s,t||(s.x=this.offKnobX,i.fillStyle=this.offColor),this._isOn=t,this.addChild(e),e.x=211,e.y=25,this.input.hitArea=new h(0,0,300,50),this.input.pointerChildrenEnabled=!1,this.clickSound=new f(w.sounds.click.data)}over(){this._bg.visible=!0,this._bg.alpha=1,super.over()}up(){this._bg.visible=!1,super.up()}update(e){}}class st extends Qe{constructor(e){super();this.height=50,this._bg=new Xe(0,0,300,50,"rgba(255,255,255,0.1)"),this._bg.visible=!1,this.addChild(this._bg),this._textField=new S(e,w.fonts["OpenSans-ExtraBold"].data,20),this._textField.fill="#FFFFFF",this._textField.align="left",this._textField.baseline="middle",this._textField.x=12,this._textField.y=25,this._textField.shadowFill="#000000",this._textField.shadowAlpha=.2,this._textField.shadowX=-2,this._textField.shadowY=2,this.addChild(this._textField);e=new et;e.y=50,this.addChild(e),this._textField.fontSize;this.input.hitArea=new h(0,0,300,50),this.input.pointerChildrenEnabled=!1,this.clickSound=new f(w.sounds.click.data)}over(){this._bg.visible=!0,this._bg.alpha=1,super.over()}up(){this._bg.visible=!1,super.up()}update(e){}}class nt{constructor(){this._list=[],this._iterator=-1,this._reverseIterator=-1,this._count=0,this.display=new C}add(e){if(e.isActive)throw new Error("GameScreen is already added to the screen manager!");if(e._isDisposed)throw new Error("GameScreen is disposed!");e._isExiting=!1,e._isActive=!0,e._isFocused=!1,e._isOccluded=!0,e.screenManager=this,this._list.push(e),this._count++,this.display.addChild(e._display),e._isInitialized||e.initialize(),e.added(),this.updateScreenState()}addBehind(e,t){var i=e;if(!t.isActive)throw new Error("overScreen is not in the screen manager!");if(i.isActive)throw new Error("GameScreen is already added to the screen manager!");if(i._isDisposed)throw new Error("GameScreen is disposed!");i._isExiting=!1,i._isActive=!0,i._isFocused=!1,i._isOccluded=!0,i.screenManager=this;t=this._list.indexOf(t);0===t?this._list.unshift(e):this._list.splice(t,0,e),this._count++,t<=this._iterator&&this._iterator++,t<=this._reverseIterator&&this._reverseIterator++,this.display.addChildAt(i._display,t),i._isInitialized||i.initialize(),i.added(),this.updateScreenState()}remove(e){var t=e;if(!e.isActive)throw new Error("GameScreen is not in the screen manager!");e.isFocused&&t.loseFocus(),e.isOccluded||t.hide(),t.removed();var i=this._list.indexOf(e);0<=i&&(this._list.splice(i,1),this._count--,i<=this._iterator&&this._iterator--,i<=this._reverseIterator)&&this._reverseIterator--,this.display.removeChild(e.display),t._isActive=!1,t.screenManager=null,e.onRemoved.invoke(e),this.updateScreenState()}removeAll(){for(;0<this._list.length;)this.remove(this._list[this._list.length-1])}updateScreenState(){if(-1!==this._reverseIterator)throw new Error("Already iterating!");let e=!0,t=!1,i=!0;for(this._reverseIterator=this._count-1;0<=this._reverseIterator;this._reverseIterator--){var s=this._list[this._reverseIterator];i?(s._isInputAllowed||(s._isInputAllowed=!0,s.refreshInputState()),s._isModal&&(i=!1)):s._isInputAllowed&&(s._isInputAllowed=!1,s.refreshInputState()),e?(s._isFocused||s.gainFocus(),s._isModal&&(e=!1)):s._isFocused&&s.loseFocus(),t?s._isOccluded||s.hide():(s._isOccluded&&s.show(),s._isPopup||(t=!0))}this._reverseIterator=-1}update(e){if(-1!==this._iterator)throw new Error("already iterating!");for(this._iterator=0;this._iterator<this._count;++this._iterator)this._list[this._iterator].update(e);this._iterator=-1}draw(){if(this.updateScreenState(),-1!==this._iterator)throw new Error("already iterating!");for(this._iterator=0;this._iterator<this._count;++this._iterator)this._list[this._iterator].anchor(),this._list[this._iterator].draw();this._iterator=-1}toString(){let t="ScreenManager:";for(let e=this._list.length-1;0<=e;--e)t+="\n    "+this._list[e];return t}}class ot{get isModal(){return this._isModal}set isModal(e){this._isModal=e}get isPopup(){return this._isPopup}set isPopup(e){this._isPopup=e}get inputEnabled(){return this._inputEnabled}set inputEnabled(e){this._inputEnabled!==e&&(this._inputEnabled=e,this.refreshInputState())}get isActive(){return this._isActive}get isFocused(){return this._isFocused}get isOccluded(){return this._isOccluded}get isExiting(){return this._isExiting}get isDisposed(){return this._isDisposed}get display(){return this._display}constructor(e){this.onRemoved=new r,this._isModal=!0,this._isPopup=!1,this._inputEnabled=!0,this._inputState=!1,this._isActive=!1,this._isFocused=!1,this._isOccluded=!0,this._isInitialized=!1,this._isInputAllowed=!1,this._isExiting=!1,this._isDisposed=!1,this._display=new C,this.screenManager=null,this.name=e,this._display.input=new x(this._display),this._display.visible=!1,this._display.input.pointerEnabled=this._display.input.pointerChildrenEnabled=!1}initialize(){this._isInitialized=!0,this.anchor()}dispose(){this._isDisposed=!0,this._display=null}added(){}removed(){}exit(){!this._isActive||this._isExiting||(this._isExiting=!0,this.screenManager.remove(this))}gainFocus(){this._isFocused=!0,P._instance.navBar.homeButton.input.onPointerClick.add(this.navHomeButton_onClick,this),P._instance.navBar.settingsButton.input.onPointerClick.add(this.navSettingsButton_onClick,this),P._instance.navBar.closeButton.input.onPointerClick.add(this.navCloseButton_onClick,this)}loseFocus(){this._isFocused=!1,P._instance.navBar.homeButton.input.onPointerClick.remove(this.navHomeButton_onClick,this),P._instance.navBar.settingsButton.input.onPointerClick.remove(this.navSettingsButton_onClick,this),P._instance.navBar.closeButton.input.onPointerClick.remove(this.navCloseButton_onClick,this)}show(){this._isOccluded=!1,this._display.visible=!0}hide(){this._isOccluded=!0,this._display.visible=!1}refreshInputState(){this._isInputAllowed&&this._inputEnabled?!1===this._inputState&&(this._inputState=!0,this._display.input.pointerEnabled=this._display.input.pointerChildrenEnabled=!0,this.inputStateChanged(!0)):!0===this._inputState&&(this._inputState=!1,this._display.input.pointerEnabled=this._display.input.pointerChildrenEnabled=!1,this.inputStateChanged(!1))}inputStateChanged(e){}homeClicked(){}navHomeButton_onClick(){this.inputEnabled&&this.homeClicked()}settingsClicked(){}navSettingsButton_onClick(){this.inputEnabled&&this.settingsClicked()}closeClicked(){}navCloseButton_onClick(){this.inputEnabled&&this.closeClicked()}update(e){}anchor(){}draw(){}toString(){try{return"["+this.constructor.name+"]"}catch(e){return"[GameScreen]"}}}ot._debug=!1;class P{static getInstance(){return this._instance}get usesDailyChallenge(){return this._usesDailyChallenge}get usesMultiplayerGameModes(){return this._usesMultiplayerGameModes}constructor(e,t){if(this._usesDailyChallenge=!1,this._usesMultiplayerGameModes=!1,this._lastTickTime=0,this.timeScale=1,this.urlVars=[],P._instance)throw new Error("Singleton!");P._instance=e.instance=this,this.expfsCancelBtn_onClick=this.expfsCancelBtn_onClick.bind(this),this._type=e,this._settingsScreenClass=t,this.urlVars=function(){let e=[],t=location.search.trim();return"?"===t.charAt(0)&&(t=t.substring(1)),""!==t&&(e=t.split("&"),window.history.replaceState({},document.title,location.pathname)),e}(),this.screenManager=new nt,F.root.addChild(this.screenManager.display),this.navBar=new E,F.root.addChild(this.navBar),d.add(document.getElementById("expfs_cancel-btn"),"click",this.expfsCancelBtn_onClick,!0,!0)}expfsCancelBtn_onClick(){this.cancelExpanderFullscreen(),n.preferFullscreen=!1,m.fullscreen.exitFullscreen()}activate(){this._lastTickTime=Date.now()}deactivate(){}tick(){var e=Date.now();let t=e-this._lastTickTime;50<t&&(t=50),this._lastTickTime=e,y.isActive&&this.update(t*this.timeScale),this.draw()}update(e){this.screenManager.update(e),this.navBar.update(e)}draw(){F.clear(),this.screenManager.draw(),F.draw()}}class rt{constructor(){this.controller=null,this.screen=null,this._consumed=!1}initialize(){}dispose(){}update(e){}toString(){try{return"["+this.constructor.name+"]"}catch(e){return"[GamePhase]"}}}const at=new class{constructor(){this.default={shadow:"rgba(0,0,0,0.25)",buttonBorder:"#000000"},this.game={},this.theme={},this._themes={}}initialize(){let s=new v;function e(e){for(var t in e){var i=e[t];if("string"!=typeof i)throw new Error("Invalid color! must be a hex string");e[t]=s.fromStyle(i).toStyleHexRGBA()}}for(var t in e(this.game),this._themes)e(this._themes[t]);this.theme=this._themes[y.info.theme]}};class ht extends se{constructor(){super("com.games247."+y.info.gameType+"."+y.info.theme+".DailyChallenge"),this.year=null,this.month=null,this.day=null,this.state=null,this.score=null}save(){var e={};e.year=this.year,e.month=this.month,e.day=this.day,e.state=this.state,e.score=this.score,super.write(e)}load(){var e=super.read();this.year=u.validateIntMinInclusive(e.year,2020,null),this.month=u.validateIntMinInclusive(e.month,1,null),this.day=u.validateIntMinInclusive(e.day,1,null),this.state=u.validateOneOf(e.state,[0,1,2],null),this.score=u.validateIntMinInclusive(e.score,0,null),null!==this.year&&null!==this.month&&null!==this.day&&null!==this.state||this.reset()}reset(){this.year=this.month=this.day=this.state=this.score=null}}const B=p.isMainThread?new class{constructor(){this.onUpdated=new r,this.state=0,this.table={numPostedScores:0,averageScore:0,entries:[]},this.score=null,this._storable=new ht,this._lastSyncTime=0,this._syncInterval=3e4,this.loaded=!1,this.isUpdating=!1,this._xhr=null,this._disabled=!1,this.xhr_evt=this.xhr_evt.bind(this),"android-auto"===window.games247.nativeAppType?(this._api="https://247games.local:3000/api/1/",this._endpoint=this._api+"daily-challenge/",l.info("Daily Challenge disabled in android auto builds."),this._disabled=!0):0===location.hostname.indexOf("247games.local")||0===location.hostname.indexOf("localhost")?(this._api="https://247games.local:3000/api/1/",this._endpoint=this._api+"daily-challenge/",l.info("Using local daily challenge api.",this._api)):(this._api="https://247gamesdev.com:3000/api/1/",this._endpoint=this._api+"daily-challenge/");var e=new Date;this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.updateSeed()}load(){if(this.loaded)throw new Error("Load should only be called once during startup!");this.loaded=!0,this._storable.load(),this.day!==this._storable.day||this.month!==this._storable.month||this._storable.year!==this.year?this.store():(this.score=this._storable.score,this.state=this._storable.state),this.sync()}sync(e=!1){if(!this.loaded)throw new Error("DailyChallenge not loaded!");var t,i,s,n,o;this.isUpdating||(s=new Date,o=s.getTime(),t=s.getFullYear(),i=s.getMonth()+1,s=s.getDate(),n=s!==this.day||i!==this.month||t!==this.year,o=o-this._lastSyncTime>=this._syncInterval,n||o||e?((n||e)&&(this.year=t,this.month=i,this.day=s,this.state=0,this.score=null,this.table={numPostedScores:0,averageScore:0,entries:[]},this.updateSeed()),this.fetchAll()):this.onUpdated.invoke())}syncComplete(e){e&&(this.state=e.state,this.table=e.table,this.store()),this.onUpdated.invoke()}start(){if(!this.loaded)throw new Error("DailyChallenge not loaded!");var e;0!==this.state?l.warn("Invalid daily challenge state, ignoring attempt to start!"):(this.state=1,this.store(),e=new XMLHttpRequest,e.open("POST",this._endpoint,!0),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(JSON.stringify({gameType:y.info.gameType,theme:y.info.theme,year:this.year,month:this.month,day:this.day,action:"start"})))}submit(e){if(!this.loaded)throw new Error("DailyChallenge not loaded!");1!==this.state&&l.warn("Invalid daily challenge state, not in started state"),this.score=e,this.state=2,this.store(),this._xhr&&this.destroyXHR(),this.createXHR(),this._disabled?this.xhr_evt({type:"error"}):this._xhr.send(JSON.stringify({gameType:y.info.gameType,theme:y.info.theme,year:this.year,month:this.month,day:this.day,score:e,action:"submit"}))}fetchAll(){this.createXHR(),this._disabled?this.xhr_evt({type:"error"}):this._xhr.send(JSON.stringify({gameType:y.info.gameType,theme:y.info.theme,year:this.year,month:this.month,day:this.day,action:"fetch-all"}))}createXHR(){this._xhr=new XMLHttpRequest,d.add(this._xhr,"load",this.xhr_evt),d.add(this._xhr,"abort",this.xhr_evt),d.add(this._xhr,"error",this.xhr_evt),d.add(this._xhr,"timeout",this.xhr_evt),this._xhr.open("POST",this._endpoint,!0),this._xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"),this.isUpdating=!0,this._lastSyncTime=Date.now()}destroyXHR(){d.remove(this._xhr,"load",this.xhr_evt),d.remove(this._xhr,"abort",this.xhr_evt),d.remove(this._xhr,"error",this.xhr_evt),d.remove(this._xhr,"timeout",this.xhr_evt),this._xhr=null,this.isUpdating=!1}xhr_evt(e){var t=this._xhr;this.destroyXHR(),"load"===e.type&&200<=t.status&&t.status<400?this.syncComplete(this.parseResponse(t.responseText)):this.syncComplete(null)}parseResponse(e){let t=null;try{t=JSON.parse(e),t&&!0===t.success&&0<=[0,1,2].indexOf(t.state)&&t.table&&void 0!==t.table.averageScore&&void 0!==t.table.numPostedScores&&"object"==typeof t.table.entries&&void 0!==t.table.entries.length||(!1===t.success?l.warn("DC request was unsuccessful"):l.warn("Malformed DC response"),t=null)}catch(e){l.warn("Error handling DC response"),t=null}return t}store(){this._storable.year=this.year,this._storable.month=this.month,this._storable.day=this.day,this._storable.score=this.score,this._storable.state=this.state,this._storable.save()}updateSeed(){var t=new H(1e4*this.year+100*this.month+this.day),i=["247","4th-of-july","christmas","cinco-de-mayo","easter","fall","halloween","new-years","spring","st-patricks","summer","thanksgiving","valentines","winter"].indexOf(y.info.theme);for(let e=0;e<i;++e)t.next();this.seed=t.seed}calculateCurrentTimeSeed(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,e=e.getDate(),s=new H(1e4*t+100*i+e),n=["247","4th-of-july","christmas","cinco-de-mayo","easter","fall","halloween","new-years","spring","st-patricks","summer","thanksgiving","valentines","winter"].indexOf(y.info.theme);for(let e=0;e<n;++e)s.next();return s.seed}}:null;class lt extends Qe{constructor(e=100,t=100){super(),this.w=e,this.h=t;this._shadow=new Xe(0,0,e,t,"rgba(0,0,0,0.25)"),this._shadow.x=-4,this._shadow.y=4,this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._btn=new C,this.addChild(this._btn),this._base=new Xe(0,0,e,t,"#000000"),this._btn.addChild(this._base);var i=e-4,s=t-4,s=(this._topBevel=new Je([4,4,i,4,i-7,11,11,11,11,s-7,4,s],"#5C5C5C"),this._btn.addChild(this._topBevel),this._bottomBevel=new Je([i,4,i,s,4,s,11,s-7,i-7,s-7,i-7,11],"#333333"),this._btn.addChild(this._bottomBevel),e-10),i=s-10,s=t-10,s=(s-10)/2,n=10+s;this._topFace=new Xe(10,10,i,s,"#232323"),this._btn.addChild(this._topFace),this._bottomFace=new Xe(10,n,i,s,"#000000"),this._btn.addChild(this._bottomFace),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new h(0,0,e,t),this.clickSound=new f(w.sounds.click.data)}down(){super.down(),this._btn.y=1,this._btn.x=-1}up(){super.up(),this._btn.y=0,this._btn.x=0}over(){super.over(),this._btn.y=-1,this._btn.x=0}}class dt extends Qe{constructor(e=100,t=100){super(),this.w=e,this.h=t;var i=e-8,s=t-8;this.btn=new C,this._face=new T(0,0,i,s/2-2,14*.8,"#333333"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._side=new T(0,0,i,s/2,14*.8,"#666666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._base=new T(0,0,e,t,14,"#000000"),this._shadow=new T(0,0,e,t,14,"rgba(0,0,0,0.25)"),this._shadow.x=-4,this._shadow.y=4,this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this.btn.addChild(this._base),this.btn.addChild(this._side),this.btn.addChild(this._face),this.addChild(this.btn),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new h(0,0,e,t),this.clickSound=new f(w.sounds.click.data)}enabled(){super.enabled(),this._face.fillStyle="#333333",this._side.fillStyle="#666666",this._base.fillStyle="#000000"}disabled(){super.disabled(),this._face.fillStyle="#555555",this._side.fillStyle="#666666",this._base.fillStyle="#444444",this.btn.y=0,this.btn.x=0}down(){super.down(),this.btn.y=1,this.btn.x=-1}up(){super.up(),this.btn.y=0,this.btn.x=0}over(){super.over(),this.btn.y=-1,this.btn.x=0}}class A extends dt{constructor(e,t=340,i=100){super(t,i),this.asSelectableOption=!1,this.asSelectebleOptionSelected=!1,this.label=this._label=new S(e,w.fonts["OpenSans-ExtraBold"].data,46),this.label.fill="#FFFFFF",this.label.baseline="middle",this.label.align="center",this.label.x=t/2,this.label.y=i/2,this.label.shadowFill="#000000",this.label.shadowAlpha=1,this.label.shadowX=0,this.label.shadowY=-2,this.label.shadowOverStroke="#000000",this.label.shadowOverStrokeWidth=5,this.btn.addChild(this.label)}enabled(){super.enabled(),this.updateColors()}disabled(){super.disabled(),this.updateColors()}updateColors(){this.isDisabled?(this.label.fill="#AAAAAA",this.label.shadowFill="#444444",this.label.shadowOverStroke="#444444"):this.asSelectableOption?(this.asSelectebleOptionSelected?(this.label.fill="#FFFFFF",this.label.shadowFill="#000000",this.label.shadowOverStroke="#000000",this._face.fillStyle="#333333",this._side.fillStyle="#666666"):(this.label.fill="#444444",this.label.shadowFill="#000000",this.label.shadowOverStroke="#000000",this._face.fillStyle="#222222",this._side.fillStyle="#444444"),this._base.fillStyle="#000000"):(this.label.fill="#FFFFFF",this.label.shadowFill="#000000",this.label.shadowOverStroke="#000000")}setAsSelectableOption(e){this.asSelectableOption!==e&&(this.asSelectableOption=e,this.updateColors())}setAsSelectableOptionSelected(e){this.asSelectebleOptionSelected!==e&&(this.asSelectebleOptionSelected=e,this.updateColors())}}class ct extends A{constructor(e,t,i=340,s=100){super(t,i,s),this._spacing=16,this._btnWidth=i,this._icon=new Ye(e),this._icon.y=s/2,this._icon.regY=this._icon.height/2,this._label.align="left",this._lblWidth=this._label.measure().width,this.btn.addChild(this._icon);t=this._lblWidth+this._spacing+this._icon.width;this._icon.x=this._btnWidth/2-t/2,this._label.x=this._icon.x+this._icon.width+this._spacing}}class ut extends dt{constructor(e,t=100,i=100){super(t,i),this.icon=new Ye(e),this.icon.y=i/2,this.icon.x=t/2,this.icon.regY=this.icon.height/2,this.icon.regX=this.icon.width/2,this.btn.addChild(this.icon)}}class pt extends Qe{constructor(e){super(),this.isLeft=e;this._shadow=new Ye(w.images.arrow_right_shadow),this._shadow.x=-4,this._shadow.y=4,this.addChild(this._shadow),this._btn=new Ye(w.images.arrow_right),this.addChild(this._btn),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new h(0,0,this._btn.width,this._btn.height),this.regY=this._btn.height/2,this.isLeft?(this.input.hitArea.x=-this._btn.width,this._btn.scaleX=-1,this._shadow.scaleX=-1,this.clickSound=new f(w.sounds.swoop_backward.data)):this.clickSound=new f(w.sounds.swoop_forward.data)}down(){super.down(),this._btn.y=1,this._btn.x=-1}up(){super.up(),this._btn.y=0,this._btn.x=0}over(){super.over(),this._btn.y=-1,this._btn.x=0}}class mt extends Qe{constructor(e=340,t=90){super(),this.isOn=!1,this.activeLabelFill=new v(1,1,1,1),this.activeLabelStroke=new v(0,0,0,1),this.inactiveLabelFill=(new v).fromStyle("#7C7C7C"),this.inactiveLabelStroke=(new v).fromStyle("#4C4C4C"),this.knobTweenX=null,this.onLabelFillTween=null,this.onLabelStrokeTween=null,this.offLabelFillTween=null,this.offLabelStrokeTween=null,this.w=e,this.h=t;var i=e-8,s=t-8;this.rail=new C,this.addChild(this.rail),this._outline=new T(0,0,e,t,14,"#000000"),this.rail.addChild(this._outline),this._tray=new T(0,0,i,s,14*.8,"#5C5C5C"),this._tray.x=4,this._tray.y=4,this.rail.addChild(this._tray),this._knob=new dt(2.5*e/6,t),this._knob.x=0,this._knob.input.pointerEnabled=this._knob.input.pointerChildrenEnabled=!1,this.rail.addChild(this._knob),this._activeLabelHolder=new C,this.rail.addChild(this._activeLabelHolder),this._inactiveLabelHolder=new C,this.rail.addChild(this._inactiveLabelHolder),this._offLabel=new S("Off",w.fonts["OpenSans-ExtraBold"].data,46),this._offLabel.fill="#FFFFFF",this._offLabel.baseline="middle",this._offLabel.align="center",this._offLabel.x=2.5*e/6/2,this._offLabel.y=t/2,this._offLabel.shadowFill="#000000",this._offLabel.shadowAlpha=1,this._offLabel.shadowX=0,this._offLabel.shadowY=-2,this._offLabel.shadowOverStroke="#000000",this._offLabel.shadowOverStrokeWidth=5,this._activeLabelHolder.addChild(this._offLabel),this._onLabel=new S("On",w.fonts["OpenSans-ExtraBold"].data,46),this._onLabel.fill="#7C7C7C",this._onLabel.baseline="middle",this._onLabel.align="center",this._onLabel.x=e-2.5*e/6/2,this._onLabel.y=t/2,this._onLabel.shadowFill="#4C4C4C",this._onLabel.shadowAlpha=1,this._onLabel.shadowX=0,this._onLabel.shadowY=-2,this._onLabel.shadowOverStroke="#4C4C4C",this._onLabel.shadowOverStrokeWidth=5,this._inactiveLabelHolder.addChild(this._onLabel),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new h(0,0,e,t),this.clickSound=new f(w.sounds.click.data)}down(){super.down(),this._knob.down(),this._activeLabelHolder.y=1,this._activeLabelHolder.x=-1}up(){super.up(),this._knob.up(),this._activeLabelHolder.y=0,this._activeLabelHolder.x=0}over(){super.over(),this._knob.over(),this._activeLabelHolder.y=-1,this._activeLabelHolder.x=0}setToggleState(e,t=!0){t?this.isOn!==e&&(this.isOn=e,this._onLabel.parent.removeChild(this._onLabel),this._offLabel.parent.removeChild(this._offLabel),e?(this._activeLabelHolder.addChild(this._onLabel),this._inactiveLabelHolder.addChild(this._offLabel),this.knobTweenX=new o(this._knob.x,this.w-this._knob.w,100,0,a.Quadratic.easeOut),this.onLabelFillTween=new o((new v).fromStyle(this._onLabel.fill).r,this.activeLabelFill.r,100,0,a.Quadratic.easeIn),this.onLabelStrokeTween=new o((new v).fromStyle(this._onLabel.shadowFill).r,this.activeLabelStroke.r,100,0,a.Quadratic.easeIn),this.offLabelFillTween=new o((new v).fromStyle(this._offLabel.fill).r,this.inactiveLabelFill.r,100,0,a.Quadratic.easeOut),this.offLabelStrokeTween=new o((new v).fromStyle(this._offLabel.shadowFill).r,this.inactiveLabelStroke.r,100,0,a.Quadratic.easeOut)):(this._inactiveLabelHolder.addChild(this._onLabel),this._activeLabelHolder.addChild(this._offLabel),this.knobTweenX=new o(this._knob.x,0,100,0,a.Quadratic.easeOut),this.onLabelFillTween=new o((new v).fromStyle(this._onLabel.fill).r,this.inactiveLabelFill.r,100,0,a.Quadratic.easeOut),this.onLabelStrokeTween=new o((new v).fromStyle(this._onLabel.shadowFill).r,this.inactiveLabelStroke.r,100,0,a.Quadratic.easeOut),this.offLabelFillTween=new o((new v).fromStyle(this._offLabel.fill).r,this.activeLabelFill.r,100,0,a.Quadratic.easeIn),this.offLabelStrokeTween=new o((new v).fromStyle(this._offLabel.shadowFill).r,this.activeLabelStroke.r,100,0,a.Quadratic.easeIn))):(this.knobTweenX=null,this.onLabelFillTween=null,this.onLabelStrokeTween=null,this.offLabelFillTween=null,this.offLabelStrokeTween=null,this.isOn=e,this._onLabel.parent.removeChild(this._onLabel),this._offLabel.parent.removeChild(this._offLabel),e?(this._activeLabelHolder.addChild(this._onLabel),this._inactiveLabelHolder.addChild(this._offLabel),this._knob.x=this.w-this._knob.w,this._onLabel.fill=this.activeLabelFill.toStyleHexRGB(),this._onLabel.shadowOverStroke=this._onLabel.shadowFill=this.activeLabelStroke.toStyleHexRGB(),this._offLabel.fill=this.inactiveLabelFill.toStyleHexRGB(),this._offLabel.shadowOverStroke=this._offLabel.shadowFill=this.inactiveLabelStroke.toStyleHexRGB()):(this._inactiveLabelHolder.addChild(this._onLabel),this._activeLabelHolder.addChild(this._offLabel),this._knob.x=0,this._onLabel.fill=this.inactiveLabelFill.toStyleHexRGB(),this._onLabel.shadowOverStroke=this._onLabel.shadowFill=this.inactiveLabelStroke.toStyleHexRGB(),this._offLabel.fill=this.activeLabelFill.toStyleHexRGB(),this._offLabel.shadowOverStroke=this._offLabel.shadowFill=this.activeLabelStroke.toStyleHexRGB()))}update(e){var t;this.knobTweenX&&(this._knob.x=this.knobTweenX.update(e),this.knobTweenX.isFinished)&&(this.knobTweenX=null),this.onLabelFillTween&&(t=this.onLabelFillTween.update(e),this._onLabel.fill=new v(t,t,t,1).toStyleHexRGB(),this.onLabelFillTween.isFinished)&&(this.onLabelFillTween=null),this.onLabelStrokeTween&&(t=this.onLabelStrokeTween.update(e),this._onLabel.shadowFill=this._onLabel.shadowOverStroke=new v(t,t,t,1).toStyleHexRGB(),this.onLabelStrokeTween.isFinished)&&(this.onLabelStrokeTween=null),this.offLabelFillTween&&(t=this.offLabelFillTween.update(e),this._offLabel.fill=new v(t,t,t,1).toStyleHexRGB(),this.offLabelFillTween.isFinished)&&(this.offLabelFillTween=null),this.offLabelStrokeTween&&(t=this.offLabelStrokeTween.update(e),this._offLabel.shadowFill=this._offLabel.shadowOverStroke=new v(t,t,t,1).toStyleHexRGB(),this.offLabelStrokeTween.isFinished)&&(this.offLabelStrokeTween=null)}}class gt extends ct{constructor(){super(w.images.icon_play,"Play",340,90)}}class ft extends A{constructor(){super("Play",340,90)}}class _t extends A{constructor(){super("Pass & Play",340,90)}}class wt extends ct{constructor(){super(w.images.icon_more,"Games",340,90)}}A;A;A;class yt extends A{constructor(){super("Play Online",340,90)}}A;class vt extends A{constructor(){super("New Game",340,90)}}class bt extends A{constructor(){super("Resume",340,90)}}class kt extends A{constructor(e="Replay"){super(e,340,90)}}A;class xt extends A{constructor(){super("View Board",340,90)}}class St extends ut{constructor(){super(w.images.icon_home,90,90)}}class Ct extends ut{constructor(){super(w.images.icon_undo,90,90)}enabled(){super.enabled(),this.icon.setImage(w.images.icon_undo)}disabled(){super.disabled(),this.icon.setImage(w.images.icon_undo_disabled)}}class Tt extends ut{constructor(){super(w.images.icon_hint,90,90)}}class Ft extends ut{constructor(){super(w.images.icon_help,90,90)}}ut;class Pt extends Qe{constructor(){super();this.w=90,this.h=90;this._btn=new C,this._faceDark=new T(0,0,82.5,80,14*.8,"#CC0000"),this._faceDark.x=4,this._faceDark.y=6,this._face=new T(0,0,82,39,14*.8,"#FF0000"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._side=new T(0,0,82,41,14*.8,"#FF6666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._base=new T(0,0,90,90,14,"#000000"),this._shadow=new T(0,0,90,90,14,"rgba(0,0,0,0.25)"),this._shadow.x=-4,this._shadow.y=4,this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._btn.addChild(this._base),this._btn.addChild(this._side),this._btn.addChild(this._faceDark),this._btn.addChild(this._face),this.addChild(this._btn),this.input.pointerChildrenEnabled=!1,this.input.hitArea=new h(0,0,90,90),this.clickSound=new f(w.sounds.click.data),this._icon=new Ye(w.images.icon_x_red),this._icon.y=45,this._icon.x=45,this._icon.regY=this._icon.height/2,this._icon.regX=this._icon.width/2,this._btn.addChild(this._icon)}down(){super.down(),this._btn.y=1,this._btn.x=-1}up(){super.up(),this._btn.y=0,this._btn.x=0}over(){super.over(),this._btn.y=-1,this._btn.x=0}}class Bt extends ut{constructor(){super(w.images.icon_wrench,90,90)}}class At extends ut{constructor(){super(w.images.icon_pause,70,70)}}class Et extends ct{constructor(e="Daily Challenge",t=540){var i=0!==B.state;super(w.images[i?"icon_daily_challenge_complete":"icon_daily_challenge"],e,t,90),this._isDCCompleted=i}render(e,t,i){var s=0!==B.state;s!==this._isDCCompleted&&(this._isDCCompleted=s,this._icon.setImage(w.images[s?"icon_daily_challenge_complete":"icon_daily_challenge"]),this._icon.regX=this._icon.width/2,this._icon.regY=this._icon.height/2),super.render(e,t,i)}}class Mt extends A{constructor(){super("Play Now",340,90)}}class Lt extends A{constructor(){super("Not Today",340,90)}}class Ot extends A{constructor(){super("Done",340,90)}}A;A;class Rt{constructor(e){this._showing=!1,this._onY=E.topMargin,this._offY=0,this._yTween=null,this._alphaTween=null,this._button=e,this._button.input.pointerEnabled=!1,this._button.y=this._offY,this._button.alpha=0}show(e=!0){this._showing?e||(this._yTween=null,this._alphaTween=null,this._button.y=this._onY,this._button.alpha=1):(this._showing=!0,this._button.input.pointerEnabled=!0,e?(this._yTween=new o(this._button.y,this._onY,150,0,a.Quadratic.easeOut),this._alphaTween=new o(this._button.alpha,1,150,0,a.Quadratic.easeOut)):(this._yTween=null,this._alphaTween=null,this._button.y=this._onY,this._button.alpha=1))}hide(e=!0){this._showing?(this._showing=!1,this._button.input.pointerEnabled=!1,e?(this._yTween=new o(this._button.y,this._offY,150,0,a.Quadratic.easeOut),this._alphaTween=new o(this._button.alpha,0,150,0,a.Quadratic.easeOut)):(this._yTween=null,this._alphaTween=null,this._button.y=this._offY,this._button.alpha=0)):e||(this._yTween=null,this._alphaTween=null,this._button.y=this._offY,this._button.alpha=0)}update(e){this._yTween&&(this._button.y=this._yTween.update(e),this._yTween.isFinished)&&(this._yTween=null),this._alphaTween&&(this._button.alpha=this._alphaTween.update(e),this._alphaTween.isFinished)&&(this._alphaTween=null)}}class E extends C{constructor(){super(),Z.isMobileDevice&&"Apple iOS"!==Z.os&&"android-auto"!==window.games247.nativeAppType&&(E.sideMargin=40),this.homeButton=new St,this.addChild(this.homeButton),this.home=new Rt(this.homeButton),this.closeButton=new Pt,this.addChild(this.closeButton),this.close=new Rt(this.closeButton),this.settingsButton=new Bt,this.addChild(this.settingsButton),this.settings=new Rt(this.settingsButton),this.input=new x(this,!0,!0)}update(e){this.home.update(e),this.close.update(e),this.settings.update(e)}render(e,t,i){var s=E.sideMargin;this.homeButton.x=s,this.closeButton.x=s,this.settingsButton.x=F.width-s-this.settingsButton.w,super.render(e,t,i)}hideAll(e=!0){this.home.hide(e),this.close.hide(e),this.settings.hide(e)}}E.topMargin=16,E.sideMargin=16,E.height=E.topMargin+90;class Dt extends C{constructor(e=100,t=100,i){super(),this.value=i,this.w=e,this.h=t,this.regX=e/2,this.regY=t/2;var i=e+4,s=t+4,n=i,o=s,r=e-8;this._shadow=new T(-8,4,n,o,14*1.15,"rgba(0,0,0,0.25)"),this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._panel=new C,this.addChild(this._panel),this._outerStroke=new T(-2,-2,i,s,14*1.15,"#FFFFFF"),this._panel.addChild(this._outerStroke),this._base=new T(0,0,e,t,14,"#000000"),this._panel.addChild(this._base),this._side=new T(0,0,r,46,14*.8,"#666666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._panel.addChild(this._side),this._face=new T(0,0,r,44,14*.8,"#333333"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._panel.addChild(this._face),this._grad=new T(0,0,e,t-(this._face.y+this._face.rectangle.height),14,ze.panelBg),this._grad.topLeftRadius=0,this._grad.topRightRadius=0,this._grad.y=this._face.y+this._face.rectangle.height,this._panel.addChild(this._grad),this._panel.input=new x(this._panel,!0,!1,new h(0,0,e,t)),this.content=new C,this.addChild(this.content)}}class It extends Qe{constructor(e=100,t=100,i){super(),this.value=i,this.w=e,this.h=t,this.regX=e/2,this.regY=t/2;var i=e+4,s=t+4,n=i,o=s,r=e-8;this._shadow=new T(-8,4,n,o,14*1.15,"rgba(0,0,0,0.25)"),this._shadow.input.pointerEnabled=this._shadow.input.pointerChildrenEnabled=!1,this.addChild(this._shadow),this._panel=new C,this.addChild(this._panel),this._outerStroke=new T(-2,-2,i,s,14*1.15,"#FFFFFF"),this._panel.addChild(this._outerStroke),this._base=new T(0,0,e,t,14,"#000000"),this._panel.addChild(this._base),this._side=new T(0,0,r,46,14*.8,"#666666"),this._side.bottomLeftRadius=this._side.bottomRightRadius=0,this._side.x=4,this._side.y=4,this._panel.addChild(this._side),this._face=new T(0,0,r,44,14*.8,"#333333"),this._face.bottomLeftRadius=this._face.bottomRightRadius=0,this._face.x=4,this._face.y=6,this._panel.addChild(this._face),this._grad=new T(0,0,e,t-(this._face.y+this._face.rectangle.height),14,ze.panelBg),this._grad.topLeftRadius=0,this._grad.topRightRadius=0,this._grad.y=this._face.y+this._face.rectangle.height,this._panel.addChild(this._grad),this.input.pointerChildrenEnabled=!1,this.input.pointerEnabled=!0,this.input.hitArea=new h(0,0,e,t),this.clickSound=new f(w.sounds.click.data)}down(){super.down(),this._panel.y=1,this._panel.x=-1}up(){super.up(),this._panel.y=0,this._panel.x=0}over(){super.over(),this._panel.y=-1,this._panel.x=0}}class Gt extends It{constructor(e,t,i,s,n,o=814,r=478){super(o,r,n),this.stars=[],this.titleTextField=new S(e,w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.captionTextField=new S(t,w.fonts["OpenSans-ExtraBold"].data,48),this.captionTextField.fill="#FFFFFF",this.captionTextField.align="center",this.captionTextField.x=this.w/2,this.captionTextField.y=140,this._panel.addChild(this.captionTextField),this.recordLabelTextField=new S("Record: ",w.fonts["OpenSans-ExtraBold"].data,64),this.recordLabelTextField.fill="#CCCCCC",this.recordLabelTextField.align="left",this.recordLabelTextField.y=this.h-this.recordLabelTextField.fontSize-36,this._panel.addChild(this.recordLabelTextField),this.recordTextField=new S(i,w.fonts["OpenSans-ExtraBold"].data,this.recordLabelTextField.fontSize),this.recordTextField.fill="#FFFFFF",this.recordTextField.align="left",this.recordTextField.y=this.recordLabelTextField.y,this._panel.addChild(this.recordTextField);o=this.recordLabelTextField.measure().width,r=this.recordTextField.measure().width,n=this.recordLabelTextField.fontSize/5,e=o+n+r;this.recordLabelTextField.x=this.w/2-e/2,this.recordTextField.x=this.recordLabelTextField.x+o+n;let a=(this.captionTextField.y+1.5*this.captionTextField.fontSize+this.recordLabelTextField.y)/2;t||(a-=1.5*this.captionTextField.fontSize/2);for(let e=1;e<=3;++e){var h=new Ye(w.images["star_"+(s>=e?"fill":"empty")]);h.regX=h.width/2,h.regY=h.height/2,h.x=this.w/2+(h.width+20)*(e-2),h.y=a,this._panel.addChild(h),this.stars.push(h)}}}class Nt extends Dt{constructor(e,t,i=980,s=620){super(i,s),this.titleTextField=new S("Paused",w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.difficultyLabelTextField=new S("Level:",w.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="center",this.difficultyLabelTextField.x=this.w/2,this.difficultyLabelTextField.y=140,this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new S(e,w.fonts["OpenSans-ExtraBold"].data,82),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="center",this.difficultyTextField.x=this.w/2,this.difficultyTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.difficultyTextField),this.timeLabelTextField=new S("Time:",w.fonts["OpenSans-ExtraBold"].data,48),this.timeLabelTextField.fill="#CCCCCC",this.timeLabelTextField.align="center",this.timeLabelTextField.x=this.w/2,this.timeLabelTextField.y=this.difficultyTextField.y+this.difficultyTextField.fontSize+36,this._panel.addChild(this.timeLabelTextField),this.timeTextField=new S(t,w.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.timeLabelTextField.y+this.timeLabelTextField.fontSize,this._panel.addChild(this.timeTextField),this.resumeButton=new bt,this.resumeButton.x=this.w/2-this.resumeButton.w/2,this.resumeButton.y=this.h-this.resumeButton.h-32,this.content.addChild(this.resumeButton)}}class zt extends Dt{constructor(e,t,i=980,s=620){super(i,s),this.titleTextField=new S("Resume?",w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.difficultyLabelTextField=new S("Level:",w.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="center",this.difficultyLabelTextField.x=this.w/2,this.difficultyLabelTextField.y=140,this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new S(e,w.fonts["OpenSans-ExtraBold"].data,82),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="center",this.difficultyTextField.x=this.w/2,this.difficultyTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.difficultyTextField),this.timeLabelTextField=new S("Time:",w.fonts["OpenSans-ExtraBold"].data,48),this.timeLabelTextField.fill="#CCCCCC",this.timeLabelTextField.align="center",this.timeLabelTextField.x=this.w/2,this.timeLabelTextField.y=this.difficultyTextField.y+this.difficultyTextField.fontSize+36,this._panel.addChild(this.timeLabelTextField),this.timeTextField=new S(t,w.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.timeLabelTextField.y+this.timeLabelTextField.fontSize,this._panel.addChild(this.timeTextField);this.newGameButton=new vt,this.newGameButton.x=this.w/2-16-this.newGameButton.w,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.resumeButton=new bt,this.resumeButton.x=this.w/2+16,this.resumeButton.y=this.newGameButton.y,this.content.addChild(this.resumeButton)}}class Ht extends Dt{constructor(e=980,t=700){super(e,t),this.titleTextField=new S("Play Online",w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.anyoneLabelTextField=new S("Play a random online opponent",w.fonts["OpenSans-Bold"].data,48),this.anyoneLabelTextField.fill="#CCCCCC",this.anyoneLabelTextField.align="center",this.anyoneLabelTextField.x=this.w/2,this.anyoneLabelTextField.y=180,this._panel.addChild(this.anyoneLabelTextField),this.anyoneButton=new A("Play Anyone",440),this.anyoneButton.x=this.w/2-this.anyoneButton.w/2,this.anyoneButton.y=this.anyoneLabelTextField.y+this.anyoneLabelTextField.fontSize+50,this.content.addChild(this.anyoneButton),this.inviteLabelTextField=new S("or invite a friend to play online",w.fonts["OpenSans-Bold"].data,48),this.inviteLabelTextField.fill="#CCCCCC",this.inviteLabelTextField.align="center",this.inviteLabelTextField.x=this.w/2,this.inviteLabelTextField.y=this.anyoneButton.y+this.anyoneButton.h+64,this._panel.addChild(this.inviteLabelTextField),this.inviteButton=new A("Invite a Friend",440),this.inviteButton.x=this.w/2-this.inviteButton.w/2,this.inviteButton.y=this.inviteLabelTextField.y+this.inviteLabelTextField.fontSize+50,this.content.addChild(this.inviteButton)}}class Ut extends Dt{constructor(e,t,i,s,n,o="Replay",r=!0,a=1160,h=620,l=450){super(a,r?h:l),this.stars=[],this.titleTextField=new S(n,w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.difficultyLabelTextField=new S("Level:",w.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="left",this.difficultyLabelTextField.y=r?312:142,this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new S(e,w.fonts["OpenSans-ExtraBold"].data,48),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="left",this.difficultyTextField.y=this.difficultyLabelTextField.y,this._panel.addChild(this.difficultyTextField);a=this.difficultyLabelTextField.measure().width,h=a+this.difficultyTextField.measure().width+8,this.difficultyLabelTextField.x=this.w/2-h/2,this.difficultyTextField.x=this.difficultyLabelTextField.x+a+8,this.timeTextField=new S(t,w.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.timeTextField),this.newGameButton=new vt,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.replayButton=new kt(o),this.replayButton.y=this.newGameButton.y,this.content.addChild(this.replayButton),this.viewBoardButton=new xt,this.viewBoardButton.y=this.newGameButton.y,this.content.addChild(this.viewBoardButton),l=this.newGameButton.w+32+this.replayButton.w+32+this.viewBoardButton.w;this.viewBoardButton.x=this.w/2-l/2,this.newGameButton.x=this.viewBoardButton.x+this.viewBoardButton.w+32,this.replayButton.x=this.newGameButton.x+this.newGameButton.w+32;for(let e=1;e<=3;++e){var d=new Ye(w.images["star_"+(s>=e?"fill":"empty")]);d.scaleX=d.scaleY=1,d.regX=d.width/2,d.regY=d.height/2,d.x=this.w/2+(+d.width+20)*(e-2),d.y=220,this._panel.addChild(d),this.stars.push(d),r||(d.visible=!1)}this.leftRecordMedal=new Ye(w.images.icon_medal),this.addChild(this.leftRecordMedal),this.rightRecordMedal=new Ye(w.images.icon_medal),this.addChild(this.rightRecordMedal),this.leftRecordMedal.regX=this.leftRecordMedal.width,this.leftRecordMedal.regY=this.rightRecordMedal.regY=this.leftRecordMedal.height/2,this.repositionMedals(),i&&r||(this.leftRecordMedal.visible=this.rightRecordMedal.visible=!1)}repositionMedals(){var e=this.timeTextField.measure().width;this.leftRecordMedal.x=this.w/2-e/2-20,this.rightRecordMedal.x=this.w/2+e/2+20,this.leftRecordMedal.y=this.rightRecordMedal.y=this.timeTextField.y+60}}class $t extends Dt{constructor(e,t,i,s="Replay",n=1160,o=450,r){var a=void 0!==r,o=(a&&450===o&&(o+=68),super(n,o),this.titleTextField=new S(i,w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.captionTextField=new S(r||"",w.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=n/2,this.captionTextField.y=142,this._panel.addChild(this.captionTextField),a||(this.captionTextField.visible=!1),this.difficultyLabelTextField=new S("Level:",w.fonts["OpenSans-ExtraBold"].data,48),this.difficultyLabelTextField.fill="#CCCCCC",this.difficultyLabelTextField.align="left",this.difficultyLabelTextField.y=142+(a?68:0),this._panel.addChild(this.difficultyLabelTextField),this.difficultyTextField=new S(e,w.fonts["OpenSans-ExtraBold"].data,48),this.difficultyTextField.fill="#FFFFFF",this.difficultyTextField.align="left",this.difficultyTextField.y=this.difficultyLabelTextField.y,this._panel.addChild(this.difficultyTextField),this.difficultyLabelTextField.measure().width),i=o+this.difficultyTextField.measure().width+8,r=(this.difficultyLabelTextField.x=this.w/2-i/2,this.difficultyTextField.x=this.difficultyLabelTextField.x+o+8,this.timeTextField=new S(t,w.fonts["OpenSans-ExtraBold"].data,82),this.timeTextField.fill="#FFFFFF",this.timeTextField.align="center",this.timeTextField.x=this.w/2,this.timeTextField.y=this.difficultyLabelTextField.y+this.difficultyLabelTextField.fontSize,this._panel.addChild(this.timeTextField),this.newGameButton=new vt,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.replayButton=new kt(s),this.replayButton.y=this.newGameButton.y,this.content.addChild(this.replayButton),this.viewBoardButton=new xt,this.viewBoardButton.y=this.newGameButton.y,this.content.addChild(this.viewBoardButton),this.newGameButton.w+32+this.replayButton.w+32+this.viewBoardButton.w);this.viewBoardButton.x=this.w/2-r/2,this.newGameButton.x=this.viewBoardButton.x+this.viewBoardButton.w+32,this.replayButton.x=this.newGameButton.x+this.newGameButton.w+32}}Dt;class qt extends C{constructor(e){super(),this.isOn=!1,this.xTween=null,this.alphaTween=null,this.input=new x(this,!1,!1),this.holder=new C,this.addChild(this.holder),this.item=e,this.holder.addChild(e),this.visible=!1,this.alpha=0,this.holder.x=-qt.tweenDist}on(e){this.isOn||(this.isOn=!0,this.holder.x=e?-qt.tweenDist:qt.tweenDist,this.alpha=0,this.visible=!0,this.xTween=new o(this.holder.x,0,qt.tweenDur,qt.tweenDelay,a.Quadratic.easeOut),this.alphaTween=new o(this.alpha,1,qt.tweenDur,qt.tweenDelay))}off(e){this.isOn&&(this.isOn=!1,this.holder.x=0,this.alpha=1,this.input.pointerEnabled=this.input.pointerChildrenEnabled=!1,this.xTween=e?new o(this.holder.x,qt.tweenDist,qt.tweenDur,0,a.Quadratic.easeOut):new o(this.holder.x,-qt.tweenDist,qt.tweenDur,0,a.Quadratic.easeOut),this.alphaTween=new o(this.alpha,0,qt.tweenDur,0))}warpOff(){this.isOn=!1,this.input.pointerEnabled=this.input.pointerChildrenEnabled=!1,this.holder.x=-qt.tweenDist,this.alpha=0,this.visible=!1,this.xTween=null,this.alphaTween=null}warpOn(){this.isOn=!0,this.input.pointerEnabled=this.input.pointerChildrenEnabled=!0,this.holder.x=0,this.alpha=1,this.visible=!0,this.xTween=null,this.alphaTween=null}update(e){this.alphaTween?(this.alpha=this.alphaTween.update(e),this.alphaTween.isFinished&&(this.alphaTween=null,this.isOn)&&(this.input.pointerEnabled=this.input.pointerChildrenEnabled=!0)):this.isOn||(this.visible=!1),this.xTween&&(this.holder.x=this.xTween.update(e),this.xTween.isFinished)&&(this.xTween=null)}}qt.tweenDist=150,qt.tweenDur=100,qt.tweenDelay=100;class Wt extends C{constructor(e){super(),this.onIndexChange=new r,this.onItemClick=new r,this.entries=[],this.trayPos=0,this.currentIndex=0,this.yShift=0,this._startingIndex=e}addEntry(e){this.entries.push(e),this.addChild(e),e.item.input.onPointerClick.add(this.item_onClick,this)}initialize(){this.leftButton=new pt(!0),this.addChild(this.leftButton),this.rightButton=new pt(!1),this.addChild(this.rightButton),this.rightButton.input.onPointerClick.add(this.rightButton_onClick,this),this.leftButton.input.onPointerClick.add(this.leftButton_onClick,this),this.currentIndex=this._startingIndex,this.entries[this.currentIndex].warpOn(),this.updateArrowButtons()}updateArrowButtons(){0===this.currentIndex?this.leftButton.visible=!1:this.leftButton.visible=!0,this.currentIndex===this.entries.length-1?this.rightButton.visible=!1:this.rightButton.visible=!0}startTween(t){for(let e=0;e<this.entries.length;++e)t?e===this.currentIndex-1?this.entries[e].off(!1):e===this.currentIndex?this.entries[e].on(!1):this.entries[e].warpOff():e===this.currentIndex+1?this.entries[e].off(!0):e===this.currentIndex?this.entries[e].on(!0):this.entries[e].warpOff()}rightButton_onClick(){this.currentIndex++,this.onIndexChange.invoke(this,!0),this.updateArrowButtons(),this.startTween(!0)}leftButton_onClick(){this.currentIndex--,this.onIndexChange.invoke(this,!1),this.updateArrowButtons(),this.startTween(!1)}item_onClick(e){this.onItemClick.invoke(this,e)}anchor(){for(var e of this.entries)e.x=F.width/2,e.y=F.height/2+this.yShift;this.leftButton.x=F.width/2-this.entries[0].item.w/2-26,this.leftButton.y=F.height/2+this.yShift,this.rightButton.x=F.width/2+this.entries[0].item.w/2+26,this.rightButton.y=F.height/2+this.yShift}update(e){for(var t of this.entries)t.update(e)}}class jt extends C{constructor(e=100,t=360){super(),this.radius=e,this.degsPerSecond=t,this.base=new Ke(0,0,this.radius,"#CCCCCC"),this.base.alpha=.3,this.base.innerRadius=.8*this.radius,this.addChild(this.base),this.bar=new Ke(0,0,this.radius,"#CCCCCC"),this.bar.startAngle=0,this.bar.endAngle=90,this.bar.innerRadius=this.base.innerRadius,this.addChild(this.bar)}update(e){this.bar.rotation+=e/1e3*this.degsPerSecond}}class Vt extends Je{constructor(){super([-6,-10,6,0,-6,10]),this.closePath=!1,this.strokeStyle="#CCCCCC",this.strokeWidth=6,this.strokeLineCap="square"}}class Yt extends Qe{constructor(e){super(),this.w=80,this.h=60,this.icon=new Vt,this.addChild(this.icon),e&&(this.icon.scaleX=-1),this.input.hitArea=new h(-this.w/2,-this.h/2,this.w,this.h),this.clickSound=new f(w.sounds.click.data)}over(){this.icon.y=-1,this.icon.strokeStyle="#FFFFFF",super.over()}up(){this.icon.y=0,this.icon.strokeStyle="#CCCCCC",super.up()}down(){this.icon.y=1,this.icon.strokeStyle="#FFFFFF",super.down()}}class Xt extends Yt{constructor(e){super(e),this.icon2=new Vt,this.addChild(this.icon2),this.icon.x=-8,this.icon2.x=-this.icon.x,e&&(this.icon2.scaleX=-1)}over(){super.over(),this.icon2.y=this.icon.y,this.icon2.strokeStyle=this.icon.strokeStyle}up(){super.up(),this.icon2.y=this.icon.y,this.icon2.strokeStyle=this.icon.strokeStyle}down(){super.down(),this.icon2.y=this.icon.y,this.icon2.strokeStyle=this.icon.strokeStyle}}class Jt extends C{constructor(){super(),this.rankTextField=new S("0",w.fonts["RobotoMono-SemiBold"].data,48),this.rankTextField.align="left",this.rankTextField.baseline="top",this.rankTextField.fill="#FFFFFF",this.rankSuffixTextField=new S("th",w.fonts["RobotoMono-SemiBold"].data,24),this.rankSuffixTextField.align="left",this.rankSuffixTextField.baseline="top",this.rankSuffixTextField.y=6,this.rankSuffixTextField.fill="#FFFFFF",this.timeTextField=new S("00:00",w.fonts["RobotoMono-SemiBold"].data,48),this.timeTextField.align="right",this.timeTextField.baseline="top",this.timeTextField.fill="#FFFFFF",this.addChild(this.rankTextField),this.addChild(this.rankSuffixTextField),this.addChild(this.timeTextField),this.w=this.timeTextField.x=600,this.h=this.timeTextField.fontSize}setRankText(e){this.rankTextField.text=e+"",this.rankSuffixTextField.text=u.getPlaceSuffix(e),this.rankSuffixTextField.x=this.rankTextField.measure().width+2,this.rankSuffixTextField.visible=e<=100}clear(e){this.setRankText(e),this.timeTextField.text="-:--",this.rankSuffixTextField.fill=this.timeTextField.fill=this.rankTextField.fill="#CCCCCC"}set(e,t){this.setRankText(e),this.timeTextField.text=u.toTimerString(t),t===B.score?this.rankSuffixTextField.fill=this.timeTextField.fill=this.rankTextField.fill="#FECC07":this.rankSuffixTextField.fill=this.timeTextField.fill=this.rankTextField.fill="#FFFFFF"}}class Kt extends C{constructor(e){super(),this.rows=[],this.numPages=1,this.page=0,this.initEntries(),this.screen=e,this.rankHeaderTextField=new S("RANK",w.fonts["RobotoMono-SemiBold"].data,48),this.rankHeaderTextField.align="left",this.rankHeaderTextField.baseline="top",this.rankHeaderTextField.fill="#CCCCCC",this.addChild(this.rankHeaderTextField),this.timeHeaderTextField=new S("TIME",w.fonts["RobotoMono-SemiBold"].data,48),this.timeHeaderTextField.align="right",this.timeHeaderTextField.baseline="top",this.timeHeaderTextField.fill="#CCCCCC",this.addChild(this.timeHeaderTextField),this.pageTextField=new S("1000 / 1000",w.fonts["RobotoMono-SemiBold"].data,36),this.pageTextField.align="center",this.pageTextField.baseline="middle",this.pageTextField.fill="#CCCCCC",this.addChild(this.pageTextField);for(let e=0;e<10;++e){var t=this.createRow();t.y=66+e*(t.h+16),this.addChild(t),this.rows.push(t)}this.w=this.rows[0].w,this.dividerBottom=new Je([0,0,this.w,0]),this.dividerBottom.strokeStyle="#666666",this.dividerBottom.strokeWidth=2,this.addChild(this.dividerBottom),this.dividerBottom.y=66+this.rows.length*this.rows[0].h+16*(this.rows.length-1)+24,this.pageTextField.x=this.w/2,this.pageTextField.y=this.dividerBottom.y+20+this.pageTextField.fontSize/2,this.h=this.pageTextField.y+this.pageTextField.fontSize,this.dividerTop=new Je([0,this.rankHeaderTextField.fontSize+12,this.w,this.rankHeaderTextField.fontSize+12]),this.dividerTop.strokeStyle="#666666",this.dividerTop.strokeWidth=2,this.addChild(this.dividerTop),this.timeHeaderTextField.x=this.rows[0].w,this.nextPageButton=new Yt(!1),this.nextPageButton.y=this.pageTextField.y,this.nextPageButton.x=this.w/2+150,this.addChild(this.nextPageButton),this.prevPageButton=new Yt(!0),this.prevPageButton.y=this.pageTextField.y,this.prevPageButton.x=this.w/2-150,this.addChild(this.prevPageButton),this.firstPageButton=new Xt(!0),this.firstPageButton.y=this.pageTextField.y,this.firstPageButton.x=this.prevPageButton.x-this.prevPageButton.w,this.addChild(this.firstPageButton),this.lastPageButton=new Xt(!1),this.lastPageButton.y=this.pageTextField.y,this.lastPageButton.x=this.nextPageButton.x+this.nextPageButton.w,this.addChild(this.lastPageButton),this.nextPageButton.input.onPointerClick.add(this.pageButton_onClick,this),this.prevPageButton.input.onPointerClick.add(this.pageButton_onClick,this),this.firstPageButton.input.onPointerClick.add(this.pageButton_onClick,this),this.lastPageButton.input.onPointerClick.add(this.pageButton_onClick,this)}initEntries(){this.entries=B.table.entries}createRow(){return new Jt}populate(e){this.initEntries();e=Math.floor((e-1)/this.rows.length);this.numPages=Math.max(1,Math.ceil(this.entries.length/this.rows.length)),this.setPage(e)}setPage(t){for(let e=0;e<this.rows.length;++e){var i=t*this.rows.length+e,s=t*this.rows.length+e+1;i>=this.entries.length?this.rows[e].clear(s):(i=this.entries[i],this.rows[e].set(s,i))}this.pageTextField.text=t+1+" / "+this.numPages,this.page=t}pageButton_onClick(e){e===this.nextPageButton?(this.screen.track("Next Page Button Pressed"),this.page<this.numPages-1&&this.setPage(this.page+1)):e===this.lastPageButton?(this.screen.track("Last Page Button Pressed"),this.setPage(this.numPages-1)):e===this.prevPageButton?(this.screen.track("Previous Page Button Pressed"),0<this.page&&this.setPage(this.page-1)):e===this.firstPageButton&&(this.screen.track("First Page Button Pressed"),this.setPage(0))}}class Qt extends Dt{constructor(e,t="Daily Challenge"){super(1164,1164),this.screen=e,this.titleTextField=new S(t,w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.spinner=new jt,this.spinner.x=this.w/2,this.spinner.y=this.h/2,this._panel.addChild(this.spinner),this.captionTextField=new S("Loading...",w.fonts["OpenSans-ExtraBold"].data,56),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=this.w/2,this.captionTextField.y=150,this._panel.addChild(this.captionTextField),this.scoreboard=this.createScoreboard(),this.content.addChild(this.scoreboard),this.scoreboard.visible=!1;this.notTodayButton=new Lt,this.notTodayButton.x=this.w/2-16-this.notTodayButton.w,this.notTodayButton.y=this.h-this.notTodayButton.h-32,this.content.addChild(this.notTodayButton),this.playNowButton=new Mt,this.playNowButton.x=this.w/2+16,this.playNowButton.y=this.notTodayButton.y,this.content.addChild(this.playNowButton),this.doneButton=new Ot,this.doneButton.x=this.w/2-this.doneButton.w/2,this.doneButton.y=this.notTodayButton.y,this.content.addChild(this.doneButton),this.doneButton.visible=!1,this.notTodayButton.visible=this.playNowButton.visible=!1,this.scoreboard.x=this.w/2-this.scoreboard.w/2,this.scoreboard.y=236}createScoreboard(){return new Kt(this.screen)}populate(){var e=0!==B.state,t=null!==B.score;let i="What's Your Score?",s="#FECC07";this.scoreboard.visible=!0;let n=1;s=e?(this.doneButton.visible=!0,this.notTodayButton.visible=this.playNowButton.visible=!1,t&&0<=B.table.entries.indexOf(B.score)?(n=B.table.entries.indexOf(B.score)+1,i="You ranked "+u.toPlaceString(n)+"!","#FECC07"):(i="You did not rank today.","#CCCCCC")):(this.doneButton.visible=!1,this.notTodayButton.visible=this.playNowButton.visible=!0,i="What's Your Score?","#FECC07"),this.spinner.visible=!1,this.captionTextField.fill=s,this.captionTextField.text=i,this.captionTextField.fontSize=48,this.scoreboard.populate(n)}update(e){this.spinner.update(e)}}class Zt extends Dt{constructor(e,t,i){super(1164,1164),this.screen=i,this.isWin=e,this.time=t,this.titleTextField=new S("Daily Challenge",w.fonts["OpenSans-ExtraBold"].data,110),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=20,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=this.w/2,this.titleTextField.y=-6,this._panel.addChild(this.titleTextField),this.spinner=new jt,this.spinner.x=this.w/2,this.spinner.y=this.h/2,this._panel.addChild(this.spinner),this.captionTextField=new S("Loading...",w.fonts["OpenSans-ExtraBold"].data,56),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=this.w/2,this.captionTextField.y=150,this._panel.addChild(this.captionTextField),this.scoreboard=new Kt(this.screen),this.content.addChild(this.scoreboard),this.scoreboard.visible=!1;this.newGameButton=new Ot,this.newGameButton.y=this.h-this.newGameButton.h-32,this.content.addChild(this.newGameButton),this.viewBoardButton=new xt,this.viewBoardButton.y=this.newGameButton.y,this.content.addChild(this.viewBoardButton);i=this.newGameButton.w+32+this.viewBoardButton.w;this.viewBoardButton.x=this.w/2-i/2,this.newGameButton.x=this.viewBoardButton.x+this.viewBoardButton.w+32,this.newGameButton.visible=this.viewBoardButton.visible=!0,this.scoreboard.x=this.w/2-this.scoreboard.w/2,this.scoreboard.y=236}populate(){var e=0!==B.state,t=null!==B.score;let i="What's Your Score?",s="#FECC07";this.scoreboard.visible=!0;let n=1;s=e&&t&&0<=B.table.entries.indexOf(B.score)?(n=B.table.entries.indexOf(B.score)+1,i="You ranked "+u.toPlaceString(n)+"!","#FECC07"):(i="You did not rank today.","#CCCCCC"),this.spinner.visible=!1,this.captionTextField.fill=s,this.captionTextField.text=i,this.captionTextField.fontSize=48,this.scoreboard.populate(n)}update(e){this.spinner.update(e)}}class ei extends C{constructor(e){super(),this.isDead=!1,this.xTween=new o(0,200,500,0,a.Quadratic.easeOut),this.alphaTween=new o(0,1,250,0,a.none),this.timeRem=1200,this.textField=new S(e,w.fonts["OpenSans-ExtraBold"].data,50),this.textField.fill="#FFFFFF",this.textField.underStroke="#FF0000",this.textField.underStrokeWidth=10,this.textField.align="left",this.textField.baseline="alphabetic",this.textField.x=this.xTween.start,this.textField.y=0,this.textField.alpha=this.alphaTween.start,this.addChild(this.textField),this.input=new x(this,!1,!1)}update(e){this.textField.x=this.xTween.update(e),this.textField.alpha=this.alphaTween.update(e),this.timeRem-=e,this.timeRem<=0&&(this.isDead=!0)}}class ti extends C{constructor(e,t,i=null){super(),this.penalties=[],this.isNotPausable=t,this.pauseButton=new At,this.pauseButton.x=E.sideMargin,this.pauseButton.y=-(E.topMargin+this.pauseButton.h),this.clockIcon=new Ye(w.images.icon_clock),this.addChild(this.clockIcon),this.clockIcon.x=E.sideMargin,this.clockIcon.y=-(E.topMargin+this.clockIcon.height),this.timeTextField=new S("00:00",w.fonts["OpenSans-ExtraBold"].data,50),this.timeTextField.align="left",this.timeTextField.baseline="alphabetic",this.timeTextField.x=this.pauseButton.x+this.pauseButton.w+16,this.timeTextField.y=70-(E.topMargin+70)-8,this.timeTextField.shadowX=-4,this.timeTextField.shadowY=4,this.timeTextField.shadowFill="#000000",this.timeTextField.shadowAlpha=.25,this.timeTextField.fill="#FFFFFF",this.timeTextField.input=new x(this.timeTextField,!1,!1),this.addChild(this.timeTextField),this.addChild(this.pauseButton),this.height=E.topMargin+70,this.isNotPausable?(this.pauseButton.visible=!1,this.timeTextField.x=this.clockIcon.x+this.clockIcon.width+16):this.clockIcon.visible=!1,this.setTime(e),this.input=new x(this,!1,!0),this.stopwatch=i,this.stopwatch&&(this.stopwatch.onTimeChange.add(this.stopwatch_onTimeChange,this),this.stopwatch.onRunningStateChange.add(this.stopwatch_onRunningStateChange,this),this.stopwatch_onRunningStateChange())}dispose(){this.stopwatch&&(this.stopwatch.onTimeChange.contains(this.stopwatch_onTimeChange,this)&&this.stopwatch.onTimeChange.remove(this.stopwatch_onTimeChange,this),this.stopwatch.onRunningStateChange.contains(this.stopwatch_onRunningStateChange,this))&&this.stopwatch.onRunningStateChange.remove(this.stopwatch_onRunningStateChange,this)}stopwatch_onRunningStateChange(){}stopwatch_onTimeChange(){this.setTime(this.stopwatch.time)}setTime(e){this.timeTextField.text=u.toTimerString(e,0)}penalty(e){e=new ei(e);e.y=this.timeTextField.y,e.x=this.timeTextField.x,this.penalties.push(e),this.addChild(e)}update(t){for(let e=0;e<this.penalties.length;++e)this.penalties[e].update(t),this.penalties[e].isDead&&(this.removeChild(this.penalties[e]),this.penalties.splice(e,1),e--)}}class ii extends C{constructor(e,t,i,s,n="Daily Challenge"){super(),this.isPractice=!1,this.isDailyChallenge=t,this.isOnline=i||!1,this.isTwoPlayer=s||!1,this._dailyChallengeText=n,this.starIcon=new Ye(w.images.icon_star),this.addChild(this.starIcon),this.starIcon.x=-(E.sideMargin+this.starIcon.width),this.starIcon.y=-(E.topMargin+this.starIcon.height),this.timeTextField=new S("00:00",w.fonts["OpenSans-ExtraBold"].data,50),this.timeTextField.align="right",this.timeTextField.baseline="alphabetic",this.timeTextField.x=this.starIcon.x-16,this.timeTextField.y=70-(E.topMargin+70)-8,this.timeTextField.shadowX=-4,this.timeTextField.shadowY=4,this.timeTextField.shadowFill="#000000",this.timeTextField.shadowAlpha=.25,this.timeTextField.fill="#FFFFFF",this.timeTextField.input=new x(this.timeTextField,!1,!1),this.addChild(this.timeTextField),this.height=E.topMargin+70,this.setTime(e),this.input=new x(this,!1,!0)}setTime(e){this.isDailyChallenge?this.timeTextField.text=this._dailyChallengeText:this.isOnline?this.timeTextField.text="Online Game":this.isTwoPlayer?this.timeTextField.text="2 Player":this.isPractice?this.timeTextField.text="Practice":this.timeTextField.text=null===e?"--:--":u.toTimerString(e,0)}}class si extends ot{track(e,t,i){bi.track(this.name,e,t,i)}constructor(e,t){super(e),this.buttons=[],this._dimmerTweenIn=null,this._drawerTweenIn=null,this._dimmerTweenOut=null,this._drawerTweenOut=null,this.title=t,this.isPopup=!0}initialize(){this.dimmer=new Ze(new v(1,1,1,.7)),this.display.addChild(this.dimmer),this.drawerHolder=new C,this.display.addChild(this.drawerHolder),this.drawer=new C,this.drawerHolder.addChild(this.drawer),this.drawerShadow=new Xe(0,0,300,F.height,"#000000"),this.drawerShadow.alpha=.2,this.drawerShadow.x=-3,this.drawer.addChild(this.drawerShadow),this.drawerBackground=new Xe(0,0,300,F.height,"#333333"),this.drawer.addChild(this.drawerBackground),this.track("Opened");var e;this.titleText=new S(this.title,w.fonts["OpenSans-ExtraBold"].data,24),this.titleText.fill="#FFFFFF",this.titleText.align="left",this.titleText.baseline="middle",this.drawer.addChild(this.titleText),this.titleText.x=12,this.titleText.y=30,this.titleText.shadowFill="#000000",this.titleText.shadowAlpha=.2,this.titleText.shadowX=-2,this.titleText.shadowY=2,this.closeButton=new tt(!1,60),this.closeButton.x=300-this.closeButton.width,this.drawer.addChild(this.closeButton);let t=60;this.drawer.addChild(new et(t));for(e of this.buttons)e.y=t,this.drawer.addChild(e),t+=e.height;this._dimmerTweenIn=new o(0,this.dimmer.alpha,250,0),this.dimmer.alpha=this._dimmerTweenIn.start,this._drawerTweenIn=new o(0,-300,300,0,a.Quadratic.easeOut),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.closeButton.input.onPointerClick.add(this.closeButton_onClick,this),super.initialize()}close(){this._dimmerTweenIn=null,this._dimmerTweenOut=new o(this.dimmer.alpha,0,300),this._drawerTweenIn=null,this._drawerTweenOut=new o(this.drawer.x,0,250,0,a.Quadratic.easeIn),this.inputEnabled=!1}removed(){this.track("Closed"),super.removed()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}closeButton_onClick(){this.track("Close Button Pressed"),this.close()}anchor(){this.drawerHolder.x=F.screen.right;var e=F.screen.width,t=F.height,e=e/320,t=t/426,e=Math.min(e,t);this.drawerHolder.scaleX=this.drawerHolder.scaleY=e,this.drawerShadow.rectangle.y=this.drawerBackground.rectangle.y=F.screen.top/e,this.drawerShadow.rectangle.height=this.drawerBackground.rectangle.height=F.screen.height/e+1,super.anchor()}gainFocus(){P._instance.navBar.hideAll(),super.gainFocus()}update(e){if(this.anchor(),this.isFocused){for(var t of this.buttons)t.update(e);this._dimmerTweenIn&&(this.dimmer.alpha=this._dimmerTweenIn.update(e),this._dimmerTweenIn.isFinished)&&(this._dimmerTweenIn=null),this._dimmerTweenOut&&(this.dimmer.alpha=this._dimmerTweenOut.update(e),this._dimmerTweenOut.isFinished)&&(this._dimmerTweenOut=null,this.exit()),this._drawerTweenIn&&(this.drawer.x=this._drawerTweenIn.update(e),this._drawerTweenIn.isFinished)&&(this._drawerTweenIn=null),this._drawerTweenOut&&(this.drawer.x=this._drawerTweenOut.update(e),this._drawerTweenOut.isFinished)&&(this._drawerTweenOut=null)}}}class ni extends ot{constructor(e,t=!0){super(e),this.onClosing=new r,this.openCloseAlphaTween=null,this.closeTweening=!1,this.nextScreen=null,this.childScreens=[],this._animateOn=t}initialize(){this._animateOn&&(this.display.alpha=0,this.openCloseAlphaTween=new o(0,1,150,0)),this.track("Opened"),super.initialize()}exit(){for(;0<this.childScreens.length;)this.childScreens.pop().exit();super.exit()}removed(){this.track("Closed"),super.removed()}close(){this.openCloseAlphaTween=new o(this.display.alpha,0,Math.max(1,150*+this.display.alpha),0),this.closeTweening=!0,this.inputEnabled=!1,this.onClosing.invoke(this)}track(e,t,i){bi.track(this.name,e,t,i)}settingsClicked(){this.track("Settings Button Pressed"),this.screenManager.add(new P._instance._settingsScreenClass)}homeClicked(){this.track("Home Button Pressed"),this.close()}closeClicked(){this.track("Close Button Pressed"),this.close()}update(e){this.openCloseAlphaTween&&(this.display.alpha=this.openCloseAlphaTween.update(e),this.openCloseAlphaTween.isFinished)&&(this.openCloseAlphaTween=null,this.closeTweening)&&(this.nextScreen&&this.screenManager.add(this.nextScreen),this.nextScreen=null,this.exit()),super.update(e)}}class oi extends ni{constructor(e,t){super(t),this.title=e,this.content=new C,this.display.addChild(this.content),this.titleTextField=new S(this.title,w.fonts["OpenSans-ExtraBold"].data,80),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=16,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.content.addChild(this.titleTextField)}initialize(){super.initialize()}gainFocus(){P._instance.navBar.home.show(),P._instance.navBar.settings.show(),super.gainFocus()}anchor(){F.width,F.height;super.anchor()}}class ri extends ni{constructor(e=!0,t="Daily Challenge Screen"){super(t),this.toDailyChallenge=!1,this.isPopup=!0,this.autoHideHome=e}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.panel=this.createPanel(),this.display.addChild(this.panel),this.panel.notTodayButton.input.onPointerClick.add(this.notTodayButton_onClick,this),this.panel.playNowButton.input.onPointerClick.add(this.playNowButton_onClick,this),this.panel.doneButton.input.onPointerClick.add(this.doneButton_onClick,this),B.onUpdated.add(this.DailyChallenge_onUpdated,this),B.sync(),super.initialize()}createPanel(){return new Qt(this)}gainFocus(e=!0){e&&P._instance.navBar.home.show(),P._instance.navBar.settings.show(),super.gainFocus()}removed(){B.onUpdated.contains(this.DailyChallenge_onUpdated,this)&&B.onUpdated.remove(this.DailyChallenge_onUpdated,this),super.removed()}close(){!this.toDailyChallenge&&this.autoHideHome&&P._instance.navBar.home.hide(),super.close()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}notTodayButton_onClick(){this.track("Not Today Button Pressed"),this.close()}playNowButton_onClick(){this.track("Play Now Button Pressed"),this.toDailyChallenge=!0,B.start(),this.close()}doneButton_onClick(){this.track("Done Button Pressed"),this.close()}DailyChallenge_onUpdated(){B.onUpdated.remove(this.DailyChallenge_onUpdated,this),this.panel.populate()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}update(e){this.panel.update(e),super.update(e)}}class ai extends si{constructor(e="Settings Screen",t="Settings"){super(e,t)}}class hi extends ni{constructor(e,t){void 0===t?(ye.warn("StandardTitleScreen(animateOn:boolean, name?:string)","StandardTitleScreen(animateOn:boolean, opts:StandardTitleScreenInitOpts)"),super("Title Screen",e),this._initOpts={name:"Title Screen",layout:1}):"string"==typeof t?(ye.warn("StandardTitleScreen(animateOn:boolean, name?:string)","StandardTitleScreen(animateOn:boolean, opts:StandardTitleScreenInitOpts)"),super(t,e),this._initOpts={name:t,layout:1}):(t=t,"string"!=typeof t.name&&(t.name="Title Screen"),super(t.name,e),this._initOpts=t,1===this._initOpts.layout&&ye.warn("StandardTitleScreenLayoutVersion.V1","StandardTitleScreenLayoutVersion.V2 or greater")),this.content=this.titleBitmap=this.playButton=this.moreGamesButton=this.dailyChallengeButton=this._resumeGameScreen=this._resumeOpenForNumPlayers=this._playOnlineGameScreen=this._dailyChallengeScreen=null}initialize(){if(this.content=new C,this.display.addChild(this.content),1===this._initOpts.layout)this.titleBitmap=new Ye(w.images["@theme/intro"]),this.titleBitmap.regX=this.titleBitmap.width/2,this.content.addChild(this.titleBitmap),this.playButton=this.createPlayButton(),this.content.addChild(this.playButton),this.playButton.input.onPointerClick.add(this.playButton_onClick,this),this.moreGamesButton=new wt,this.moreGamesButton.clickSound=null,this.content.addChild(this.moreGamesButton),this.moreGamesButton.input.onPointerClick.add(this.moreGamesButton_onClick,this),P._instance.usesDailyChallenge&&(this.dailyChallengeButton=this.createDailyChallengeButton(),this.content.addChild(this.dailyChallengeButton),this.dailyChallengeButton.input.onPointerClick.add(this.dailyChallengeButton_onClick,this),B.sync());else{if(2!==this._initOpts.layout)throw new Error("Unknown layout version");this.titleBitmap=new Ye(w.images["@theme/intro"]),this.titleBitmap.regX=this.titleBitmap.width/2,this.content.addChild(this.titleBitmap),this.playButton=this.createPlayButton(),this.content.addChild(this.playButton),this.playButton.input.onPointerClick.add(this.playButton_onClick,this),this.playButton.regX=this.playButton.w/2,this.onlinePlayButton=this.createPlayOnlineButton(),this.content.addChild(this.onlinePlayButton),this.onlinePlayButton.input.onPointerClick.add(this.onlinePlayButton_onClick,this),this.onlinePlayButton.regX=this.onlinePlayButton.w/2,this.passAndPlayButton=this.createPassAndPlayButton(),this.content.addChild(this.passAndPlayButton),this.passAndPlayButton.input.onPointerClick.add(this.passAndPlayButton_onClick,this),this.passAndPlayButton.regX=this.passAndPlayButton.w/2,P._instance.usesDailyChallenge&&B.sync()}this._animateOn||(P._instance.navBar.home.hide(!1),P._instance.navBar.settings.show(!1)),super.initialize()}createPlayButton(){return new(1===this._initOpts.layout?gt:ft)}createPassAndPlayButton(){return new _t}createPlayOnlineButton(){return new yt}createDailyChallengeButton(){return new Et}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.show(),super.gainFocus()}exit(){this._resumeGameScreen&&(this._resumeGameScreen.exit(),this._resumeGameScreen=null),this._playOnlineGameScreen&&(this._playOnlineGameScreen.exit(),this._playOnlineGameScreen=null),this._dailyChallengeScreen&&(this._dailyChallengeScreen.exit(),this._dailyChallengeScreen=null),super.exit()}createDailyChallenge(){return new ri}homeClicked(){}playButton_onClick(){this.track("Play Button Pressed"),1===this._initOpts.layout&&P._instance.usesMultiplayerGameModes?(this.nextScreen=this.createMultiplayerGameMode(),this.close()):this.hasInProgressGame(1)?(this._resumeOpenForNumPlayers=1,this._resumeGameScreen=this.createResumeGame(1),this._resumeGameScreen.onClosing.add(this.resumeGameScreen_onClosing,this),this.screenManager.add(this._resumeGameScreen)):(this.nextScreen=this.createLevelSelect(),this.close())}onlinePlayButton_onClick(){this.track("Play Online Button Pressed"),this._playOnlineGameScreen=this.createPlayOnline(),this._playOnlineGameScreen.onClosing.add(this.playOnlineGameScreen_onClosing,this),this.screenManager.add(this._playOnlineGameScreen)}passAndPlayButton_onClick(){this.track("Pass & Play Button Pressed"),this.hasInProgressGame(2)?(this._resumeOpenForNumPlayers=2,this._resumeGameScreen=this.createResumeGame(2),this._resumeGameScreen.onClosing.add(this.resumeGameScreen_onClosing,this),this.screenManager.add(this._resumeGameScreen)):(this.nextScreen=this.createPassAndPlayGame(),this.nextScreen&&this.close())}moreGamesButton_onClick(){this.track("More Games Button Pressed"),u.openLink(!1,y.config.moreGamesURL)}dailyChallengeButton_onClick(){this.track("Daily Challenge Button Pressed"),this._dailyChallengeScreen=this.createDailyChallenge(),this._dailyChallengeScreen.onClosing.add(this.dailyChallengeScreen_onClosing,this),this.screenManager.add(this._dailyChallengeScreen)}resumeGameScreen_onClosing(){this._resumeGameScreen.onClosing.remove(this.resumeGameScreen_onClosing,this),this._resumeGameScreen.toNewGame?(1===this._resumeOpenForNumPlayers?this.nextScreen=this.createLevelSelect():this.nextScreen=this.createPassAndPlayGame(),this.nextScreen&&this.close()):this._resumeGameScreen.toResumeGame?(this.nextScreen=this.createResumedGameplay(this._resumeOpenForNumPlayers),this.nextScreen&&this.close()):this._resumeGameScreen=null}playOnlineGameScreen_onClosing(){this._playOnlineGameScreen.onClosing.remove(this.playOnlineGameScreen_onClosing,this),this._playOnlineGameScreen.toPlayAnyone?(this.nextScreen=this.createPlayOnlineAnyone(),this.nextScreen&&this.close()):this._playOnlineGameScreen.toInviteFriend?(this.nextScreen=this.createPlayOnlineInviteFriend(),this.nextScreen&&this.close()):this._playOnlineGameScreen=null}dailyChallengeScreen_onClosing(){this._dailyChallengeScreen.onClosing.remove(this.dailyChallengeScreen_onClosing,this),this._dailyChallengeScreen.toDailyChallenge?(this.nextScreen=this.createDailyChallengeGameplay(),this.nextScreen&&this.close()):this._dailyChallengeScreen=null}anchor(){if(1===this._initOpts.layout){var t=F.width,i=F.height,t=(this.playButton.x=t/2-this.playButton.w-16,this.moreGamesButton.x=t/2+16,this.titleBitmap.x=t/2,this.dailyChallengeButton&&(this.dailyChallengeButton.x=F.width/2-this.dailyChallengeButton.w/2),t-40),t=Math.min(1,t/this.titleBitmap.width),t=(this.titleBitmap.scaleX=this.titleBitmap.scaleY=t,this.titleBitmap.height*t),t=50+t+this.playButton.h;this.titleBitmap.y=i/2-t/2,this.playButton.y=this.moreGamesButton.y=i/2+t/2-this.playButton.h,this.dailyChallengeButton&&(this.dailyChallengeButton.y=this.playButton.y+this.playButton.h+32)}else{i=this.passAndPlayButton.h+32+this.onlinePlayButton.h+32+this.passAndPlayButton.h,t=new h(20,0,F.width-20-20,Math.min(+F.height-50-i-50,.58*F.height)),t=(this.titleBitmap.scaleX=this.titleBitmap.scaleY=Math.min(1,Math.min(t.width/this.titleBitmap.width,t.height/this.titleBitmap.height)),this.playButton.x=this.onlinePlayButton.x=this.passAndPlayButton.x=this.titleBitmap.x=t.x+t.width/2,this.titleBitmap.scaleY*this.titleBitmap.height+50+i);let e=(F.height-t)/2;25<e&&(e-=25),this.titleBitmap.y=e,this.playButton.y=this.titleBitmap.y+this.titleBitmap.scaleY*this.titleBitmap.height+50,this.onlinePlayButton.y=this.playButton.y+this.playButton.h+32,this.passAndPlayButton.y=this.onlinePlayButton.y+this.onlinePlayButton.h+32}super.anchor()}}class li extends ni{constructor(e,t,i,s="Resume Game Screen"){super(s),this.toNewGame=!1,this.toResumeGame=!1,this._panelWidth=void 0,this._panelHeight=void 0,this.isPopup=!0,this.difficultyName=e,this.time=t,this._autoHideHome=i}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.panel=new zt(this.difficultyName,u.toTimerString(this.time,0),this._panelWidth,this._panelHeight),this.display.addChild(this.panel),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),this.panel.resumeButton.input.onPointerClick.add(this.resumeButton_onClick,this),super.initialize()}gainFocus(){P._instance.navBar.home.show(),P._instance.navBar.settings.show(),super.gainFocus()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}newGameButton_onClick(){this.track("New Game Button Pressed"),this.toNewGame=!0,this.close()}resumeButton_onClick(){this.track("Resume Button Pressed"),this.toResumeGame=!0,this.close()}close(){this.toNewGame||this.toResumeGame||this._autoHideHome&&P._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}class di extends ni{constructor(e,t,i="Level Select Screen"){super(i),this._dailyChallengeScreen=null,this.values=e,this._startingIndex=t}initialize(){this.carousel=new Wt(this._startingIndex),this.display.addChild(this.carousel);for(var e of this.values){e=this.createItem(e),e=new qt(e);this.carousel.addEntry(e)}this.carousel.initialize(),this.carousel.onIndexChange.add(this.carousel_onIndexChange,this),this.carousel.onItemClick.add(this.carousel_onItemClick,this),P._instance.usesDailyChallenge?(this.dailyChallengeButton=new Et,this.display.addChild(this.dailyChallengeButton),this.dailyChallengeButton.input.onPointerClick.add(this.dailyChallengeButton_onClick,this),B.sync()):this.dailyChallengeButton=null,super.initialize()}gainFocus(){P._instance.navBar.home.show(),P._instance.navBar.settings.show(),super.gainFocus()}exit(){this._dailyChallengeScreen&&(this._dailyChallengeScreen.exit(),this._dailyChallengeScreen=null),super.exit()}createDailyChallenge(){return new ri(!1)}homeClicked(){this.track("Home Button Pressed"),P._instance.usesMultiplayerGameModes?this.nextScreen=this.createGameMode():(P._instance.navBar.home.hide(),this.nextScreen=this.createTitle()),this.close()}dailyChallengeButton_onClick(){this.track("Daily Challenge Button Pressed"),this._dailyChallengeScreen=this.createDailyChallenge(),this._dailyChallengeScreen.onClosing.add(this.dailyChallengeScreen_onClosing,this),this.screenManager.add(this._dailyChallengeScreen)}carousel_onItemClick(e,t){this.nextScreen=this.createNewGame(t),this.close()}dailyChallengeScreen_onClosing(){this._dailyChallengeScreen.onClosing.remove(this.dailyChallengeScreen_onClosing,this),this._dailyChallengeScreen.toDailyChallenge?(this.nextScreen=this.createDailyChallengeGameplay(),this.close()):this._dailyChallengeScreen=null}anchor(){this.carousel.anchor(),this.dailyChallengeButton&&(this.dailyChallengeButton.x=F.width/2-this.dailyChallengeButton.w/2,this.dailyChallengeButton.y=this.carousel.entries[0].y+this.carousel.entries[0].item.h/2+32),super.anchor()}update(e){this.carousel.update(e),super.update(e)}}class ci extends ni{constructor(e,t,i="Pause Game Screen"){super(i),this._panelWidth=void 0,this._panelHeight=void 0,this.difficultyName=e,this.time=t}initialize(){this.panel=new Nt(this.difficultyName,u.toTimerString(this.time,0),this._panelWidth,this._panelHeight),this.display.addChild(this.panel),this.panel.resumeButton.input.onPointerClick.add(this.resumeButton_onClick,this),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.hide(),super.gainFocus()}resumeButton_onClick(){this.track("Resume Button Pressed"),this.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}class ui extends ni{constructor(e="View Board Screen"){super(e),this.isPopup=!0,this.hitCatcher=new C,this.display.addChild(this.hitCatcher),this.hitCatcher.input=new x(this.hitCatcher,!0,!1,new h),this.hitCatcher.cursor="pointer",this.hitCatcher.input.onPointerClick.add(this.hitCatcher_onClick,this)}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.show(),P._instance.navBar.close.show(),super.gainFocus()}close(){P._instance.navBar.close.hide(),super.close(),this.exit()}loseFocus(){P._instance.navBar.close.hide(),super.loseFocus()}hitCatcher_onClick(){this.closeClicked()}anchor(){this.hitCatcher.input.hitArea.set(0,0,F.width,F.height),super.anchor()}}class pi extends ni{constructor(e,t,i="Daily Challenge Complete Screen"){super(i),this.isPopup=!0,this.isWin=e,this.time=t}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.cursor="auto",this.panel=new Zt(this.isWin,this.time,this),this.display.addChild(this.panel),this.panel.viewBoardButton.input.onPointerClick.add(this.viewBoardButton_onClick,this),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),B.onUpdated.add(this.DailyChallenge_onUpdated,this),B.isUpdating||this.DailyChallenge_onUpdated(),super.initialize()}DailyChallenge_onUpdated(){B.onUpdated.remove(this.DailyChallenge_onUpdated,this),this.panel.populate()}removed(){B.onUpdated.contains(this.DailyChallenge_onUpdated,this)&&B.onUpdated.remove(this.DailyChallenge_onUpdated,this),super.removed()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.show(),super.gainFocus()}viewBoardButton_onClick(){this.track("View Board Button Pressed");var e=new ui;e.onRemoved.add(this.viewBoardScreen_onRemoved,this),this.display.visible=!1,this.screenManager.add(e)}viewBoardScreen_onRemoved(e){e.onRemoved.remove(this.viewBoardScreen_onRemoved,this),this.display.visible=!0}newGameButton_onClick(){this.track("New Game Button Pressed"),this.close()}close(){P._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}update(e){this.panel.update(e),super.update(e)}}class mi extends ni{constructor(e,t,i,s,n,o="Replay",r=null,a="Win Screen"){super(a),this.toNewGame=!1,this.toReplay=!1,this.wPanel=void 0,this.hPanelUsesStars=void 0,this.hPanelNoStars=void 0,this.isPopup=!0,null===r&&(r=i?"New Record!":"Winner!"),this.title=r,this.difficultyName=e,this.time=t,this.isNewRecord=i,this.numStars=s,this.stingerSoundAsset=n,this._replayButtonText=o}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.cursor="auto",this.panel=new Ut(this.difficultyName,u.toTimerString(this.time,0),this.isNewRecord,this.numStars,this.title,this._replayButtonText,0<=this.numStars,this.wPanel,this.hPanelUsesStars,this.hPanelNoStars),this.display.addChild(this.panel),this.panel.viewBoardButton.input.onPointerClick.add(this.viewBoardButton_onClick,this),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),this.panel.replayButton.input.onPointerClick.add(this.replayButton_onClick,this),this.stingerSoundAsset&&new f(this.stingerSoundAsset.data).play(),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.show(),super.gainFocus()}createViewBoard(){return new ui}viewBoardButton_onClick(){this.track("View Board Button Pressed");var e=this.createViewBoard();e.onRemoved.add(this.viewBoardScreen_onRemoved,this),this.display.visible=!1,this.screenManager.add(e)}viewBoardScreen_onRemoved(e){e.onRemoved.remove(this.viewBoardScreen_onRemoved,this),this.display.visible=!0}newGameButton_onClick(){this.track("New Game Button Pressed"),this.toNewGame=!0,this.close()}replayButton_onClick(){this.track("Replay Button Pressed"),this.toReplay=!0,this.close()}close(){P._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}class gi extends ni{constructor(e,t,i,s="Replay",n=null,o="Lose Screen",r){super(o),this.toNewGame=!1,this.toReplay=!1,this.wPanel=1160,this.hPanel=450,this.isPopup=!0,null===n&&(n="Game Over"),this.title=n,this.caption=r,this.difficultyName=e,this.time=t,this.stingerSoundAsset=i,this._replayButtonText=s}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.cursor="auto",this.panel=new $t(this.difficultyName,u.toTimerString(this.time,0),this.title,this._replayButtonText,this.wPanel,this.hPanel,this.caption),this.display.addChild(this.panel),this.panel.viewBoardButton.input.onPointerClick.add(this.viewBoardButton_onClick,this),this.panel.newGameButton.input.onPointerClick.add(this.newGameButton_onClick,this),this.panel.replayButton.input.onPointerClick.add(this.replayButton_onClick,this),this.stingerSoundAsset&&new f(this.stingerSoundAsset.data).play(),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.show(),super.gainFocus()}createViewBoard(){return new ui}viewBoardButton_onClick(){this.track("View Board Button Pressed");var e=this.createViewBoard();e.onRemoved.add(this.viewBoardScreen_onRemoved,this),this.display.visible=!1,this.screenManager.add(e)}viewBoardScreen_onRemoved(e){e.onRemoved.remove(this.viewBoardScreen_onRemoved,this),this.display.visible=!0}newGameButton_onClick(){this.track("New Game Button Pressed"),this.toNewGame=!0,this.close()}replayButton_onClick(){this.track("Replay Button Pressed"),this.toReplay=!0,this.close()}close(){P._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}class fi extends ni{constructor(e,t="Play Online Screen"){super(t),this.toPlayAnyone=!1,this.toInviteFriend=!1,this._panelWidth=void 0,this._panelHeight=void 0,this.isPopup=!0,this._autoHideHome=e}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this),this.panel=new Ht,this._panelWidth=this.panel.w,this._panelHeight=this.panel.h,this.display.addChild(this.panel),this.panel.anyoneButton.input.onPointerClick.add(this.anyoneButton_onClick,this),this.panel.inviteButton.input.onPointerClick.add(this.inviteButton_onClick,this),super.initialize()}gainFocus(){P._instance.navBar.home.show(),P._instance.navBar.settings.show(),super.gainFocus()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}anyoneButton_onClick(){this.track("Play Anyone Button Pressed"),this.toPlayAnyone=!0,this.close()}inviteButton_onClick(){this.track("Invite Friend Button Pressed"),this.toInviteFriend=!0,this.close()}close(){this.toPlayAnyone||this.toInviteFriend||this._autoHideHome&&P._instance.navBar.home.hide(),super.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}const _i=p.isMainThread?window["247gamesdebug"]={enableSVGCaching(){Ne.enabled=!0,F._dirty=!0},disableSVGCaching(){Ne.enabled=!1,F._dirty=!0},dumpScreens(){console.log(P._instance.screenManager.toString())},showBitmapOutlines:!1}:null;const wi=p.isMainThread?new class{constructor(){this.onAdClosed=new r,this.isShowingAd=!1,this.adHolder=null,this.skipBtn=null,this._adBreak=null,this.skipBtn_click=this.skipBtn_click.bind(this),window.games247&&window.games247.ads?window.games247.ads.createAdBreak?this.enabled=!0:(this.mobileEnabled="true"===document.getElementById("site-script").getAttribute("data-interstitial-enabled-mobile"),this.mobileUnit=document.getElementById("site-script").getAttribute("data-interstitial-unit-mobile"),this.mobileBaseId=this.mobileUnit+"_",this.desktopEnabled="true"===document.getElementById("site-script").getAttribute("data-interstitial-enabled-desktop"),this.desktopUnit=document.getElementById("site-script").getAttribute("data-interstitial-unit-desktop"),this.desktopBaseId=this.desktopUnit+"_","android-auto"===window.games247.nativeAppType&&(this.mobileEnabled=this.desktopEnabled=!1),Z.isMobileDevice?(this.enabled=this.mobileEnabled,this.baseId=this.mobileBaseId,this.unit=this.mobileUnit):(this.enabled=this.desktopEnabled,this.baseId=this.desktopBaseId,this.unit=this.desktopUnit)):this.enabled=!1}adsBlocked(){return 1!==window.games247pbjs}showAd(){window.games247.ads.createAdBreak?this.showAdBreak():this.showAdOld()}showAdStack(){window.games247.ads.createAdBreak?this.showAdBreak():this.showAdStackOld()}showAdBreak(){console.log("InterstitialAds.showAdBreak"),this._adBreak=window.games247.ads.createAdBreak(),this._adBreak.onStart.add(this.adBreak_onStart,this),this._adBreak.onEnd.add(this.adBreak_onEnd,this),this._adBreak.start()}showAdOld(){if(!this.isShowingAd)if(this.isShowingAd=!0,this.adsBlocked())this.isShowingAd=!1,this.onAdClosed.invoke(!0);else{var e=document.createElement("div"),n=(e.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000000;",this.adHolder=e,document.createElement("div")),o=(n.style.cssText="display: inline-block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);",this.baseId+Math.floor(1e5*Math.random()));n.id=o,e.appendChild(n);let t=document.createElement("div"),i=(t.style.cssText=`
	color: #FFFFFF;
	background: rgba(0,0,0,0.15);
	display: inline-block;
	font-family: sans-serif;
	font-weight: normal;
	font-size: 18px;
	padding: 12px 36px;
	border: solid 1px rgba(255,255,255,0.3);
	border-right-width: 0;
	position: absolute;
	bottom: 20px;
	right: 0;
	font-weight: 500;
	cursor: pointer;
	-webkit-user-select: none;
	-ms-user-select: none;
	user-select: none;
	`,t.innerHTML=`
	Close Ad
	`,d.add(t,"click",this.skipBtn_click,!0,!0),d.add(t,"touchend",this.skipBtn_click,!0,!0),d.add(t,"touchstart",this.skipBtn_click,!0,!0),e.appendChild(t),this.skipBtn=t,t.style.pointerEvents="none",5),s=(t.innerHTML=i+"",t.style.opacity="0.65",null);s=setTimeout(function e(){s=null,i--,0===i?(t.style.opacity="1",t.innerHTML="Close Ad",t.style.pointerEvents="auto"):(t.innerHTML=i+"",s=setTimeout(e,1e3))},1e3),document.getElementById("app-player").appendChild(e);try{window.games247.ads.loadBanner300x250(o,2e3,function(){})}catch(e){null!==s&&(clearTimeout(s),s=null,this.skipBtn_click())}}}showAdStackOld(){if(!this.isShowingAd)if(this.isShowingAd=!0,this.adsBlocked())this.isShowingAd=!1,this.onAdClosed.invoke(!0);else{var e=document.createElement("div"),n=(e.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000000;",e.classList.add("asc-interstitial-stack"),this.adHolder=e,document.createElement("div")),o=(n.classList.add("asc-interstitial-stack-list"),e.appendChild(n),document.createElement("div")),r=(o.classList.add("asc-interstitial-stack-item"),n.appendChild(o),document.createElement("div")),n=(r.classList.add("asc-interstitial-stack-item"),n.appendChild(r),document.createElement("div")),a=this.baseId+Math.floor(1e5*Math.random()),o=(n.id=a,o.appendChild(n),document.createElement("div")),n=this.baseId+Math.floor(1e5*Math.random());o.id=n,r.appendChild(o);let t=document.createElement("div"),i=(t.style.cssText=`
	color: #FFFFFF;
	background: rgba(0,0,0,0.15);
	display: inline-block;
	font-family: sans-serif;
	font-weight: normal;
	font-size: 18px;
	padding: 12px 36px;
	border: solid 1px rgba(255,255,255,0.3);
	border-right-width: 0;
	position: absolute;
	bottom: 20px;
	right: 0;
	font-weight: 500;
	cursor: pointer;
	-webkit-user-select: none;
	-ms-user-select: none;
	user-select: none;
	`,t.innerHTML=`
	Close Ad
	`,d.add(t,"click",this.skipBtn_click,!0,!0),d.add(t,"touchend",this.skipBtn_click,!0,!0),d.add(t,"touchstart",this.skipBtn_click,!0,!0),e.appendChild(t),this.skipBtn=t,t.style.pointerEvents="none",5),s=(t.innerHTML=i+"",t.style.opacity="0.65",null);s=setTimeout(function e(){s=null,i--,0===i?(t.style.opacity="1",t.innerHTML="Close Ad",t.style.pointerEvents="auto"):(t.innerHTML=i+"",s=setTimeout(e,1e3))},1e3),document.getElementById("app-player").appendChild(e);try{window.games247.ads.loadBanner300x250Stack(a,n,2e3,function(){})}catch(e){null!==s&&(clearTimeout(s),s=null,this.skipBtn_click())}}}skipBtn_click(){d.remove(this.skipBtn,"click",this.skipBtn_click),d.remove(this.skipBtn,"touchend",this.skipBtn_click),d.remove(this.skipBtn,"touchstart",this.skipBtn_click),this.isShowingAd=!1,this.adHolder&&(this.adHolder.parentElement.removeChild(this.adHolder),this.adHolder=null,this.onAdClosed.invoke(!1)),fe.reset()}adBreak_onStart(e){console.log("InterstitialAds.adBreak_onStart")}adBreak_onEnd(e){console.log("InterstitialAds.adBreak_onEnd"),this._adBreak.onStart.remove(this.adBreak_onStart,this),this._adBreak.onEnd.remove(this.adBreak_onEnd,this),this._adBreak=null,fe.reset(),this.onAdClosed.invoke(!1)}}:null;class yi extends ot{constructor(e){super("Interstitial"),this.useAdStack=!1,this.isPopup=!0,this._nextScreen=e}initialize(){console.log("init StandardInterstitialAdScreen",this.shouldShowAd()),super.initialize(),this.markPlacementOpportunity(),wi.enabled&&this.shouldShowAd()?this.showAd():this.close()}showAd(){wi.onAdClosed.add(this.InterstitialAds_onAdClosed,this),this.useAdStack?wi.showAdStack():wi.showAd()}close(){this._nextScreen&&this.screenManager.add(this._nextScreen),this._nextScreen=null,this.exit()}InterstitialAds_onAdClosed(e){console.log("interstitial closed... blocked?",e),wi.onAdClosed.remove(this.InterstitialAds_onAdClosed,this),this.close()}}class vi{constructor(){this.gtag=window.gtag,this.debug=!0;var e=location.href;"android-auto"===window.games247.nativeAppType?(this.enabled=!1,this.debug=!1,l.info("Google Analytics disabled in android auto builds.")):0<=e.indexOf("file://")&&!window.games247.nativeAppType||0<=e.indexOf("127.0.0.1")||0<=e.indexOf("192.168.1.")||0<=e.indexOf("localhost")||0<=e.indexOf("nautgames.com")||0<=e.indexOf("spencer-evans.com")||0<=e.indexOf("247gamesdev.com")?(this.enabled=!1,l.info("Google Analytics is disabled because the game is running on a test server.")):this.gtag?this.enabled=!0:(this.enabled=!1,l.info("Google Analytics is disabled because gtag could not be found."))}track(e,t,i,s){let n;this.debug&&(n=void 0!==s?e+" --\x3e "+t+(i?" :: "+i+" = "+s:""):e+" --\x3e "+t+(i?" :: "+i:""));try{var o;this.debug&&this.enabled,this.enabled&&(o={},o.event_category=e,void 0!==i&&(o.event_label=i),void 0!==s&&(o.value=s),this.gtag("event",t,o))}catch(e){this.debug&&l.info("GA Failed Event: "+n)}}}const bi=p.isMainThread?new class{constructor(){this.googleAnalytics=new vi}track(e,t,i,s){this.googleAnalytics.track(e,t,i,s)}}:null;class ki{constructor(){this.state=0}}class xi{constructor(e){this.type=e}static define(e,t){if(this.roomControllerMap[e])throw new Error("Type already defined!");this.roomControllerMap[e]=t}}xi.roomIdLength=5,xi.roomIdLetters="ABCDEFGHKLMNPRSTUVWXYZ",xi.roomControllerMap={};class Si extends xi{constructor(e){if(super(0),this.rooms={},this._roomIdGenerator=0,this._sessionIdGenerator=0,this.endpoint=e,Si.endpoints[e])throw new Error("Already exists!");Si.endpoints[e]=this}static reconnect(e,t,i){var s=Si.endpoints[e.clientDriver.client.endpoint];s?e.serverResponse_connectFailure("Reconnect not implemented"):e.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+e.clientDriver.client.endpoint)}static joinById(e,t,i){var s,n,o,r=Si.endpoints[e.clientDriver.client.endpoint];r?(s=r.rooms[t],s?(n=new Ci(e,s,"session_"+ ++r._sessionIdGenerator),o=s.onAuth(n,i,null),o?(e.id=t,e.sessionId=n.sessionId,e.name=s.type,s.clients.push(n),e.serverResponse_connectSuccess(),s.onJoin(n,i,null)):(e.serverResponse_connectFailure("Failed room authorization"),r.cleanUpRoom(s))):e.serverResponse_connectFailure("Could not locate LocalGameServer room with id: "+t)):e.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+e.clientDriver.client.endpoint)}static create(e,t,i){var s=Si.endpoints[e.clientDriver.client.endpoint];s?(t=new Ti(s,"room_"+ ++s._roomIdGenerator,t),s.rooms[t.id]=t,t.onCreate(i),this.joinById(e,t.id,i)):e.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+e.clientDriver.client.endpoint)}static join(e,t,i){var s=Si.endpoints[e.clientDriver.client.endpoint];if(s){var n,o=s.rooms;for(n in o){var r=o[n];if(r.type===t&&r.clients.length<r.maxClients&&!r.locked)return void this.joinById(e,r.id,i)}e.serverResponse_connectFailure("No available rooms")}else e.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+e.clientDriver.client.endpoint)}static joinOrCreate(e,t,i){var s=Si.endpoints[e.clientDriver.client.endpoint];if(s){var n,o=s.rooms;for(n in o){var r=o[n];if(r.type===t&&r.clients.length<r.maxClients&&!r.locked)return void this.joinById(e,r.id,i)}this.create(e,t,i)}else e.serverResponse_connectFailure("Could not locate LocalGameServer at endpoint: "+e.clientDriver.client.endpoint)}cleanUpRoom(e){0===e.clients.length&&delete this.rooms[e.id]}}Si.endpoints={};class Ci{constructor(e,t,i){this._roomDriver=e,this.sessionId=i,this._serverRoom=t,this._roomDriver.serverClient=this}leave(e,t){this._serverRoom.onLeave(this,!1);let i=this;function s(){i._roomDriver.receive_leave(e)}0<=i._roomDriver.clientDriver.client.latency?setTimeout(s,i._roomDriver.clientDriver.client.latency/2):s()}send(e,t){let i=this;function s(){i._roomDriver.receive_message(e,JSON.parse(JSON.stringify(t)))}0<=i._roomDriver.clientDriver.client.latency?setTimeout(s,i._roomDriver.clientDriver.client.latency/2):s()}error(e,t){let i=this;function s(){i._roomDriver.receive_error(e,t)}0<=i._roomDriver.clientDriver.client.latency?setTimeout(s,i._roomDriver.clientDriver.client.latency/2):s()}receive_leave(){this._serverRoom.onLeave(this,!0);let e=this;function t(){e._roomDriver.receive_leave(1e3)}0<=e._roomDriver.clientDriver.client.latency?setTimeout(t,e._roomDriver.clientDriver.client.latency/2):t()}receive_message(e,t){this._serverRoom.onMessage(this,e,t)}}class Ti{get locked(){return this.clients.length>=this.maxClients||this._manuallyLocked}constructor(e,t,i){this.clients=[],this.maxClients=Infinity,this._manuallyLocked=!1,this.__FLAG_IS_LOCAL_GAME_SERVER_ROOM=!0,this.server=e,this.id=t,this.type=i,this.controller=new xi.roomControllerMap[i](this)}onCreate(e){this.controller.onCreate(e)}onAuth(e,t,i){return this.controller.onAuth(e,t,i)}onJoin(e,t,i){this.controller.onJoin(e,t,i)}onLeave(e,t){this.clients.splice(this.clients.indexOf(e),1),this.controller.onLeave(e,t),this.server.cleanUpRoom(this)}onMessage(e,t,i){this.controller.onMessage(e,t,i)}broadcast(e,t,i){var s,n=this.clients.slice(0);for(s of n)i&&i.except===s||s.send(e,t)}disconnect(){for(;0<this.clients.length;)this.clients[0].leave(1001,"Game room disconnected");this.server.cleanUpRoom(this)}lock(){this._manuallyLocked=!0}unlock(){this._manuallyLocked=!1}}class Fi{constructor(e,t){this.serverType=e,this.endpoint=t}newRoom(){return new(0===this.serverType?Li:Oi)(this)}reconnect(e,t,i){var s=this.newRoom();return s.type=e,s.id=t,s.sessionId=i,s.connectAction=4,s}joinById(e,t,i){var s=this.newRoom();return s.type=e,s.id=t,s.createJoinOptions=i,s.connectAction=3,s}join(e,t){var i=this.newRoom();return i.type=e,i.createJoinOptions=t,i.connectAction=0,i}create(e,t){var i=this.newRoom();return i.type=e,i.createJoinOptions=t,i.connectAction=1,i}joinOrCreate(e,t){var i=this.newRoom();return i.type=e,i.createJoinOptions=t,i.connectAction=2,i}}class Pi{constructor(e){this.client=e}reconnect(e,t,i,s){var n=new Mi(this);n.reconnect(e,t,i,s)}joinById(e,t,i,s){var n=new Mi(this);n.joinById(e,t,i,s)}create(e,t,i,s){var n=new Mi(this);n.create(e,t,i,s)}join(e,t,i,s){var n=new Mi(this);n.join(e,t,i,s)}joinOrCreate(e,t,i,s){var n=new Mi(this);n.joinOrCreate(e,t,i,s)}}class Bi extends Fi{constructor(e,t=-1){super(0,e),this.clientDriver=new Pi(this),this.latency=t}}class Ai extends Fi{constructor(e){super(1,"wss://"+e),this.colyseusClient=new D.Client(this.endpoint)}}class Ei{constructor(e){this.onConnecting=new r,this.onConnected=new r,this.onConnectFailed=new r,this.onDisconnected=new r,this.onError=new r,this.onMessage=new r,this.type=null,this.id=null,this.sessionId=null,this.connectAction=null,this.createJoinOptions=void 0,this.connection=new ki,this.client=e}assertCanConnect(){if(1===this.connection.state)throw new Error("Already connecting!");if(2===this.connection.state)throw new Error("Already connected!")}assertCanDisconnect(){if(0===this.connection.state)throw new Error("Already disconnected!")}assertConnected(){if(2!==this.connection.state)throw new Error("Not connected!")}setState(e){var t;this.connection.state!==e&&(t=this.connection.state,this.connection.state=e,1===e?this.onConnecting.invoke(this):2===e?this.onConnected.invoke(this):0===e&&(1===t?this.onConnectFailed:this.onDisconnected).invoke(this))}}class Mi{constructor(e){this.onError=new r,this.onLeave=new r,this.onMessage=new r,this._connectSuccessCallback=null,this._connectFailureCallback=null,this.id=null,this.name=null,this.sessionId=null,this.serverClient=null,this.clientDriver=e}reconnect(e,t,i,s){let n=this;function o(){Si.reconnect(n,e,t)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(o,this.clientDriver.client.latency/2):o()}joinById(e,t,i,s){let n=this;function o(){Si.joinById(n,e,t)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(o,this.clientDriver.client.latency/2):o()}create(e,t,i,s){let n=this;function o(){Si.create(n,e,t)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(o,this.clientDriver.client.latency/2):o()}join(e,t,i,s){let n=this;function o(){Si.join(n,e,t)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(o,this.clientDriver.client.latency/2):o()}joinOrCreate(e,t,i,s){let n=this;function o(){Si.joinOrCreate(n,e,t)}this._connectSuccessCallback=i,this._connectFailureCallback=s,0<=this.clientDriver.client.latency?setTimeout(o,this.clientDriver.client.latency/2):o()}serverResponse_connectFailure(e){let t=this;function i(){t._connectFailureCallback(e)}0<=this.clientDriver.client.latency?setTimeout(i,this.clientDriver.client.latency/2):i()}serverResponse_connectSuccess(){let e=this;function t(){e._connectSuccessCallback(e)}0<=this.clientDriver.client.latency?setTimeout(t,this.clientDriver.client.latency/2):t()}leave(){let e=this;Si.endpoints[this.clientDriver.client.endpoint];function t(){e.serverClient.receive_leave()}0<=this.clientDriver.client.latency?setTimeout(t,this.clientDriver.client.latency/2):t()}send(e,t){let i=this;var s=Si.endpoints[this.clientDriver.client.endpoint];s.rooms[this.id];function n(){i.serverClient.receive_message(e,JSON.parse(JSON.stringify(t)))}0<=this.clientDriver.client.latency?setTimeout(n,this.clientDriver.client.latency/2):n()}receive_leave(e){this.onLeave.invoke(e)}receive_error(e,t){this.onError.invoke(e,t)}receive_message(e,t){this.onMessage.invoke(e,t)}}class Li extends Ei{constructor(e){super(e),this._connectPromise=!1,this.roomDriver=null,this.connect_success=this.connect_success.bind(this),this.connect_failure=this.connect_failure.bind(this)}connect(){var e;this.assertCanConnect(),this._connectPromise||(e=this.client.clientDriver,this.setState(1),this._connectPromise=!0,4===this.connectAction?e.reconnect(this.id,this.sessionId,this.connect_success,this.connect_failure):3===this.connectAction?e.joinById(this.id,this.createJoinOptions,this.connect_success,this.connect_failure):1===this.connectAction?e.create(this.type,this.createJoinOptions,this.connect_success,this.connect_failure):0===this.connectAction?e.join(this.type,this.createJoinOptions,this.connect_success,this.connect_failure):2===this.connectAction&&e.joinOrCreate(this.type,this.createJoinOptions,this.connect_success,this.connect_failure))}connect_success(e){this._connectPromise=!1,1===this.connection.state?e.name!==this.type?(e.leave(),this.connect_failure("Incorrect room type")):(this.roomDriver=e,4===this.connectAction?this.type=this.roomDriver.name:(3===this.connectAction?this.type=this.roomDriver.name:this.id=this.roomDriver.id,this.sessionId=this.roomDriver.sessionId),this.connectAction=4,this.roomDriver.onError.add(this.roomDriver_onError,this),this.roomDriver.onLeave.add(this.roomDriver_onLeave,this),this.roomDriver.onMessage.add(this.roomDriver_onMessage,this),this.setState(2)):e.leave()}connect_failure(e){this._connectPromise=!1,l.info("Failed to connect to local game room:",e),this.setState(0)}disconnect(){this.assertCanDisconnect(),this._connectPromise||(this.roomDriver.onError.remove(this.roomDriver_onError,this),this.roomDriver.onLeave.remove(this.roomDriver_onLeave,this),this.roomDriver.onMessage.remove(this.roomDriver_onMessage,this),this.roomDriver.leave(),this.roomDriver=null),this.setState(0)}send(e,t){this.assertConnected(),this.roomDriver.send(e,t)}roomDriver_onError(e,t){this.onError.invoke(this,e,t)}roomDriver_onLeave(e){1e3!==e?l.info("Left local game room with abnormal close code: "+e):l.info("Unexpectedly left local game room with normal close code: "+e),this._connectPromise=!1,this.roomDriver&&(this.roomDriver.onError.remove(this.roomDriver_onError,this),this.roomDriver.onLeave.remove(this.roomDriver_onLeave,this),this.roomDriver.onMessage.remove(this.roomDriver_onMessage,this),this.roomDriver=null),this.setState(0)}roomDriver_onMessage(e,t){this.onMessage.invoke(this,e,t)}}class Oi extends Ei{constructor(e){super(e),this._connectPromise=null,this.colyseusRoom=null,this.connect_success=this.connect_success.bind(this),this.connect_failure=this.connect_failure.bind(this),this.colyseusRoom_onError=this.colyseusRoom_onError.bind(this),this.colyseusRoom_onLeave=this.colyseusRoom_onLeave.bind(this),this.colyseusRoom_onMessage=this.colyseusRoom_onMessage.bind(this)}connect(){var e;this.assertCanConnect(),this._connectPromise||(e=this.client.colyseusClient,4===this.connectAction?this._connectPromise=e.reconnect(this.id,this.sessionId):3===this.connectAction?this._connectPromise=e.joinById(this.id,this.createJoinOptions):1===this.connectAction?this._connectPromise=e.create(this.type,this.createJoinOptions):0===this.connectAction?this._connectPromise=e.join(this.type,this.createJoinOptions):2===this.connectAction&&(this._connectPromise=e.joinOrCreate(this.type,this.createJoinOptions)),this._connectPromise.then(this.connect_success,this.connect_failure).catch(this.connect_failure)),this.setState(1)}connect_success(e){this._connectPromise=null,1===this.connection.state?e.name!==this.type?(e.leave(!0),this.connect_failure("Incorrect room type")):(this.colyseusRoom=e,4===this.connectAction?this.type=this.colyseusRoom.name:(3===this.connectAction?this.type=this.colyseusRoom.name:this.id=e.id,this.sessionId=e.sessionId),this.connectAction=4,this.colyseusRoom.onError(this.colyseusRoom_onError),this.colyseusRoom.onLeave(this.colyseusRoom_onLeave),this.colyseusRoom.onMessage("*",this.colyseusRoom_onMessage),this.setState(2)):e.leave(!0)}connect_failure(e){this._connectPromise=null,l.info("Failed to connect to remote game room:",e),this.setState(0)}disconnect(){this.assertCanDisconnect(),this._connectPromise||(this.colyseusRoom.onError.remove(this.colyseusRoom_onError),this.colyseusRoom.onLeave.remove(this.colyseusRoom_onLeave),this.colyseusRoom.removeAllListeners(),this.colyseusRoom.leave(!0),this.colyseusRoom=null),this.setState(0)}send(e,t){this.assertConnected(),this.colyseusRoom.send(e,t)}colyseusRoom_onError(e,t){this.onError.invoke(this,e,t)}colyseusRoom_onLeave(e){1e3!==e?l.info("Left remove game room with abnormal close code: "+e):l.info("Unexpectedly left remote game room with normal close code: "+e),this._connectPromise=null,this.colyseusRoom&&(this.colyseusRoom.onError.remove(this.colyseusRoom_onError),this.colyseusRoom.onLeave.remove(this.colyseusRoom_onLeave),this.colyseusRoom.removeAllListeners(),this.colyseusRoom=null),this.setState(0)}colyseusRoom_onMessage(e,t){this.onMessage.invoke(this,e,t)}}at.game={},at._themes[247]={},at._themes["4th-of-july"]={},at._themes.christmas={},at._themes["cinco-de-mayo"]={},at._themes.easter={},at._themes.fall={},at._themes.halloween={},at._themes["new-years"]={},at._themes.spring={},at._themes["st-patricks"]={},at._themes.summer={},at._themes.thanksgiving={},at._themes.valentines={},at._themes.winter={};const Ri={production:{envName:"Production",host:"room.247chess.com:50004",allowedDomains:["247chess.com"]},staging:{envName:"Staging",host:"room.247chess.com:50005",allowedDomains:["staging.247chess.com"]},development:{envName:"Development",host:"247games.local:50004",allowedDomains:["247games.local:8080","127.0.0.1:8080","localhost:8080","247games.local:8081","127.0.0.1:8081","localhost:8081","247games.local:8082","127.0.0.1:8082","localhost:8082","247games.local:8083","127.0.0.1:8083","localhost:8083","247games.local:8084","127.0.0.1:8084","localhost:8084","247games.local:8085","127.0.0.1:8085","localhost:8085","247games.local:8086","127.0.0.1:8086","localhost:8086","247games.local:8087","127.0.0.1:8087","localhost:8087","247games.local:8088","127.0.0.1:8088","localhost:8088","247games.local:8089","127.0.0.1:8089","localhost:8089"]}},Di=(p.isMainThread&&(b=document.getElementById("game-script"),He=b.getAttribute("data-theme"),s=w.images,Ue=w.sounds,$e=w.fonts,b=b.getAttribute("data-basepath")+"game/",$e["RobotoMono-SemiBold"]=new Oe(b+"fonts/RobotoMono-SemiBold",2146,-555,2048,14400,8124),$e["OpenSans-ExtraBold"]=new Oe(b+"fonts/OpenSans-ExtraBold",2189,-600,2048,11048,6036),$e["OpenSans-Bold"]=new Oe(b+"fonts/OpenSans-Bold",2189,-600,2048,12120,6688),$e["AsapCondensed-SemiBold"]=new Oe(b+"fonts/AsapCondensed-SemiBold",934,-212,1e3,13848,7e3),$e["Asap-Regular"]=new Oe(b+"fonts/Asap-Regular",934,-212,1e3,14604,7216),Ue.swoop_forward=new Re(b+"sounds/swoop_forward",444,2680,2600),Ue.swoop_backward=new Re(b+"sounds/swoop_backward",418,2629,2347),Ue.keypress=new Re(b+"sounds/keypress",104,1773,1132),Ue.countdown=new Re(b+"sounds/countdown",392,5007,2911),Ue.click=new Re(b+"sounds/click",470,3698,3431),Ue.win=new Re(b+"sounds/win",5146,74724,32403),Ue.welcome=new Re(b+"sounds/welcome",3239,39720,20384),Ue["turn-notification"]=new Re(b+"sounds/turn-notification",360,3024,2904),Ue.select=new Re(b+"sounds/select",287,2813,2082),Ue.record=new Re(b+"sounds/record",1228,6635,7645),Ue.promote=new Re(b+"sounds/promote",522,3931,3381),Ue.move=new Re(b+"sounds/move",470,3930,3322),Ue.lose=new Re(b+"sounds/lose",3971,48216,24950),Ue.check=new Re(b+"sounds/check",1045,6481,6844),Ue.capture=new Re(b+"sounds/capture",209,2320,1730),s.star_fill=new Le(b+"images/star_fill",168.11,159.89,5197),s.star_empty=new Le(b+"images/star_empty",168.11,159.89,3621),s.kb_delete=new Le(b+"images/kb_delete",80,80,244),s.icon_x_red=new Le(b+"images/icon_x_red",56.32,56.32,676),s.icon_wrench=new Le(b+"images/icon_wrench",64.32,64.32,752),s.icon_undo_disabled=new Le(b+"images/icon_undo_disabled",64.16,50.7,1075),s.icon_undo=new Le(b+"images/icon_undo",64.16,50.7,1063),s.icon_swap_hor=new Le(b+"images/icon_swap_hor",88,88,287),s.icon_stats=new Le(b+"images/icon_stats",64.3,64.3,585),s.icon_star=new Le(b+"images/icon_star",68.07,64.91,853),s.icon_play=new Le(b+"images/icon_play",43.69,49.83,410),s.icon_pause=new Le(b+"images/icon_pause",38.11,41.64,512),s.icon_more=new Le(b+"images/icon_more",44,44,369),s.icon_medal=new Le(b+"images/icon_medal",55.66,68.53,7562),s.icon_home=new Le(b+"images/icon_home",67.84,63.95,1367),s.icon_hint=new Le(b+"images/icon_hint",42.95,64.32,1357),s.icon_help=new Le(b+"images/icon_help",64.3,64.3,1342),s.icon_daily_challenge_complete=new Le(b+"images/icon_daily_challenge_complete",54.18,52,624),s.icon_daily_challenge=new Le(b+"images/icon_daily_challenge",54.18,52,734),s.icon_clock=new Le(b+"images/icon_clock",57.14,57.14,578),s.arrow_right_shadow=new Le(b+"images/arrow_right_shadow",145.38,162.52,499),s.arrow_right=new Le(b+"images/arrow_right",145.38,162.52,738),"247"===He?(s["@theme/white_rook"]=new e(1,b+"images/247/white_rook",2111,1484),s["@theme/white_queen"]=new e(1,b+"images/247/white_queen",3719,2588),s["@theme/white_pawn"]=new e(1,b+"images/247/white_pawn",2547,1704),s["@theme/white_knight"]=new e(1,b+"images/247/white_knight",3320,2396),s["@theme/white_king"]=new e(1,b+"images/247/white_king",3749,3188),s["@theme/white_bishop"]=new e(1,b+"images/247/white_bishop",3143,2190),s["@theme/intro"]=new e(1,b+"images/247/intro",103299,39066),s["@theme/game_bg"]=new e(1,b+"images/247/game_bg",92255,8090),s["@theme/black_rook"]=new e(1,b+"images/247/black_rook",1863,1190),s["@theme/black_queen"]=new e(1,b+"images/247/black_queen",3181,1918),s["@theme/black_pawn"]=new e(1,b+"images/247/black_pawn",2263,1374),s["@theme/black_knight"]=new e(1,b+"images/247/black_knight",2867,1832),s["@theme/black_king"]=new e(1,b+"images/247/black_king",3299,2326),s["@theme/black_bishop"]=new e(1,b+"images/247/black_bishop",2708,1660),s["@theme/board"]=new e(2,b+"images/247/board",175189)):"spring"===He?(s["@theme/white_rook"]=new e(1,b+"images/spring/white_rook",3795,2704),s["@theme/white_queen"]=new e(1,b+"images/spring/white_queen",7053,3944),s["@theme/white_pawn"]=new e(1,b+"images/spring/white_pawn",5716,3952),s["@theme/white_knight"]=new e(1,b+"images/spring/white_knight",7088,5160),s["@theme/white_king"]=new e(1,b+"images/spring/white_king",5033,4086),s["@theme/white_bishop"]=new e(1,b+"images/spring/white_bishop",4832,3210),s["@theme/intro"]=new e(1,b+"images/spring/intro",119695,50912),s["@theme/game_bg"]=new e(1,b+"images/spring/game_bg",59068,6896),s["@theme/black_rook"]=new e(1,b+"images/spring/black_rook",3906,2768),s["@theme/black_queen"]=new e(1,b+"images/spring/black_queen",7475,3776),s["@theme/black_pawn"]=new e(1,b+"images/spring/black_pawn",7463,3602),s["@theme/black_knight"]=new e(1,b+"images/spring/black_knight",8489,4674),s["@theme/black_king"]=new e(1,b+"images/spring/black_king",6185,3698),s["@theme/black_bishop"]=new e(1,b+"images/spring/black_bishop",5484,3012),s["@theme/board"]=new e(2,b+"images/spring/board",213429)):"summer"===He?(s["@theme/white_rook"]=new e(1,b+"images/summer/white_rook",6135,3880),s["@theme/white_queen"]=new e(1,b+"images/summer/white_queen",6061,3638),s["@theme/white_pawn"]=new e(1,b+"images/summer/white_pawn",7132,4234),s["@theme/white_knight"]=new e(1,b+"images/summer/white_knight",4985,3486),s["@theme/white_king"]=new e(1,b+"images/summer/white_king",7544,4810),s["@theme/white_bishop"]=new e(1,b+"images/summer/white_bishop",4275,3106),s["@theme/intro"]=new e(1,b+"images/summer/intro",121069,58232),s["@theme/game_bg"]=new e(1,b+"images/summer/game_bg",171416,10012),s["@theme/black_rook"]=new e(1,b+"images/summer/black_rook",6306,3942),s["@theme/black_queen"]=new e(1,b+"images/summer/black_queen",4615,3630),s["@theme/black_pawn"]=new e(1,b+"images/summer/black_pawn",7140,4406),s["@theme/black_knight"]=new e(1,b+"images/summer/black_knight",5595,3444),s["@theme/black_king"]=new e(1,b+"images/summer/black_king",7589,4772),s["@theme/black_bishop"]=new e(1,b+"images/summer/black_bishop",3841,2922),s["@theme/board"]=new e(2,b+"images/summer/board",189907)):"fall"===He?(s["@theme/white_rook"]=new e(1,b+"images/fall/white_rook",4145,2686),s["@theme/white_queen"]=new e(1,b+"images/fall/white_queen",10652,5810),s["@theme/white_pawn"]=new e(1,b+"images/fall/white_pawn",6542,4106),s["@theme/white_knight"]=new e(1,b+"images/fall/white_knight",4245,3138),s["@theme/white_king"]=new e(1,b+"images/fall/white_king",7764,4986),s["@theme/white_bishop"]=new e(1,b+"images/fall/white_bishop",6968,4466),s["@theme/intro"]=new e(1,b+"images/fall/intro",90017,41404),s["@theme/game_bg"]=new e(1,b+"images/fall/game_bg",180507,17724),s["@theme/black_rook"]=new e(1,b+"images/fall/black_rook",2670,2202),s["@theme/black_queen"]=new e(1,b+"images/fall/black_queen",9355,5174),s["@theme/black_pawn"]=new e(1,b+"images/fall/black_pawn",7243,3326),s["@theme/black_knight"]=new e(1,b+"images/fall/black_knight",4747,2742),s["@theme/black_king"]=new e(1,b+"images/fall/black_king",8578,4466),s["@theme/black_bishop"]=new e(1,b+"images/fall/black_bishop",7595,4160),s["@theme/board"]=new e(2,b+"images/fall/board",169387)):"winter"===He?(s["@theme/white_rook"]=new e(1,b+"images/winter/white_rook",7302,4688),s["@theme/white_queen"]=new e(1,b+"images/winter/white_queen",6734,3982),s["@theme/white_pawn"]=new e(1,b+"images/winter/white_pawn",5418,4490),s["@theme/white_knight"]=new e(1,b+"images/winter/white_knight",7152,4892),s["@theme/white_king"]=new e(1,b+"images/winter/white_king",5401,3246),s["@theme/white_bishop"]=new e(1,b+"images/winter/white_bishop",4506,3162),s["@theme/intro"]=new e(1,b+"images/winter/intro",108227,49476),s["@theme/game_bg"]=new e(1,b+"images/winter/game_bg",59922,5928),s["@theme/black_rook"]=new e(1,b+"images/winter/black_rook",7995,4648),s["@theme/black_queen"]=new e(1,b+"images/winter/black_queen",6881,3928),s["@theme/black_pawn"]=new e(1,b+"images/winter/black_pawn",8102,5554),s["@theme/black_knight"]=new e(1,b+"images/winter/black_knight",7692,5192),s["@theme/black_king"]=new e(1,b+"images/winter/black_king",5824,3722),s["@theme/black_bishop"]=new e(1,b+"images/winter/black_bishop",5347,3428),s["@theme/board"]=new e(2,b+"images/winter/board",209497)):"christmas"===He?(s["@theme/white_rook"]=new e(1,b+"images/christmas/white_rook",3161,2616),s["@theme/white_queen"]=new e(1,b+"images/christmas/white_queen",8222,5008),s["@theme/white_pawn"]=new e(1,b+"images/christmas/white_pawn",4e3,2962),s["@theme/white_knight"]=new e(1,b+"images/christmas/white_knight",6287,3614),s["@theme/white_king"]=new e(1,b+"images/christmas/white_king",10274,5514),s["@theme/white_bishop"]=new e(1,b+"images/christmas/white_bishop",6643,3966),s["@theme/intro"]=new e(1,b+"images/christmas/intro",114430,55704),s["@theme/game_bg"]=new e(1,b+"images/christmas/game_bg",5384,3212),s["@theme/black_rook"]=new e(1,b+"images/christmas/black_rook",3812,2504),s["@theme/black_queen"]=new e(1,b+"images/christmas/black_queen",8670,4906),s["@theme/black_pawn"]=new e(1,b+"images/christmas/black_pawn",4262,2896),s["@theme/black_knight"]=new e(1,b+"images/christmas/black_knight",7226,3950),s["@theme/black_king"]=new e(1,b+"images/christmas/black_king",10368,5192),s["@theme/black_bishop"]=new e(1,b+"images/christmas/black_bishop",6432,3692),s["@theme/board"]=new e(2,b+"images/christmas/board",178815)):"easter"===He?(s["@theme/white_rook"]=new e(1,b+"images/easter/white_rook",3011,1638),s["@theme/white_queen"]=new e(1,b+"images/easter/white_queen",5569,3320),s["@theme/white_pawn"]=new e(1,b+"images/easter/white_pawn",5443,2990),s["@theme/white_knight"]=new e(1,b+"images/easter/white_knight",6919,3202),s["@theme/white_king"]=new e(1,b+"images/easter/white_king",6633,3464),s["@theme/white_bishop"]=new e(1,b+"images/easter/white_bishop",2370,1682),s["@theme/intro"]=new e(1,b+"images/easter/intro",108012,47336),s["@theme/game_bg"]=new e(1,b+"images/easter/game_bg",171091,20754),s["@theme/black_rook"]=new e(1,b+"images/easter/black_rook",3112,1782),s["@theme/black_queen"]=new e(1,b+"images/easter/black_queen",5327,4244),s["@theme/black_pawn"]=new e(1,b+"images/easter/black_pawn",5313,3586),s["@theme/black_knight"]=new e(1,b+"images/easter/black_knight",7267,4320),s["@theme/black_king"]=new e(1,b+"images/easter/black_king",6726,4764),s["@theme/black_bishop"]=new e(1,b+"images/easter/black_bishop",2156,1770),s["@theme/board"]=new e(2,b+"images/easter/board",210224)):"4th-of-july"===He?(s["@theme/white_rook"]=new e(1,b+"images/4th-of-july/white_rook",4594,2884),s["@theme/white_queen"]=new e(1,b+"images/4th-of-july/white_queen",7990,3804),s["@theme/white_pawn"]=new e(1,b+"images/4th-of-july/white_pawn",2269,1442),s["@theme/white_knight"]=new e(1,b+"images/4th-of-july/white_knight",6201,3152),s["@theme/white_king"]=new e(1,b+"images/4th-of-july/white_king",7214,4192),s["@theme/white_bishop"]=new e(1,b+"images/4th-of-july/white_bishop",3756,2196),s["@theme/intro"]=new e(1,b+"images/4th-of-july/intro",110562,50730),s["@theme/game_bg"]=new e(1,b+"images/4th-of-july/game_bg",3412,1192),s["@theme/black_rook"]=new e(1,b+"images/4th-of-july/black_rook",4793,2686),s["@theme/black_queen"]=new e(1,b+"images/4th-of-july/black_queen",6874,4040),s["@theme/black_pawn"]=new e(1,b+"images/4th-of-july/black_pawn",2046,1466),s["@theme/black_knight"]=new e(1,b+"images/4th-of-july/black_knight",5330,3788),s["@theme/black_king"]=new e(1,b+"images/4th-of-july/black_king",7232,4528),s["@theme/black_bishop"]=new e(1,b+"images/4th-of-july/black_bishop",3611,2404),s["@theme/board"]=new e(2,b+"images/4th-of-july/board",240806)):"halloween"===He?(s["@theme/white_rook"]=new e(1,b+"images/halloween/white_rook",4261,3432),s["@theme/white_queen"]=new e(1,b+"images/halloween/white_queen",5089,3078),s["@theme/white_pawn"]=new e(1,b+"images/halloween/white_pawn",3958,2786),s["@theme/white_knight"]=new e(1,b+"images/halloween/white_knight",5003,3210),s["@theme/white_king"]=new e(1,b+"images/halloween/white_king",6620,4732),s["@theme/white_bishop"]=new e(1,b+"images/halloween/white_bishop",4329,3390),s["@theme/intro"]=new e(1,b+"images/halloween/intro",103197,55930),s["@theme/game_bg"]=new e(1,b+"images/halloween/game_bg",64338,43794),s["@theme/black_rook"]=new e(1,b+"images/halloween/black_rook",5006,3364),s["@theme/black_queen"]=new e(1,b+"images/halloween/black_queen",5665,3946),s["@theme/black_pawn"]=new e(1,b+"images/halloween/black_pawn",4516,2700),s["@theme/black_knight"]=new e(1,b+"images/halloween/black_knight",5457,4142),s["@theme/black_king"]=new e(1,b+"images/halloween/black_king",8281,4572),s["@theme/black_bishop"]=new e(1,b+"images/halloween/black_bishop",5538,3256),s["@theme/board"]=new e(2,b+"images/halloween/board",192004)):"thanksgiving"===He?(s["@theme/white_rook"]=new e(1,b+"images/thanksgiving/white_rook",8378,4520),s["@theme/white_queen"]=new e(1,b+"images/thanksgiving/white_queen",7912,4700),s["@theme/white_pawn"]=new e(1,b+"images/thanksgiving/white_pawn",6955,4064),s["@theme/white_knight"]=new e(1,b+"images/thanksgiving/white_knight",5969,3896),s["@theme/white_king"]=new e(1,b+"images/thanksgiving/white_king",5156,3184),s["@theme/white_bishop"]=new e(1,b+"images/thanksgiving/white_bishop",3505,2712),s["@theme/intro"]=new e(1,b+"images/thanksgiving/intro",113887,59586),s["@theme/game_bg"]=new e(1,b+"images/thanksgiving/game_bg",166802,17500),s["@theme/black_rook"]=new e(1,b+"images/thanksgiving/black_rook",4755,3214),s["@theme/black_queen"]=new e(1,b+"images/thanksgiving/black_queen",6801,3802),s["@theme/black_pawn"]=new e(1,b+"images/thanksgiving/black_pawn",4255,2750),s["@theme/black_knight"]=new e(1,b+"images/thanksgiving/black_knight",3969,2978),s["@theme/black_king"]=new e(1,b+"images/thanksgiving/black_king",4499,2428),s["@theme/black_bishop"]=new e(1,b+"images/thanksgiving/black_bishop",3095,2178),s["@theme/board"]=new e(2,b+"images/thanksgiving/board",166236)):"new-years"===He?(s["@theme/white_rook"]=new e(1,b+"images/new-years/white_rook",3525,1934),s["@theme/white_queen"]=new e(1,b+"images/new-years/white_queen",5099,2732),s["@theme/white_pawn"]=new e(1,b+"images/new-years/white_pawn",3854,2090),s["@theme/white_knight"]=new e(1,b+"images/new-years/white_knight",8215,4284),s["@theme/white_king"]=new e(1,b+"images/new-years/white_king",6167,2930),s["@theme/white_bishop"]=new e(1,b+"images/new-years/white_bishop",7122,3298),s["@theme/intro"]=new e(1,b+"images/new-years/intro",102735,49990),s["@theme/game_bg"]=new e(1,b+"images/new-years/game_bg",30691,8292),s["@theme/black_rook"]=new e(1,b+"images/new-years/black_rook",3447,1990),s["@theme/black_queen"]=new e(1,b+"images/new-years/black_queen",4357,2576),s["@theme/black_pawn"]=new e(1,b+"images/new-years/black_pawn",3822,2224),s["@theme/black_knight"]=new e(1,b+"images/new-years/black_knight",8302,4740),s["@theme/black_king"]=new e(1,b+"images/new-years/black_king",5643,3222),s["@theme/black_bishop"]=new e(1,b+"images/new-years/black_bishop",6552,3606),s["@theme/board"]=new e(2,b+"images/new-years/board",142984)):"valentines"===He?(s["@theme/white_rook"]=new e(1,b+"images/valentines/white_rook",4351,2022),s["@theme/white_queen"]=new e(1,b+"images/valentines/white_queen",7538,4256),s["@theme/white_pawn"]=new e(1,b+"images/valentines/white_pawn",2150,1628),s["@theme/white_knight"]=new e(1,b+"images/valentines/white_knight",5954,4316),s["@theme/white_king"]=new e(1,b+"images/valentines/white_king",3501,2384),s["@theme/white_bishop"]=new e(1,b+"images/valentines/white_bishop",5265,4098),s["@theme/intro"]=new e(1,b+"images/valentines/intro",99860,52642),s["@theme/game_bg"]=new e(1,b+"images/valentines/game_bg",60249,23464),s["@theme/black_rook"]=new e(1,b+"images/valentines/black_rook",5670,2468),s["@theme/black_queen"]=new e(1,b+"images/valentines/black_queen",8634,4510),s["@theme/black_pawn"]=new e(1,b+"images/valentines/black_pawn",2557,1690),s["@theme/black_knight"]=new e(1,b+"images/valentines/black_knight",6778,4056),s["@theme/black_king"]=new e(1,b+"images/valentines/black_king",5377,2994),s["@theme/black_bishop"]=new e(1,b+"images/valentines/black_bishop",6875,3932),s["@theme/board"]=new e(2,b+"images/valentines/board",151696)):"st-patricks"===He?(s["@theme/white_rook"]=new e(1,b+"images/st-patricks/white_rook",2984,2416),s["@theme/white_queen"]=new e(1,b+"images/st-patricks/white_queen",3841,3062),s["@theme/white_pawn"]=new e(1,b+"images/st-patricks/white_pawn",5078,3834),s["@theme/white_knight"]=new e(1,b+"images/st-patricks/white_knight",5191,4096),s["@theme/white_king"]=new e(1,b+"images/st-patricks/white_king",4323,3382),s["@theme/white_bishop"]=new e(1,b+"images/st-patricks/white_bishop",3788,2822),s["@theme/intro"]=new e(1,b+"images/st-patricks/intro",108848,59266),s["@theme/game_bg"]=new e(1,b+"images/st-patricks/game_bg",51917,4430),s["@theme/black_rook"]=new e(1,b+"images/st-patricks/black_rook",3041,2504),s["@theme/black_queen"]=new e(1,b+"images/st-patricks/black_queen",3891,3188),s["@theme/black_pawn"]=new e(1,b+"images/st-patricks/black_pawn",5031,4012),s["@theme/black_knight"]=new e(1,b+"images/st-patricks/black_knight",5163,4086),s["@theme/black_king"]=new e(1,b+"images/st-patricks/black_king",4389,3406),s["@theme/black_bishop"]=new e(1,b+"images/st-patricks/black_bishop",3907,2778),s["@theme/board"]=new e(2,b+"images/st-patricks/board",180821)):"cinco-de-mayo"===He&&(s["@theme/white_rook"]=new e(1,b+"images/cinco-de-mayo/white_rook",5639,3476),s["@theme/white_queen"]=new e(1,b+"images/cinco-de-mayo/white_queen",5374,2730),s["@theme/white_pawn"]=new e(1,b+"images/cinco-de-mayo/white_pawn",6546,4286),s["@theme/white_knight"]=new e(1,b+"images/cinco-de-mayo/white_knight",6408,3980),s["@theme/white_king"]=new e(1,b+"images/cinco-de-mayo/white_king",6211,4250),s["@theme/white_bishop"]=new e(1,b+"images/cinco-de-mayo/white_bishop",4074,2646),s["@theme/intro"]=new e(1,b+"images/cinco-de-mayo/intro",118259,57924),s["@theme/game_bg"]=new e(1,b+"images/cinco-de-mayo/game_bg",201146,13452),s["@theme/black_rook"]=new e(1,b+"images/cinco-de-mayo/black_rook",5322,3584),s["@theme/black_queen"]=new e(1,b+"images/cinco-de-mayo/black_queen",5287,2882),s["@theme/black_pawn"]=new e(1,b+"images/cinco-de-mayo/black_pawn",6457,5136),s["@theme/black_knight"]=new e(1,b+"images/cinco-de-mayo/black_knight",5561,4332),s["@theme/black_king"]=new e(1,b+"images/cinco-de-mayo/black_king",6122,4666),s["@theme/black_bishop"]=new e(1,b+"images/cinco-de-mayo/black_bishop",3951,2814),s["@theme/board"]=new e(2,b+"images/cinco-de-mayo/board",185942))),{null:"Not Applicable",0:"Easy",1:"Medium",2:"Hard",3:"Expert"});$e=k=k||{},$e[$e.None=0]="None",$e[$e.TenSeconds=1e4]="TenSeconds",$e[$e.FiveMinutes=3e5]="FiveMinutes",$e[$e.TenMinutes=6e5]="TenMinutes",$e[$e.FifteenMinutes=9e5]="FifteenMinutes",$e[$e.ThirtyMinutes=18e5]="ThirtyMinutes",$e[$e.OnlineGameTimeLimit=6e5]="OnlineGameTimeLimit";class Ii{constructor(e){this.time=0,this.takenPieces=[],this.kingMoved=!1,this.kingSideRookMoved=!1,this.queenSideRookMoved=!1,this.team=e}pack(){var e=new Array(5);return e[0]=this.time,e[1]=this.kingMoved,e[2]=this.kingSideRookMoved,e[3]=this.queenSideRookMoved,e[4]=this.takenPieces.slice(0),e}validate(t,i){if("object"!=typeof t||null===t)return this.validateError("data is not a valid object",i);if(5!==t.length)return this.validateError("data is incorrect length",i);if(!Number.isSafeInteger(t[0])||t[0]<0)return this.validateError("time invalid",i);if("boolean"!=typeof t[1])return this.validateError("kingMoved invalid",i);if("boolean"!=typeof t[2])return this.validateError("kingSideRookMoved invalid",i);if("boolean"!=typeof t[3])return this.validateError("queenSideRookMoved invalid",i);if("object"!=typeof t[4]||null===t[4])return this.validateError("takenPieces invalid",i);if(!Number.isSafeInteger(t[4].length))return this.validateError("takenPieces length invalid",i);if(t[4].length<0||15<t[4].length)return this.validateError("takenPieces length range invalid",i);var s=[0,1,2,3,4];for(let e=0;e<t[4].length;++e)if(s.indexOf(t[4][e])<0)return this.validateError("takenPieces has invalid value!",i);return!0}validateError(e,t){return t&&console.log("TeamState.validate error: "+e),!1}unpack(t){this.time=t[0],this.kingMoved=t[1],this.kingSideRookMoved=t[2],this.queenSideRookMoved=t[3],this.takenPieces.length=0;for(let e=0;e<t[4].length;++e)this.takenPieces.push(t[4][e])}matches(t,i){if(this.kingMoved!==t[1])return this.matchesError("kingMoved",i);if(this.kingSideRookMoved!==t[2])return this.matchesError("kingSideRookMoved",i);if(this.queenSideRookMoved!==t[3])return this.matchesError("queenSideRookMoved",i);if(t[4].length!==this.takenPieces.length)return this.matchesError("takenPieces length differs",i);for(let e=0;e<t[4].length;++e)if(this.takenPieces[e]!==t[4][e])return this.matchesError("takenPieces contents differ",i);return!0}matchesError(e,t){return t&&console.log("TeamState.matches error: "+e),!1}copy(t){this.team=t.team,this.time=t.time,this.takenPieces.length=t.takenPieces.length;for(let e=0;e<this.takenPieces.length;++e)this.takenPieces[e]=t.takenPieces[e];this.kingMoved=t.kingMoved,this.kingSideRookMoved=t.kingSideRookMoved,this.queenSideRookMoved=t.queenSideRookMoved}}const Gi=[["P","N","B","R","Q","K"],["p","n","b","r","q","k"]],Ni=["Pawn","Knight","Bishop","Rook","Queen","King"];class zi{constructor(e,t,i,s){this.board=null,this.team=null,this.type=null,this.i=null,this.cell=null,this.board=e,this.team=t,this.type=i,this.i=s}pack(){var e=new Array(2);return e[0]=this.type,e[1]=this.cell?this.cell.i:-1,e}validate(e,t){return"object"!=typeof e||null===e?this.validateError("data is not a valid object",t):2!==e.length?this.validateError("data is incorrect length",t):!Number.isSafeInteger(e[0])||e[0]<0||5<e[0]?this.validateError("type invalid",t):!(!Number.isSafeInteger(e[1])||e[1]<-1||64<=e[1])||this.validateError("cell_i invalid",t)}validateError(e,t){return t&&console.log("Piece.validate error: "+e),!1}unpack(e){this.type=e[0];let t=null;0<=e[1]&&(t=this.board.cells[e[1]]),t!==this.cell&&(this.cell&&(this.cell.piece=null,this.cell=null),t)&&(t.piece&&(t.piece.cell=null,t.piece=null),t.piece=this,this.cell=t)}matches(e,t){if(this.type!==e[0])return this.matchesError("type",t);let i=null;return 0<=e[1]&&(i=this.board.cells[e[1]]),this.cell===i||this.matchesError("cell_i",t)}matchesError(e,t){return t&&console.log("Piece.matches error: "+e),!1}}class Hi{constructor(e,t,i){this.board=null,this.r=null,this.c=null,this.i=null,this.piece=null,this.board=e,this.r=t,this.c=i,this.i=8*t+i}}class Ui{constructor(){this.grid=new Array(8),this.cells=[],this.pieces=[];for(let t=0;t<8;++t){var i=this.grid[t]=new Array(8);for(let e=0;e<8;++e)this.cells.push(i[e]=new Hi(this,t,e))}var t;for(t of[0,1]){for(let e=0;e<8;++e)this.pieces.push(new zi(this,t,0,this.pieces.length));for(let e=0;e<2;++e)this.pieces.push(new zi(this,t,1,this.pieces.length));for(let e=0;e<2;++e)this.pieces.push(new zi(this,t,2,this.pieces.length));for(let e=0;e<2;++e)this.pieces.push(new zi(this,t,3,this.pieces.length));for(let e=0;e<1;++e)this.pieces.push(new zi(this,t,4,this.pieces.length));for(let e=0;e<1;++e)this.pieces.push(new zi(this,t,5,this.pieces.length))}}pack(){var e,t=new Array(1);t[0]=new Array(this.pieces.length);for(e of this.pieces)t[0][e.i]=e.pack();return t}validate(e,t){if("object"!=typeof e||null===e)return this.validateError("data is not a valid object",t);if(1!==e.length)return this.validateError("data is incorrect length",t);if("object"!=typeof e[0]||null===e[0])return this.validateError("pieces is not a valid object",t);if(e[0].length!==this.pieces.length)return this.validateError("pieces is incorrect length",t);for(var i of this.pieces)if(!i.validate(e[0][i.i],t))return this.validateError("pieces validation failed",t);return!0}validateError(e,t){return t&&console.log("Board.validate error: "+e),!1}unpack(e){for(var t of this.pieces)t.cell=null;for(var i of this.cells)i.piece=null;for(var s of this.pieces)s.unpack(e[0][s.i])}matches(e,t){for(var i of this.pieces)if(!i.matches(e[0][i.i],t))return this.matchesError("pieces matching failed",t);return!0}matchesError(e,t){return t&&console.log("Board.matches error: "+e),!1}copy(t){for(let e=0;e<this.pieces.length;++e)this.pieces[e].type=t.pieces[e].type,this.pieces[e].cell=t.pieces[e].cell?this.cells[t.pieces[e].cell.i]:null;for(let e=0;e<this.cells.length;++e)this.cells[e].piece=t.cells[e].piece?this.pieces[t.cells[e].piece.i]:null}}class $i{constructor(e,t,i,s,n){if(this.gameMode=null,this.difficulty=null,this.timeLimit=k.None,this.firstPlayerWhite=!0,this.teams=[new Ii(0),new Ii(1)],this.board=new Ui,this.turnState=null,this.team=null,this.winner=null,this.iSrcLastMove=-1,this.iDestLastMove=-1,this.history=[],this.outcome=null,this.threefoldRule=!0,this.penalty=0,this.undoStack=[],0===arguments.length||4===e)this.gameMode=4,this.timeLimit=k.OnlineGameTimeLimit,this.threefoldRule=!0;else if(0===e)this.gameMode=e,this.difficulty=t,this.firstPlayerWhite=0===i,this.timeLimit=s,this.threefoldRule=n;else if(1===e)this.gameMode=e,this.firstPlayerWhite=0===t,this.timeLimit=i,this.threefoldRule=s;else{if(3!==e)throw new Error("Could not match constructor overload");this.gameMode=e;n=new H(t),i=[0,1,2,3],s=(this.difficulty=i[Math.floor(n.next()*i.length)],this.firstPlayerWhite=n.next()<.5,[k.FiveMinutes,k.TenMinutes,k.FifteenMinutes,k.ThirtyMinutes]);this.timeLimit=s[Math.floor(n.next()*s.length)],this.threefoldRule=n.next()<.5}}isPausable(){return 0===this.gameMode||1===this.gameMode}isHintAllowed(){return 0===this.gameMode||1===this.gameMode}isUndoAllowed(){return 0===this.gameMode||1===this.gameMode}pack(){var e=new Array(17);return e[0]=this.gameMode,e[1]=this.difficulty,e[2]=this.timeLimit,e[3]=this.firstPlayerWhite,e[4]=this.teams[0].pack(),e[5]=this.teams[1].pack(),e[6]=this.board.pack(),e[7]=this.turnState,e[8]=this.team,e[9]=this.winner,e[10]=this.iSrcLastMove,e[11]=this.iDestLastMove,e[12]=this.history.slice(),e[13]=this.outcome,e[14]=this.threefoldRule,e[15]=this.penalty,e[16]=this.undoStack,e}validate(t,i){if("object"!=typeof t||null===t)return this.validateError("data is not a valid object",i);if(17!==t.length)return this.validateError("data is incorrect length",i);if([0,4,1,3].indexOf(t[0])<0)return this.validateError("gameMode invalid",i);if(0===t[0]||3===t[0]){if([0,1,2,3].indexOf(t[1])<0)return this.validateError("difficulty invalid",i)}else if(null!==t[1])return this.validateError("difficulty should be null",i);if(4!==t[0]){if([k.None,k.TenSeconds,k.FiveMinutes,k.TenMinutes,k.FifteenMinutes,k.ThirtyMinutes].indexOf(t[2])<0)return this.validateError("timeLimit invalid",i)}else if(t[2]!==k.OnlineGameTimeLimit)return this.validateError("timeLimit invalid",i);if(4!==t[0]){if("boolean"!=typeof t[3])return this.validateError("firstPlayerWhite invalid",i)}else if(!0!==t[3])return this.validateError("firstPlayerWhite must be true in online games",i);if([0,1,9].indexOf(t[7])<0)return this.validateError("turnState invalid",i);if([0,1].indexOf(t[8])<0)return this.validateError("team invalid",i);if(9!==t[7]){if(null!==t[9])return this.validateError("winner invalid for current turn state",i)}else if([0,1,2].indexOf(t[9])<0)return this.validateError("winner invalid for GameOver game state",i);if(!Number.isSafeInteger(t[10])||t[10]<-1||64<=t[10])return this.validateError("iSrcLastMove invalid",i);if(!Number.isSafeInteger(t[11])||t[11]<-1||64<=t[11])return this.validateError("iDestLastMove invalid",i);if("object"!=typeof t[12]||null===t[12])return this.validateError("history is not a valid object",i);if("number"!=typeof t[12].length||t[12].length<0)return this.validateError("history is not a valid array",i);for(let e=0;e<t[12].length;++e)if("string"!=typeof t[12][e]||69!==t[12][e].length)return this.validateError("history entry is invalid",i);if(9!==t[7]){if(null!==t[13])return this.validateError("outcome invalid for current turn state",i)}else if([0,1,2,3,4].indexOf(t[13])<0)return this.validateError("outcome invalid for GameOver game state",i);if(4===t[0]){if(!0!==t[14])return this.validateError("threefoldRule invalid for online games",i)}else if("boolean"!=typeof t[14])return this.validateError("threefoldRule invalid type",i);if(4===t[0]){if(0!==t[15])return this.validateError("penalty invalid for online games",i)}else if(!Number.isSafeInteger(t[15]))return this.validateError("penalty invalid",i);return!!this.teams[0].validate(t[4],i)&&!!this.teams[1].validate(t[5],i)&&!!this.board.validate(t[6],i)}validateError(e,t){return t&&console.log("GameState.validate error: "+e),!1}unpack(s){this.gameMode=s[0],this.difficulty=s[1],this.timeLimit=s[2],this.firstPlayerWhite=s[3],this.turnState=s[7],this.team=s[8],this.iSrcLastMove=s[10],this.iDestLastMove=s[11],this.history=s[12].slice(),this.outcome=s[13],this.threefoldRule=s[14],this.penalty=s[15],this.undoStack.length=0;for(let i=0;i<s[16].length;++i)this.undoStack.push({whiteTakenPieces:s[16][i].whiteTakenPieces.slice(),whiteKingMoved:s[16][i].whiteKingMoved,whiteKingSideRookMoved:s[16][i].whiteKingSideRookMoved,whiteQueenSideRookMoved:s[16][i].whiteQueenSideRookMoved,blackTakenPieces:s[16][i].blackTakenPieces.slice(),blackKingMoved:s[16][i].blackKingMoved,blackKingSideRookMoved:s[16][i].blackKingSideRookMoved,blackQueenSideRookMoved:s[16][i].blackQueenSideRookMoved,board:function(){var t=[];for(let e=0;e<s[16][i].board[0].length;++e)t.push([s[16][i].board[0][e][0],s[16][i].board[0][e][1]]);return[t]}(),turnState:s[16][i].turnState,team:s[16][i].team,iSrcLastMove:s[16][i].iSrcLastMove,iDestLastMove:s[16][i].iDestLastMove});this.teams[0].unpack(s[4]),this.teams[1].unpack(s[5]),this.board.unpack(s[6])}matches(t,i){if(this.gameMode!==t[0])return this.matchesError("gameMode",i);if(this.difficulty!==t[1])return this.matchesError("difficulty",i);if(this.timeLimit!==t[2])return this.matchesError("timeLimit",i);if(this.firstPlayerWhite!==t[3])return this.matchesError("firstPlayerWhite",i);if(this.turnState!==t[7])return this.matchesError("turnState",i);if(this.team!==t[8])return this.matchesError("team",i);if(this.iSrcLastMove!==t[10])return this.matchesError("iSrcLastMove",i);if(this.iDestLastMove!==t[11])return this.matchesError("iDestLastMove",i);if(this.history.length!==t[12].length)return this.matchesError("history.length",i);for(let e=0;e<this.history.length;++e)if(this.history[e]!==t[12][e])return this.matchesError("history entry",i);return this.outcome!==t[13]?this.matchesError("outcome",i):this.threefoldRule!==t[14]?this.matchesError("threefoldRule",i):this.penalty!==t[15]?this.matchesError("penalty",i):!!this.teams[0].matches(t[4],i)&&!!this.teams[1].matches(t[5],i)&&!!this.board.matches(t[6],i)}matchesError(e,t){return t&&console.log("GameState.matches error: "+e),!1}copy(t){this.gameMode=t.gameMode,this.difficulty=t.difficulty,this.timeLimit=t.timeLimit,this.firstPlayerWhite=t.firstPlayerWhite,this.teams[0].copy(t.teams[0]),this.teams[1].copy(t.teams[1]),this.board.copy(t.board),this.turnState=t.turnState,this.team=t.team,this.winner=t.winner,this.iSrcLastMove=t.iSrcLastMove,this.iDestLastMove=t.iDestLastMove,this.history.length=t.history.length;for(let e=0;e<this.history.length;++e)this.history[e]=t.history[e];this.outcome=t.outcome,this.threefoldRule=t.threefoldRule,this.penalty=t.penalty,this.undoStack.length=t.undoStack.length;for(let e=0;e<this.undoStack.length;++e)this.undoStack[e]=t.undoStack[e];return this}pushState(){var e={whiteTakenPieces:this.teams[0].takenPieces.slice(),whiteKingMoved:this.teams[0].kingMoved,whiteKingSideRookMoved:this.teams[0].kingSideRookMoved,whiteQueenSideRookMoved:this.teams[0].queenSideRookMoved,blackTakenPieces:this.teams[1].takenPieces.slice(),blackKingMoved:this.teams[1].kingMoved,blackKingSideRookMoved:this.teams[1].kingSideRookMoved,blackQueenSideRookMoved:this.teams[1].queenSideRookMoved,board:this.board.pack(),turnState:this.turnState,team:this.team,iSrcLastMove:this.iSrcLastMove,iDestLastMove:this.iDestLastMove};for(this.undoStack.unshift(e);10<this.undoStack.length;)this.undoStack.pop()}popState(){var e=this.undoStack.shift();this.teams[0].takenPieces=e.whiteTakenPieces.slice(),this.teams[0].kingMoved=e.whiteKingMoved,this.teams[0].kingSideRookMoved=e.whiteKingSideRookMoved,this.teams[0].queenSideRookMoved=e.whiteQueenSideRookMoved,this.teams[1].takenPieces=e.blackTakenPieces.slice(),this.teams[1].kingMoved=e.blackKingMoved,this.teams[1].kingSideRookMoved=e.blackKingSideRookMoved,this.teams[1].queenSideRookMoved=e.blackQueenSideRookMoved,this.board.unpack(e.board),this.turnState=e.turnState,this.team=e.team,this.iSrcLastMove=e.iSrcLastMove,this.iDestLastMove=e.iDestLastMove,this.history.pop()}}class qi{constructor(){this.cells=new Uint8Array(64),this.kingsMoved=[0,0],this.kingSideRooksMoved=[0,0],this.queenSideRooksMoved=[0,0],this.iSrcLastMove=-1,this.iDestLastMove=-1,this.kingLocations=[0,0]}copyGameState(e){var t=e.board;for(let e=0;e<64;++e)null!==t.cells[e].piece?0===t.cells[e].piece.team?(5===t.cells[e].piece.type&&(this.kingLocations[0]=e),this.cells[e]=1+t.cells[e].piece.type):(5===t.cells[e].piece.type&&(this.kingLocations[1]=e),this.cells[e]=11+t.cells[e].piece.type):this.cells[e]=0;this.kingsMoved[0]=e.teams[0].kingMoved?1:0,this.kingSideRooksMoved[0]=e.teams[0].kingSideRookMoved?1:0,this.queenSideRooksMoved[0]=e.teams[0].queenSideRookMoved?1:0,this.kingsMoved[1]=e.teams[1].kingMoved?1:0,this.kingSideRooksMoved[1]=e.teams[1].kingSideRookMoved?1:0,this.queenSideRooksMoved[1]=e.teams[1].queenSideRookMoved?1:0,this.iSrcLastMove=e.iSrcLastMove,this.iDestLastMove=e.iDestLastMove}copy(t){for(let e=0;e<this.cells.length;++e)this.cells[e]=t.cells[e];this.kingsMoved[0]=t.kingsMoved[0],this.kingSideRooksMoved[0]=t.kingSideRooksMoved[0],this.queenSideRooksMoved[0]=t.queenSideRooksMoved[0],this.kingsMoved[1]=t.kingsMoved[1],this.kingSideRooksMoved[1]=t.kingSideRooksMoved[1],this.queenSideRooksMoved[1]=t.queenSideRooksMoved[1],this.iSrcLastMove=t.iSrcLastMove,this.iDestLastMove=t.iDestLastMove,this.kingLocations[0]=t.kingLocations[0],this.kingLocations[1]=t.kingLocations[1]}dump(){let i="";for(let t=0;t<8;++t){for(let e=0;e<8;++e)i+=this.cells[8*t+e]+",";i+="\n"}return i}}const Wi=[2,0,0,0,0,0,0,void 0,void 0,void 0,void 0,1,1,1,1,1,1],ji=["V","P","N","B","R","Q","K",void 0,void 0,void 0,void 0,"p","n","b","r","q","k"];class Vi{constructor(){this.type=0,this.iSrc=0,this.iDest=0,this.iCapture=-1,this.isPromotion=!1,this.aiPromoteTo=null}clone(){var e=new Vi;return e.type=this.type,e.iSrc=this.iSrc,e.iDest=this.iDest,e.iCapture=this.iCapture,e.isPromotion=this.isPromotion,e.aiPromoteTo=this.aiPromoteTo,e}copy(e){return this.type=e.type,this.iSrc=e.iSrc,this.iDest=e.iDest,this.iCapture=e.iCapture,this.isPromotion=e.isPromotion,this.aiPromoteTo=e.aiPromoteTo,this}}Vi.pool=new N;class Yi{constructor(){this.count=0,this.list=[]}add(e,t,i,s){this.count>=this.list.length&&this.list.push(new Vi);var n=this.list[this.count];n.type=e,n.iSrc=t,n.iDest=i,0===e?(n.iCapture=-1,n.isPromotion=s||!1):2===e?(n.iCapture=i,n.isPromotion=s||!1):(n.iCapture=3===e?s:-1,n.isPromotion=!1),this.count++}addEvalMove(e){this.count>=this.list.length&&this.list.push(new Vi);var t=this.list[this.count];t.iCapture=e.iCapture,t.iSrc=e.iSrc,t.iDest=e.iDest,t.isPromotion=e.isPromotion,t.type=e.type,this.count++}clear(){this.count=0}getDumpList(){var t=[];for(let e=0;e<this.count;++e)t.push(this.list[e].clone());return t}}const M=new class{constructor(){this._board=new qi,this._testBoard=new qi,this._moves=new Yi,this._allowedMoves=new Yi}newGame(e,t){return this.layoutBoard(e.board),this.resetTeamState(e.teams[0]),this.resetTeamState(e.teams[1]),e.turnState=0,e.team=0,e.winner=null,e.outcome=null,e.penalty=0,e.iSrcLastMove=-1,e.iDestLastMove=-1,e.undoStack.length=0,e.history.length=0,this._board.copyGameState(e),e.history.push(this.genHistoryKey(0,this._board)),!0}isGameStarted(e){return 2<=e.history.length}isGameOver(e){return 9===e.turnState}canSetActivePiece(e,t,i,s){return 0!==e.turnState?this.error("turn state invalid",s):i!==e.team?this.error("team invalid got "+i+" expected "+e.team,s):Number.isSafeInteger(t)?!(t<-1||64<=t)||this.error("cellIndex out of range",s):this.error("cellIndex invalid",s)}timeUp(e,t,i){return 0===e.turnState&&t===e.team&&e.timeLimit!==k.None&&(e.teams[t].time=e.timeLimit,e.outcome=4,e.winner=0===e.team?1:0,e.team=2,e.turnState=9,!0)}move(i,s,t,n,o,r,a,e,h){if(0!==i.turnState)return this.error("turn state incorrect",h);if(s!==i.team)return this.error("team incorrect expected "+i.team+" got "+s,h);if(!Number.isSafeInteger(e))return this.error("team time no safe integer",h);if(e<0||e<i.teams[s].time)return this.error("team time less than 0 or less than current time",h);if(i.timeLimit!==k.None&&e>=i.timeLimit)return this.error("time limit exceeded",h);if(!Number.isSafeInteger(n)||n<0||64<=n)return this.error("iSrc invalid",h);if(!i.board.cells[n].piece||i.board.cells[n].piece.team!==s)return this.error("iSrc wasnt a piece for this team",h);var l=this.getMoves(i);let d=null;for(let e=0;e<l.count&&(d=l.list[e],d.type!==t||d.iSrc!==n||d.iDest!==o||d.iCapture!==r||d.isPromotion!==a);++e)d=null;if(!d)return this.error("could not find matching move",h);if(i.teams[s].time=e,0===t){h=i.board.cells[n].piece;this.removePiece(i.board.cells[n]),this.setPiece(i.board.cells[o],h),5===h.type?i.teams[s].kingMoved=!0:3===h.type&&(0===s?56===n?i.teams[s].queenSideRookMoved=!0:63===n&&(i.teams[s].kingSideRookMoved=!0):0===n?i.teams[s].queenSideRookMoved=!0:7===n&&(i.teams[s].kingSideRookMoved=!0))}else if(2===t||3===t){e=i.board.cells[r].piece;this.removePiece(i.board.cells[r]),i.teams[s].takenPieces.push(e.type),e=i.board.cells[n].piece,this.removePiece(i.board.cells[n]),this.setPiece(i.board.cells[o],e),5===e.type?i.teams[s].kingMoved=!0:3===e.type&&(0===s?56===n?i.teams[s].queenSideRookMoved=!0:63===n&&(i.teams[s].kingSideRookMoved=!0):0===n?i.teams[s].queenSideRookMoved=!0:7===n&&(i.teams[s].kingSideRookMoved=!0))}else{let e=null,t=null;t=o<n?0===s?(e=56,59):(e=0,3):0===s?(e=63,61):(e=7,5);h=i.board.cells[n].piece;this.removePiece(i.board.cells[n]),this.setPiece(i.board.cells[o],h),h=i.board.cells[e].piece,this.removePiece(i.board.cells[e]),this.setPiece(i.board.cells[t],h),i.teams[s].kingMoved=!0,0===s?56===e?i.teams[s].queenSideRookMoved=!0:63===e&&(i.teams[s].kingSideRookMoved=!0):0===e?i.teams[s].queenSideRookMoved=!0:7===e&&(i.teams[s].kingSideRookMoved=!0)}return i.iSrcLastMove=n,i.iDestLastMove=o,a?i.turnState=1:this.advanceTurnState(i),!0}promote(e,t,i){return 1===e.turnState&&t===e.team&&(4===i||3===i||2===i||1===i)&&!(!e.board.cells[e.iDestLastMove].piece||0!==e.board.cells[e.iDestLastMove].piece.type||(t=e.board.cells[e.iDestLastMove].piece,t.type=i,this.advanceTurnState(e),0))}isTeamInCheck(e,t){return this._board.copyGameState(e),this.isUnderAttack(this._board,this._board.kingLocations[t],0===t?1:0)}advanceTurnState(e){e.team=0===e.team?1:0,e.turnState=0;var t=this.getMoves(e);this.isCheckmate(this._board,t,e.team)?(e.outcome=0,e.winner=0===e.team?1:0,e.team=2,e.turnState=9):this.isStalemate(t)?(e.outcome=1,e.winner=2,e.team=2,e.turnState=9):this.isTwoKingsDraw(this._board)?(e.outcome=2,e.winner=2,e.team=2,e.turnState=9):e.threefoldRule&&this.isThreefoldDraw(e,this._board)?(e.outcome=3,e.winner=2,e.team=2,e.turnState=9):e.history.push(this.genHistoryKey(e.team,this._board))}isCheckmate(e,t,i){return 0===t.count&&this.isUnderAttack(e,e.kingLocations[i],0===i?1:0)}isStalemate(e){return 0===e.count}isTwoKingsDraw(t){for(let e=0;e<t.cells.length;++e)if(0!==t.cells[e]&&t.cells[e]%10!=6)return!1;return!0}isThreefoldDraw(t,e){var i=this.genHistoryKey(t.team,e);let s=1;for(let e=0;e<t.history.length;++e)t.history[e]===i&&s++;return 3<=s}getMoves(t){if(0!==t.turnState)throw new Error("Not in a Moving turn state");this._board.copyGameState(t),this._moves.clear(),this._allowedMoves.clear();for(let e=0;e<64;++e)if(Wi[this._board.cells[e]]===t.team){var i=this._board.cells[e];if(i%10==1)this.getPawnMoves(this._board,e,i,this._moves);else if(i%10==2)this.getKnightMoves(this._board,e,i,this._moves);else if(i%10==3)this.getBishopMoves(this._board,e,i,this._moves);else if(i%10==4)this.getRookMoves(this._board,e,i,this._moves);else if(i%10==5)this.getQueenMoves(this._board,e,i,this._moves);else{if(i%10!=6)throw new Error("Cannot move piece type: "+i);this.getKingMoves(this._board,e,i,this._moves)}}var s=0===t.team?1:0;let n=!1,o=!1;for(let e=0;e<this._moves.count;++e)this._testBoard.copy(this._board),this.doEvalMove(this._testBoard,this._moves.list[e]),this.isUnderAttack(this._testBoard,this._testBoard.kingLocations[t.team],s)||1===this._moves.list[e].type&&(n||(o=this.isUnderAttack(this._board,this._board.kingLocations[t.team],s),n=!0),o||this.isUnderAttack(this._board,(this._moves.list[e].iSrc+this._moves.list[e].iDest)/2,s))||this._allowedMoves.addEvalMove(this._moves.list[e]);return this._allowedMoves}getPawnMoves(e,t,i,s){var n=e.cells,o=Wi[i],r=0===o?1:0,a=0===o?6:1,h=0===o?3:4,o=0===o?0:7,l=Math.floor(t/8),d=t%8,i=11===i?1:-1,c=0<=e.iDestLastMove?Math.floor(e.iDestLastMove/8):-1,u=0<=e.iDestLastMove?e.iDestLastMove%8:-1,p=d,m=l+i,g=8*m+p;0<=m&&m<8&&0===n[g]&&s.add(0,t,g,m===o),p=d,m=l+2*i,g=8*m+p,l===a&&0===n[8*(l+i)+d]&&0===n[g]&&s.add(0,t,g,!1),p=d-1,m=l+i,g=8*m+p,0<=m&&m<8&&0<=p&&p<8&&Wi[n[g]]===r&&s.add(2,t,g,m===o),p=1+d,m=l+i,g=8*m+p,0<=m&&m<8&&0<=p&&p<8&&Wi[n[g]]===r&&s.add(2,t,g,m===o),c===h&&n[e.iDestLastMove]===10*r+1&&16===Math.abs(e.iDestLastMove-e.iSrcLastMove)&&(p=d-1,m=l+i,g=8*m+p,0<=m&&m<8&&0<=p&&p<8&&c===l&&u==p&&s.add(3,t,g,e.iDestLastMove),p=1+d,m=l+i,g=8*m+p,0<=m)&&m<8&&0<=p&&p<8&&c===l&&u==p&&s.add(3,t,g,e.iDestLastMove)}getKnightMoves(e,t,i,s){var e=e.cells,i=Wi[i],i=0===i?1:0,n=Math.floor(t/8),o=t%8,r=1+o,a=n-2,h=8*a+r;0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h)),r=2+o,a=n-1,h=8*a+r,0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h)),r=2+o,a=n+1,h=8*a+r,0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h)),r=1+o,a=n+2,h=8*a+r,0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h)),r=o-1,a=n+2,h=8*a+r,0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h)),r=o-2,a=n+1,h=8*a+r,0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h)),r=o-2,a=n-1,h=8*a+r,0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h)),r=o-1,a=n-2,h=8*a+r,0<=a&&a<8&&0<=r&&r<8&&(0===e[h]?s.add(0,t,h):Wi[e[h]]===i&&s.add(2,t,h))}getBishopMoves(e,n,t,o){var r,a,h,l=e.cells,e=Wi[t],d=0===e?1:0,c=Math.floor(n/8),u=n%8;for(let s=-1;s<=1;s+=2)for(let i=-1;i<=1;i+=2){let t=!0;for(let e=1;t&&e<=7;++e)t=!1,a=u+e*i,r=c+e*s,h=8*r+a,0<=r&&r<8&&0<=a&&a<8&&(0===l[h]?(o.add(0,n,h),t=!0):Wi[l[h]]===d&&o.add(2,n,h))}}getRookMoves(e,o,t,r){var a,h,l,d=e.cells,e=Wi[t],c=0===e?1:0,u=Math.floor(o/8),p=o%8;for(let n=-1;n<=1;n+=1){let e=0,t=0,s=1;0===n&&(e=-1,t=1,s=2);for(let i=e;i<=t;i+=s){let t=!0;for(let e=1;t&&e<=7;++e)t=!1,h=p+e*i,a=u+e*n,l=8*a+h,0<=a&&a<8&&0<=h&&h<8&&(0===d[l]?(r.add(0,o,l),t=!0):Wi[d[l]]===c&&r.add(2,o,l))}}}getQueenMoves(e,n,t,o){var r,a,h,l=e.cells,e=Wi[t],d=0===e?1:0,c=Math.floor(n/8),u=n%8;for(let s=-1;s<=1;s+=1)for(let i=-1;i<=1;i+=1){let t=!0;for(let e=1;t&&e<=7;++e)t=!1,a=u+e*i,r=c+e*s,h=8*r+a,0<=r&&r<8&&0<=a&&a<8&&(0===l[h]?(o.add(0,n,h),t=!0):Wi[l[h]]===d&&o.add(2,n,h))}}getKingMoves(e,i,t,s){var n=e.cells,t=Wi[t],o=0===t?1:0,r=0===t?63:7,a=0===t?56:0,h=Math.floor(i/8),l=i%8;let d=0,c=0,u=0;for(let t=-1;t<=1;t+=1)for(let e=-1;e<=1;e+=1)c=l+ +e,d=h+ +t,u=8*d+c,0<=d&&d<8&&0<=c&&c<8&&(0===n[u]?s.add(0,i,u):Wi[n[u]]===o&&s.add(2,i,u));c=2+l,d=h,u=8*d+c,e.kingsMoved[t]||e.kingSideRooksMoved[t]||e.cells[r]%10!=4||0!==e.cells[8*h+l+1]||0!==e.cells[8*h+l+2]||s.add(1,i,u),c=l-2,d=h,u=8*d+c,e.kingsMoved[t]||e.queenSideRooksMoved[t]||e.cells[a]%10!=4||0!==e.cells[8*h+l-1]||0!==e.cells[8*h+l-2]||0!==e.cells[8*h+l-3]||s.add(1,i,u)}doEvalMove(i,e){var s=e.type,n=e.iSrc,o=e.iDest,e=e.iCapture,r=Wi[i.cells[n]];if(0===s){var t=i.cells[n];i.cells[n]=0,i.cells[o]=t,t%10==6?(i.kingsMoved[r]=1,i.kingLocations[r]=o):t%10==4&&(0===r?56===n?i.queenSideRooksMoved[r]=1:63===n&&(i.kingSideRooksMoved[r]=1):0===n?i.queenSideRooksMoved[r]=1:7===n&&(i.kingSideRooksMoved[r]=1))}else if(2===s||3===s){t=i.cells[n];i.cells[e]=0,i.cells[n]=0,i.cells[o]=t,t%10==6?(i.kingsMoved[r]=1,i.kingLocations[r]=o):t%10==4&&(0===r?56===n?i.queenSideRooksMoved[r]=1:63===n&&(i.kingSideRooksMoved[r]=1):0===n?i.queenSideRooksMoved[r]=1:7===n&&(i.kingSideRooksMoved[r]=1))}else{let e=null,t=null;t=o<n?0===r?(e=56,59):(e=0,3):0===r?(e=63,61):(e=7,5);s=i.cells[n];i.cells[n]=0,i.cells[o]=s,i.kingLocations[r]=o,s=i.cells[e],i.cells[e]=0,i.cells[t]=s,i.kingsMoved[r]=1,0===r?56===e?i.queenSideRooksMoved[r]=1:63===e&&(i.kingSideRooksMoved[r]=1):0===e?i.queenSideRooksMoved[r]=1:7===e&&(i.kingSideRooksMoved[r]=1)}i.iSrcLastMove=n,i.iDestLastMove=o}isUnderAttack(e,t,i){var s=Math.floor(t/8),n=t%8;let o=6,r=5,a=4,h=3,l=2,d=1,c=-1;if(1===i&&(o=16,r=15,a=14,h=13,l=12,d=11,c=1),this.isPiece(e,o,s-1,n-1)||this.isPiece(e,o,s-1,n)||this.isPiece(e,o,s-1,1+n)||this.isPiece(e,o,s,n-1)||this.isPiece(e,o,s,1+n)||this.isPiece(e,o,s+1,n-1)||this.isPiece(e,o,s+1,n)||this.isPiece(e,o,s+1,1+n))return!0;let u=0,p=0,m=0;for(p=s-1;0<=p;--p){if(u=e.cells[8*p+n],u===a||u===r)return!0;if(0!==u)break}for(p=s+1;p<8;++p){if(u=e.cells[8*p+n],u===a||u===r)return!0;if(0!==u)break}for(m=n-1;0<=m;--m){if(u=e.cells[8*s+m],u===a||u===r)return!0;if(0!==u)break}for(m=1+n;m<8;++m){if(u=e.cells[8*s+m],u===a||u===r)return!0;if(0!==u)break}for(p=s-1,m=n-1;0<=p&&0<=m;){if(u=e.cells[8*p+m],u===h||u===r)return!0;if(0!==u)break;p--,m--}for(p=s-1,m=1+n;0<=p&&m<=7;){if(u=e.cells[8*p+m],u===h||u===r)return!0;if(0!==u)break;p--,m++}for(p=s+1,m=n-1;p<=7&&0<=m;){if(u=e.cells[8*p+m],u===h||u===r)return!0;if(0!==u)break;p++,m--}for(p=s+1,m=1+n;p<=7&&m<=7;){if(u=e.cells[8*p+m],u===h||u===r)return!0;if(0!==u)break;p++,m++}return!!(this.isPiece(e,l,s-2,n-1)||this.isPiece(e,l,s-2,1+n)||this.isPiece(e,l,s+2,n-1)||this.isPiece(e,l,s+2,1+n)||this.isPiece(e,l,s-1,n-2)||this.isPiece(e,l,s-1,2+n)||this.isPiece(e,l,s+1,n-2)||this.isPiece(e,l,s+1,2+n))||!!this.isPiece(e,d,s-c,n-1)||!!this.isPiece(e,d,s-c,1+n)}genHistoryKey(e,t){let i="";i+=e,t.kingsMoved[0]||t.kingSideRooksMoved[0]&&t.queenSideRooksMoved[0]?i+="N":t.kingSideRooksMoved[0]||t.queenSideRooksMoved[0]?t.kingSideRooksMoved[0]?t.queenSideRooksMoved[0]||(i+="Q"):i+="K":i+="E",t.kingsMoved[1]||t.kingSideRooksMoved[1]&&t.queenSideRooksMoved[1]?i+="N":t.kingSideRooksMoved[1]||t.queenSideRooksMoved[1]?t.kingSideRooksMoved[1]?t.queenSideRooksMoved[1]||(i+="Q"):i+="K":i+="E",0<=t.iDestLastMove&&t.cells[t.iDestLastMove]%10==1&&t.iDestLastMove-t.iSrcLastMove==16?(i+=Math.floor(t.iDestLastMove/8),i+=t.iDestLastMove%8):i+="NN";for(let e=0;e<64;++e)i+=ji[t.cells[e]];if(69!==i.length)throw new Error("History key length incorrect!");return i}isPiece(e,t,i,s){return 0<=i&&0<=s&&i<8&&s<8&&e.cells[8*i+s]===t}resetTeamState(e){e.time=0,e.kingMoved=!1,e.kingSideRookMoved=!1,e.queenSideRookMoved=!1,e.takenPieces.length=0}clearBoard(e){for(var t of e.cells)t.piece&&this.removePiece(t)}layoutBoard(e){this.clearBoard(e),this.setPiece(e.grid[6][0],e.pieces[0]).type=0,this.setPiece(e.grid[6][1],e.pieces[1]).type=0,this.setPiece(e.grid[6][2],e.pieces[2]).type=0,this.setPiece(e.grid[6][3],e.pieces[3]).type=0,this.setPiece(e.grid[6][4],e.pieces[4]).type=0,this.setPiece(e.grid[6][5],e.pieces[5]).type=0,this.setPiece(e.grid[6][6],e.pieces[6]).type=0,this.setPiece(e.grid[6][7],e.pieces[7]).type=0,this.setPiece(e.grid[7][1],e.pieces[8]),this.setPiece(e.grid[7][6],e.pieces[9]),this.setPiece(e.grid[7][2],e.pieces[10]),this.setPiece(e.grid[7][5],e.pieces[11]),this.setPiece(e.grid[7][0],e.pieces[12]),this.setPiece(e.grid[7][7],e.pieces[13]),this.setPiece(e.grid[7][3],e.pieces[14]),this.setPiece(e.grid[7][4],e.pieces[15]),this.setPiece(e.grid[1][0],e.pieces[16]).type=0,this.setPiece(e.grid[1][1],e.pieces[17]).type=0,this.setPiece(e.grid[1][2],e.pieces[18]).type=0,this.setPiece(e.grid[1][3],e.pieces[19]).type=0,this.setPiece(e.grid[1][4],e.pieces[20]).type=0,this.setPiece(e.grid[1][5],e.pieces[21]).type=0,this.setPiece(e.grid[1][6],e.pieces[22]).type=0,this.setPiece(e.grid[1][7],e.pieces[23]).type=0,this.setPiece(e.grid[0][1],e.pieces[24]),this.setPiece(e.grid[0][6],e.pieces[25]),this.setPiece(e.grid[0][2],e.pieces[26]),this.setPiece(e.grid[0][5],e.pieces[27]),this.setPiece(e.grid[0][0],e.pieces[28]),this.setPiece(e.grid[0][7],e.pieces[29]),this.setPiece(e.grid[0][3],e.pieces[30]),this.setPiece(e.grid[0][4],e.pieces[31])}removePiece(e){if(null===e.piece)throw new Error("Cell already empty!");if(e.piece.cell!==e)throw new Error("Piece and cell mismatch!");e.piece.cell=null,e.piece=null}setPiece(e,t){if(null!==e.piece)throw new Error("Cell already as piece!");if(null!==t.cell)throw new Error("Piece already in another cell!");return e.piece=t,t.cell=e,t}error(e,t){return t&&console.log("Rules error: "+e),!1}},Xi=function(){let H="",U="",$="",q="";const W=-1,a=0,j=[0,0,0,0,0,0,0,0,1],V=1,Y=2,X=3;const J=6,f=1,_=2,h=3,w=4,l=5,K=6,r=7,d=8,c=9,u=10,p=11,y=12,Q=[0,K,f,_,h,w,l,0,0,y,r,d,c,u,p],Z=[0,2,3,4,5,6,1,10,11,12,13,14,9],v=0,ee=0,te=2,ie=3,se=5,ne=6,oe=7;const re=112,ae=114,he=115,le=117,de=118,ce=119,ue=120,o=["a8","b8","c8","d8","e8","f8","g8","h8","i8","j8","k8","l8","m8","n8","o8","p8","a7","b7","c7","d7","e7","f7","g7","h7","i7","j7","k7","l7","m7","n7","o7","p7","a6","b6","c6","d6","e6","f6","g6","h6","i6","j6","k6","l6","m6","n6","o6","p6","a5","b5","c5","d5","e5","f5","g5","h5","i5","j5","k5","l5","m5","n5","o5","p5","a4","b4","c4","d4","e4","f4","g4","h4","i4","j4","k4","l4","m4","n4","o4","p4","a3","b3","c3","d3","e3","f3","g3","h3","i3","j3","k3","l3","m3","n3","o3","p3","a2","b2","c2","d2","e2","f2","g2","h2","i2","j2","k2","l2","m2","n2","o2","p2","a1","b1","c1","d1","e1","f1","g1","h1","i1","j1","k1","l1","m1","n1","o1","p1"];let b=[u,d,c,p,y,c,d,u,13,13,13,13,13,13,13,13,r,r,r,r,r,r,r,r,13,13,13,13,13,13,13,13,v,v,v,v,v,v,v,v,13,13,13,13,13,13,13,13,v,v,v,v,v,v,v,v,13,13,13,13,13,13,13,13,v,v,v,v,v,v,v,v,13,13,13,13,13,13,13,13,v,v,v,v,v,v,v,v,13,13,13,13,13,13,13,13,f,f,f,f,f,f,f,f,13,13,13,13,13,13,13,13,w,_,h,l,K,h,_,w,13,13,13,13,13,13,13,13],k=a,x=ue,S=15,C=0,T=0,F=[116,4],P={[f]:0,[_]:0,[h]:0,[w]:0,[l]:0,[K]:0,[r]:0,[d]:0,[c]:0,[u]:0,[p]:0,[y]:0,pieces:new Array(130)},B=[],A=0,pe=0,t=1804289383;function i(){var e=t;return e^=e<<13,e^=e>>17,e^=e<<5,t=e,e}let E=new Array(1664),me=new Array(16),ge=0;function fe(){let t=0;for(let e=0;e<128;e++){var i;0==(136&e)&&(i=b[e],i!=v)&&(t^=E[128*i+e])}return k==a&&(t^=ge),x!=ue&&(t^=E[x]),t^=me[S],t}function _e(){for(let e=f;e<=y;e++)P[e]=0;for(let e=0;e<P.pieces.length;e++)P.pieces[e]=0;for(let e=0;e<128;e++){var t;0==(136&e)&&(t=b[e],t)&&(P.pieces[10*t+P[t]]=e,P[t]++)}}function s(t){var i=[],s=(Pe(i),t[0].charCodeAt(0)-"a".charCodeAt(0)+16*(8-(t[1].charCodeAt(0)-"0".charCodeAt(0)))),n=t[2].charCodeAt(0)-"a".charCodeAt(0)+16*(8-(t[3].charCodeAt(0)-"0".charCodeAt(0)));for(let e=0;e<i.length;e++){var o,r=i[e].move;if((127&r)==s&&L(r)==n&&(o=O(r),!o||(o==_||o==d)&&"n"==t[4]||(o==h||o==c)&&"b"==t[4]||(o==w||o==u)&&"r"==t[4]||(o==l||o==p)&&"q"==t[4]))return r}return 0}var e=[16,-16,1,-1,15,17,-15,-17];const we=[[],e,[],[33,31,18,14,-33,-31,-18,-14],[15,17,-15,-17],[16,-16,1,-1],e];function ye(i,t){for(let e=J;e>=V;e--){var s=e|t<<3;if(e==Y){var n=16*(1-2*t);for(let e=-1;e<=1;e+=2){var o=i+n+e;if(!(136&o)&&b[o]==Q[s])return 1}}else{var r=4&e,a=we[e];for(let t=0;t<a.length;t++){let e=i;do{if(e+=a[t],136&e)break;var h=b[e];if(h!==v){if(h==Q[s])return 1;break}}while(r)}}}return 0}function M(e,t,i,s,n,o,r){return e|t<<7|i<<14|s<<18|n<<19|o<<20|r<<21}function L(e){return e>>7&127}function O(e){return e>>14&15}function ve(e){return e>>18&1}function be(e){return e>>19&1}function ke(e){return e>>20&1}function xe(e){return e>>21&1}const Se=[96,16],Ce=[0,112],Te=[[1,2],[4,8]],Fe=[7,15,15,15,3,15,15,11,13,13,13,13,13,13,13,13,15,15,15,15,15,15,15,15,13,13,13,13,13,13,13,13,15,15,15,15,15,15,15,15,13,13,13,13,13,13,13,13,15,15,15,15,15,15,15,15,13,13,13,13,13,13,13,13,15,15,15,15,15,15,15,15,13,13,13,13,13,13,13,13,15,15,15,15,15,15,15,15,13,13,13,13,13,13,13,13,15,15,15,15,15,15,15,15,13,13,13,13,13,13,13,13,13,15,15,15,12,15,15,14,13,13,13,13,13,13,13,13];function R(e,t){let i=0;ve(t)?(i=et[13*b[127&t]+b[L(t)]],i+=1e4):i=N[A]==t?9e3:N[tt+A]==t?8e3:lt[128*b[127&t]+L(t)],e.push({move:t,score:i})}function Pe(i){for(let t=f;t<=y;t++)for(let e=0;e<P[t];e++){var s=P.pieces[10*t+e],n=Z[b[s]],o=7&n;if(j[8&n]==k){if(o==Y){var r=-16*(1-2*k);let t=s+r;if(0==(136&t)&&b[t]==v)if((240&t)==Ce[k])for(let e=J;e>=X;e--)R(i,M(s,t,Q[e|k<<3],0,0,0,0));else{R(i,M(s,t,0,0,0,0,0));var n=s+2*r;(240&s)==Se[k]&&b[n]==v&&R(i,M(s,n,0,0,1,0,0))}for(let e=-1;e<=1;e+=2)if(t=s+r+e,!(136&t)){var a=Z[b[t]];if(a!=v&&j[8&a]!=k)if((240&t)==Ce[k])for(let e=J;e>=X;e--)R(i,M(s,t,Q[e|k<<3],1,0,0,0));else R(i,M(s,t,0,1,0,0,0));t==x&&R(i,M(s,t,0,1,0,1,0))}}else o==V&&(n=F[k],S&Te[k][0]&&b[n+1]==v&&b[n+2]==v&&0==ye(n,1-k)&&0==ye(n+1,1-k)&&R(i,M(n,n+2,0,0,0,0,1)),S&Te[k][1])&&b[n-1]==v&&b[n-2]==v&&b[n-3]==v&&0==ye(n,1-k)&&0==ye(n-1,1-k)&&R(i,M(n,n-2,0,0,0,0,1));if(o!=Y){var h=4&o,l=we[o];for(let t=0;t<l.length;t++){let e=s;do{if(e+=l[t],136&e)break;var d=Z[b[e]];if(d!=v){j[8&d]!=k&&R(i,M(s,e,0,1,0,0,0));break}}while(R(i,M(s,e,0,0,0,0,0)),h)}}}}}function Be(t,i,s){b[s]=b[i],b[i]=v,T^=E[128*t+i],T^=E[128*t+s];for(let e=0;e<P[t];e++)if(P.pieces[10*t+e]==i){P.pieces[10*t+e]=s;break}}function Ae(t,i){let s;for(let e=0;e<P[t];e++)if(P.pieces[10*t+e]==i){s=e;break}P[t]--,P.pieces[10*t+s]=P.pieces[10*t+P[t]]}function Ee(e,t){b[t]=e,T^=E[128*e+t],P.pieces[10*e+P[e]]=t,P[e]++}function Me(e){A++,pe++,dt[pe]=T;var t=127&e,i=L(e),s=O(e),n=b[i];if(B.push({move:e,capturedPiece:0,side:k,enpassant:x,castle:S,fifty:C,hash:T}),Be(b[t],t,i),C++,ve(e)?(n&&(B[B.length-1].capturedPiece=n,T^=E[128*n+i],Ae(n,i)),C=0):b[i]!=f&&b[i]!=r||(C=0),x!=ue&&(T^=E[x]),x=ue,be(e))k==a?(x=i+16,T^=E[i+16]):(x=i-16,T^=E[i-16]);else if(ke(e))k==a?(b[i+16]=v,T^=E[128*r+i+16],Ae(r,i+16)):(b[i-16]=v,T^=E[128*f+(i-16)],Ae(f,i-16));else if(xe(e))switch(i){case de:Be(w,ce,le);break;case ae:Be(w,re,he);break;case ne:Be(u,oe,se);break;case te:Be(u,ee,ie)}return s&&(k==a?(T^=E[128*f+i],Ae(f,i)):(T^=E[128*r+i],Ae(r,i)),Ee(s,i)),b[i]!=K&&b[i]!=y||(F[k]=i),T^=me[S],S&=Fe[t],S&=Fe[i],T^=me[S],k^=1,T^=ge,ye(F[1^k],k)?(Le(),0):1}function Le(){A--,pe--;var e=B.length-1,t=B[e].move,i=127&t,s=L(t);if(Be(b[s],s,i),ve(t)&&Ee(B[e].capturedPiece,s),ke(t))k==a?Ee(f,s-16):Ee(r,s+16);else if(xe(t))switch(s){case de:Be(w,le,ce);break;case ae:Be(w,he,re);break;case ne:Be(u,se,oe);break;case te:Be(u,ie,ee)}else O(t)&&(k==a?Ee(r,i):Ee(f,i),Ae(O(t),i));b[i]!=K&&b[i]!=y||(F[1^k]=i),k=B[e].side,x=B[e].enpassant,S=B[e].castle,T=B[e].hash,C=B[e].fifty,B.pop()}let D=0;function n(t){D=0,console.log("   Performance test:\n");var i,e="",s=Date.now(),n=[];Pe(n);for(let e=0;e<n.length;e++)Me(n[e].move)&&(i=D,function t(i){if(0==i)D++;else{var s=[];Pe(s);for(let e=0;e<s.length;e++)Me(s[e].move)&&(t(i-1),Le())}}(t-1),Le(),i=D-i,console.log("   move "+(e+1)+(e<9?":  ":": ")+o[127&n[e].move]+o[L(n[e].move)]+(O(n[e].move)?bt[O(n[e].move)]:" ")+"    nodes: "+i));e+="\n   Depth: "+t,e+="\n   Nodes: "+D,e+="\n    Time: "+(Date.now()-s)+" ms\n",console.log(e)}const I=0,m=1,Oe=2,Re=0,De=1,Ie=2,Ge=3,Ne=4,ze=5,He=5900,Ue=500,$e=[[0,89,308,319,488,888,20001,-92,-307,-323,-492,-888,-20002],[0,96,319,331,497,853,19998,-102,-318,-334,-501,-845,-2e4]],g=[[[0,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13,-4,68,61,47,47,49,45,-1,13,13,13,13,13,13,13,13,6,16,25,33,24,24,14,-6,13,13,13,13,13,13,13,13,0,-1,9,28,20,8,-1,11,13,13,13,13,13,13,13,13,6,4,6,14,14,-5,6,-6,13,13,13,13,13,13,13,13,-1,-8,-4,4,2,-12,-1,5,13,13,13,13,13,13,13,13,5,16,16,-14,-14,13,15,8,13,13,13,13,13,13,13,13,0,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13],[-55,-40,-30,-28,-26,-30,-40,-50,13,13,13,13,13,13,13,13,-37,-15,0,-6,4,3,-17,-40,13,13,13,13,13,13,13,13,-25,5,16,12,11,6,6,-29,13,13,13,13,13,13,13,13,-24,5,21,14,18,9,11,-26,13,13,13,13,13,13,13,13,-36,-5,9,23,24,21,2,-24,13,13,13,13,13,13,13,13,-32,-1,4,19,20,4,11,-25,13,13,13,13,13,13,13,13,-38,-22,4,-1,8,-5,-18,-34,13,13,13,13,13,13,13,13,-50,-46,-32,-24,-36,-25,-34,-50,13,13,13,13,13,13,13,13],[-16,-15,-12,-5,-10,-12,-10,-20,13,13,13,13,13,13,13,13,-13,5,6,1,-6,-5,3,-6,13,13,13,13,13,13,13,13,-16,6,-1,16,7,-1,-6,-5,13,13,13,13,13,13,13,13,-14,-1,11,14,4,10,11,-13,13,13,13,13,13,13,13,13,-4,5,12,16,4,6,2,-16,13,13,13,13,13,13,13,13,-15,4,14,8,16,4,16,-15,13,13,13,13,13,13,13,13,-5,6,6,6,3,6,9,-7,13,13,13,13,13,13,13,13,-14,-4,-15,-4,-9,-4,-12,-14,13,13,13,13,13,13,13,13],[5,-2,6,2,-2,-6,4,-2,13,13,13,13,13,13,13,13,8,13,11,15,11,15,16,4,13,13,13,13,13,13,13,13,-6,3,3,6,1,-2,3,-5,13,13,13,13,13,13,13,13,-10,5,-4,-4,-1,-6,3,-2,13,13,13,13,13,13,13,13,-4,3,5,-2,4,1,-5,1,13,13,13,13,13,13,13,13,0,1,1,-3,5,6,1,-9,13,13,13,13,13,13,13,13,-10,-1,-4,0,5,-6,-6,-9,13,13,13,13,13,13,13,13,-1,-2,-6,9,9,5,4,-5,13,13,13,13,13,13,13,13],[-25,-9,-11,-3,-7,-13,-10,-17,13,13,13,13,13,13,13,13,-4,-6,4,-5,-1,6,4,-5,13,13,13,13,13,13,13,13,-8,-5,2,0,7,6,-4,-5,13,13,13,13,13,13,13,13,0,-4,7,-1,7,11,0,1,13,13,13,13,13,13,13,13,-6,4,7,1,-1,2,-6,-2,13,13,13,13,13,13,13,13,-15,11,11,11,4,11,6,-15,13,13,13,13,13,13,13,13,-5,-6,1,-6,3,-3,3,-10,13,13,13,13,13,13,13,13,-15,-4,-13,-8,-3,-16,-8,-24,13,13,13,13,13,13,13,13],[-30,-40,-40,-50,-50,-40,-40,-30,13,13,13,13,13,13,13,13,-30,-37,-43,-49,-50,-39,-40,-30,13,13,13,13,13,13,13,13,-32,-41,-40,-46,-49,-40,-46,-30,13,13,13,13,13,13,13,13,-32,-38,-39,-52,-54,-39,-39,-30,13,13,13,13,13,13,13,13,-20,-33,-29,-42,-44,-29,-30,-19,13,13,13,13,13,13,13,13,-10,-18,-17,-20,-22,-21,-20,-13,13,13,13,13,13,13,13,13,14,18,-1,-1,4,-1,15,14,13,13,13,13,13,13,13,13,21,35,11,6,1,14,32,22,13,13,13,13,13,13,13,13]],[[0,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13,-4,174,120,94,85,98,68,4,13,13,13,13,13,13,13,13,6,48,44,45,31,38,37,-6,13,13,13,13,13,13,13,13,-6,-4,-1,-6,2,-1,-2,-2,13,13,13,13,13,13,13,13,2,2,5,-3,0,-5,4,-3,13,13,13,13,13,13,13,13,-2,0,1,5,0,-1,0,1,13,13,13,13,13,13,13,13,-2,5,6,-6,0,3,4,-4,13,13,13,13,13,13,13,13,0,0,0,0,0,0,0,0,13,13,13,13,13,13,13,13],[-50,-40,-30,-24,-24,-35,-40,-50,13,13,13,13,13,13,13,13,-38,-17,6,-5,5,-4,-15,-40,13,13,13,13,13,13,13,13,-24,3,15,9,15,10,-6,-26,13,13,13,13,13,13,13,13,-29,5,21,17,18,9,10,-28,13,13,13,13,13,13,13,13,-36,-5,18,16,14,20,5,-26,13,13,13,13,13,13,13,13,-32,7,5,20,11,15,9,-27,13,13,13,13,13,13,13,13,-43,-20,5,-1,5,1,-22,-40,13,13,13,13,13,13,13,13,-50,-40,-32,-27,-30,-25,-35,-50,13,13,13,13,13,13,13,13],[-14,-13,-4,-7,-14,-9,-16,-20,13,13,13,13,13,13,13,13,-11,6,3,-6,4,-3,5,-4,13,13,13,13,13,13,13,13,-11,-3,5,15,4,-1,-5,-10,13,13,13,13,13,13,13,13,-7,-1,11,16,5,11,7,-13,13,13,13,13,13,13,13,13,-4,4,10,16,6,12,4,-16,13,13,13,13,13,13,13,13,-4,4,11,12,10,7,7,-12,13,13,13,13,13,13,13,13,-11,7,6,6,-3,2,1,-7,13,13,13,13,13,13,13,13,-15,-4,-11,-4,-10,-10,-6,-17,13,13,13,13,13,13,13,13],[5,-6,1,-4,-4,-6,6,-3,13,13,13,13,13,13,13,13,-6,4,2,5,-1,3,4,-15,13,13,13,13,13,13,13,13,-15,3,3,0,-1,-6,5,-9,13,13,13,13,13,13,13,13,-16,6,0,-6,-3,-3,-4,-4,13,13,13,13,13,13,13,13,-15,6,2,-6,6,0,-6,-10,13,13,13,13,13,13,13,13,-6,-1,3,-2,6,5,0,-15,13,13,13,13,13,13,13,13,-8,-4,1,-4,3,-5,-6,-5,13,13,13,13,13,13,13,13,1,0,-2,1,1,4,2,0,13,13,13,13,13,13,13,13],[-21,-7,-6,1,-8,-15,-10,-16,13,13,13,13,13,13,13,13,-4,-5,3,-4,2,6,3,-10,13,13,13,13,13,13,13,13,-13,-2,7,2,6,10,-4,-6,13,13,13,13,13,13,13,13,-1,-4,3,1,8,8,-2,-2,13,13,13,13,13,13,13,13,0,6,8,1,-1,1,0,-3,13,13,13,13,13,13,13,13,-11,10,6,3,7,9,4,-10,13,13,13,13,13,13,13,13,-12,-6,5,0,0,-5,4,-10,13,13,13,13,13,13,13,13,-20,-6,-7,-7,-4,-12,-9,-20,13,13,13,13,13,13,13,13],[-50,-40,-30,-20,-20,-30,-40,-50,13,13,13,13,13,13,13,13,-30,-18,-15,6,3,-6,-24,-30,13,13,13,13,13,13,13,13,-35,-16,20,32,34,14,-11,-30,13,13,13,13,13,13,13,13,-34,-5,24,35,34,35,-16,-35,13,13,13,13,13,13,13,13,-36,-7,31,34,34,34,-12,-31,13,13,13,13,13,13,13,13,-30,-7,14,33,36,16,-13,-33,13,13,13,13,13,13,13,13,-36,-27,5,2,5,-1,-31,-33,13,13,13,13,13,13,13,13,-48,-26,-26,-26,-28,-25,-30,-51,13,13,13,13,13,13,13,13]]],G=[re,113,ae,he,116,le,de,ce,13,13,13,13,13,13,13,13,96,97,98,99,100,101,102,103,13,13,13,13,13,13,13,13,80,81,82,83,84,85,86,87,13,13,13,13,13,13,13,13,64,65,66,67,68,69,70,71,13,13,13,13,13,13,13,13,48,49,50,51,52,53,54,55,13,13,13,13,13,13,13,13,32,33,34,35,36,37,39,40,13,13,13,13,13,13,13,13,16,17,18,19,20,21,22,23,13,13,13,13,13,13,13,13,ee,1,te,ie,4,se,ne,oe,13,13,13,13,13,13,13,13];function qe(){if(0==P[f]&&0==P[r])if(0==P[w]&&0==P[u]&&0==P[l]&&0==P[p]){if(0==P[h]&&0==P[c]){if(P[_]<3&&P[d]<3)return 1}else if(0==P[_]&&0==P[d]){if(Math.abs(P[h]-P[c])<2)return 1}else if((P[_]<3&&0==P[h]||1==P[h]&&0==P[_])&&(P[d]<3&&0==P[c]||1==P[c]&&0==P[d]))return 1}else if(0==P[l]&&0==P[p])if(1==P[w]&&1==P[u]){if(P[_]+P[h]<2&&P[d]+P[c]<2)return 1}else if(1==P[w]&&0==P[u]){if(P[_]+P[h]==0&&(P[d]+P[c]==1||P[d]+P[c]==2))return 1}else if(1==P[u]&&0==P[w]&&P[d]+P[c]==0&&(P[_]+P[h]==1||P[_]+P[h]==2))return 1;return 0}function We(){if(qe())return 0;var e=function(){let t=0;for(let e=_;e<=l;e++)t+=P[e]*$e[I][e];for(let e=d;e<=p;e++)t+=P[e]*-$e[I][e];return t}();let t=-1,i=(t=e>He?I:e<Ue?m:Oe,0),s=0,n=0;for(let t=f;t<=y;t++)for(let e=0;e<P[t];e++){var o=P.pieces[10*t+e];switch(s+=$e[I][t],n+=$e[m][t],t){case f:s+=g[I][Re][o],n+=g[m][Re][o];break;case _:s+=g[I][De][o],n+=g[m][De][o];break;case h:s+=g[I][Ie][o],n+=g[m][Ie][o];break;case w:s+=g[I][Ge][o],n+=g[m][Ge][o];break;case l:s+=g[I][Ne][o],n+=g[m][Ne][o];break;case K:s+=g[I][ze][o],n+=g[m][ze][o];break;case r:s-=g[I][Re][G[o]],n-=g[m][Re][G[o]];break;case d:s-=g[I][De][G[o]],n-=g[m][De][G[o]];break;case c:s-=g[I][Ie][G[o]],n-=g[m][Ie][G[o]];break;case u:s-=g[I][Ge][G[o]],n-=g[m][Ge][G[o]];break;case p:s-=g[I][Ne][G[o]],n-=g[m][Ne][G[o]];break;case y:s-=g[I][ze][G[o]],n-=g[m][ze][G[o]]}}return t==Oe?i=(s*e+n*(He-e))/He:t==I?i=s:t==m&&(i=n),i=i*(100-C)/100<<0,k==a?i:-i}let je=838860;const Ve=1e5,Ye=0,Xe=1,Je=2;let Ke=[];function Qe(){for(let e=0;e<je;e++)Ke[e]={hashKey:0,depth:0,flag:0,score:0,bestMove:0}}function Ze(e,t,i,s){var n=Ke[(2147483647&T)%je];e<-st&&(e-=A),e>st&&(e+=A),n.hashKey=T,n.score=e,n.flag=s,n.depth=i,n.bestMove=t}const et=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,105,205,305,405,505,605,105,205,305,405,505,605,0,104,204,304,404,504,604,104,204,304,404,504,604,0,103,203,303,403,503,603,103,203,303,403,503,603,0,102,202,302,402,502,602,102,202,302,402,502,602,0,101,201,301,401,501,601,101,201,301,401,501,601,0,100,200,300,400,500,600,100,200,300,400,500,600,0,105,205,305,405,505,605,105,205,305,405,505,605,0,104,204,304,404,504,604,104,204,304,404,504,604,0,103,203,303,403,503,603,103,203,303,403,503,603,0,102,202,302,402,502,602,102,202,302,402,502,602,0,101,201,301,401,501,601,101,201,301,401,501,601,0,100,200,300,400,500,600,100,200,300,400,500,600],tt=64,it=49e3,st=48e3,nt=1,ot=0;let rt,at=new Array(tt*tt),ht=new Array(tt),N=new Array(2*tt),lt=new Array(1664),dt=new Array(1e3),z={timeSet:0,stopTime:0,stopped:0,time:-1};function ct(){z={timeSet:0,stopTime:0,stopped:0,time:-1}}function ut(){D=0,z.stopped=0,A=0;for(let e=0;e<at.length;e++)at[e]=0;for(let e=0;e<ht.length;e++)ht[e]=0;for(let e=0;e<N.length;e++)N[e]=0;for(let e=0;e<lt.length;e++)lt[e]=0}function pt(){1==z.timeSet&&Date.now()>z.stopTime&&(z.stopped=1)}function mt(){for(let e=0;e<pe;e++)if(dt[e]==T)return 1;return 0}function gt(t,i){for(let e=t+1;e<i.length;e++){var s;i[t].score<i[e].score&&(s=i[t],i[t]=i[e],i[e]=s)}}function ft(t,i){for(let e=0;e<t.length;e++)if(t[e].move==i.value)return void(t[e].score=3e4);if(A&&rt){rt=0;for(let e=0;e<t.length;e++)if(t[e].move==at[A]){rt=1,t[e].score=2e4;break}}}function _t(e){at[64*A+A]=e;for(let e=A+1;e<ht[A+1];e++)at[64*A+e]=at[64*(A+1)+e];ht[A]=ht[A+1]}function wt(t,i){if(ht[A]=A,D++,0==(2047&D)&&(pt(),1==z.stopped))return 0;if(A>tt-1)return We();var e=We();if(i<=e)return i;t<e&&(t=e);var s=[],n=s;for(let t=f;t<=y;t++)for(let e=0;e<P[t];e++){var o=P.pieces[10*t+e],r=Z[b[o]],a=7&r;if(j[8&r]==k){if(a==Y){var h,l=-16*(1-2*k);for(let e=-1;e<=1;e+=2)if(h=o+l+e,!(136&h)){var d=Z[b[h]];if(d!=v&&j[8&d]!=k)if((240&h)==Ce[k])for(let e=J;e>=X;e--)R(n,M(o,h,Q[e|k<<3],1,0,0,0));else R(n,M(o,h,0,1,0,0,0));h==x&&R(n,M(o,h,0,1,0,1,0))}}if(a!=Y){var c=4&a,u=we[a];for(let t=0;t<u.length;t++){let e=o;do{if(e+=u[t],136&e)break;var p=Z[b[e]];if(p!=v){j[8&p]!=k&&R(n,M(o,e,0,1,0,0,0));break}}while(c)}}}}ft(s,{value:0});for(let e=0;e<s.length;e++){gt(e,s);var m=s[e].move;if(0!=Me(m)){var g=-wt(-i,-t);if(Le(),1==z.stopped)return 0;if(t<g&&(_t(m),t=g,i<=g))return i}}return t}function yt(s,n,o,e){ht[A]=A;var r={value:0};let a=Xe,h=0;var l=1<n-s?1:0;let d=0;if(A&&(h=function(t,i,e,s){var n=Ke[(2147483647&T)%je];if(n.hashKey==T){if(n.depth>=s){let e=n.score;if(e<-st&&(e+=A),e>st&&(e-=A),n.flag==Ye)return e;if(n.flag==Xe&&e<=t)return t;if(n.flag==Je&&e>=i)return i}e.value=n.bestMove}return Ve}(s,n,r,o))!=Ve&&0==l)return h;if(0==(2047&D)&&(pt(),1==z.stopped))return 0;if(A&&mt()||100<=C)return 0;if(0==o)return D++,wt(s,n);if(s<-it&&(s=-it),n>it-1&&(n=it-1),!(n<=s)){let t=0;var c=ye(F[k],1^k);if(c&&o++,0==c&&0==l){var u=We();if(o<3&&Math.abs(n-1)>100-it){var p=$e[I][f]*o;if(n<=u-p)return u-p}if(e){if(A&&2<o&&n<=u){if(B.push({move:0,capturedPiece:0,side:k,enpassant:x,castle:S,fifty:C,hash:T}),x!=ue&&(T^=E[x]),x=ue,C=0,k^=1,T^=ge,h=-yt(-n,1-n,o-1-2,ot),k=B[B.length-1].side,x=B[B.length-1].enpassant,S=B[B.length-1].castle,C=B[B.length-1].fifty,T=B[B.length-1].hash,B.pop(),1==z.stopped)return 0;if(h>=n)return n}h=u+$e[I][f];let e;if(h<n&&1==o)return e=wt(s,n),e>h?e:h;if(h+=$e[I][f],h<n&&o<4&&(e=wt(s,n),e<n))return e>h?e:h}p=[0,$e[I][f],$e[I][_],$e[I][w]];o<4&&Math.abs(s)<st&&u+p[o]<=s&&(d=1)}let i=0;var m=[];Pe(m),ft(m,r);for(let e=0;e<m.length;e++){gt(e,m);var g=m[e].move;if(0!=Me(g))if(t++,d&&i&&0==ve(g)&&0==O(g)&&0==ye(F[k],1^k))Le();else{if((0==i||(h=!(0==l&&3<i&&2<o&&0==c)||(127&g)==(127&N[A])&&L(g)==L(N[A])||(127&g)==(127&N[tt+A])&&L(g)==L(N[tt+A])||0!=ve(g)||0!=O(g)?s+1:-yt(-s-1,-s,o-2,nt),h>s&&(h=-yt(-s-1,-s,o-1,nt),h>s)&&h<n))&&(h=-yt(-n,-s,o-1,nt)),Le(),i++,1==z.stopped)return 0;if(h>s&&(a=Ye,r.value=g,s=h,_t(g),0==ve(g)&&(lt[128*b[127&g]+L(g)]+=o),h>=n))return Ze(n,r.value,o,Je),0==ve(g)&&(N[tt+A]=N[A],N[A]=g),n}}if(0==t)return c?-it+A:0;Ze(s,r.value,o,a)}return s}function vt(t){var i,s=Date.now();let n=0;ut();for(let e=1;e<=t&&(n=at[0],rt=1,i=yt(-5e4,5e4,e,nt),!(1==z.stopped||Date.now()>z.stopTime&&-1!=z.time));e++){let t="";t=i>=-it&&i<=-st?"info score mate "+Math.trunc(-(i+it)/2-1)+" depth "+e+" nodes "+D+" time "+(Date.now()-s)+" pv ":i>=st&&i<=it?"info score mate "+Math.trunc((it-i)/2+1)+" depth "+e+" nodes "+D+" time "+(Date.now()-s)+" pv ":"info score cp "+i+" depth "+e+" nodes "+D+" time "+(Date.now()-s)+" pv ";for(let e=0;e<ht[0];e++)t+=Ct(at[e])+" ";if(t.includes("mate")||t.includes("-49000"))break}var e=1==z.stopped?n:at[0];return e}const bt={[l]:"q",[w]:"r",[h]:"b",[_]:"n",[p]:"q",[u]:"r",[c]:"b",[d]:"n"},kt={P:f,N:_,B:h,R:w,Q:l,K:K,p:r,n:d,b:c,r:u,q:p,k:y},xt=["--","WP","WN","WB","WR","WQ","WK","Bp","Bn","Bb","Br","Bq","Bk"];function St(i){for(let t=0;t<8;t++)for(let e=0;e<16;e++){var s=16*t+e;0==(136&s)&&(b[s]=v)}k=W,x=ue,S=0,C=0,T=0,F=[0,0],B=[],A=0,pe=0;for(let e=0;e<dt.length;++e)dt[e]=0;let n=0;for(let t=0;t<8;t++)for(let e=0;e<16;e++){var o,r=16*t+e;0==(136&r)&&((i[n].charCodeAt(0)>="a".charCodeAt(0)&&i[n].charCodeAt(0)<="z".charCodeAt(0)||i[n].charCodeAt(0)>="A".charCodeAt(0)&&i[n].charCodeAt(0)<="Z".charCodeAt(0))&&("K"==i[n]?F[a]=r:"k"==i[n]&&(F[1]=r),b[r]=kt[i[n]],n++),i[n].charCodeAt(0)>="0".charCodeAt(0)&&i[n].charCodeAt(0)<="9".charCodeAt(0)&&(o=i[n].charCodeAt(0)-"0".charCodeAt(0),b[r]||e--,e+=o,n++),"/"==i[n])&&n++}for(n++,k="w"==i[n]?a:1,n+=2;" "!=i[n];){switch(i[n]){case"K":S|=1;break;case"Q":S|=2;break;case"k":S|=4;break;case"q":S|=8}n++}var e,t;n++,x="-"!=i[n]?(e=i[n].charCodeAt(0)-"a".charCodeAt(0),t=8-(i[n+1].charCodeAt(0)-"0".charCodeAt(0)),16*t+e):ue,C=parseInt(i.slice(n,i.length-1).split(" ")[1]),pe=2*parseInt(i.slice(n,i.length+1).split(" ")[2]),T=fe(),_e()}function Ct(e){return O(e)?o[127&e]+o[L(e)]+bt[O(e)]:o[127&e]+o[L(e)]}for(let e=0;e<1664;e++)E[e]=i();for(let e=0;e<16;e++)me[e]=i();ge=i(),T=fe(),_e(),Qe();let Tt={VERSION:"1.5a",ELO:"1920",START_FEN:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1 ",COLOR:{WHITE:a,BLACK:1},PIECE:{NO_PIECE:v,WHITE_PAWN:f,WHITE_KNIGHT:_,WHITE_BISHOP:h,WHITE_ROOK:w,WHITE_QUEEN:l,WHITE_KING:K,BLACK_PAWN:r,BLACK_KNIGHT:d,BLACK_BISHOP:c,BLACK_ROOK:u,BLACK_QUEEN:p,BLACK_KING:y},SQUARE:{A8:ee,B8:1,C8:te,D8:ie,E8:4,F8:se,G8:ne,H8:oe,A7:16,B7:17,C7:18,D7:19,E7:20,F7:21,G7:22,H7:23,A6:32,B6:33,C6:34,D6:35,E6:36,F6:37,G6:39,H6:40,A5:48,B5:49,C5:50,D5:51,E5:52,F5:53,G5:54,H5:55,A4:64,B4:65,C4:66,D4:67,E4:68,F4:69,G4:70,H4:71,A3:80,B3:81,C3:82,D3:83,E3:84,F3:85,G3:86,H3:87,A2:96,B2:97,C2:98,D2:99,E2:100,F2:101,G2:102,H2:103,A1:re,B1:113,C1:ae,D1:he,E1:116,F1:le,G1:de,H1:ce},perft:function(e){n(e)},squareToString:function(e){return o[e]},promotedToString:function(e){return bt[e]},printBoard:function(){{let i="";for(let t=0;t<8;t++){for(let e=0;e<16;e++){var s=16*t+e;0==e&&(i+="   "+(8-t).toString()+"  "),0==(136&s)&&(i+=xt[b[s]]+"  ")}i+="\n"}i+="      a   b   c   d   e   f   g   h",i+="\n\n     Side:     "+(0==k?"white":"black"),i+="\n     Castling:  "+(1&S?"K":"-")+(2&S?"Q":"-")+(4&S?"k":"-")+(8&S?"q":"-"),i+="\n     Ep:          "+(x==ue?"no":o[x]),i+="\n\n     Key: "+T,i+="\n 50 rule:          "+C,i+="\n   moves:          "+(pe%2?Math.round(pe/2)-1:Math.round(pe/2)),console.log(i+"\n"),Qe()}},setBoard:function(e){St(e)},generateFen:function(){{var n=["","P","N","B","R","Q","K","p","n","b","r","q","k"];let s="";for(let i=0;i<8;i++){let t=0;for(let e=0;e<16;e++){var o=16*i+e;0==(136&o)&&(o=b[o],0==o&&t++,o)&&(s+=(t||"")+n[o],t=0)}t&&(s+=t),t=0,i<7&&(s+="/")}return s+=" "+(Tt.getSide()?"b":"w"),s}},getPiece:function(e){return b[e]},getSide:function(){return k},getFifty:function(){return C},moveFromString:s,moveToString:Ct,moveStack:function(){return B},loadMoves:function(e){var t=e.split(" ");for(let e=0;e<t.length;e++){var n=t[e],n=(t[e],s(n));if(n){Me(n);let e="",t=0,i=0,s=0;i=parseInt(H),s=parseInt(U),t=parseInt($),e=q,B[B.length-1].piece=b[L(n)],B[B.length-1].inCheck=ye(F[k],1^k)?1:0,B[B.length-1].score=i,B[B.length-1].depth=s,B[B.length-1].time=t,B[B.length-1].pv=e}}A=0},getMoves:function(){var t=[];for(let e=0;e<B.length;e++)t.push(Ct(B[e].move));return t},pgn:function(){return null},getMoveSource:function(e){return 127&e},getMoveTarget:L,getMovePromoted:O,getMoveCapture:ve,getMoveCastling:xe,generateLegalMoves:function(){var t=[],i=[];ut(),Pe(i);for(let e=0;e<i.length;e++)0!=Me(i[e].move)&&(t.push(i[e]),Le());return t},printMoveList:function(e){{var i=e;let t="   Move     Capture  Double   Enpass   Castling  Score\n\n";for(let e=0;e<i.length;e++){var s=i[e].move;t+="   "+o[127&s]+o[L(s)],t+=O(s)?bt[O(s)]:" ",t+="    "+ve(s)+"        "+be(s)+"        "+ke(s)+"        "+xe(s)+"         "+i[e].score+"\n"}t+="\n   Total moves: "+i.length,console.log(t)}},resetTimeControl:function(){ct()},setTimeControl:function(e){e=e,z=e},getTimeControl:function(){return JSON.parse(JSON.stringify(z))},search:vt,searchTime:function(e){ct();var t=(new Date).getTime();return z.timeSet=1,z.time=e,z.stopTime=t+z.time,Tt.search(64)},searchTimeAndDepth:function(e,t){ct();var i=(new Date).getTime();return z.timeSet=1,z.time=e,z.stopTime=i+z.time,Tt.search(t)},isMaterialDraw:qe,takeBack:function(){B.length&&Le()},isRepetition:mt,inCheck:function(e){return ye(F[e],1^e)},isSquareAttacked:ye,setTranspositionTableSize:function(e){e=e,Ke=[],e<4&&(e=4),128<e&&(e=128),je=Math.trunc(1048576*e/20),Qe()}};return Tt}();class Ji{constructor(e,t,i){this.gameMode=null,this.isPublic=!1,this.roomId=null,this.packedGameState=null,this.gameMode=e,4===e&&!0===t&&(this.isPublic=!0),4===e&&!1===t?"string"==typeof i&&(this.roomId=i):this.packedGameState=t}isOnline(){return 4===this.gameMode}isPublicOnline(){return 4===this.gameMode&&this.isPublic}isJoinPrivateOnline(){return this.isOnline()&&!this.isPublic&&null!==this.roomId}isCreatePrivateOnline(){return this.isOnline()&&!this.isPublic&&null===this.roomId}}const L=p.isMainThread?new class extends se{constructor(){super("com.games247."+y.info.gameType+".GameSettings"),this.mute=!1,this.fullscreen=n.defaultPreferFullscreen,this.levelSelectPage=1,this.firstPlayerWhite=!0,this.threefoldRule=!0,this.timeLimit=k.TenMinutes,this.showMoves=!0,this.rotateBoardForLocalTwoPlayer=!1,this.showTimer=!0}save(){var e={};e.mute=this.mute,e.fullscreen=this.fullscreen,e.levelSelectPage=this.levelSelectPage,e.firstPlayerWhite=this.firstPlayerWhite,e.threefoldRule=this.threefoldRule,e.timeLimit=this.timeLimit,e.showMoves=this.showMoves,e.rotateBoardForLocalTwoPlayer=this.rotateBoardForLocalTwoPlayer,e.showTimer=this.showTimer,super.write(e)}load(){var e=super.read();this.mute=u.validateBoolean(e.mute,y.config.defaultMute),this.fullscreen=u.validateBoolean(e.fullscreen,n.defaultPreferFullscreen),this.levelSelectPage=u.validateOneOf(e.levelSelectPage,[0,1,2,3],1),this.firstPlayerWhite=u.validateBoolean(e.firstPlayerWhite,!0),this.threefoldRule=u.validateBoolean(e.threefoldRule,!0),this.timeLimit=u.validateOneOf(e.timeLimit,[k.None,k.TenSeconds,k.FiveMinutes,k.TenMinutes,k.FifteenMinutes,k.ThirtyMinutes],k.TenMinutes),this.showMoves=u.validateBoolean(e.showMoves,!0),this.rotateBoardForLocalTwoPlayer=u.validateBoolean(e.rotateBoardForLocalTwoPlayer,!1),this.showTimer=u.validateBoolean(e.showTimer,!0)}reset(){this.mute=y.config.defaultMute,this.fullscreen=n.defaultPreferFullscreen,this.levelSelectPage=1,this.firstPlayerWhite=!0,this.threefoldRule=!0,this.timeLimit=k.TenMinutes,this.showMoves=!0,this.rotateBoardForLocalTwoPlayer=!1,this.showTimer=!0}}:null,Ki=p.isMainThread?new class extends se{constructor(){super("com.games247."+y.info.gameType+".GameAds"),this.launches=0,this.adPlacementOpportunities=0}save(){var e={};e.launches=this.launches,e.adPlacementOpportunities=this.adPlacementOpportunities,super.write(e)}load(){var e=super.read();this.launches=u.validateIntMinInclusive(e.launches,0,0),this.adPlacementOpportunities=u.validateIntMinInclusive(e.adPlacementOpportunities,0,0),this.launches++,this.save()}reset(){this.launches=0,this.adPlacementOpportunities=0}}:null,Qi=p.isMainThread?new class extends se{constructor(){super("com.games247."+y.info.gameType+"."+y.info.theme+".GameRecords"),this.times=[null,null,null,null]}save(){var e={};e.shots=this.times,super.write(e)}load(){var e=super.read();e.shots&&"object"==typeof e.shots?(this.times[0]=u.validateIntMinInclusive(e.shots[0],0,null),this.times[1]=u.validateIntMinInclusive(e.shots[1],0,null),this.times[2]=u.validateIntMinInclusive(e.shots[2],0,null),this.times[3]=u.validateIntMinInclusive(e.shots[3],0,null)):this.reset()}reset(){this.times[0]=this.times[1]=this.times[2]=this.times[3]=null}}:null,O=p.isMainThread?new class extends se{constructor(){super("com.games247."+y.info.gameType+"."+y.info.theme+".GameSave"),this.onePlayer=null,this.twoPlayer=null}hasInProgressGame(e){return e?!!this.onePlayer&&!!M.isGameStarted(this.onePlayer)&&!M.isGameOver(this.onePlayer):!!this.twoPlayer&&!!M.isGameStarted(this.twoPlayer)&&!M.isGameOver(this.twoPlayer)}save(){var e={};e.onePlayer=this.onePlayer?this.onePlayer.pack():null,e.twoPlayer=this.twoPlayer?this.twoPlayer.pack():null,super.write(e)}load(){var e=super.read();this.onePlayer=null;try{e.onePlayer&&(this.onePlayer=new $i,this.onePlayer.validate(e.onePlayer,!0)?this.onePlayer.unpack(e.onePlayer):this.onePlayer=null)}catch(e){this.onePlayer=null}this.twoPlayer=null;try{e.twoPlayer&&(this.twoPlayer=new $i,this.twoPlayer.validate(e.twoPlayer,!0)?this.twoPlayer.unpack(e.twoPlayer):this.twoPlayer=null)}catch(e){this.twoPlayer=null}}reset(){this.onePlayer=null,this.twoPlayer=null}}:null;class Zi extends class{constructor(e){this.phase=null,this._changingPhase=!1,this.debug=!1,this.screen=e}next(e){if(this._changingPhase)throw new Error("Already changing phase!");if(this._changingPhase=!0,this.phase&&(this.debug&&l.info("Stopping phase: "+this.phase),this.phase.dispose(),this.phase.controller=null,this.phase.screen=null,this.phase=null),this._changingPhase=!1,e){if(e._consumed)throw new Error("Phases cannot be re-used!");e._consumed=!0,this.phase=e,this.phase.controller=this,this.phase.screen=this.screen,this.debug&&l.info("Starting phase: "+this.phase),this.phase.initialize()}}update(e){this.phase&&this.phase.update(e)}}{constructor(e,t){super(e),this.client=null,this.room=null,this.isJoinById=!1,this.roomState=null,this._queue=[],this.wasRoomFull=!1,this.ai=new p(Js),this.turnTimerRunning=!1,this.turnTimerStartTime=0,this.turnTimerStopTime=0,this.turnTimerInitialTime=0,this.turnTimerElapsedGameTime=0,this.activeTeam=2,this.client=t.isOnline()?new Ai(R.remoteHost.host):new Bi(R.localServer.endpoint);let i;t.isPublicOnline()?this.room=this.client.joinOrCreate("PublicGameplay",i={gameMode:t.gameMode}):t.isJoinPrivateOnline()?(this.isJoinById=!0,this.room=this.client.joinById("PrivateGameplay",t.roomId,i={gameMode:t.gameMode})):t.isCreatePrivateOnline()?this.room=this.client.create("PrivateGameplay",i={gameMode:t.gameMode}):t.isOnline()||(this.room=this.client.create("PrivateGameplay",i={gameMode:t.gameMode,packedGameState:t.packedGameState})),this.roomState=new Zs(!t.isOnline(),this.room.type),this.roomState.initialize(i,!0),this.gameState=this.roomState.gameState,this.room.onConnecting.add(this.room_onConnecting,this),this.room.onConnected.add(this.room_onConnected,this),this.room.onConnectFailed.add(this.room_onConnectFailed,this),this.room.onDisconnected.add(this.room_onDisconnected,this),this.room.onError.add(this.room_onError,this),this.room.onMessage.add(this.room_onMessage,this),this.ai.start()}dispose(){this.next(null),0!==this.room.connection.state&&this.room.disconnect(),this.ai&&(this.ai.stop(),this.ai=null)}sync(e){this.roomState.unpack(e),this.syncStateAndUI()}syncStateAndUI(){this.turnTimerRunning=!1,this.activeTeam=this.gameState.team,this.syncUI()}syncUI(){this.screen.sync(),this.updateUndoButton()}joined(e){if(this.roomState.isLocal)this.roomState.players[0].isPresent=this.roomState.players[1].isPresent=!0,this.roomState.players[0].sessionId=this.roomState.players[1].sessionId=e;else for(var t of this.roomState.players)if(null===t.sessionId){t.isPresent=!0,t.sessionId=e;break}this.roomState.isGameFull()&&(this.wasRoomFull=!0),this.syncUI()}left(e){for(var t of this.roomState.players)t.sessionId===e&&(t.isPresent=!1,t.sessionId=null);this.syncUI()}exit(e){this.screen.isOpenedByJoinLink,R.instance.navBar.home.hide(),this.screen.doClose(new Rs(!0),e)}save(){0===this.gameState.gameMode?(O.onePlayer=new $i,O.onePlayer.copy(this.gameState),O.save()):1===this.gameState.gameMode&&(O.twoPlayer=new $i,O.twoPlayer.copy(this.gameState),O.save())}updateUndoButton(){0<this.gameState.undoStack.length?this.screen.undoButton.enableButton():this.screen.undoButton.disableButton()}updateHintButton(){}updateLegendButton(){}getTeamController(e){if(0===this.gameState.gameMode||3===this.gameState.gameMode)return this.gameState.firstPlayerWhite?0===e?0:1:1===e?0:1;if(1===this.gameState.gameMode)return 0;if(4===this.gameState.gameMode)return this.room.sessionId===this.roomState.players[0].sessionId?0===e?0:2:1===e?0:2;throw new Error("Unsupported game mode")}getPlayerIndex(e){return 0===e?0:1}getTeamClock(e){return 4===this.gameState.gameMode||3===this.gameState.gameMode?this.turnTimerRunning&&e===this.gameState.team?this.turnTimerInitialTime+(Date.now()-this.turnTimerStartTime):this.gameState.teams[e].time:this.turnTimerRunning&&e===this.gameState.team?this.turnTimerInitialTime+this.turnTimerElapsedGameTime:this.gameState.teams[e].time}pushState(){0!==this.gameState.gameMode&&1!==this.gameState.gameMode||this.gameState.pushState()}popState(){0!==this.gameState.gameMode&&1!==this.gameState.gameMode||(this.gameState.popState(),this.syncStateAndUI(),this.save())}hasEvents(){return 0<this._queue.length}peekEvent(){return 0<this._queue.length?this._queue[0]:null}nextEvent(){return 0<this._queue.length?this._queue.shift():null}requeueEvent(e){this._queue.unshift(e)}room_onConnecting(e){this.debug&&l.info("GameplayController.room_onConnecting"),this._queue.push(new ts(0))}room_onConnected(e){this.debug&&l.info("GameplayController.room_onConnected"),this._queue.push(new ts(1))}room_onConnectFailed(e){this.debug&&l.info("GameplayController.room_onConnectFailed"),this._queue.push(new ts(2))}room_onDisconnected(e){this.debug&&l.info("GameplayController.room_onDisconnected"),this._queue.push(new ts(3))}room_onError(e,t,i){this.debug&&l.info("GameplayController.room_onError",t,i),this._queue.push(new is(t,i))}room_onMessage(e,t,i){this.debug&&l.info("GameplayController.room_onMessage",t),this._queue.push(new ss(t,i))}}class es{constructor(e){this.eventType=e}}class ts extends es{constructor(e){super(e)}}class is extends es{constructor(e,t){super(4),this.code=e,this.message=t}}class ss extends es{constructor(e,t){super(5),this.type=e,this.message=t}}class ns extends rt{constructor(){super(...arguments),this.processRoomEventsEnabled=!1}initialize(){}dispose(){this.processRoomEventsEnabled=!1}disconnect(){0!==this.controller.room.connection.state&&this.controller.room.disconnect()}unexpectedMessage(e,t){l.warn("Unexpected Message: "+t.type),this.controller.requeueEvent(t),this.controller.next(new rs(e.preState,new as))}outOfSync(e,t){l.warn("Out of sync! Found on message: "+t.type),"Sync"!==t.type&&this.controller.requeueEvent(t),this.controller.next(new rs(e.preState,new as))}fatal(e){l.warn("Fatal Unhandled Action: "+e),this.disconnect(),this.controller.next(new ls(1,!1))}onConnecting(e){this.fatal("onConnecting")}onConnected(e){this.fatal("onConnected")}onConnectFailed(e){this.fatal("onConnectFailed")}onDisconnected(e){this.disconnect(),this.controller.next(new ls(1,!1))}onError(e){l.warn("Received room error (code="+e.code+"): "+e.message),this.disconnect(),this.controller.next(new ls(1,!1))}onMessage(e){if("Join"===e.type&&e.message.sessionId===this.controller.room.sessionId)this.onJoinSelf(e.message,e);else if("Replay"===e.type)this.onReplay(e.message,e);else if("Leave"===e.type)this.onLeave(e.message,e);else if("Sync"===e.type)this.outOfSync(e.message,e);else if(this.controller.roomState.matches(e.message.preState,!0))if("Join"===e.type)this.onJoinOther(e.message,e);else if("SetActivePiece"===e.type)this.onSetActivePiece(e.message,e);else if("Move"===e.type)this.onMove(e.message,e);else if("TimeUp"===e.type)this.onTimeUp(e.message,e);else{if("Promote"!==e.type)throw new Error("Unknown message type: "+e.type);this.onPromote(e.message,e)}else this.outOfSync(e.message,e)}onJoinSelf(e,t){this.fatal("onJoinSelf")}onJoinOther(e,t){this.unexpectedMessage(e,t)}onLeave(e,t){this.processRoomEventsEnabled=!1,this.controller.next(new cs(e,t))}onSetActivePiece(e,t){this.unexpectedMessage(e,t)}onTimeUp(e,t){this.unexpectedMessage(e,t)}onMove(e,t){this.unexpectedMessage(e,t)}onPromote(e,t){this.unexpectedMessage(e,t)}onReplay(e,t){this.unexpectedMessage(e,t)}processRoomEvents(){for(;this.processRoomEventsEnabled&&this.controller&&this.controller.hasEvents();){var e=this.controller.nextEvent();if(0===e.eventType)ns.debug&&l.log("Process Room Event: Connecting"),this.onConnecting(e);else if(1===e.eventType)ns.debug&&l.log("Process Room Event: Connected"),this.onConnected(e);else if(2===e.eventType)ns.debug&&l.log("Process Room Event: ConnectFailed"),this.onConnectFailed(e);else if(3===e.eventType)ns.debug&&l.log("Process Room Event: Disconnected"),this.onDisconnected(e);else if(4===e.eventType)ns.debug&&l.log("Process Room Event: Error"),this.onError(e);else{if(5!==e.eventType)throw new Error("Unknown room event type: "+e.eventType);ns.debug&&l.log("Process Room Event: Message ("+e.type+")"),this.onMessage(e)}}}update(e){this.processRoomEvents()}}ns.debug=!1;class os extends ns{initialize(){this.controller.next(new hs)}}class rs extends ns{constructor(e,t){super(),this.syncState=e,this.nextPhase=t}initialize(){this.controller.sync(this.syncState),this.controller.next(this.nextPhase)}}class as extends ns{initialize(){if(this.controller.roomState.isGameFull())if(0===this.controller.gameState.turnState)this.controller.next(new ps);else if(1===this.controller.gameState.turnState)this.controller.next(new ps);else{if(9!==this.controller.gameState.turnState)throw new Error("Could not determine next phase");this.controller.next(new vs)}else this.controller.next(new ds)}}class hs extends ns{initialize(){this._connectingScreen=new Es,this._connectingScreen.onCancel.add(this.connectingScreen_onCancel,this),this.screen.screenManager.add(this._connectingScreen),this.processRoomEventsEnabled=!0,this.controller.room.connect(),this.processRoomEvents()}dispose(){this._connectingScreen&&(this._connectingScreen.onCancel.remove(this.connectingScreen_onCancel,this),this._connectingScreen.exit(),this._connectingScreen=null)}onConnecting(e){}onConnected(e){}onConnectFailed(e){this.controller.next(new ls(0,!1))}onJoinSelf(e){this.processRoomEventsEnabled=!1,this._connectingScreen.doClose(),this.controller.sync(e.preState),this.controller.joined(e.sessionId),this.controller.next(new as)}connectingScreen_onCancel(){this.processRoomEventsEnabled=!1,this.disconnect(),this._connectingScreen.doClose(),this.controller.exit()}}class ls extends ns{constructor(e,t){super(),this._reason=e,this._animateOn=t}initialize(){0===this._reason?this.screen.isOpenedByJoinLink?this._disconnectedScreen=new Ms("Connect Failed Screen","Room Not Found","The join link is no longer valid.",this._animateOn):this.controller.isJoinById?this._disconnectedScreen=new Ms("Connect Failed Screen","Room Not Found","Please check the game code and try again.",this._animateOn):this._disconnectedScreen=new Ms("Connect Failed Screen","Couldn't Connect","Please try again later.",this._animateOn):2===this._reason?this._disconnectedScreen=new Ms("No Opponent Screen","No Opponent","Nobody joined the game. Please try again later.",this._animateOn):3===this._reason?this._disconnectedScreen=new Ms("Promotion Timeout Screen","Promotion Timeout","You took too long and you left the game.",this._animateOn):4===this._reason?this._disconnectedScreen=new Ms("Opponent Quit Screen","Opponent Quit","Your opponent left the game.",this._animateOn):5===this._reason?this._disconnectedScreen=new Ms("Opponent No Replay Screen","Opponent Left","Your opponent decided not to play again.",this._animateOn):this._disconnectedScreen=new Ms("Disconnected Screen","Disconnected","Please check your connection.",this._animateOn),this._disconnectedScreen.onClose.add(this.disconnectedScreen_onClose,this),this.screen.screenManager.add(this._disconnectedScreen),this.disconnect(),super.initialize()}dispose(){this._disconnectedScreen&&(this._disconnectedScreen.onClose.remove(this.disconnectedScreen_onClose,this),this._disconnectedScreen.exit(),this._disconnectedScreen=null)}disconnectedScreen_onClose(){this._disconnectedScreen.doClose(),this.screen.isOpenedByJoinLink||R.instance.navBar.home.hide(),this.screen.doClose(new Rs(!0),[this._disconnectedScreen])}}class ds extends ns{constructor(){super(),this.timeout=this.timeout.bind(this)}initialize(){this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Create Game"):bi.track("GameTracking","Private - Create Game")),this._waitingForOpponentScreen=new Os(this.controller.roomState.isPrivateOnline()?this.controller.room.id:null,this.controller.wasRoomFull),this._waitingForOpponentScreen.onCancel.add(this.waitingForOpponentScreen_onCancel,this),this.screen.screenManager.add(this._waitingForOpponentScreen),this.processRoomEventsEnabled=!0,this.processRoomEvents(),d.setTimeout(this.timeout,6e5,!1)}dispose(){this._waitingForOpponentScreen&&(this._waitingForOpponentScreen.onCancel.remove(this.waitingForOpponentScreen_onCancel,this),this._waitingForOpponentScreen.exit(),this._waitingForOpponentScreen=null),d.containsTimeout(this.timeout)&&d.clearTimeout(this.timeout)}onJoinOther(e){this.processRoomEventsEnabled=!1,this._waitingForOpponentScreen.doClose(),this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Opponent Joined"):bi.track("GameTracking","Private - Opponent Joined")),this.controller.sync(e.preState),this.controller.joined(e.sessionId),this.controller.next(new as)}waitingForOpponentScreen_onCancel(){this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Cancel Waiting For Opponent"):bi.track("GameTracking","Private - Cancel Waiting For Opponent")),this.processRoomEventsEnabled=!1,this.disconnect(),this._waitingForOpponentScreen.doClose(),this.controller.exit()}timeout(){this.controller.roomState.isLocal||this.controller.wasRoomFull||(this.controller.roomState.isPublic?this.controller.roomState.isPublic&&bi.track("GameTracking","Public - Timeout Waiting For Opponent"):bi.track("GameTracking","Private - Timeout Waiting For Opponent")),this.disconnect(),this.controller.next(new ls(2,!1))}}class cs extends ns{constructor(e,t){super(),this._msg=e,this._evt=t}initialize(){super.initialize(),this.controller.sync(this._msg.preState),this.controller.left(this._msg.sessionId),this._msg.terminating?this.controller.next(new ls(4,!0)):this.controller.next(new as)}}class us extends ns{constructor(){super(),this._canceled=!1,this._waitTimeLeft=6e5,this._lastTick=0,this.timeout=this.timeout.bind(this)}initialize(){var e,t;this._lastTick=Date.now(),super.initialize(),this._waitingScreen=new Ls,this.screen.screenManager.add(this._waitingScreen),4!==this.controller.gameState.gameMode?1===this.controller.gameState.gameMode?(this._waitingScreen.exit(),t=this.screen.screenManager,e=new $i(1,this.controller.gameState.firstPlayerWhite?0:1,this.controller.gameState.timeLimit,this.controller.gameState.threefoldRule),M.newGame(e,!0),O.twoPlayer=new $i,O.twoPlayer.copy(e),O.save(),e=new Ji(1,e.pack()),this.screen.exit(),t.add(new Bs(new As(e,!1,!1)))):(this._waitingScreen.exit(),t=this.screen.screenManager,e=new $i(0,this.controller.gameState.difficulty,this.controller.gameState.firstPlayerWhite?0:1,this.controller.gameState.timeLimit,this.controller.gameState.threefoldRule),M.newGame(e,!0),O.onePlayer=new $i,O.onePlayer.copy(e),O.save(),e=new Ji(0,e.pack()),this.screen.exit(),t.add(new Bs(new As(e,!1,!1)))):(2===this.controller.room.connection.state&&(t=this.controller.roomState.players[0].sessionId===this.controller.room.sessionId?0:1,this.controller.roomState.players[t].wantsReplay=!0,this.controller.room.send("Replay",{playerIndex:t})),this._waitingScreen.cancelButton.input.onPointerClick.add(this.cancelButton_onClick,this),d.setTimeout(this.timeout,6e4,!1),this.processRoomEventsEnabled=!0)}dispose(){this._waitingScreen.cancelButton.input.onPointerClick.contains(this.cancelButton_onClick,this)&&this._waitingScreen.cancelButton.input.onPointerClick.remove(this.cancelButton_onClick,this),this._waitingScreen.screenManager&&this._waitingScreen.exit(),d.containsTimeout(this.timeout)&&d.clearTimeout(this.timeout),super.dispose()}cancelButton_onClick(){this._waitingScreen.track("Close Button Pressed"),this._canceled=!0,0!==this.controller.room.connection.state&&this.controller.room.disconnect(),this._waitingScreen.doClose(),R.instance.navBar.home.hide(),this.screen.doClose(new Rs(!0))}timeout(){this.disconnect(),this.controller.next(new ls(5,!1))}onReplay(e,t){this._waitingScreen.exit(),this.controller.sync(e.postState),this.controller.next(new as)}}class ps extends ns{initialize(){super.initialize();var e=M.isTeamInCheck(this.controller.gameState,this.controller.gameState.team);0===this.controller.gameState.team?(this.controller.screen.hud.playerStatusDisplays[1].setCheck(e,!0),this.controller.screen.hud.playerStatusDisplays[0].setCheck(!1,!0)):(this.controller.screen.hud.playerStatusDisplays[1].setCheck(!1,!0),this.controller.screen.hud.playerStatusDisplays[0].setCheck(e,!0)),this.controller.activeTeam=this.controller.gameState.team,this.controller.screen.hud.playerStatusDisplays[0].setActiveTurn(this.controller.gameState.team),this.controller.screen.hud.playerStatusDisplays[1].setActiveTurn(this.controller.gameState.team),0===this.controller.gameState.turnState?this.controller.next(new gs):this.controller.next(new ks)}}class ms extends ns{initialize(){super.initialize(),this.controller.screen.hud.playerStatusDisplays[0].setCheck(!1,!0),this.controller.screen.hud.playerStatusDisplays[1].setCheck(!1,!0),this.controller.screen.hud.playerStatusDisplays[0].setActiveTurn(2),this.controller.screen.hud.playerStatusDisplays[1].setActiveTurn(2),this.controller.next(new as)}}class gs extends ns{initialize(){super.initialize();var e=this.controller.getTeamController(this.controller.gameState.team);if(0===e)this.controller.next(new _s);else if(1===e)this.controller.next(new ys);else{if(2!==e)throw new Error("Should not happen!");this.controller.next(new ws)}}}class fs extends ns{constructor(){super(),this.timeUp=this.timeUp.bind(this)}initialize(){super.initialize(),this.team=this.controller.gameState.team,this.teamState=this.controller.gameState.teams[this.team],this.playerStatusDisplay=this.screen.hud.playerStatusDisplays[this.team],this.playerIndex=this.controller.getPlayerIndex(this.team),this.processRoomEventsEnabled=!0}startTimer(t){if(this.controller.turnTimerRunning)throw new Error("Timer already running!");var e=Date.now();if(this.controller.turnTimerRunning=!0,this.controller.turnTimerStartTime=e,this.controller.turnTimerInitialTime=this.teamState.time,this.controller.turnTimerElapsedGameTime=0,4===this.controller.gameState.gameMode||3===this.controller.gameState.gameMode){let e=this.controller.gameState.timeLimit-this.teamState.time;e<=0&&(e=1),t||d.setTimeout(this.timeUp,e,!1)}}stopTimer(){if(!this.controller.turnTimerRunning)throw new Error("Timer already stopped!");var e=Date.now();this.controller.turnTimerRunning=!1,this.controller.turnTimerStopTime=e,4!==this.controller.gameState.gameMode&&3!==this.controller.gameState.gameMode||d.containsTimeout(this.timeUp)&&d.clearTimeout(this.timeUp)}timeUp(){this.onTimeUp()}update(e){this.controller&&this.controller.turnTimerRunning&&4!==this.controller.gameState.gameMode&&3!==this.controller.gameState.gameMode&&(this.controller.turnTimerElapsedGameTime+=e,this.controller.gameState.timeLimit!==k.None)&&this.controller.turnTimerInitialTime+this.controller.turnTimerElapsedGameTime>=this.controller.gameState.timeLimit&&this.timeUp(),super.update(e)}}class _s extends fs{constructor(){super(...arguments),this.inputEnabled=!1,this._moves=null,this._moveablePieceCellDisplays=[],this._selectedPieceCell=null,this._hintResult=null,this._legendScreen=null}initialize(){super.initialize(),this.enableInput(),this.startTimer(!1),this._moves=M.getMoves(this.controller.gameState);for(let e=0;e<this._moves.count;++e)this._moveablePieceCellDisplays.push(this.controller.screen.boardDisplay.cellDisplays[this._moves.list[e].iSrc]);for(var e of this._moveablePieceCellDisplays)e.setMoveable(!0);4===this.controller.gameState.gameMode&&new f(w.sounds["turn-notification"].data).play(),this.controller.updateHintButton(),this.screen.hintButton.input.onPointerClick.add(this.hintButton_onPointerClick,this),this.controller.updateUndoButton(),this.screen.undoButton.input.onPointerClick.add(this.undoButton_onPointerClick,this),this.controller.updateLegendButton(),this.screen.legendButton.input.onPointerClick.add(this.legendButton_onPointerClick,this)}dispose(){this.disableInput(),this.stopTimer(),this.clearSelectedPieceCell();for(var e of this._moveablePieceCellDisplays)e.setMoveable(!1);this.screen.hintButton.input.onPointerClick.remove(this.hintButton_onPointerClick,this),this.screen.undoButton.input.onPointerClick.remove(this.undoButton_onPointerClick,this),this.screen.legendButton.input.onPointerClick.remove(this.legendButton_onPointerClick,this),this.hideHint(),this.controller.ai.onMessage.contains(this.ai_onMessage,this)&&(this.controller.ai.onMessage.remove(this.ai_onMessage,this),this.controller.ai.stop(),this.controller.ai.start(),this.screen.inputEnabled=!0,R.instance.navBar.input.pointerChildrenEnabled=!0),this._legendScreen&&(this._legendScreen.onRemoved.remove(this.legendScreen_onRemoved,this),this._legendScreen.exit(),this._legendScreen=null),super.dispose()}setSelectedPieceCell(e){this._selectedPieceCell!==e&&(this._selectedPieceCell&&this.clearSelectedPieceCell(),new f(w.sounds.select.data).play(),this._selectedPieceCell=e,this._selectedPieceCell.setSelected(!0),this.showMoves())}clearSelectedPieceCell(){this._selectedPieceCell&&(this.hideHint(),this.clearMoves(),this._selectedPieceCell.setSelected(!1),this._selectedPieceCell=null)}showMoves(){for(let e=0;e<this._moves.count;++e){var t,i,s;this._moves.list[e].iSrc===this._selectedPieceCell.cell.i&&(t=this._moves.list[e],i=this.controller.screen.boardDisplay.cellDisplays[t.iDest],2===t.type||3===t.type?(i.setMoveToCapture(!0),i.input.pointerEnabled=!0,s=this.controller.screen.boardDisplay.cellDisplays[t.iCapture],s.setCapture(!0)):0!==t.type&&1!==t.type||(i.setMoveToNormal(!0),i.input.pointerEnabled=!0))}}clearMoves(){for(var e of this.screen.boardDisplay.cellDisplays)e.clearMovingMarks(),e.cell.piece&&e.cell.piece.team===this.team||(e.input.pointerEnabled=!1)}chooseMove(e,t,i,s,n){this.controller.pushState();let o=this.controller.getTeamClock(this.team),r=(this.controller.gameState.timeLimit!==k.None&&o>=this.controller.gameState.timeLimit&&(o=this.controller.gameState.timeLimit-1),null),a=null,h=null;0===e?r=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[t].piece.i]:2===e||3===e?(r=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[t].piece.i],h=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[s].piece.i]):(r=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[t].piece.i],a=i<t?0===this.team?this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[56].piece.i]:this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[0].piece.i]:0===this.team?this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[63].piece.i]:this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[7].piece.i]);var l=M.move(this.controller.gameState,this.team,e,t,i,s,n,o,!1);if(!l)throw new Error("Move not accepted locally!");this.sendMove(e,t,i,s,n,o),0===e?this.controller.next(new bs(this.team,e,r)):2===e||3===e?this.controller.next(new bs(this.team,e,r,h)):this.controller.next(new bs(this.team,e,r,a))}onTimeUp(){M.timeUp(this.controller.gameState,this.team,!0),this.sendTimeUp(),this.controller.save(),this.controller.next(new ms)}sendSetActivePiece(){2===this.controller.room.connection.state&&this.controller.room.send("SetActivePiece",{playerIndex:this.playerIndex,cellIndex:this._selectedPieceCell?this._selectedPieceCell.cell.i:-1})}sendTimeUp(){2===this.controller.room.connection.state&&this.controller.room.send("TimeUp",{playerIndex:this.playerIndex})}sendMove(e,t,i,s,n,o){2===this.controller.room.connection.state&&this.controller.room.send("Move",{playerIndex:this.playerIndex,type:e,iSrc:t,iDest:i,iCapture:s,isPromotion:n,teamTime:o})}sendHint(){2===this.controller.room.connection.state&&this.controller.room.send("Hint",{playerIndex:this.playerIndex})}enableInput(){if(this.inputEnabled)throw new Error("Already enabled!");this.inputEnabled=!0;for(var e of this.controller.screen.boardDisplay.cellDisplays)e.input.onPointerClick.add(this.cellDisplay_onClick,this),e.cell.piece&&e.cell.piece.team===this.team&&(e.input.pointerEnabled=!0);this.screen.boardDisplay.hitCatcher.input.pointerEnabled=!0,this.screen.boardDisplay.hitCatcher.input.onPointerClick.add(this.hitCatcher_onClick,this)}disableInput(){if(this.inputEnabled){this.inputEnabled=!1;for(var e of this.controller.screen.boardDisplay.cellDisplays)e.input.onPointerClick.remove(this.cellDisplay_onClick,this),e.input.pointerEnabled=!1;this.screen.boardDisplay.hitCatcher.input.pointerEnabled=!1,this.screen.boardDisplay.hitCatcher.input.onPointerClick.remove(this.hitCatcher_onClick,this)}}cellDisplay_onClick(t){if(this._selectedPieceCell)for(let e=0;e<this._moves.count;++e)if(this._moves.list[e].iSrc===this._selectedPieceCell.cell.i&&this._moves.list[e].iDest===t.cell.i)return void this.chooseMove(this._moves.list[e].type,this._moves.list[e].iSrc,this._moves.list[e].iDest,this._moves.list[e].iCapture,this._moves.list[e].isPromotion);t.cell.piece&&t.cell.piece.team===this.team?this.setSelectedPieceCell(t):this.clearSelectedPieceCell(),this.sendSetActivePiece()}hitCatcher_onClick(){this.clearSelectedPieceCell(),this.sendSetActivePiece()}hintButton_onPointerClick(){if(this._hintResult)this.showHint();else{0===this.controller.gameState.gameMode&&(this.controller.gameState.penalty+=6e4,this.screen.timerDisplay.penalty("+60 seconds"),this.sendHint());let e=this.controller.getTeamClock(this.team);this.controller.gameState.timeLimit!==k.None&&e>=this.controller.gameState.timeLimit&&(e=this.controller.gameState.timeLimit-1),this.controller.gameState.teams[this.team].time=e,this.controller.save(),this.screen.inputEnabled=!1,R.instance.navBar.input.pointerChildrenEnabled=!1,this.controller.ai.onMessage.add(this.ai_onMessage,this),this.controller.ai.sendMessage("process",{packedGameState:this.controller.gameState.pack(),difficulty:3,maxTime:500})}}undoButton_onPointerClick(){this.controller.gameState.undoStack.length<=0?this.screen.undoButton.disableButton():this.controller.next(new Fs)}legendButton_onPointerClick(){this._legendScreen=new zs(this.controller.gameState.team),this._legendScreen.onRemoved.add(this.legendScreen_onRemoved,this),this.screen.screenManager.add(this._legendScreen)}legendScreen_onRemoved(){this._legendScreen.onRemoved.remove(this.legendScreen_onRemoved,this),this._legendScreen=null}ai_onMessage(e){this.controller.ai.onMessage.remove(this.ai_onMessage,this),this.screen.inputEnabled=!0,R.instance.navBar.input.pointerChildrenEnabled=!0,this._hintResult=e.data,this.showHint()}showHint(){this.clearSelectedPieceCell(),this.setSelectedPieceCell(this.screen.boardDisplay.cellDisplays[this._hintResult.iSrc]);for(var e of this.screen.boardDisplay.cellDisplays)e.setHintLevel(1);this.screen.boardDisplay.cellDisplays[this._hintResult.iSrc].setHintLevel(2),this.screen.boardDisplay.cellDisplays[this._hintResult.iDest].setHintLevel(2),0<=this._hintResult.iCapture&&this.screen.boardDisplay.cellDisplays[this._hintResult.iCapture].setHintLevel(2)}hideHint(){for(var e of this.screen.boardDisplay.cellDisplays)e.setHintLevel(0)}}class ws extends fs{constructor(){super(...arguments),this._selectedPieceCell=null,this._legendScreen=null}initialize(){super.initialize(),this.startTimer(!1),this.controller.updateLegendButton(),this.screen.legendButton.input.onPointerClick.add(this.legendButton_onPointerClick,this)}dispose(){this.stopTimer(),this._selectedPieceCell&&this._selectedPieceCell.setSelected(!1),this._selectedPieceCell=null,this.screen.legendButton.input.onPointerClick.remove(this.legendButton_onPointerClick,this),this._legendScreen&&(this._legendScreen.onRemoved.remove(this.legendScreen_onRemoved,this),this._legendScreen.exit(),this._legendScreen=null),super.dispose()}onTimeUp(){M.timeUp(this.controller.gameState,this.team,!0),this.controller.save(),this.controller.next(new ms)}onSetActivePiece(e,t){this._selectedPieceCell&&(this._selectedPieceCell.setSelected(!1),this._selectedPieceCell=null),0<=e.cellIndex&&(this._selectedPieceCell=this.screen.boardDisplay.cellDisplays[e.cellIndex],this._selectedPieceCell.setSelected(!0),new f(w.sounds.select.data).play())}onMove(e){let t=null,i=null,s=null;0===e.type?t=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[e.iSrc].piece.i]:2===e.type||3===e.type?(t=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[e.iSrc].piece.i],s=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[e.iCapture].piece.i]):(t=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[e.iSrc].piece.i],i=e.iDest<e.iSrc?0===this.team?this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[56].piece.i]:this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[0].piece.i]:0===this.team?this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[63].piece.i]:this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[7].piece.i]),M.move(this.controller.gameState,this.team,e.type,e.iSrc,e.iDest,e.iCapture,e.isPromotion,e.teamTime,!0),0===e.type?this.controller.next(new bs(this.team,e.type,t)):2===e.type||3===e.type?this.controller.next(new bs(this.team,e.type,t,s)):this.controller.next(new bs(this.team,e.type,t,i))}legendButton_onPointerClick(){this._legendScreen=new zs(this.controller.gameState.team),this._legendScreen.onRemoved.add(this.legendScreen_onRemoved,this),this.screen.screenManager.add(this._legendScreen)}legendScreen_onRemoved(){this._legendScreen.onRemoved.remove(this.legendScreen_onRemoved,this),this._legendScreen=null}}class ys extends fs{constructor(){super(...arguments),this._aiProcessing=!1,this._minTime=500,this._result=null}initialize(){super.initialize(),this.startTimer(!1),this._aiProcessing=!0,this.controller.ai.onMessage.add(this.ai_onMessage,this),this.controller.ai.sendMessage("process",{packedGameState:this.controller.gameState.pack(),difficulty:this.controller.gameState.difficulty,maxTime:3e3})}dispose(){this.stopTimer(),this._aiProcessing&&(this.controller.ai.onMessage.remove(this.ai_onMessage,this),this._aiProcessing=!1,this.controller.ai.stop(),this.controller.ai.start()),super.dispose()}chooseMove(e,t,i,s,n,o){let r=this.controller.getTeamClock(this.team),a=(this.controller.gameState.timeLimit!==k.None&&r>=this.controller.gameState.timeLimit&&(r=this.controller.gameState.timeLimit-1),null),h=null,l=null;0===e?a=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[t].piece.i]:2===e||3===e?(a=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[t].piece.i],l=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[s].piece.i]):(a=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[t].piece.i],h=i<t?0===this.team?this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[56].piece.i]:this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[0].piece.i]:0===this.team?this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[63].piece.i]:this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[7].piece.i]);var d=M.move(this.controller.gameState,this.team,e,t,i,s,n,r,!1);if(!d)throw new Error("Move not accepted locally!");this.sendMove(e,t,i,s,n,r),0===e?this.controller.next(new bs(this.team,e,a)):2===e||3===e?this.controller.next(new bs(this.team,e,a,l)):this.controller.next(new bs(this.team,e,a,h))}onTimeUp(){M.timeUp(this.controller.gameState,this.team,!0),this.sendTimeUp(),this.controller.save(),this.controller.next(new ms)}sendTimeUp(){2===this.controller.room.connection.state&&this.controller.room.send("TimeUp",{playerIndex:this.playerIndex})}sendMove(e,t,i,s,n,o){2===this.controller.room.connection.state&&this.controller.room.send("Move",{playerIndex:this.playerIndex,type:e,iSrc:t,iDest:i,iCapture:s,isPromotion:n,teamTime:o})}ai_onMessage(e){this.controller.ai.onMessage.remove(this.ai_onMessage,this),this._aiProcessing=!1,this._result=e.data}update(e){var t;0<this._minTime?this._minTime-=e:this._result&&(t=this._result,this._result=null,this.chooseMove(t.type,t.iSrc,t.iDest,t.iCapture,t.isPromotion,t.aiPromoteTo)),super.update(e)}}class vs extends ns{constructor(){super()}initialize(){super.initialize();var t=this.controller.gameState,e=t.gameMode,i=this.controller.gameState.difficulty,s=t.outcome,n=t.winner;if(0===e){var o=0===this.controller.getTeamController(0)?0:1,r=this.controller.getTeamClock(o)+t.penalty;let e=!1;if(n===o)(null===Qi.times[i]||r<Qi.times[i])&&(e=!0,Qi.times[i]=r,Qi.save(),this.screen.recordDisplay.setTime(r),new f(w.sounds.record.data).play()),this.gameOverScreen=new mi(Di[i],r,e,R.instance.calcStarRating(r,i),w.sounds.win,"Play Again");else if(2===n){let e="It's a draw!";1===s?e="Stalemate! No moves can be made.":3===s?e="The same board position has happened 3 times.":2===s&&(e="Only two kings remain."),this.gameOverScreen=new gi(Di[i],r,w.sounds.lose,"Play Again","Draw","Draw Screen",e)}else this.gameOverScreen=new gi(Di[i],r,w.sounds.lose,"Play Again");this.gameOverScreen.onClosing.add(this.gameOverScreen_onClosing,this),this.screen.screenManager.add(this.gameOverScreen)}else if(1===e){o=this.controller.getTeamClock(0)+this.controller.getTeamClock(1)+t.penalty;if(2!==n)this.gameOverScreen=new mi("2 Player",o,!1,R.instance.calcStarRating(o,i),w.sounds.win,"Play Again");else{let e="It's a draw!";1===s?e="Stalemate! No moves can be made.":3===s?e="The same board position has happened 3 times.":2===s&&(e="Only two kings remain."),this.gameOverScreen=new gi("2 Player",o,w.sounds.lose,"Play Again","Draw","Draw Screen",e)}this.gameOverScreen.onClosing.add(this.gameOverScreen_onClosing,this),this.screen.screenManager.add(this.gameOverScreen)}else if(4===e){r=0===this.controller.getTeamController(0)?0:1,o=this.controller.getTeamClock(r)+t.penalty;if(n===r)this.gameOverScreen=new mi("Online",o,!1,R.instance.calcStarRating(o,i),w.sounds.win,"Play Again");else if(2===n){let e="It's a draw!";1===s?e="Stalemate! No moves can be made.":3===s?e="The same board position has happened 3 times.":2===s&&(e="Only two kings remain."),this.gameOverScreen=new gi("Online",o,w.sounds.lose,"Play Again","Draw","Draw Screen",e)}else this.gameOverScreen=new gi("Online",o,w.sounds.lose,"Play Again");this.gameOverScreen.onClosing.add(this.gameOverScreen_onClosing,this),this.screen.screenManager.add(this.gameOverScreen)}else{if(3!==e)throw new Error("Not implemented!");r=0===this.controller.getTeamController(0)?0:1,i=this.controller.getTeamClock(r)+t.penalty;console.log("DC COMPLETE"),console.log(this.controller.gameState),console.log("lpt",r),console.log("time",i),console.log("winner",n),console.log("outcome",s),(n===r?(B.submit(i),new f(w.sounds.win.data)):new f(w.sounds.lose.data)).play(),this.dcCompleteScreen=new pi(!1,i),this.dcCompleteScreen.onClosing.add(this.dcCompleteScreen_onClosing,this),this.screen.screenManager.add(this.dcCompleteScreen)}}dispose(){this.gameOverScreen&&this.gameOverScreen.onClosing.contains(this.gameOverScreen_onClosing,this)&&this.gameOverScreen.onClosing.remove(this.gameOverScreen_onClosing,this),this.dcCompleteScreen&&this.dcCompleteScreen.onClosing.contains(this.dcCompleteScreen_onClosing,this)&&this.dcCompleteScreen.onClosing.remove(this.dcCompleteScreen_onClosing,this),super.dispose()}gameOverScreen_onClosing(e){e.onClosing.remove(this.gameOverScreen_onClosing,this),e.toNewGame?this.controller.exit([e]):(e.exit(),this.controller.next(new us))}dcCompleteScreen_onClosing(e){e.onClosing.remove(this.dcCompleteScreen_onClosing,this),this.controller.exit([e])}update(e){super.update(e)}}class bs extends ns{constructor(e,t,i,s){super(),this.type=null,this._movingPieceDisplay1=null,this._xTween1=null,this._yTween1=null,this._movingPieceDisplay2=null,this._xTween2=null,this._yTween2=null,this._capturedPiece=null,this.movingTeam=null,this.movingTeam=e,this.type=t,0===t?this._movingPieceDisplay1=i:2===t||3===t?(this._movingPieceDisplay1=i,this._capturedPiece=s):(this._movingPieceDisplay1=i,this._movingPieceDisplay2=s)}initialize(){super.initialize();var e=this.screen.boardDisplay.cellDisplays[this._movingPieceDisplay1.piece.cell.i];this._xTween1=new o(this._movingPieceDisplay1.x,142.5*(e.cell.c+.5),400,200,a.Quadratic.easeOut),this._yTween1=new o(this._movingPieceDisplay1.y,142.5*(e.cell.r+.5),400,200,a.Quadratic.easeOut),this._movingPieceDisplay2&&(e=this.screen.boardDisplay.cellDisplays[this._movingPieceDisplay2.piece.cell.i],this._xTween2=new o(this._movingPieceDisplay2.x,142.5*(e.cell.c+.5),400,200,a.Quadratic.easeOut),this._yTween2=new o(this._movingPieceDisplay2.y,142.5*(e.cell.r+.5),400,200,a.Quadratic.easeOut)),this._movingPieceDisplay2&&this.screen.boardDisplay.pieceLayer.setChildIndex(this._movingPieceDisplay2,this.screen.boardDisplay.pieceLayer.children.length-1),this.screen.boardDisplay.pieceLayer.setChildIndex(this._movingPieceDisplay1,this.screen.boardDisplay.pieceLayer.children.length-1),new f(w.sounds.move.data).play()}dispose(){super.dispose()}moveFinished(){this._capturedPiece&&(this._capturedPiece.visible=!1,this.screen.hud.playerStatusDisplays[this._movingPieceDisplay1.piece.team].takePiece(this._capturedPiece.piece.type),new f(w.sounds.capture.data).play()),1===this.controller.gameState.turnState?(this.controller.save(),this.controller.next(new ks)):(this.controller.save(),this.controller.next(new ms))}update(e){(this._xTween1||this._yTween1||this._xTween2||this._yTween2)&&(this._xTween1&&(this._movingPieceDisplay1.x=this._xTween1.update(e),this._xTween1.isFinished)&&(this._xTween1=null),this._yTween1&&(this._movingPieceDisplay1.y=this._yTween1.update(e),this._yTween1.isFinished)&&(this._yTween1=null),this._xTween2&&(this._movingPieceDisplay2.x=this._xTween2.update(e),this._xTween2.isFinished)&&(this._xTween2=null),this._yTween2&&(this._movingPieceDisplay2.y=this._yTween2.update(e),this._yTween2.isFinished)&&(this._yTween2=null),this._xTween1||this._yTween1||this._xTween2||this._yTween2||this.moveFinished()),super.update(e)}}class ks extends ns{initialize(){super.initialize();var e=this.controller.getTeamController(this.controller.gameState.team);if(0===e)this.controller.next(new Ss);else if(1===e)this.controller.next(new Ts);else{if(2!==e)throw new Error("Should not happen!");this.controller.next(new Cs)}}}class xs extends ns{constructor(){super(),this.timeUp=this.timeUp.bind(this)}initialize(){super.initialize(),this.team=this.controller.gameState.team,this.teamState=this.controller.gameState.teams[this.team],this.playerStatusDisplay=this.screen.hud.playerStatusDisplays[this.team],this.playerIndex=this.controller.getPlayerIndex(this.team),4===this.controller.gameState.gameMode&&0===this.controller.getTeamController(this.team)&&d.setTimeout(this.timeUp,6e4,!1),this.processRoomEventsEnabled=!0}dispose(){d.containsTimeout(this.timeUp)&&d.clearTimeout(this.timeUp),super.dispose()}timeUp(){this.onTimeUp()}}class Ss extends xs{constructor(){super(...arguments),this.promotionScreen=null}initialize(){super.initialize(),this.promotionScreen=new Ds(this.screen,this.team,4===this.controller.gameState.gameMode),this.promotionScreen.onRemoved.add(this.promotionScreen_onRemoved,this),this.controller.screen.screenManager.add(this.promotionScreen)}dispose(){this.promotionScreen&&(this.promotionScreen.onRemoved.remove(this.promotionScreen_onRemoved,this),this.promotionScreen.exit()),super.dispose()}onTimeUp(){this.disconnect(),this.controller.next(new ls(3,!0))}sendPromotion(e){2===this.controller.room.connection.state&&this.controller.room.send("Promote",{playerIndex:this.playerIndex,chosen:e})}promotionScreen_onRemoved(e){this.promotionScreen.onRemoved.remove(this.promotionScreen_onRemoved,this),this.promotionScreen=null;var t=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[this.controller.gameState.iDestLastMove].piece.i];M.promote(this.controller.gameState,this.team,e.chosen),this.sendPromotion(e.chosen),t.updatePieceImage(),new f(w.sounds.promote.data).play(),this.controller.save(),this.controller.next(new ms)}}class Cs extends xs{initialize(){super.initialize()}dispose(){super.dispose()}onTimeUp(){}onPromote(e,t){var i=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[this.controller.gameState.iDestLastMove].piece.i];M.promote(this.controller.gameState,this.team,e.chosen),i.updatePieceImage(),new f(w.sounds.promote.data).play(),this.controller.save(),this.controller.next(new ms)}}class Ts extends xs{initialize(){super.initialize();var e=this.screen.boardDisplay.pieceDisplays[this.controller.gameState.board.cells[this.controller.gameState.iDestLastMove].piece.i];M.promote(this.controller.gameState,this.team,4),this.sendPromotion(4),e.updatePieceImage(),new f(w.sounds.promote.data).play(),this.controller.save(),this.controller.next(new ms)}dispose(){super.dispose()}onTimeUp(){this.disconnect(),this.controller.next(new ls(3,!0))}sendPromotion(e){2===this.controller.room.connection.state&&this.controller.room.send("Promote",{playerIndex:this.playerIndex,chosen:e})}}class Fs extends rt{constructor(){super()}initialize(){super.initialize(),this.team=this.controller.gameState.team,this.playerIndex=this.controller.getPlayerIndex(this.team),0===this.controller.gameState.gameMode&&(this.controller.gameState.penalty+=12e4,this.screen.timerDisplay.penalty("+2 minutes"));let e=this.controller.getTeamClock(this.team);this.controller.gameState.timeLimit!==k.None&&e>=this.controller.gameState.timeLimit&&(e=this.controller.gameState.timeLimit-1),this.controller.gameState.teams[this.team].time=e,this.controller.save(),this.controller.popState(),this.sendUndo(),this.controller.next(new as)}dispose(){super.dispose()}update(e){super.update(e)}sendUndo(){2===this.controller.room.connection.state&&this.controller.room.send("Undo",{playerIndex:this.playerIndex,postGameState:this.controller.gameState.pack()})}}class Ps extends ai{initialize(){this.soundsToggleButton=new it("Sounds",!_.isMuted),this.soundsToggleButton.input.onPointerClick.add(this.soundsToggleButton_onClick,this),this.buttons.push(this.soundsToggleButton),!Z.isMobileDevice&&"exe"!==window.games247.nativeAppType||(this.fullscreenToggleButton=new it("Fullscreen",L.fullscreen),this.fullscreenToggleButton.input.onPointerClick.add(this.fullscreenToggleButton_onClick,this),this.buttons.push(this.fullscreenToggleButton)),this.showTimerToggleButton=new it("Show Timer",L.showTimer),this.showTimerToggleButton.input.onPointerClick.add(this.showTimerToggleButton_onClick,this),this.buttons.push(this.showTimerToggleButton),this.showMovesToggleButton=new it("Show Moves",L.showMoves),this.showMovesToggleButton.input.onPointerClick.add(this.showMovesToggleButton_onClick,this),this.buttons.push(this.showMovesToggleButton),this.rotateBoardToggleButton=new it("Rotate Board",L.rotateBoardForLocalTwoPlayer),this.rotateBoardToggleButton.input.onPointerClick.add(this.rotateBoardToggleButton_onClick,this),this.buttons.push(this.rotateBoardToggleButton),!Z.isMobileDevice&&"exe"!==window.games247.nativeAppType||(this.exitButton=new st("Exit Game"),this.exitButton.clickSound=null,this.exitButton.input.onPointerClick.add(this.exitButton_onClick,this),this.buttons.push(this.exitButton)),super.initialize()}added(){Ps.isOpen=!0,super.added()}removed(){Ps.isOpen=!1,super.removed()}fullscreenToggleButton_onClick(){this.track("Fullscreen Button Pressed"),L.fullscreen=!L.fullscreen,L.save(),this.fullscreenToggleButton.isOn=L.fullscreen,n.preferFullscreen=L.fullscreen,L.fullscreen?m.fullscreen.isFullscreen||m.fullscreen.requestFullscreen():m.fullscreen.isFullscreen&&m.fullscreen.exitFullscreen()}exitButton_onClick(){this.track("Exit Game Button Pressed"),window.games247.nativeAppType?window.close():n.pause()}soundsToggleButton_onClick(){this.track("Mute Button Pressed"),_.isMuted=!_.isMuted,this.soundsToggleButton.isOn=!_.isMuted,L.mute=_.isMuted,L.save()}showTimerToggleButton_onClick(){this.track("Show Timer Button Pressed"),L.showTimer=!L.showTimer,this.showTimerToggleButton.isOn=L.showTimer,L.save()}showMovesToggleButton_onClick(){this.track("Show Moves Button Pressed"),L.showMoves=!L.showMoves,this.showMovesToggleButton.isOn=L.showMoves,L.save()}rotateBoardToggleButton_onClick(){this.track("Rotate Board Button Pressed"),L.rotateBoardForLocalTwoPlayer=!L.rotateBoardForLocalTwoPlayer,this.rotateBoardToggleButton.isOn=L.rotateBoardForLocalTwoPlayer,L.save()}}Ps.isOpen=!1;class Bs extends yi{initialize(){document.documentElement.classList.contains("desktop")&&(this.useAdStack=!0),super.initialize()}markPlacementOpportunity(){Ki.adPlacementOpportunities++,Ki.save()}shouldShowAd(){let e=!1;return wi.enabled&&1<Ki.adPlacementOpportunities&&1<=Ki.launches&&(e=!0),e}}class As extends ni{constructor(e,t,i){super("Gameplay Screen",i),this.isOpenedByJoinLink=t,this.controller=new Zi(this,e)}initialize(){this.display.addChild(this.pointerCatchLayer=new C).input=new x(this.pointerCatchLayer,!1,!1,new h),this.display.addChild(this.boardLayer=new C).input=new x(this.boardLayer,!1,!0),this.display.addChild(this.passivesLayer=new C).input=new x(this.passivesLayer,!1,!1),this.display.addChild(this.interactivesLayer=new C).input=new x(this.interactivesLayer,!1,!0),this.boardLayer.addChild(this.boardDisplay=new Us(this.controller.gameState.board)),this.passivesLayer.addChild(this.hud=new Ys),this.undoButton=new Ct,this.undoButton.x=16,this.undoButton.y=130,this.undoButton.visible=this.controller.gameState.isUndoAllowed(),this.interactivesLayer.addChild(this.undoButton),this.hintButton=new Tt,this.hintButton.x=16,this.hintButton.y=244,this.hintButton.visible=this.controller.gameState.isHintAllowed(),this.display.addChild(this.hintButton),this.legendButton=new Ft,this.legendButton.x=F.width-this.legendButton.w-16,this.legendButton.y=130,this.display.addChild(this.legendButton),this.timerDisplay=new ti(0,!this.controller.gameState.isPausable()),this.display.addChild(this.timerDisplay),this.timerDisplay.pauseButton.input.onPointerClick.add(this.pauseButton_onClick,this),this.recordDisplay=new ii(0===this.controller.gameState.gameMode?Qi.times[this.controller.gameState.difficulty]:0,3===this.controller.gameState.gameMode,4===this.controller.gameState.gameMode,1===this.controller.gameState.gameMode),this.display.addChild(this.recordDisplay),this.boardDisplay.pieceLayer.visible=!1,this.hud.visible=!1,this.controller.next(new os),super.initialize()}removed(){this.controller.next(null),this.controller.dispose(),super.removed()}gainFocus(){R.instance.navBar.settings.show(),R.instance.navBar.home.show(),super.gainFocus()}doClose(e,t=[]){this.nextScreen=e,this.childScreens=t,this.close()}homeClicked(){this.inputEnabled=!1,this.controller.exit(),super.homeClicked()}pauseButton_onClick(){let e=null;0===this.controller.gameState.gameMode?e=new Hs(Di[O.onePlayer.difficulty],this.controller.getTeamClock(this.controller.gameState.firstPlayerWhite?0:1)+O.onePlayer.penalty):1===this.controller.gameState.gameMode&&(e=new Hs("2 Player",this.controller.getTeamClock(this.controller.gameState.firstPlayerWhite?0:1)+this.controller.getTeamClock(this.controller.gameState.firstPlayerWhite?1:0)+O.twoPlayer.penalty)),e&&(this.track("Pause Button Pressed"),R.instance.navBar.settings.hide(),R.instance.navBar.home.hide(),this.screenManager.add(e))}anchor(){var e=new h(122,16,F.width-244,F.height-E.height-16),t=Math.min(e.width/1200,e.height/1200),t=(this.boardDisplay.scaleX=this.boardDisplay.scaleY=t,1200*this.boardDisplay.scaleX),e=(this.boardDisplay.x=e.x+e.width/2,this.boardDisplay.y=e.y+e.height/2,new h(e.x+e.width/2+-.5*t,e.y+e.height/2+-.5*t,t,t));this.pointerCatchLayer.input.hitArea.set(0,0,F.width,F.height),this.updateBoardRotatedState(),this.updateHUDFlippedState(),this.hud.anchor(e),this.timerDisplay.y=F.height,this.recordDisplay.x=F.width,this.recordDisplay.y=F.height,this.legendButton.x=F.width-E.sideMargin-this.legendButton.w,super.anchor()}updateBoardRotatedState(){let t=!1;if(0===this.controller.gameState.gameMode||3===this.controller.gameState.gameMode)!1===this.controller.gameState.firstPlayerWhite&&(t=!0);else if(1===this.controller.gameState.gameMode)L.rotateBoardForLocalTwoPlayer?1===this.controller.activeTeam&&(t=!0):!1===this.controller.gameState.firstPlayerWhite&&(t=!0);else{let e=this.controller.roomState.players[0];this.controller.roomState.players[1].sessionId===this.controller.room.sessionId&&(e=this.controller.roomState.players[1]),1===e.team&&(t=!0)}this.boardDisplay.setRotated(t)}updateHUDFlippedState(){let t=!1;if(0===this.controller.gameState.gameMode||3===this.controller.gameState.gameMode)!1===this.controller.gameState.firstPlayerWhite&&(t=!0);else if(1===this.controller.gameState.gameMode)!1===this.controller.gameState.firstPlayerWhite&&(t=!0);else{let e=this.controller.roomState.players[0];this.controller.roomState.players[1].sessionId===this.controller.room.sessionId&&(e=this.controller.roomState.players[1]),1===e.team&&(t=!0)}this.hud.setFlipped(t)}sync(){this.boardDisplay.pieceLayer.visible=!0,this.hud.visible=!0,this.boardDisplay.sync(),this.hud.sync(this.controller.room,this.controller.roomState),this.hud.playerStatusDisplays[0].setTime(this.controller.getTeamClock(0)),this.hud.playerStatusDisplays[1].setTime(this.controller.getTeamClock(1)),this.undoButton.x=E.sideMargin,this.hintButton.x=E.sideMargin,this.legendButton.x=F.width-E.sideMargin-this.legendButton.w,this.controller.updateUndoButton(),this.controller.updateHintButton()}update(e){!this.isFocused&&4!==this.controller.gameState.gameMode&&3!==this.controller.gameState.gameMode||(this.controller.update(e),this.hud.update(e),this.boardDisplay.update(e)),this.timerDisplay.update(e),super.update(e)}draw(){this.hud.playerStatusDisplays[0].setTime(this.controller.getTeamClock(0),!1),this.hud.playerStatusDisplays[1].setTime(this.controller.getTeamClock(1),!1);let e=this.controller.getTeamClock(this.controller.gameState.firstPlayerWhite?0:1);1===this.controller.gameState.gameMode&&(e+=this.controller.getTeamClock(this.controller.gameState.firstPlayerWhite?1:0)),e+=this.controller.gameState.penalty,this.timerDisplay.setTime(e),this.timerDisplay.timeTextField.visible=L.showTimer,super.draw()}}class Es extends ni{constructor(){super("Connecting Screen",!0),this.onCancel=new r,this.isPopup=!0}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Dt(640,360),this.display.addChild(this.panel),this.titleTextField=new S("Connecting",w.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=320,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new S("Just a moment...",w.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=320,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.cancelButton=new A("Cancel",340,90),this.cancelButton.x=320-this.cancelButton.w/2,this.cancelButton.y=360-this.cancelButton.h-32,this.panel.content.addChild(this.cancelButton),this.cancelButton.input.onPointerClick.add(this.cancelButton_onClick,this),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}cancelButton_onClick(){this.track("Cancel Button Pressed"),this.onCancel.invoke(this)}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}class Ms extends ni{constructor(e,t,i,s){super(e,s),this.onClose=new r,this.isPopup=!0,this._title=t,this._caption=i}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Dt(1080,360),this.display.addChild(this.panel),this.titleTextField=new S(this._title,w.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=540,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new S(this._caption,w.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=540,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.closeButton=new A("Close",340,90),this.closeButton.x=540-this.closeButton.w/2,this.closeButton.y=360-this.closeButton.h-32,this.panel.content.addChild(this.closeButton),this.closeButton.input.onPointerClick.add(this.closeButton_onClick,this),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}closeButton_onClick(){this.track("Close Button Pressed"),this.onClose.invoke(this)}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}class Ls extends ni{constructor(){super("Waiting For Replay Screen",!1),this.isPopup=!0,this.startTime=Date.now()}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);this.panel=new Dt(1080,380),this.display.addChild(this.panel),this.titleTextField=new S("Waiting to Play Again",w.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=540,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new S("Waiting for your opponent to choose play again.",w.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=540,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.timerTextField=new S("",w.fonts["Asap-Regular"].data,32),this.timerTextField.fill="#888888",this.timerTextField.align="center",this.timerTextField.baseline="bottom",this.timerTextField.x=540,this.timerTextField.y=238,this.panel.addChild(this.timerTextField),this.cancelButton=new A("Cancel",340,90),this.cancelButton.x=540-this.cancelButton.w/2,this.cancelButton.y=380-this.cancelButton.h-32,this.panel.content.addChild(this.cancelButton),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}update(e){super.update(e)}draw(){var e=Date.now()-this.startTime;let t=6e4-e;t<0&&(t=0),this.timerTextField.text=u.toTimerString(t,0)+" Remaining"}}class Os extends ni{constructor(e,t){super("Waiting For Opponent Screen",!1),this.onCancel=new r,this.linkField=new C,this.hideCopiedIn=0,this.isPopup=!0,this.roomId=e,this.canCopy=!0,this.hadOpponent=t,this.startTime=Date.now()}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.dimmer.cursor=null,this.display.addChild(this.dimmer);let e=800,t=380;var i;this.roomId&&(e=1080,t=560),this.panel=new Dt(e,t),this.display.addChild(this.panel),this.titleTextField=new S("Finding Opponent",w.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=e/2,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new S("Please wait while your opponent joins.",w.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=e/2,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.timerTextField=new S("",w.fonts["Asap-Regular"].data,32),this.timerTextField.fill="#CCCCCC",this.timerTextField.align="center",this.timerTextField.baseline="bottom",this.timerTextField.x=e/2,this.timerTextField.y=t-32-90-20,this.panel.addChild(this.timerTextField),this.roomId&&(this.titleTextField.text="Invite a Friend",this.captionTextField.text="Share this link to play with a friend",this.hadOpponent&&(this.titleTextField.text="Your Friend Left"),this.linkField=new C,this.panel.addChild(this.linkField),this.linkTextField=new S(this.getLinkText(),w.fonts["Asap-Regular"].data,34),this.linkTextField.fill="#03a9f4",this.linkTextField.align="left",this.linkTextField.x=18,this.linkTextField.y=18,i=Math.ceil(this.linkTextField.measure().width),this.linkCopyButton=new A("Copy",200,90),this.linkCopyButton.x=this.linkTextField.x+i+36,this.linkCopyButton.y=-6,i=i+36,this.linkFieldBackground=new T(0,0,i,82,6,"#222222"),this.linkFieldBackground.y=-2,this.linkFieldBackground.strokeStyle="#AAAAAA",this.linkFieldBackground.strokeWidth=2,i=this.linkCopyButton.x+this.linkCopyButton.w,this.linkField.y=240,this.linkField.x=e/2-i/2,this.linkField.addChild(this.linkFieldBackground),this.linkField.addChild(this.linkTextField),this.linkField.addChild(this.linkCopyButton),this.linkField.input=new x(this.linkField,!0,!0,this.linkFieldBackground.rectangle),this.linkField.cursor="pointer",this.linkField.input.onPointerClick.add(this.linkField_onPointerClick,this),this.copiedTextField=new S("Link copied to clipboard!",w.fonts["Asap-Regular"].data,30),this.copiedTextField.fill="#34ea3a",this.copiedTextField.align="center",this.copiedTextField.x=i/2,this.copiedTextField.y=this.linkFieldBackground.rectangle.height+12,this.linkField.addChild(this.copiedTextField),this.copiedTextField.visible=!1),this.cancelButton=new A("Cancel",340,90),this.cancelButton.x=e/2-this.cancelButton.w/2,this.cancelButton.y=t-this.cancelButton.h-32,this.panel.content.addChild(this.cancelButton),this.cancelButton.input.onPointerClick.add(this.cancelButton_onClick,this),super.initialize()}getLinkText(){if(window.games247.nativeAppType){let e=R.remoteHost.host,t=(0<=e.indexOf(":")&&(e=e.substring(0,e.indexOf(":"))),e=e.replace("room.",""),y.info.theme+"/");return"247"===y.info.theme&&(t=""),"Development"===R.remoteHost.envName?e+":8081//"+t+"?room="+this.roomId:(R.remoteHost.envName,e+"/"+t+"?room="+this.roomId)}if("Development"===R.remoteHost.envName)return location.host+location.pathname+"?room="+this.roomId;if("Staging"===R.remoteHost.envName)return location.host+location.pathname+"?room="+this.roomId;{let e=location.host+location.pathname+"?room="+this.roomId;return 0!==e.indexOf("www.")&&(e="www."+e),e}}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.hide(),super.gainFocus()}doClose(){this.close()}copy(e,t,i){let s=this;function n(){s.copiedTextField.visible=!0,s.hideCopiedIn=5e3}if(navigator.clipboard)o=navigator.clipboard.writeText(e),o&&d.promise(o,function(){n()},function(e){l.info("copy failed",e)});else{o=document.createElement("textarea");o.value=e,o.style.cssText="position: absolute; top: 0px; left: 0px; width: 100px; z-index: 9999999;",document.body.appendChild(o),o.select();try{document.execCommand("copy")}catch(e){l.info("failed to execute copy command")}document.body.removeChild(o),l.info("Legacy copy run..."),n()}var o}linkField_onPointerClick(e,t){var i=this.linkTextField.text,s="Join My Game",n="Join my "+y.info.name+" game\nGame Code: "+this.roomId+"\nGame Link: "+i;window.games247.nativeAppType?this.copy("https://"+i,s,n):this.copy(i,s,n)}cancelButton_onClick(){this.track("Cancel Button Pressed"),this.onCancel.invoke(this)}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}update(e){0<this.hideCopiedIn&&(this.hideCopiedIn-=e,this.hideCopiedIn<=0)&&(this.copiedTextField.visible=!1),super.update(e)}draw(){var e=Date.now()-this.startTime;let t=6e5-e;t<0&&(t=0),this.timerTextField.text=u.toTimerString(t,0)+" Remaining"}}class Rs extends hi{constructor(e){super(e,{layout:2})}hasInProgressGame(e){return 1===e?O.hasInProgressGame(!0):O.hasInProgressGame(!1)}createLevelSelect(){return new Is}createDailyChallengeGameplay(){throw new Error("Should not be used!")}createResumeGame(e){return 1===e?new li(Di[O.onePlayer.difficulty],O.onePlayer.teams[O.onePlayer.firstPlayerWhite?0:1].time+O.onePlayer.penalty,!1):new li("2 Player",O.twoPlayer.teams[0].time+O.twoPlayer.teams[1].time+O.twoPlayer.penalty,!1)}createResumedGameplay(e){return 1===e?(e=O.onePlayer,e=new Ji(0,e.pack()),new Bs(new As(e,!1,!0))):(e=O.twoPlayer,e=new Ji(1,e.pack()),new Bs(new As(e,!1,!0)))}createMultiplayerGameMode(){throw new Error("Should not be used!")}createPassAndPlayGame(){return new Gs(null)}createPlayOnline(){return new Ns}createPlayOnlineAnyone(){var e=new Ji(4,!0);return new Bs(new As(e,!1,!0))}createPlayOnlineInviteFriend(){var e=new Ji(4,!1);return new As(e,!1,!0)}}class Ds extends ni{constructor(e,t,i){super("Promotion Screen",!0),this.queenBtn=null,this.rookBtn=null,this.bishopBtn=null,this.knightBtn=null,this.chosen=null,this.isPopup=!0,this.gameplayScreen=e,this.team=t,this._showClock=i}initialize(){this.startTime=Date.now(),this.dimmer=new Ze(new v(0,0,0,.6)),this.dimmer.input=new x(this.dimmer,!1,!1),this.display.addChild(this.dimmer);this._showClock,this.panel=new Dt(880,520),this.display.addChild(this.panel),this.titleTextField=new S("Promotion",w.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=440,this.titleTextField.y=9,this.panel.addChild(this.titleTextField),this.captionTextField=new S("Choose a piece to promote your pawn to",w.fonts["Asap-Regular"].data,44),this.captionTextField.fill="#CCCCCC",this.captionTextField.align="center",this.captionTextField.x=440,this.captionTextField.y=120,this.panel.addChild(this.captionTextField),this.timerTextField=new S(u.toTimerString(6e4)+" Remaining",w.fonts["Asap-Regular"].data,32),this.timerTextField.fill="#888888",this.timerTextField.align="center",this.timerTextField.baseline="bottom",this.timerTextField.x=440,this.timerTextField.y=218,this.panel.addChild(this.timerTextField),this._showClock||(this.timerTextField.visible=!1);this.queenBtn=new Xs(this.team,4),this.queenBtn.x=68,this.queenBtn.y=this._showClock?240:220,this.panel.addChild(this.queenBtn),this.rookBtn=new Xs(this.team,3),this.rookBtn.x=256,this.rookBtn.y=this.queenBtn.y,this.panel.addChild(this.rookBtn),this.bishopBtn=new Xs(this.team,2),this.bishopBtn.x=444,this.bishopBtn.y=this.queenBtn.y,this.panel.addChild(this.bishopBtn),this.knightBtn=new Xs(this.team,1),this.knightBtn.x=632,this.knightBtn.y=this.queenBtn.y,this.panel.addChild(this.knightBtn),this.queenBtn.input.onPointerClick.add(this.pieceBtn_onClick,this),this.rookBtn.input.onPointerClick.add(this.pieceBtn_onClick,this),this.bishopBtn.input.onPointerClick.add(this.pieceBtn_onClick,this),this.knightBtn.input.onPointerClick.add(this.pieceBtn_onClick,this),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.hide(),super.gainFocus()}pieceBtn_onClick(e){this.chosen=e.type,this.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}draw(){var e=Date.now()-this.startTime;let t=6e4-e;t<0&&(t=0),this.timerTextField.text=u.toTimerString(t,0)+" Remaining"}}class Is extends di{constructor(){super([0,1,2,3],L.levelSelectPage)}createItem(e){var t=Qi.times[e],t=new Gt(Di[e],void 0,t?u.toTimerString(t,0):"--:--",R.instance.calcStarRating(t,e),e);return t}carousel_onIndexChange(e,t){t?this.track("Next Arrow Button Pressed"):this.track("Previous Arrow Button Pressed"),L.levelSelectPage=this.carousel.currentIndex,L.save()}createNewGame(e){var t=e.value;return this.track(Di[t]+" Button Pressed"),new Gs(e.value)}createDailyChallengeGameplay(){var e=new $i(3,B.seed),e=(M.newGame(e,!0),new Ji(3,e.pack()));return bi.track("GameTracking","One Player - Create Game - Daily Challenge"),new As(e,!1,!0)}createGameMode(){throw new Error("Should not be used!")}createTitle(){return new Rs(!0)}}class Gs extends oi{constructor(e){super("Options",(null===e?"Two":"One")+" Player Setup Screen"),this._firstPlayerWhite=!0,this._timeLimit=null,this.difficulty=e}initialize(){var e=this.titleTextField.fontSize+20+75,t=(this.piecesTextField=new S("Pieces",w.fonts["AsapCondensed-SemiBold"].data,40),this.piecesTextField.shadowFill="#000000",this.piecesTextField.shadowAlpha=.3,this.piecesTextField.shadowX=-3,this.piecesTextField.shadowY=3,this.piecesTextField.fill="#FFFFFF",this.piecesTextField.align="left",this.piecesTextField.y=e,this.content.addChild(this.piecesTextField),e+=40,e+=18,this.whitePawnButton=new dt(150,150),new Ye(w.images["@theme/white_pawn"])),t=(t.scaleX=t.scaleY=120/t.height,t.regX=t.width/2,t.regY=t.height/2,t.x=this.whitePawnButton.w/2,t.y=this.whitePawnButton.h/2,this.whitePawnButton.btn.addChild(t),this.whitePawnButton.y=e,this.content.addChild(this.whitePawnButton),this.leftPieceTextField=new S(null===this.difficulty?"Player 1":"Player",w.fonts["AsapCondensed-SemiBold"].data,28),this.leftPieceTextField.shadowFill="#000000",this.leftPieceTextField.shadowAlpha=.3,this.leftPieceTextField.shadowX=-2,this.leftPieceTextField.shadowY=2,this.leftPieceTextField.fill="#FFFFFF",this.leftPieceTextField.align="left",this.leftPieceTextField.x=0,this.leftPieceTextField.y=e+150+10,this.content.addChild(this.leftPieceTextField),this.swapCheckersButton=new ut(w.images.icon_swap_hor,90,90),this.swapCheckersButton.x=200,this.swapCheckersButton.y=this.whitePawnButton.y+this.whitePawnButton.h/2-this.swapCheckersButton.h/2,this.content.addChild(this.swapCheckersButton),this.blackPawnButton=new dt(150,150),new Ye(w.images["@theme/black_pawn"]));t.scaleX=t.scaleY=120/t.height,t.regX=t.width/2,t.regY=t.height/2,t.x=this.blackPawnButton.w/2,t.y=this.blackPawnButton.h/2,this.blackPawnButton.btn.addChild(t),this.blackPawnButton.x=340,this.blackPawnButton.y=e,this.content.addChild(this.blackPawnButton),this.rightPieceTextField=new S(null===this.difficulty?"Player 2":"Computer",w.fonts["AsapCondensed-SemiBold"].data,28),this.rightPieceTextField.shadowFill="#000000",this.rightPieceTextField.shadowAlpha=.3,this.rightPieceTextField.shadowX=-2,this.rightPieceTextField.shadowY=2,this.rightPieceTextField.fill="#FFFFFF",this.rightPieceTextField.align="left",this.rightPieceTextField.x=this.blackPawnButton.x,this.rightPieceTextField.y=e+150+10,this.content.addChild(this.rightPieceTextField),e+=178,e+=90,this.timeLimitTextField=new S("Time Limit",w.fonts["AsapCondensed-SemiBold"].data,40),this.timeLimitTextField.shadowFill="#000000",this.timeLimitTextField.shadowAlpha=.3,this.timeLimitTextField.shadowX=-3,this.timeLimitTextField.shadowY=3,this.timeLimitTextField.fill="#FFFFFF",this.timeLimitTextField.align="left",this.timeLimitTextField.y=e,this.content.addChild(this.timeLimitTextField),e+=40,e+=18;this.timeLimitNoneButton=new A("N",120,120),this.timeLimitNoneButton.y=e,this.timeLimitNoneButton.label.fontSize=64,this.timeLimitNoneButton.value=k.None,this.timeLimitNoneButton.setAsSelectableOption(!0),this.content.addChild(this.timeLimitNoneButton),this.timeLimit5Button=new A("5",120,120),this.timeLimit5Button.x=160,this.timeLimit5Button.y=e,this.timeLimit5Button.label.fontSize=64,this.timeLimit5Button.value=k.FiveMinutes,this.timeLimit5Button.setAsSelectableOption(!0),this.content.addChild(this.timeLimit5Button),this.timeLimit10Button=new A("10",120,120),this.timeLimit10Button.x=320,this.timeLimit10Button.y=e,this.timeLimit10Button.label.fontSize=64,this.timeLimit10Button.value=k.TenMinutes,this.timeLimit10Button.setAsSelectableOption(!0),this.content.addChild(this.timeLimit10Button),this.timeLimit15Button=new A("15",120,120),this.timeLimit15Button.x=480,this.timeLimit15Button.y=e,this.timeLimit15Button.label.fontSize=64,this.timeLimit15Button.value=k.FifteenMinutes,this.timeLimit15Button.setAsSelectableOption(!0),this.content.addChild(this.timeLimit15Button),this.timeLimit30Button=new A("30",120,120),this.timeLimit30Button.x=640,this.timeLimit30Button.y=e,this.timeLimit30Button.label.fontSize=64,this.timeLimit30Button.value=k.ThirtyMinutes,this.timeLimit30Button.setAsSelectableOption(!0),this.content.addChild(this.timeLimit30Button),e+=100,e+=90,this.threefoldTextField=new S("Threefold Repetition Draw",w.fonts["AsapCondensed-SemiBold"].data,40),this.threefoldTextField.shadowFill="#000000",this.threefoldTextField.shadowAlpha=.3,this.threefoldTextField.shadowX=-3,this.threefoldTextField.shadowY=3,this.threefoldTextField.fill="#FFFFFF",this.threefoldTextField.align="left",this.threefoldTextField.y=e,this.content.addChild(this.threefoldTextField),e+=40,e+=18,this.threefoldToggleSwitch=new mt,this.threefoldToggleSwitch.y=e,this.content.addChild(this.threefoldToggleSwitch),e+=90,e+=120,this.startGameButton=new A("Start Game"),this.startGameButton.y=e,this.content.addChild(this.startGameButton),e+=this.startGameButton.h,this.optsW=760,this.optsH=e,this.titleTextField.x=this.optsW/2,this.content.regX=this.optsW/2,this.content.regY=this.optsH/2,this.setPieceToggleState(L.firstPlayerWhite,!1),this.setTimeLimitToggleState(L.timeLimit,!1),this.threefoldToggleSwitch.setToggleState(L.threefoldRule,!1),this.whitePawnButton.input.onPointerClick.add(this.pieceSwapButton_onClick,this),this.blackPawnButton.input.onPointerClick.add(this.pieceSwapButton_onClick,this),this.swapCheckersButton.input.onPointerClick.add(this.pieceSwapButton_onClick,this),this.threefoldToggleSwitch.input.onPointerClick.add(this.threefoldToggleSwitch_onClick,this),this.timeLimitNoneButton.input.onPointerClick.add(this.timeLimitButton_onClick,this),this.timeLimit5Button.input.onPointerClick.add(this.timeLimitButton_onClick,this),this.timeLimit10Button.input.onPointerClick.add(this.timeLimitButton_onClick,this),this.timeLimit15Button.input.onPointerClick.add(this.timeLimitButton_onClick,this),this.timeLimit30Button.input.onPointerClick.add(this.timeLimitButton_onClick,this),this.startGameButton.input.onPointerClick.add(this.startGameButton_onClick,this),this.startGameButton.x=this.optsW/2-this.startGameButton.w/2,super.initialize()}homeClicked(){this.track("Home Button Pressed"),this.nextScreen=null===this.difficulty?new Rs(!0):new Is,this.close()}gainFocus(){P._instance.navBar.settings.show(),P._instance.navBar.home.show(),super.gainFocus()}anchor(){var e=F.width,t=F.height;this.content.x=e/2,this.content.y=t/2-10,super.anchor()}update(e){this.threefoldToggleSwitch.update(e),super.update(e)}setPieceToggleState(e,t){this._firstPlayerWhite!==e&&(this._firstPlayerWhite=e,t&&(L.firstPlayerWhite=e,L.save()),e?(this.blackPawnButton.x=this.whitePawnButton.x,this.whitePawnButton.x=0):(this.whitePawnButton.x=this.blackPawnButton.x,this.blackPawnButton.x=0))}setTimeLimitToggleState(e,t){this._timeLimit!==e&&(this._timeLimit=e,t&&(L.timeLimit=e,L.save()),this.timeLimitNoneButton.setAsSelectableOptionSelected(this.timeLimitNoneButton.value===e),this.timeLimit5Button.setAsSelectableOptionSelected(this.timeLimit5Button.value===e),this.timeLimit10Button.setAsSelectableOptionSelected(this.timeLimit10Button.value===e),this.timeLimit15Button.setAsSelectableOptionSelected(this.timeLimit15Button.value===e),this.timeLimit30Button.setAsSelectableOptionSelected(this.timeLimit30Button.value===e))}pieceSwapButton_onClick(){this.track("Swap Pieces Button Pressed"),this.setPieceToggleState(!this._firstPlayerWhite,!0)}threefoldToggleSwitch_onClick(){this.track("Threefold Rule Button Pressed"),this.threefoldToggleSwitch.setToggleState(!this.threefoldToggleSwitch.isOn,!0),L.threefoldRule=this.threefoldToggleSwitch.isOn,L.save()}timeLimitButton_onClick(e){this.track("Time Limit "+e.label.text+" Button Pressed"),this.setTimeLimitToggleState(e.value,!0)}startGameButton_onClick(){var e;this.track("Start Game Button Pressed"),null!==this.difficulty?(e=new $i(0,this.difficulty,L.firstPlayerWhite?0:1,L.timeLimit,L.threefoldRule),M.newGame(e,!0),O.onePlayer=e,O.save(),e=new Ji(0,e.pack()),bi.track("GameTracking","One Player - Create Game - "+Di[this.difficulty]),this.nextScreen=new Bs(new As(e,!1,!0))):(e=new $i(1,L.firstPlayerWhite?0:1,L.timeLimit,L.threefoldRule),M.newGame(e,!0),O.twoPlayer=e,O.save(),e=new Ji(1,e.pack()),bi.track("GameTracking","Pass & Play - Create Game"),this.nextScreen=new Bs(new As(e,!1,!0))),this.close()}}class Ns extends fi{constructor(){super(!0)}}class zs extends ni{constructor(e){super("Piece Legend Screen",!0),this.pawnBtn=null,this.knightBtn=null,this.bishopBtn=null,this.rookBtn=null,this.queenBtn=null,this.kingBtn=null,this.isPopup=!0,this.team=e}initialize(){this.dimmer=new Ze(new v(0,0,0,.6)),this.display.addChild(this.dimmer),this.dimmer.input.onPointerClick.add(this.dimmer_onClick,this);this.panel=new Dt(760,680),this.display.addChild(this.panel),this.titleTextField=new S("Piece Legend",w.fonts["OpenSans-ExtraBold"].data,64),this.titleTextField.underStroke="#000000",this.titleTextField.underStrokeWidth=12,this.titleTextField.fill="#FFFFFF",this.titleTextField.align="center",this.titleTextField.x=380,this.titleTextField.y=9,this.panel.addChild(this.titleTextField);this.pawnBtn=new Xs(this.team,0),this.pawnBtn.x=78,this.pawnBtn.y=120,this.pawnBtn.input.pointerEnabled=this.pawnBtn.input.pointerChildrenEnabled=!1,this.panel.addChild(this.pawnBtn),this.knightBtn=new Xs(this.team,1),this.knightBtn.x=290,this.knightBtn.y=this.pawnBtn.y,this.knightBtn.input.pointerEnabled=this.knightBtn.input.pointerChildrenEnabled=!1,this.panel.addChild(this.knightBtn),this.bishopBtn=new Xs(this.team,2),this.bishopBtn.x=502,this.bishopBtn.y=this.pawnBtn.y,this.bishopBtn.input.pointerEnabled=this.bishopBtn.input.pointerChildrenEnabled=!1,this.panel.addChild(this.bishopBtn),this.rookBtn=new Xs(this.team,3),this.rookBtn.x=78,this.rookBtn.y=this.pawnBtn.y+260,this.rookBtn.input.pointerEnabled=this.rookBtn.input.pointerChildrenEnabled=!1,this.panel.addChild(this.rookBtn),this.queenBtn=new Xs(this.team,4),this.queenBtn.x=290,this.queenBtn.y=this.rookBtn.y,this.queenBtn.input.pointerEnabled=this.queenBtn.input.pointerChildrenEnabled=!1,this.panel.addChild(this.queenBtn),this.kingBtn=new Xs(this.team,5),this.kingBtn.x=502,this.kingBtn.y=this.rookBtn.y,this.kingBtn.input.pointerEnabled=this.kingBtn.input.pointerChildrenEnabled=!1,this.panel.addChild(this.kingBtn),this.closeButton=new Pt,this.closeButton.x=this.panel.w-90-16,this.closeButton.y=16,this.panel.addChild(this.closeButton),this.closeButton.input.onPointerClick.add(this.closeButton_onClick,this),super.initialize()}gainFocus(){P._instance.navBar.home.hide(),P._instance.navBar.settings.hide(),super.gainFocus()}dimmer_onClick(){this.track("Dimmer Pressed"),this.close()}closeButton_onClick(){this.track("Close Button Pressed"),this.close()}anchor(){this.panel.x=F.width/2,this.panel.y=F.height/2,super.anchor()}}class Hs extends ci{added(){Hs.isOpen=!0,super.added()}removed(){Hs.isOpen=!1,super.removed()}}Hs.isOpen=!1;class Us extends C{constructor(i){super(),this.boardImageLayer=null,this.cellLayer=null,this.pieceLayer=null,this.boardBmp=null,this.hitCatcher=null,this.pieceDisplays=[],this.grid=new Array(8),this.cellDisplays=[],this.board=null,this.cellAlphaTween=new o(1,.6,500,0,a.none,new X(-1,!0)),this.fastAlphaTween=new o(1,.6,250,0,a.none,new X(-1,!0)),this.board=i,this.addChild(this.boardImageLayer=new C).input=new x(this.boardImageLayer,!1,!0),this.addChild(this.cellLayer=new C).input=new x(this.cellLayer,!1,!0),this.addChild(this.pieceLayer=new C).input=new x(this.pieceLayer,!1,!1),this.cellLayer.x=this.cellLayer.y=this.pieceLayer.x=this.pieceLayer.y=30,this.boardImageLayer.addChild(this.boardBmp=new Ye(w.images["@theme/board"])),this.boardImageLayer.addChild(this.hitCatcher=new C).input=new x(this.hitCatcher,!1,!1,new h(0,0,1200,1200));for(let t=0;t<8;++t){var s=this.grid[t]=new Array(8);for(let e=0;e<8;++e){var n=i.grid[t][e],n=new $s(this,n);this.cellDisplays.push(s[e]=n),this.cellLayer.addChild(n)}}for(var e of i.pieces){e=new qs(e);this.pieceDisplays.push(e),this.pieceLayer.addChild(e)}this.regX=this.boardBmp.width/2,this.regY=this.boardBmp.height/2,this.sync()}sync(){for(var e of this.pieceDisplays)e.sync();for(var t of this.cellDisplays)t.sync()}setRotated(e){this.rotation=e?180:0;for(var t of this.pieceDisplays)t.setRotated(e);for(var i of this.cellDisplays)i.setRotated(e)}update(e){this.cellAlphaTween.update(e),this.fastAlphaTween.update(e);for(var t of this.cellDisplays)t.update(e)}}class $s extends C{constructor(e,t){super(),this.selected=!1,this.moveToCapture=!1,this.moveToNormal=!1,this.moveable=!1,this.capture=!1,this._desiredHighlightShapeVis=!1,this._desiredCaptureShapeVis=!1,this._hintLevel=0,this.boardDisplay=e,this.cell=t;this.highlightShape=new T(3,3,136.5,136.5,-12,"rgba(255,255,255,0.5)"),this.highlightShape.strokeWidth=3,this.highlightShape.strokeStyle="rgba(255,255,255,1)",this.addChild(this.highlightShape),this.captureDisplay=new C,this.captureDisplay.x=this.captureDisplay.y=71.25,this.addChild(this.captureDisplay);let i=new T(-71.25,-7.5,142.5,15,4,"rgba(255,0,0,1)");i.rotation=45,this.captureDisplay.addChild(i),i=new T(-71.25,-7.5,142.5,15,4,"rgba(255,0,0,1)"),i.rotation=-45,this.captureDisplay.addChild(i),this.x=142.5*(t.c+.5),this.y=142.5*(t.r+.5),this.regX=this.regY=71.25,this.alphaTween=this.boardDisplay.cellAlphaTween,this.input=new x(this,!1,!1,new h(0,0,142.5,142.5)),this.cursor="pointer",this.highlightShape.visible=!1,this.captureDisplay.visible=!1,this.sync()}sync(){this.moveable=this.selected=this.capture=this.moveToNormal=this.moveToCapture=!1,this.setHintLevel(0),this.updateState()}setRotated(e){this.rotation=e?-180:0}updateState(){this.alphaTween=this.boardDisplay.cellAlphaTween,this.selected?(this.highlightShape.fillStyle="rgba(255,255,0,0.5)",this.highlightShape.strokeStyle="rgba(255,255,0,1)",this._desiredHighlightShapeVis=!0):this.moveToCapture?(this.highlightShape.fillStyle="rgba(255,0,0,0.6)",this.highlightShape.strokeStyle="rgba(255,0,0,1)",this._desiredHighlightShapeVis=!0,this.alphaTween=this.boardDisplay.fastAlphaTween):this.moveToNormal?(this.highlightShape.fillStyle="rgba(0,255,0,0.5)",this.highlightShape.strokeStyle="rgba(0,255,0,1)",this._desiredHighlightShapeVis=!0):this.moveable?(this.highlightShape.fillStyle="rgba(255,255,255,0.5)",this.highlightShape.strokeStyle="rgba(255,255,255,1)",this._desiredHighlightShapeVis=!0):this._desiredHighlightShapeVis=!1,this._desiredCaptureShapeVis=this.capture,this.highlightShape.alpha=this.alphaTween.value}setMoveable(e){this.moveable=e,this.updateState()}setSelected(e){this.selected=e,this.updateState()}setMoveToNormal(e){this.moveToNormal=e,this.updateState()}setMoveToCapture(e){this.moveToCapture=e,this.updateState()}setCapture(e){this.capture=e,this.updateState()}clearMovingMarks(){this.moveToNormal=!1,this.moveToCapture=!1,this.capture=!1,this.updateState()}setHintLevel(e){this._hintLevel=e}update(e){this.highlightShape.alpha=this.alphaTween.value}render(e,t,i){L.showMoves?(this.highlightShape.visible=this._desiredHighlightShapeVis,this.captureDisplay.visible=this._desiredCaptureShapeVis,!this.selected&&!this.moveable&&0!==this._hintLevel&&1===this._hintLevel?this.alpha=.35:this.alpha=1):this.selected||2===this._hintLevel?(this.highlightShape.visible=this._desiredHighlightShapeVis,this.captureDisplay.visible=this._desiredCaptureShapeVis,this.alpha=1):(this.highlightShape.visible=!1,this.captureDisplay.visible=!1),super.render(e,t,i)}}class qs extends C{constructor(e){super(),this.pieceImageLayer=null,this.pieceBmp=null,this.piece=null,this.piece=e,this.addChild(this.pieceImageLayer=new C).input=new x(this.pieceImageLayer,!1,!1),this.pieceImageLayer.addChild(this.pieceBmp=new Ye(qs.getPieceImageAsset(e))),this.regX=this.pieceBmp.width/2,this.regY=this.pieceBmp.height/2,this.sync()}static getPieceImageAsset(e,t){let i,s;return s=1===arguments.length?(i=e.team,e.type):(i=e,t),0===s?w.images[0===i?"@theme/white_pawn":"@theme/black_pawn"]:1===s?w.images[0===i?"@theme/white_knight":"@theme/black_knight"]:2===s?w.images[0===i?"@theme/white_bishop":"@theme/black_bishop"]:3===s?w.images[0===i?"@theme/white_rook":"@theme/black_rook"]:4===s?w.images[0===i?"@theme/white_queen":"@theme/black_queen"]:w.images[0===i?"@theme/white_king":"@theme/black_king"]}sync(){this.piece.cell?(this.visible=!0,this.x=142.5*(this.piece.cell.c+.5),this.y=142.5*(this.piece.cell.r+.5)):this.visible=!1,this.updatePieceImage()}setRotated(e){this.rotation=e?-180:0}updatePieceImage(){this.pieceBmp.setImage(qs.getPieceImageAsset(this.piece))}}class Ws extends C{constructor(t){super(),this.teamIndicatorBmp=null,this.nameTextField=null,this.timerTextField=null,this.checkDisplay=null,this.takenPieceHolder=null,this.takenPieceDisplays=new Array(15),this.team=null,this.showingCheck=!1,this._activeTurn=2,this._timeLimit=k.None,this._time=0,this._checkTweenScaleY=null,this._checkTweenAlpha=null,this.team=t,this.teamIndicatorBmp=new Ye(w.images[0===t?"@theme/white_pawn":"@theme/black_pawn"]),this.teamIndicatorBmp.scaleX=this.teamIndicatorBmp.scaleY=90/this.teamIndicatorBmp.width,this.addChild(this.teamIndicatorBmp),this.addChild(this.takenPieceHolder=new C);Math.ceil(8);for(let e=0;e<this.takenPieceDisplays.length;++e){var i=Math.floor(e/2),s=e-2*i,n=new js(0===t?1:0);this.takenPieceDisplays[e]=n,n.x=45*s,n.y=45*i,n.scaleX=n.scaleY=45/130,this.takenPieceHolder.addChild(n)}this.nameTextField=new S("",w.fonts["AsapCondensed-SemiBold"].data,28),this.nameTextField.baseline="top",this.nameTextField.align="center",this.nameTextField.fill="#FFFFFF",this.nameTextField.underStrokeWidth=8,this.nameTextField.underStroke="#000000",this.nameTextField.x=45,this.nameTextField.y=this.teamIndicatorBmp.height*this.teamIndicatorBmp.scaleY,this.addChild(this.nameTextField),this.timerTextField=new S(u.toTimerString(0),w.fonts["RobotoMono-SemiBold"].data,30),this.timerTextField.baseline="top",this.timerTextField.align="center",this.timerTextField.fill="#FFFFFF",this.timerTextField.underStrokeWidth=8,this.timerTextField.underStroke="#000000",this.timerTextField.x=45,this.timerTextField.y=this.nameTextField.y+1.5*this.nameTextField.fontSize,this.addChild(this.timerTextField),this.checkDisplay=new Vs,this.checkDisplay.visible=!1,this.checkDisplay.scaleY=0,this.checkDisplay.alpha=0,this.addChild(this.checkDisplay),this.takenPieceHolder.y=this.timerTextField.y+1.5*this.timerTextField.fontSize+8,this.regY=this.teamIndicatorBmp.height*this.teamIndicatorBmp.scaleY}sync(t,i){let s="";if(0===i.gameState.gameMode||3===i.gameState.gameMode)s=!0===i.gameState.firstPlayerWhite?0===this.team?"Player":"Computer":1===this.team?"Player":"Computer";else if(1===i.gameState.gameMode)s=!0===i.gameState.firstPlayerWhite?0===this.team?"Player 1":"Player 2":1===this.team?"Player 1":"Player 2";else{let e=i.players[0];i.players[1].sessionId===t.sessionId&&(e=i.players[1]),s=e.team===this.team?"You":"Them"}this.nameTextField.text=s;for(let e=0;e<this.takenPieceDisplays.length;++e)e>=i.gameState.teams[this.team].takenPieces.length?this.takenPieceDisplays[e].clearPieaceType():this.takenPieceDisplays[e].setPieceType(i.gameState.teams[this.team].takenPieces[e]);this._timeLimit=i.gameState.timeLimit,this.setTime(i.gameState.teams[this.team].time),this.setActiveTurn(2)}takePiece(t){for(let e=0;e<this.takenPieceDisplays.length;++e)if(null===this.takenPieceDisplays[e].pieceType){this.takenPieceDisplays[e].setPieceType(t);break}}setActiveTurn(e){this._activeTurn=e,this.updateTextColors()}setLeft(e){this.regX=e?106:-16}setCheck(e,t){e?(t?this.showingCheck||(this._checkTweenScaleY=new o(this.checkDisplay.scaleY,1,200,0,a.Overshoot.eastOutPct30),this._checkTweenAlpha=new o(this.checkDisplay.alpha,1,150,0),new f(w.sounds.check.data).play()):(this._checkTweenScaleY=null,this._checkTweenAlpha=null,this.checkDisplay.scaleY=1,this.checkDisplay.alpha=1),this.checkDisplay.visible=!0,this.showingCheck=!0):(t?this.showingCheck&&(this._checkTweenScaleY=new o(this.checkDisplay.scaleY,0,150,0,a.Quadratic.easeIn),this._checkTweenAlpha=new o(this.checkDisplay.alpha,0,100,0,a.Quadratic.easeIn)):(this._checkTweenScaleY=null,this._checkTweenAlpha=null,this.checkDisplay.scaleY=0,this.checkDisplay.alpha=0,this.checkDisplay.visible=!1),this.showingCheck=!1)}setTime(i,s=!0){var n=this._time;if(this._time=i,this._timeLimit===k.None)this.timerTextField.text=u.toTimerString(i);else{let t=this._timeLimit-i;t<0&&(t=0),t/=1e3,t=Math.ceil(t);i=t;if(t*=1e3,!s&&y.isActive){let e=this._timeLimit-n;e<0&&(e=0),e/=1e3,e=Math.ceil(e);s=e;e*=1e3,i<s&&i<=10&&(n=new f(w.sounds.countdown.data),n.volume=.1+(10-t/1e3)/10*.9,n.play())}this.timerTextField.text=u.toTimerString(t)}this.updateTextColors()}updateTextColors(){if(2===this._activeTurn)this.nameTextField.fill="#FFFFFF",this.timerTextField.fill="#FFFFFF";else if(this._activeTurn===this.team)if(this.nameTextField.fill="#00FF00",this._timeLimit===k.None)this.timerTextField.fill="#00FF00";else{let e=this._timeLimit-this._time;e<0&&(e=0),e/=1e3,e=Math.ceil(e),e*=1e3,e<1e4?this.timerTextField.fill="#FF0000":e<6e4?this.timerTextField.fill="#FFA500":this.timerTextField.fill="#00FF00"}else this.nameTextField.fill="#FFFFFF",this.timerTextField.fill="#FFFFFF"}update(e){let t=!1;this._checkTweenAlpha&&(t=!0,this.checkDisplay.alpha=this._checkTweenAlpha.update(e),this._checkTweenAlpha.isFinished)&&(this._checkTweenAlpha=null),this._checkTweenScaleY&&(t=!0,this.checkDisplay.scaleY=this._checkTweenScaleY.update(e),this._checkTweenScaleY.isFinished)&&(this._checkTweenScaleY=null),!t||this._checkTweenAlpha||this._checkTweenScaleY||this.showingCheck||(this.checkDisplay.visible=!1)}}class js extends C{constructor(e){super(),this.pieceBmp=new Ye,this.pieceTeam=null,this.pieceType=null,this.pieceTeam=e,this.addChild(this.pieceBmp).visible=!1}clearPieaceType(){this.setPieceType(null)}setPieceType(e){this.pieceType=e,null===e?this.pieceBmp.visible=!1:(this.pieceBmp.setImage(qs.getPieceImageAsset(this.pieceTeam,e)),this.pieceBmp.visible=!0)}}class Vs extends C{constructor(){super(),this.strokeWidth=0,this.strokeUnderFill=!1,this.topLeftRadius=0,this.topRightRadius=0,this.bottomLeftRadius=0,this.bottomRightRadius=0,this.notchWidth=20,this.notchHeight=.67*this.notchWidth,this.rectangle=new h(0,0,90,50),this.fillStyle="#FFFFFF",this.topLeftRadius=this.topRightRadius=this.bottomLeftRadius=this.bottomRightRadius=6,this.input=new x(this,!1,!1),this.regY=this.rectangle.height+this.notchHeight,this.strokeUnderFill=!0,this.strokeStyle="#000000",this.strokeWidth=8,this.checkText=new S("CHECK",w.fonts["AsapCondensed-SemiBold"].data,32),this.checkText.baseline="middle",this.checkText.align="center",this.checkText.fill="#000000",this.checkText.x=this.rectangle.width/2,this.checkText.y=this.rectangle.height/2,this.addChild(this.checkText)}render(e,t,i){e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha=i;var s=this.rectangle.x,n=this.rectangle.y,o=this.topLeftRadius,r=this.topRightRadius,a=this.bottomRightRadius,h=this.bottomLeftRadius,l=this.rectangle.width,d=this.rectangle.height;e.beginPath(),e.moveTo(s+o,n),e.lineTo(s+l-r,n),e.quadraticCurveTo(s+l,n,s+l,n+r),e.lineTo(s+l,n+d-a),e.quadraticCurveTo(s+l,n+d,s+l-a,n+d),e.lineTo(s+l/2+this.notchWidth/2,n+d),e.lineTo(s+l/2,n+d+this.notchHeight),e.lineTo(s+l/2-this.notchWidth/2,n+d),e.lineTo(s+h,n+d),e.quadraticCurveTo(s,n+d,s,n+d-h),e.lineTo(s,n+o),e.quadraticCurveTo(s,n,s+o,n),e.closePath(),this.strokeUnderFill&&this.strokeStyle&&0<this.strokeWidth&&(e.lineJoin="round",e.lineCap="round",e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,e.stroke()),this.fillStyle&&("string"==typeof this.fillStyle?(e.fillStyle=this.fillStyle,e.fill()):(e.scale(this.rectangle.width,this.rectangle.height),e.fillStyle=this.fillStyle,e.fill(),e.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty))),!this.strokeUnderFill&&this.strokeStyle&&0<this.strokeWidth&&(e.lineJoin="round",e.lineCap="round",e.strokeStyle=this.strokeStyle,e.lineWidth=this.strokeWidth,e.stroke()),super.render(e,t,i)}}class Ys extends C{constructor(){super(),this.playerStatusDisplays=[new Ws(0),new Ws(1)],this._flipped=!1,this.addChild(this.playerStatusDisplays[0]),this.addChild(this.playerStatusDisplays[1])}sync(e,t){this.playerStatusDisplays[0].sync(e,t),this.playerStatusDisplays[1].sync(e,t)}setFlipped(e){this._flipped=e}anchor(e){let t=this.playerStatusDisplays[0],i=this.playerStatusDisplays[1];this._flipped&&(t=this.playerStatusDisplays[1],i=this.playerStatusDisplays[0]),t.setLeft(!0),t.x=e.x,i.setLeft(!1),i.x=e.x+e.width,t.y=i.y=e.y+e.height/2}update(e){this.playerStatusDisplays[0].update(e),this.playerStatusDisplays[1].update(e)}}class Xs extends Qe{constructor(e,t){super(),this.base=null,this.pieceHolder=null,this.pieceBmp=null,this.labelText=null,this.team=null,this.type=null,this.team=e,this.type=t;this.base=new T(0,0,180,250,12,"#111111"),this.base.strokeStyle="#222222",this.base.strokeWidth=2,this.addChild(this.base),this.base.visible=!1,this.input.hitArea=new h(0,0,this.base.rectangle.width,this.base.rectangle.height),this.input.pointerChildrenEnabled=!1,this.pieceHolder=new C,this.addChild(this.pieceHolder),this.pieceBmp=new Ye(qs.getPieceImageAsset(e,t)),this.pieceBmp.scaleX=this.pieceBmp.scaleY=160/130,this.pieceHolder.addChild(this.pieceBmp),this.pieceHolder.regX=80,this.pieceHolder.regY=80,this.pieceHolder.x=90,this.pieceHolder.y=90,this.labelText=new S(Ni[this.type],w.fonts["AsapCondensed-SemiBold"].data,44),this.labelText.fill="#FFFFFF",this.labelText.align="center",this.labelText.baseline="top",this.labelText.x=90,this.labelText.y=176,this.addChild(this.labelText)}up(){this.pieceHolder.scaleX=this.pieceHolder.scaleY=1,this.base.strokeStyle="#222222",this.base.strokeWidth=2,super.up()}down(){this.pieceHolder.scaleX=this.pieceHolder.scaleY=1.05,this.base.strokeStyle="#FFFFFF",this.base.strokeWidth=2,super.down()}over(){this.pieceHolder.scaleX=this.pieceHolder.scaleY=1.1,this.base.strokeStyle="#FFFFFF",this.base.strokeWidth=2,super.over()}}class Js{static main(e){p.onMessage.add(this.Thread_onMessage,this)}static Thread_onMessage(e){var s=new $i;s.unpack(e.data.packedGameState);let t=0;var i=e.data.maxTime;t=3===e.data.difficulty?64:2===e.data.difficulty?3:1===e.data.difficulty?2:1;let n="";for(let i=0;i<s.board.grid.length;++i){let t=0;for(let e=0;e<s.board.grid.length;++e){var o=s.board.grid[i][e];o.piece?(0<t&&(n+=t,t=0),n+=Gi[o.piece.team][o.piece.type]):t++}0<t&&(n+=t),i+1<s.board.grid.length&&(n+="/")}n+=" "+(0===s.team?"w":"b");var e=s.teams[0].kingMoved||s.teams[0].kingSideRookMoved?"":"K",r=s.teams[0].kingMoved||s.teams[0].queenSideRookMoved?"":"Q",a=s.teams[1].kingMoved||s.teams[1].kingSideRookMoved?"":"k",h=s.teams[1].kingMoved||s.teams[1].queenSideRookMoved?"":"q",a=(n+=" "+(e+r+a+h||"-"),0<=s.iDestLastMove&&0===s.board.cells[s.iDestLastMove].piece.type&&16===Math.abs(s.iDestLastMove-s.iSrcLastMove)?(e=Math.floor(s.iDestLastMove/8),r=s.iDestLastMove%8,n+=" "+["a","b","c","d","e","f","g","h"][r]+(7-e)):n+=" -",n+=" 0",n+=" 0",Xi.setBoard(n),Xi.searchTimeAndDepth(i,t)),h=Xi.moveToString(a),r=["a","b","c","d","e","f","g","h"].indexOf(h.charAt(0)),e=8-parseInt(h.charAt(1)),l=8*e+r,i=["a","b","c","d","e","f","g","h"].indexOf(h.charAt(2)),a=8-parseInt(h.charAt(3)),d=8*a+i,c=M.getMoves(s);let u=null;for(let e=0;e<c.count&&(u=c.list[e],u.iSrc!==l||u.iDest!==d);++e);p.sendMessage("done",new Ks(u))}}Js.classpath="AI";class Ks{constructor(e){this.type=0,this.iSrc=0,this.iDest=0,this.iCapture=-1,this.isPromotion=!1,this.aiPromoteTo=null,this.type=e.type,this.iSrc=e.iSrc,this.iDest=e.iDest,this.iCapture=e.iCapture,this.isPromotion=e.isPromotion,this.aiPromoteTo=e.aiPromoteTo}}p.register(Js);class Qs{constructor(e=null){this.isPresent=!1,this.sessionId=null,this.wantsReplay=!1,this.team=null,this.team=e}pack(){var e=new Array(3);return e[0]=this.isPresent,e[1]=this.sessionId,e[2]=this.wantsReplay,e}validate(e,t){return"object"!=typeof e||null===e?this.validateError("data is not a valid object",t):3!==e.length?this.validateError("data is incorrect length",t):("boolean"!=typeof e[0]&&this.validateError("isPresent is invalid",t),e[0]?"string"!=typeof e[1]&&this.validateError("session id not specified while player is present",t):"string"!=typeof e[1]&&this.validateError("session id specified while player is not present",t),"boolean"!=typeof e[2]&&this.validateError("wantsReplay is invalid",t),!0)}validateError(e,t){return t&&console.log("GameplayRoomPlayer.validate error: "+e),!1}unpack(e){this.isPresent=e[0],this.sessionId=e[1],this.wantsReplay=e[2]}matches(e,t){return this.isPresent!==e[0]?this.matchesError("isPresent",t):this.sessionId!==e[1]?this.matchesError("sessionId",t):this.wantsReplay===e[2]||this.matchesError("wantsReplay",t)}matchesError(e,t){return t&&console.log("GameplayRoomPlayer.matches error: "+e),!1}}class Zs{constructor(e,t){if(this.isLocal=null,this.isPublic=null,this.players=[new Qs(0),new Qs(1)],this.gameState=null,this.isLocal=e,"PrivateGameplay"===t)this.isPublic=!1;else{if("PublicGameplay"!==t)throw new Error("Unsuported gameRoomType: "+t);this.isPublic=!0}if(this.isLocal&&this.isPublic)throw new Error("Local rooms should never be public!")}initialize(e,t){if("object"!=typeof e||null===e)return this.initializeError("options is not a valid object",t);if(0===e.gameMode||1===e.gameMode||3===e.gameMode){if(!this.isLocal)return this.initializeError("Local game rooms can only exist on local servers",t);if(this.isPublic)return this.initializeError("Local game rooms must be private",t);if(this.gameState=new $i,!this.gameState.validate(e.packedGameState,t))return this.initializeError("options.packedGameState invalid",t);if(this.gameState.unpack(e.packedGameState),this.gameState.gameMode!==e.gameMode)return this.initializeError("options.gameMode does not match options.packedGameState",t)}else{if(4!==e.gameMode)return this.initializeError("options.gameMode not supported",t);if(this.isLocal)return this.initializeError("Remote game rooms can only exist on remote servers",t);if(this.gameState=new $i(4),!M.newGame(this.gameState,t))return!1}return!0}initializeError(e,t){return t&&console.log("GameplayRoomState.initialize error: "+e),!1}isGameFull(){return this.players[0].isPresent&&this.players[1].isPresent}isPrivateOnline(){return!this.isLocal&&!this.isPublic}pack(){var e=new Array(3);return e[0]=this.players[0].pack(),e[1]=this.players[1].pack(),e[2]=this.gameState.pack(),e}validate(e,t){return"object"!=typeof e||null===e?this.validateError("data is not a valid object",t):3!==e.length?this.validateError("data is incorrect length",t):!!this.players[0].validate(e[0],t)&&!!this.players[1].validate(e[1],t)&&!!this.gameState.validate(e[2],t)}validateError(e,t){return t&&console.log("GameplayRoomState.validate error: "+e),!1}unpack(e){this.players[0].unpack(e[0]),this.players[1].unpack(e[1]),this.gameState.unpack(e[2])}matches(e,t){return!!this.players[0].matches(e[0],t)&&!!this.players[1].matches(e[1],t)&&!!this.gameState.matches(e[2],t)}matchesError(e,t){return t&&console.log("GameplayRoomState.matches error: "+e),!1}}class en extends class{constructor(e){this.room=e,this.isLocalGameServerRoom=!!e.__FLAG_IS_LOCAL_GAME_SERVER_ROOM}}{constructor(){super(...arguments),this._numJoined=0,this._roomState=null}onCreate(e){en.debug&&console.log("GameplayRoomController.onCreate",this.room.id,e),this._roomState=new Zs(this.isLocalGameServerRoom,this.room.type),this._roomState.initialize(e,en.debug)?this.isLocalGameServerRoom?this.room.maxClients=1:this.room.maxClients=2:(en.debug&&console.log("   Failed to initialize room state, destroying the room"),this.room.disconnect())}onAuth(e,t,i){return en.debug&&console.log("GameplayRoomController.onAuth",this.room.id,t),!(this._numJoined>=this.room.maxClients&&(en.debug&&console.log("   Rejecting authenticating client, game room is full"),1))}onJoin(e,t,i){if(en.debug&&console.log("GameplayRoomController.onJoin",this.room.id,t),this._numJoined>=this.room.maxClients)en.debug&&console.log("   Rejecting joining client, game room is full"),e.leave(4300,"Too many clients");else{this._numJoined++,this._numJoined>=this.room.maxClients&&this.room.lock();t=this._roomState.pack();if(this.room.maxClients<=1)this._roomState.players[0].isPresent=this._roomState.players[1].isPresent=!0,this._roomState.players[0].sessionId=this._roomState.players[1].sessionId=e.sessionId;else for(var s of this._roomState.players)if(null===s.sessionId){s.isPresent=!0,s.sessionId=e.sessionId;break}this.room.broadcast("Join",{preState:t,sessionId:e.sessionId})}}onLeave(e,t){en.debug&&console.log("GameplayRoomController.onLeave",this.room.id,e.sessionId,t);var i,t=this._roomState.pack();for(i of this._roomState.players)i.sessionId===e.sessionId&&(i.isPresent=!1,i.sessionId=null);let s=!0;this.isLocalGameServerRoom||this._roomState.isPublic||(s=!1),this.room.broadcast("Leave",{preState:t,sessionId:e.sessionId,terminating:s}),s?this.room.disconnect():(this._numJoined--,this._numJoined<this.room.maxClients&&this.room.unlock())}onMessage(t,e,i){en.debug&&console.log("GameplayRoomController.onMessage",this.room.id,t.sessionId,e,i.playerIndex);var s=this._roomState.players[i.playerIndex];if(s)if(s.isPresent)if(s.sessionId!==t.sessionId)en.debug&&console.log("   Booting them, Incorrect player!"),t.leave(1e3,"Incorrect player");else if(0!==s.team&&1!==s.team)en.debug&&console.log("Booting them, Not a player 2!"),t.leave(1e3,"Not a player 2");else{s=this._roomState.pack();if("SetActivePiece"===e){var n=i,o=this._roomState.pack();M.canSetActivePiece(this._roomState.gameState,n.cellIndex,this._roomState.players[n.playerIndex].team,en.debug)?this.room.broadcast("SetActivePiece",{preState:o,cellIndex:n.cellIndex},{except:t}):this.syncClient(t,o,"Set active piece disallowed")}else if("TimeUp"===e){n=i,o=this._roomState.pack();M.timeUp(this._roomState.gameState,this._roomState.players[n.playerIndex].team,en.debug)?this.room.broadcast("TimeUp",{preState:o},{except:t}):this.syncClient(t,o,"Time up disallowed")}else if("Move"===e){n=i,o=this._roomState.pack();M.move(this._roomState.gameState,this._roomState.players[n.playerIndex].team,n.type,n.iSrc,n.iDest,n.iCapture,n.isPromotion,n.teamTime,en.debug)?this.room.broadcast("Move",{preState:o,type:n.type,iSrc:n.iSrc,iDest:n.iDest,iCapture:n.iCapture,isPromotion:n.isPromotion,teamTime:n.teamTime},{except:t}):this.syncClient(t,o,"Move disallowed")}else if("Promote"===e){n=i,o=this._roomState.pack();M.promote(this._roomState.gameState,this._roomState.players[n.playerIndex].team,n.chosen)?this.room.broadcast("Promote",{preState:o,chosen:n.chosen},{except:t}):this.syncClient(t,o,"Promote disallowed")}else if("Hint"===e)0===this._roomState.gameState.gameMode&&(this._roomState.gameState.penalty+=6e4);else if("Undo"===e){n=i;this._roomState.gameState.unpack(n.postGameState)}else if("Replay"===e){o=this._roomState.pack();if(M.isGameOver(this._roomState.gameState)){for(var r of this._roomState.players)r.sessionId===t.sessionId&&(r.wantsReplay=!0);let e=!0;for(var a of this._roomState.players)a.wantsReplay||(e=!1);if(e){M.newGame(this._roomState.gameState,en.debug);for(var h of this._roomState.players)h.wantsReplay=!1;this.room.broadcast("Replay",{preState:o,postState:this._roomState.pack()})}}else this.syncClient(t,s,"Game is not over")}else this.syncClient(t,s,"Unknown message type.")}else en.debug&&console.log("   Booting them, Player not present!"),t.leave(1e3,"Player not present");else en.debug&&console.log("   Booting them, Not a player!"),t.leave(1e3,"Not a player")}syncClient(e,t,i){en.debug&&console.log("   Disallowing and syncing client:",i),e.send("Sync",{preState:t})}}en.debug=!1,xi.define("PublicGameplay",en),xi.define("PrivateGameplay",en);class R extends P{constructor(){super(R,Ps);let e=location.host,t=(0===e.indexOf("www.")&&(e=e.replace("www.","")),window.games247.nativeAppType||0<=Ri.production.allowedDomains.indexOf(e)?R.remoteHost=Ri.production:0<=Ri.staging.allowedDomains.indexOf(e)?R.remoteHost=Ri.staging:(0<=Ri.development.allowedDomains.indexOf(e)||l.info("Could not identify game server host using allowedDomains, falling back to dev"),R.remoteHost=Ri.development),l.info("Chose Game Server Host: "+R.remoteHost.envName),this._usesDailyChallenge=!0,this._usesMultiplayerGameModes=!1,Qi.load(),L.load(),O.load(),Ki.load(),B.load(),window.games247.nativeAppType&&(L.fullscreen=!1),n.preferFullscreen=L.fullscreen,_.isMuted=L.mute,w.sounds["turn-notification"].data.volume=.35,n.closeSplash(),new f(w.sounds.welcome.data).play(),null);for(var i of this.urlVars)0===i.indexOf("room=")&&i.replace("room=","").length===xi.roomIdLength&&(t=i.replace("room=",""));var s;t?(s=new Ji(4,!1,t),this.screenManager.add(new As(s,!0,!1))):this.screenManager.add(new Rs(!1))}cancelExpanderFullscreen(){L.fullscreen=!1,L.save()}calcStarRating(e,t){return null==e?0:0===t||1===t||2===t?e<3e5?3:e<6e5?2:1:3!==t||e<3e5?3:e<6e5?2:1}static main(){new R}}R.localServer=new Si("local")})();